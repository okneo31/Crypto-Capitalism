<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CryptoEconomy - Ïã§Ï†ú Í≤ΩÏ†ú ÏãúÎÆ¨Î†àÏù¥ÏÖò Í≤åÏûÑ</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üí∞</text></svg>">
    
    <!-- Supabase ÌÅ¥ÎùºÏù¥Ïñ∏Ìä∏ -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;900&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --primary: #6366f1;
            --secondary: #8b5cf6;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --dark: #0f172a;
            --light: #f8fafc;
            --btc: #f7931a;
            --eth: #627eea;
            --bnb: #f3ba2f;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: #e2e8f0;
            min-height: 100vh;
        }
        
        /* Setup Screen */
        .setup-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }
        
        .setup-box {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 40px;
            width: 100%;
            max-width: 500px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }
        
        .setup-logo {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .setup-logo h1 {
            font-size: 2.5rem;
            font-weight: 900;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .setup-info {
            background: rgba(99, 102, 241, 0.1);
            border: 1px solid rgba(99, 102, 241, 0.3);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
        }
        
        .setup-info h3 {
            color: var(--primary);
            margin-bottom: 10px;
        }
        
        .setup-info p {
            color: #cbd5e1;
            line-height: 1.6;
            margin-bottom: 10px;
        }
        
        /* Login Screen */
        .login-container {
            display: none;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }
        
        .login-box {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 40px;
            width: 100%;
            max-width: 450px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }
        
        .login-logo {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .login-logo h1 {
            font-size: 2.5rem;
            font-weight: 900;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .login-logo p {
            color: #94a3b8;
            margin-top: 10px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            color: #cbd5e1;
            font-size: 0.9rem;
        }
        
        .form-input {
            width: 100%;
            padding: 12px 16px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            color: white;
            font-size: 1rem;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: var(--primary);
            background: rgba(255, 255, 255, 0.08);
        }
        
        .btn {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(99, 102, 241, 0.3);
        }
        
        .btn-secondary {
            background: transparent;
            border: 1px solid rgba(255, 255, 255, 0.2);
            margin-top: 10px;
        }
        
        /* Role Selection */
        .role-selection {
            display: none;
            padding: 40px;
        }
        
        .role-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        
        .role-card {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid transparent;
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .role-card:hover {
            border-color: var(--primary);
            background: rgba(255, 255, 255, 0.08);
            transform: translateY(-5px);
        }
        
        .role-card.selected {
            border-color: var(--success);
            background: rgba(16, 185, 129, 0.1);
        }
        
        .role-icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }
        
        .role-name {
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 10px;
        }
        
        .role-desc {
            font-size: 0.9rem;
            color: #94a3b8;
        }
        
        /* Main Game Container */
        .game-container {
            display: none;
            padding: 20px;
        }
        
        /* Top Bar */
        .top-bar {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .user-avatar {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1.2rem;
        }
        
        .user-details h3 {
            font-size: 1.1rem;
            margin-bottom: 3px;
        }
        
        .user-role {
            font-size: 0.9rem;
            color: #94a3b8;
        }
        
        .balance-display {
            display: flex;
            gap: 30px;
            align-items: center;
        }
        
        .balance-item {
            text-align: center;
        }
        
        .balance-label {
            font-size: 0.8rem;
            color: #94a3b8;
            margin-bottom: 5px;
        }
        
        .balance-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--success);
        }
        
        /* Game Board */
        .game-board {
            display: grid;
            grid-template-columns: 250px 1fr 300px;
            gap: 20px;
        }
        
        @media (max-width: 1200px) {
            .game-board {
                grid-template-columns: 1fr;
            }
        }
        
        /* Sidebar */
        .sidebar {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
        }
        
        .menu-item {
            display: block;
            width: 100%;
            padding: 12px;
            background: none;
            border: none;
            color: #94a3b8;
            text-align: left;
            border-radius: 8px;
            margin-bottom: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .menu-item:hover {
            background: rgba(255, 255, 255, 0.05);
            color: white;
        }
        
        .menu-item.active {
            background: var(--primary);
            color: white;
        }
        
        /* Main Content */
        .main-content {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 25px;
        }
        
        .content-header {
            margin-bottom: 25px;
        }
        
        .content-title {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 10px;
        }
        
        .content-subtitle {
            color: #94a3b8;
        }
        
        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 20px;
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: #94a3b8;
            margin-bottom: 10px;
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: 700;
        }
        
        /* Action Grid */
        .action-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .action-btn {
            padding: 15px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(99, 102, 241, 0.3);
        }
        
        /* Business Card */
        .business-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .business-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .business-name {
            font-size: 1.3rem;
            font-weight: 600;
        }
        
        .business-profit {
            color: var(--success);
            font-weight: 700;
        }
        
        /* Loan Applications */
        .loan-card {
            padding: 15px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 10px;
            margin-bottom: 15px;
        }
        
        .loan-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .loan-applicant {
            font-weight: 600;
        }
        
        .loan-amount {
            color: var(--primary);
            font-weight: 700;
        }
        
        .loan-actions {
            display: flex;
            gap: 10px;
        }
        
        .loan-actions .btn {
            flex: 1;
            padding: 8px;
            font-size: 0.9rem;
        }
        
        /* Market Sidebar */
        .market-sidebar {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
        }
        
        .market-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 20px;
        }
        
        .market-item {
            padding: 12px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 8px;
            margin-bottom: 10px;
        }
        
        .market-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px;
        }
        
        .market-item-name {
            font-weight: 600;
        }
        
        .market-item-price {
            color: var(--success);
        }
        
        .market-item-change {
            font-size: 0.9rem;
            color: var(--success);
        }
        
        .market-item-change.negative {
            color: var(--danger);
        }
        
        /* Notification */
        .notification {
            position: fixed;
            bottom: 20px;
            right: -400px;
            background: #1e293b;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 20px;
            max-width: 350px;
            transition: right 0.3s ease-in-out;
            z-index: 1000;
        }
        
        .notification.show {
            right: 20px;
        }
        
        .notification.success {
            border-left: 4px solid var(--success);
        }
        
        .notification.error {
            border-left: 4px solid var(--danger);
        }
        
        .notification.info {
            border-left: 4px solid var(--primary);
        }
        
        .notification.warning {
            border-left: 4px solid var(--warning);
        }
        
        /* Leaderboard */
        .leaderboard-list {
            margin-top: 20px;
        }
        
        .leaderboard-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 8px;
            margin-bottom: 10px;
        }
        
        .leaderboard-rank {
            font-weight: 700;
            color: var(--warning);
            margin-right: 15px;
        }
        
        .leaderboard-name {
            flex: 1;
        }
        
        .leaderboard-balance {
            color: var(--success);
            font-weight: 700;
        }
    </style>
</head>
<body>
    <!-- Setup Screen (Ï≤òÏùå Î≥¥Ïù¥Îäî ÌôîÎ©¥) -->
    <div class="setup-container" id="setupScreen">
        <div class="setup-box">
            <div class="setup-logo">
                <h1>üí∞ CryptoEconomy</h1>
                <p>Ïã§Ï†ú ÏïîÌò∏ÌôîÌèê Í≤ΩÏ†ú ÏãúÎÆ¨Î†àÏù¥ÏÖò</p>
            </div>
            
            <div class="setup-info">
                <h3>üéÆ Í≤åÏûÑ ÏãúÏûëÌïòÍ∏∞</h3>
                <p>Îç∞Î™® Î™®ÎìúÎ°ú Î∞îÎ°ú ÌîåÎ†àÏù¥ÌïòÍ±∞ÎÇò</p>
                <p>SupabaseÎ•º Ïó∞ÎèôÌïòÏó¨ Î©ÄÌã∞ÌîåÎ†àÏù¥Ïñ¥Î°ú Ï¶êÍ∏∞ÏÑ∏Ïöî!</p>
            </div>
            
            <button class="btn" id="playDemoBtn" style="margin-bottom: 10px;">üéØ Îç∞Î™® Î™®ÎìúÎ°ú ÏãúÏûë</button>
            
            <button class="btn btn-secondary" id="supabaseSetupBtn" style="
                background: linear-gradient(135deg, #3b82f6, #1d4ed8) !important;
                color: white !important;
                border: none !important;
                padding: 12px 24px !important;
                font-weight: 600 !important;
                cursor: pointer !important;
                margin-bottom: 15px;
            ">üîó Supabase Ïó∞ÎèôÌïòÍ∏∞</button>
            
            <div id="supabaseSetup" style="display: none; margin-top: 20px; padding: 20px; background: rgba(59, 130, 246, 0.1); border: 1px solid rgba(59, 130, 246, 0.3); border-radius: 12px;">
                <h3 style="color: var(--primary); margin-bottom: 15px; text-align: center;">üîó Supabase Ïó∞Îèô ÏÑ§Ï†ï</h3>
                
                <div class="form-group">
                    <label class="form-label">Supabase URL</label>
                    <input type="text" class="form-input" id="supabaseUrl" 
                           placeholder="https://xxxxx.supabase.co" style="margin-bottom: 10px;">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Supabase Anon Key</label>
                    <input type="text" class="form-input" id="supabaseKey" 
                           placeholder="eyJhbGc..." style="margin-bottom: 15px;">
                </div>
                
                <div style="text-align: center; margin-top: 15px;">
                    <button class="btn" id="setupSupabaseBtn" style="
                        background: var(--success) !important;
                        color: white !important;
                        padding: 12px 24px !important;
                        font-weight: 600 !important;
                        margin-right: 10px;
                    ">‚úÖ Ïó∞Îèô ÏôÑÎ£å</button>
                    
                    <button class="btn btn-secondary" id="cancelSupabaseBtn" style="
                        background: rgba(107, 114, 128, 0.8) !important;
                        color: white !important;
                        padding: 12px 24px !important;
                    ">‚ùå Ï∑®ÏÜå</button>
                </div>
                
                <div style="margin-top: 15px; padding: 10px; background: rgba(245, 158, 11, 0.1); border: 1px solid rgba(245, 158, 11, 0.3); border-radius: 8px;">
                    <p style="color: #f59e0b; margin: 0; font-size: 0.8rem; text-align: center;">
                        üí° Supabase ÌîÑÎ°úÏ†ùÌä∏Î•º ÏÉùÏÑ±ÌïòÍ≥† ÏúÑÏùò Ï†ïÎ≥¥Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî
                    </p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Login Screen -->
    <div class="login-container" id="loginScreen">
        <div class="login-box">
            <div class="login-logo">
                <h1>üí∞ CryptoEconomy</h1>
                <p>Ïã§Ï†ú ÏïîÌò∏ÌôîÌèê Í≤ΩÏ†ú ÏãúÎÆ¨Î†àÏù¥ÏÖò</p>
            </div>
            
            <div class="form-group">
                <label class="form-label">Ïù¥Î©îÏùº</label>
                <input type="email" class="form-input" id="email" placeholder="your@email.com">
            </div>
            
            <div class="form-group">
                <label class="form-label">ÏÇ¨Ïö©ÏûêÎ™Ö (Í≤åÏûÑ ÎÇ¥ ÎãâÎÑ§ÏûÑ)</label>
                <input type="text" class="form-input" id="username" placeholder="ÏõêÌïòÎäî ÎãâÎÑ§ÏûÑ (3Ïûê Ïù¥ÏÉÅ)">
            </div>
            
            <div class="form-group">
                <label class="form-label">ÎπÑÎ∞ÄÎ≤àÌò∏</label>
                <input type="password" class="form-input" id="password" placeholder="ÎπÑÎ∞ÄÎ≤àÌò∏ (ÏµúÏÜå 6Ïûê)">
            </div>
            
            <button class="btn" id="loginBtn">Î°úÍ∑∏Ïù∏ / ÌöåÏõêÍ∞ÄÏûÖ</button>
            <button class="btn btn-secondary" id="loginHelpBtn">Ï≤òÏùåÏù¥Ïã†Í∞ÄÏöî?</button>
            <button class="btn btn-secondary" id="loginAsGuestBtn">Í≤åÏä§Ìä∏Î°ú ÌîåÎ†àÏù¥</button>
        </div>
    </div>
    
    <!-- Role Selection -->
    <div class="role-selection" id="roleSelection">
        <div class="login-box" style="max-width: 800px;">
            <h2 style="text-align: center; margin-bottom: 10px;">Ïó≠Ìï†ÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</h2>
            <p style="text-align: center; color: #94a3b8; margin-bottom: 30px;">
                ÏùÄÌñâÏû•ÏùÄ 1Î™ÖÎßå Í∞ÄÎä•Ìï©ÎãàÎã§ (ÏÑ†Ï∞©Ïàú)
            </p>
            
            <div class="role-grid">
                <div class="role-card" onclick="selectRole('banker')" id="role-banker">
                    <div class="role-icon">üè¶</div>
                    <div class="role-name">ÏùÄÌñâÏû•</div>
                    <div class="role-desc">ÏùÄÌñâ Ïö¥ÏòÅ, ÎåÄÏ∂ú ÏäπÏù∏, Í∏àÎ¶¨ Í≤∞Ï†ï</div>
                </div>
                
                <div class="role-card" onclick="selectRole('entrepreneur')" id="role-entrepreneur">
                    <div class="role-icon">üíº</div>
                    <div class="role-name">ÏÇ¨ÏóÖÍ∞Ä</div>
                    <div class="role-desc">ÏÇ¨ÏóÖ Ïö¥ÏòÅ, Ìà¨Ïûê, Í±∞Îûò</div>
                </div>
                
                <div class="role-card" onclick="selectRole('investor')" id="role-investor">
                    <div class="role-icon">üìà</div>
                    <div class="role-name">Ìà¨ÏûêÏûê</div>
                    <div class="role-desc">Ï£ºÏãù, Î∂ÄÎèôÏÇ∞, ÏïîÌò∏ÌôîÌèê Ìà¨Ïûê</div>
                </div>
                
                <div class="role-card" onclick="selectRole('worker')" id="role-worker">
                    <div class="role-icon">üë∑</div>
                    <div class="role-name">ÏßÅÏû•Ïù∏</div>
                    <div class="role-desc">ÏïàÏ†ïÏ†Å ÏàòÏûÖ, Ï†ÄÏ∂ï, ÎåÄÏ∂ú</div>
                </div>
            </div>
            
            <button class="btn" style="margin-top: 30px;" onclick="confirmRole()">ÏÑ†ÌÉù ÏôÑÎ£å</button>
        </div>
    </div>
    
    <!-- Main Game -->
    <div class="game-container" id="gameContainer">
        <!-- Top Bar -->
        <div class="top-bar">
            <div class="user-info">
                <div class="user-avatar" id="userAvatar">A</div>
                <div class="user-details">
                    <h3 id="userName">Player</h3>
                    <div class="user-role" id="userRole">Ïó≠Ìï†</div>
                </div>
            </div>
            
            <div class="balance-display">
                <div class="balance-item">
                    <div class="balance-label">ÏÇ¨Ïö©Ïûê</div>
                    <div class="balance-value" id="currentUserName" style="font-size: 1.2rem; color: var(--primary);">-</div>
                    <div style="display: flex; gap: 5px; margin-top: 8px;">
                        <button onclick="showAccountMenu()" style="
                            padding: 4px 8px; background: var(--primary); 
                            color: white; border: none; border-radius: 4px; 
                            cursor: pointer; font-size: 0.8rem;
                        ">Í≥ÑÏ†ï</button>
                        <button onclick="logout()" style="
                            padding: 4px 8px; background: var(--danger); 
                            color: white; border: none; border-radius: 4px; 
                            cursor: pointer; font-size: 0.8rem;
                        ">Î°úÍ∑∏ÏïÑÏõÉ</button>
                    </div>
                </div>
                <div class="balance-item">
                    <div class="balance-label">ÎπÑÌä∏ÌÅ¨Î†àÎîß</div>
                    <div class="balance-value" id="gameBalance">0</div>
                </div>
                <div class="balance-item">
                    <div class="balance-label">Ï¥ù ÏûêÏÇ∞</div>
                    <div class="balance-value" id="totalAssets">0</div>
                </div>
                <div class="balance-item">
                    <div class="balance-label">Ïã†Ïö©Îì±Í∏â</div>
                    <div class="balance-value" id="creditGrade" style="font-size: 1.5rem;">-</div>
                    <div style="font-size: 0.9rem; margin-top: 5px;">
                        Ï†êÏàò: <span id="creditScore">-</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Game Board -->
        <div class="game-board">
            <!-- Left Sidebar -->
            <div class="sidebar">
                <button class="menu-item active" onclick="showSection('overview')">
                    üìä Í∞úÏöî
                </button>
                <button class="menu-item" onclick="showSection('bank')" id="bankMenu" style="display: none;">
                    üè¶ ÏùÄÌñâ Í¥ÄÎ¶¨
                </button>
                <button class="menu-item" onclick="showSection('business')">
                    üíº ÏÇ¨ÏóÖ
                </button>
                <button class="menu-item" onclick="showSection('investments')" id="investmentMenu" style="display: none;">
                    üìà Ìà¨Ïûê
                </button>
                <button class="menu-item" onclick="showSection('work')" id="workMenu" style="display: none;">
                    üë∑ ÏßÅÏû•
                </button>
                <button class="menu-item" onclick="showSection('p2p')">
                    ü§ù P2P Í±∞Îûò
                </button>
                <button class="menu-item" onclick="showSection('labor')">
                    üë• ÎÖ∏ÎèôÏãúÏû•
                </button>
                <button class="menu-item" onclick="showSection('loans')">
                    üí≥ ÎåÄÏ∂ú
                </button>
                <button class="menu-item" onclick="showSection('leaderboard')">
                    üèÜ ÏàúÏúÑ
                </button>
                <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid rgba(255,255,255,0.1);">
                    <button class="menu-item" onclick="changeRole()" style="background: linear-gradient(135deg, #8b5cf6, #7c3aed);">
                        üé≠ Ïó≠Ìï† Î≥ÄÍ≤Ω
                    </button>
                </div>
            </div>
            
            <!-- Main Content -->
            <div class="main-content">
                <!-- Overview Section -->
                <div id="overview-section" class="content-section">
                    <div class="content-header">
                        <h2 class="content-title">Í≤ΩÏ†ú ÌòÑÌô©</h2>
                        <p class="content-subtitle">Ïã§ÏãúÍ∞Ñ Í≤ΩÏ†ú ÏßÄÌëú</p>
                    </div>
                    
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-label">Ï¥ù Ïú†Ï†Ä</div>
                            <div class="stat-value" id="totalUsers">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Ï¥ù ÏûêÏÇ∞</div>
                            <div class="stat-value" id="totalEconomy">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">ÌôúÏÑ± ÏÇ¨ÏóÖ</div>
                            <div class="stat-value" id="totalBusinesses">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Ï¥ù ÎåÄÏ∂ú</div>
                            <div class="stat-value" id="totalLoans">0</div>
                        </div>
                    </div>
                    
                    <!-- Í≤ΩÏ†ú ÏßÄÌëú ÏÑπÏÖò -->
                    <div style="margin-top: 20px;">
                        <h3 style="color: var(--primary); margin-bottom: 15px;">üìä Í≤ΩÏ†ú ÏßÄÌëú</h3>
                        <div class="stat-grid" style="grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 10px;">
                            <div class="stat-card" style="padding: 10px;">
                                <div class="stat-label" style="font-size: 0.8rem;">Ïù∏ÌîåÎ†àÏù¥ÏÖò</div>
                                <div class="stat-value" id="inflationRate" style="font-size: 1rem;">2.5%</div>
                            </div>
                            <div class="stat-card" style="padding: 10px;">
                                <div class="stat-label" style="font-size: 0.8rem;">Í≤ΩÍ∏∞Íµ≠Î©¥</div>
                                <div class="stat-value" id="economicPhase" style="font-size: 1rem;">ÌôïÏû•Í∏∞</div>
                            </div>
                            <div class="stat-card" style="padding: 10px;">
                                <div class="stat-label" style="font-size: 0.8rem;">GDPÏÑ±Ïû•</div>
                                <div class="stat-value" id="gdpGrowth" style="font-size: 1rem;">3.2%</div>
                            </div>
                            <div class="stat-card" style="padding: 10px;">
                                <div class="stat-label" style="font-size: 0.8rem;">Ïã§ÏóÖÎ•†</div>
                                <div class="stat-value" id="unemploymentRate" style="font-size: 1rem;">4.5%</div>
                            </div>
                            <div class="stat-card" style="padding: 10px;">
                                <div class="stat-label" style="font-size: 0.8rem;">Í∏∞Ï§ÄÍ∏àÎ¶¨</div>
                                <div class="stat-value" id="interestRate" style="font-size: 1rem;">3.5%</div>
                            </div>
                            <div class="stat-card" style="padding: 10px;">
                                <div class="stat-label" style="font-size: 0.8rem;">ÏÜåÎπÑÏûêÏã†Î¢∞</div>
                                <div class="stat-value" id="consumerConfidence" style="font-size: 1rem;">75</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ÏûêÏõê & Íµ≠Í∞Ä ÌòÑÌô© ÏÑπÏÖò -->
                    <div style="margin-top: 20px;">
                        <h3 style="color: var(--success); margin-bottom: 15px;">üåç Íµ≠Í∞Ä & ÏûêÏõê ÌòÑÌô©</h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                            <!-- ÏûêÏõê ÌòÑÌô© -->
                            <div style="background: rgba(34, 34, 34, 0.6); border-radius: 12px; padding: 15px;">
                                <div id="resourceStatus">
                                    <!-- ÏûêÏõê ÏÉÅÌÉúÍ∞Ä Ïó¨Í∏∞Ïóê ÌëúÏãúÎê©ÎãàÎã§ -->
                                </div>
                            </div>
                            
                            <!-- Íµ≠Í∞Ä Í≤ΩÏ†ú ÌòÑÌô© -->
                            <div style="background: rgba(34, 34, 34, 0.6); border-radius: 12px; padding: 15px;">
                                <h4 style="color: var(--primary); margin-bottom: 15px;">üèõÔ∏è Íµ≠Í∞Ä Í≤ΩÏ†ú ÏßÄÌëú</h4>
                                <div style="display: flex; flex-direction: column; gap: 8px;">
                                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 6px; background: rgba(255,255,255,0.05); border-radius: 6px;">
                                        <span>üë• Ï¥ù Ïù∏Íµ¨</span>
                                        <span id="countryPopulation" style="font-weight: bold;">52,000,000Î™Ö</span>
                                    </div>
                                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 6px; background: rgba(255,255,255,0.05); border-radius: 6px;">
                                        <span>üìä Í≤ΩÏ†úÌôúÏÑ±ÎèÑ</span>
                                        <span id="economicActivity" style="font-weight: bold;">75%</span>
                                    </div>
                                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 6px; background: rgba(255,255,255,0.05); border-radius: 6px;">
                                        <span>üí∞ 1Ïù∏Îãπ GDP</span>
                                        <span id="gdpPerCapita" style="font-weight: bold;">$35,000</span>
                                    </div>
                                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 6px; background: rgba(255,255,255,0.05); border-radius: 6px;">
                                        <span>üí∏ ÏÜåÎπÑÏßÄÏ∂ú</span>
                                        <span id="consumerSpendingIndex" style="font-weight: bold;">80%</span>
                                    </div>
                                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 6px; background: rgba(255,255,255,0.05); border-radius: 6px;">
                                        <span>üöÄ Ï∞ΩÏóÖÎ•†</span>
                                        <span id="businessFormation" style="font-weight: bold;">15%</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="action-grid">
                        <button class="action-btn" onclick="startBusiness()">
                            üè™ ÏÇ¨ÏóÖ ÏãúÏûëÌïòÍ∏∞
                        </button>
                        <button class="action-btn" onclick="applyLoan()">
                            üí≥ ÎåÄÏ∂ú Ïã†Ï≤≠ÌïòÍ∏∞
                        </button>
                        <button class="action-btn" onclick="refreshData()">
                            üîÑ Îç∞Ïù¥ÌÑ∞ ÏÉàÎ°úÍ≥†Ïπ®
                        </button>
                    </div>
                </div>
                
                <!-- Bank Section (Bank Owner Only) -->
                <div id="bank-section" class="content-section" style="display: none;">
                    <div class="content-header">
                        <h2 class="content-title">ÏùÄÌñâ Í¥ÄÎ¶¨</h2>
                        <p class="content-subtitle">ÎåÄÏ∂ú ÏäπÏù∏, Í∏àÎ¶¨ ÏÑ§Ï†ï</p>
                    </div>
                    
                    <!-- ÏùÄÌñâ Í∏àÎ¶¨ ÏÑ§Ï†ï -->
                    <div class="stats-grid" style="margin-bottom: 30px;">
                        <div class="stat-card">
                            <div class="stat-label">Í∏∞Ï§Ä Í∏àÎ¶¨</div>
                            <div class="stat-value" id="baseRate">5.0%</div>
                            <div class="action-grid" style="margin-top: 10px; grid-template-columns: repeat(4, 1fr);">
                                <button class="action-btn" style="padding: 10px; font-size: 0.8rem;" onclick="adjustRate('base', -1)">-1%</button>
                                <button class="action-btn" style="padding: 10px; font-size: 0.8rem;" onclick="adjustRate('base', -0.1)">-0.1%</button>
                                <button class="action-btn" style="padding: 10px; font-size: 0.8rem;" onclick="adjustRate('base', 0.1)">+0.1%</button>
                                <button class="action-btn" style="padding: 10px; font-size: 0.8rem;" onclick="adjustRate('base', 1)">+1%</button>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">ÎåÄÏ∂ú Í∏àÎ¶¨</div>
                            <div class="stat-value" id="loanRate">8.0%</div>
                            <div class="action-grid" style="margin-top: 10px; grid-template-columns: repeat(4, 1fr);">
                                <button class="action-btn" style="padding: 10px; font-size: 0.8rem;" onclick="adjustRate('loan', -1)">-1%</button>
                                <button class="action-btn" style="padding: 10px; font-size: 0.8rem;" onclick="adjustRate('loan', -0.1)">-0.1%</button>
                                <button class="action-btn" style="padding: 10px; font-size: 0.8rem;" onclick="adjustRate('loan', 0.1)">+0.1%</button>
                                <button class="action-btn" style="padding: 10px; font-size: 0.8rem;" onclick="adjustRate('loan', 1)">+1%</button>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">ÏòàÍ∏à Í∏àÎ¶¨</div>
                            <div class="stat-value" id="depositRate">3.0%</div>
                            <div class="action-grid" style="margin-top: 10px; grid-template-columns: repeat(4, 1fr);">
                                <button class="action-btn" style="padding: 10px; font-size: 0.8rem;" onclick="adjustRate('deposit', -1)">-1%</button>
                                <button class="action-btn" style="padding: 10px; font-size: 0.8rem;" onclick="adjustRate('deposit', -0.1)">-0.1%</button>
                                <button class="action-btn" style="padding: 10px; font-size: 0.8rem;" onclick="adjustRate('deposit', 0.1)">+0.1%</button>
                                <button class="action-btn" style="padding: 10px; font-size: 0.8rem;" onclick="adjustRate('deposit', 1)">+1%</button>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">ÏùÄÌñâ ÏûêÏÇ∞</div>
                            <div class="stat-value" id="bankAssets">0</div>
                        </div>
                    </div>
                    
                    <!-- ÏùÄÌñâ Ï†ïÏ±Ö ÏÑ§Ï†ï -->
                    <div style="background: rgba(255, 255, 255, 0.05); border-radius: 10px; padding: 20px; margin-bottom: 30px;">
                        <h3 style="margin-bottom: 20px;">ÏùÄÌñâ Ï†ïÏ±Ö</h3>
                        <div class="action-grid">
                            <button class="action-btn" onclick="setBankPolicy('conservative')">
                                üõ°Ô∏è Î≥¥ÏàòÏ†Å Ï†ïÏ±Ö
                                <div style="font-size: 0.8rem; margin-top: 5px;">ÎÇÆÏùÄ ÏúÑÌóò, ÎÇÆÏùÄ ÏàòÏùµ</div>
                            </button>
                            <button class="action-btn" onclick="setBankPolicy('balanced')">
                                ‚öñÔ∏è Í∑†Ìòï Ï†ïÏ±Ö
                                <div style="font-size: 0.8rem; margin-top: 5px;">Ï§ëÍ∞Ñ ÏúÑÌóò, Ï§ëÍ∞Ñ ÏàòÏùµ</div>
                            </button>
                            <button class="action-btn" onclick="setBankPolicy('aggressive')">
                                üöÄ Í≥µÍ≤©Ï†Å Ï†ïÏ±Ö
                                <div style="font-size: 0.8rem; margin-top: 5px;">ÎÜíÏùÄ ÏúÑÌóò, ÎÜíÏùÄ ÏàòÏùµ</div>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Í≥†Í∏â ÏùÄÌñâ Í∏∞Îä• -->
                    <div style="background: rgba(255, 255, 255, 0.05); border-radius: 10px; padding: 20px; margin-bottom: 30px;">
                        <h3 style="margin-bottom: 20px;">Í≥†Í∏â ÏùÄÌñâ Í∏∞Îä•</h3>
                        <div class="action-grid">
                            <button class="action-btn" onclick="issueGovernmentBond()">
                                üèõÔ∏è Íµ≠Ï±Ñ Î∞úÌñâ
                                <div style="font-size: 0.8rem; margin-top: 5px;">ÏïàÏ†ÑÌïú Ìà¨Ïûê ÏÉÅÌíà</div>
                            </button>
                            <button class="action-btn" onclick="adjustMoneySupply()">
                                üí∞ ÌÜµÌôîÎüâ Ï°∞Ï†à
                                <div style="font-size: 0.8rem; margin-top: 5px;">Í≤ΩÏ†ú ÏïàÏ†ïÌôî</div>
                            </button>
                            <button class="action-btn" onclick="provideLoanGuarantee()">
                                üõ°Ô∏è ÎåÄÏ∂ú Î≥¥Ï¶ù
                                <div style="font-size: 0.8rem; margin-top: 5px;">Ï§ëÏÜåÍ∏∞ÏóÖ ÏßÄÏõê</div>
                            </button>
                            <button class="action-btn" onclick="createSpecialProduct()">
                                ‚≠ê ÌäπÎ≥Ñ Í∏àÏúµÏÉÅÌíà
                                <div style="font-size: 0.8rem; margin-top: 5px;">Í≥†ÏàòÏùµ ÏÉÅÌíà Ï∂úÏãú</div>
                            </button>
                        </div>
                    </div>
                    
                    <!-- ÏùÄÌñâ ÌÜµÍ≥Ñ -->
                    <div style="background: rgba(255, 255, 255, 0.05); border-radius: 10px; padding: 20px; margin-bottom: 30px;">
                        <h3 style="margin-bottom: 20px;">ÏùÄÌñâ ÌÜµÍ≥Ñ</h3>
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-label">Ï¥ù ÎåÄÏ∂úÏï°</div>
                                <div class="stat-value" id="totalLoansIssued">0</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">Ï¥ù ÏòàÍ∏àÏï°</div>
                                <div class="stat-value" id="totalDeposits">0</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">ÏùÄÌñâ Ïã†Ïö©ÎèÑ</div>
                                <div class="stat-value" id="bankRating">AAA</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">ÏãúÏû• Ï†êÏú†Ïú®</div>
                                <div class="stat-value" id="marketShare">0%</div>
                            </div>
                        </div>
                    </div>
                    
                    <h3 style="margin-top: 30px; margin-bottom: 20px;">ÎåÄÏ∂ú Ïã†Ï≤≠ Î™©Î°ù</h3>
                    <div id="loanApplications">
                        <!-- ÎåÄÏ∂ú Ïã†Ï≤≠ Î™©Î°ù -->
                    </div>
                </div>
                
                <!-- Business Section -->
                <div id="business-section" class="content-section" style="display: none;">
                    <div class="content-header">
                        <h2 class="content-title">ÎÇ¥ ÏÇ¨ÏóÖ</h2>
                        <p class="content-subtitle">ÏÇ¨ÏóÖ Í¥ÄÎ¶¨ Î∞è ÌôïÏû•</p>
                    </div>
                    
                    <!-- ÏÇ¨ÏóÖÍ∞Ä Ï†ÑÏö© Í∏∞Îä• -->
                    <div class="stats-grid" style="margin-bottom: 30px;">
                        <div class="stat-card">
                            <div class="stat-label">Ï¥ù ÏÇ¨ÏóÖ Ïàò</div>
                            <div class="stat-value" id="businessCount">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Ïõî ÏàòÏùµ</div>
                            <div class="stat-value" id="monthlyProfit" style="color: var(--success);">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">ÏÇ¨ÏóÖ ÌèâÍ∞ÄÏï°</div>
                            <div class="stat-value" id="businessValue">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">ÏßÅÏõê Ïàò</div>
                            <div class="stat-value" id="employeeCount">0</div>
                        </div>
                    </div>
                    
                    <div class="action-grid" style="margin-bottom: 30px;">
                        <button class="action-btn" onclick="createNewBusiness()">
                            üè™ ÏÉà ÏÇ¨ÏóÖ ÏãúÏûë
                        </button>
                        <button class="action-btn" onclick="expandBusiness()">
                            üìà ÏÇ¨ÏóÖ ÌôïÏû•
                        </button>
                        <button class="action-btn" onclick="hirEmployee()">
                            üë• ÏßÅÏõê Ï±ÑÏö©
                        </button>
                        <button class="action-btn" onclick="sellBusiness()">
                            üí∞ ÏÇ¨ÏóÖ Îß§Í∞Å
                        </button>
                        <button class="action-btn" onclick="goPublic()">
                            üèõÔ∏è Í∏∞ÏóÖ ÏÉÅÏû•
                        </button>
                        <button class="action-btn" onclick="buyBackShares()">
                            üìä ÏûêÏÇ¨Ï£º Îß§ÏûÖ
                        </button>
                        <button class="action-btn" onclick="rightOffering()">
                            üíé Ïú†ÏÉÅÏ¶ùÏûê
                        </button>
                        <button class="action-btn" onclick="showMAPanel()">
                            ü§ù M&A
                        </button>
                        <button class="action-btn" onclick="showRDPanel()">
                            üî¨ R&D
                        </button>
                        <button class="action-btn" onclick="showWorkforceManagement()">
                            üë• ÎÖ∏ÎèôÏûê Í¥ÄÎ¶¨
                        </button>
                    </div>
                    
                    <!-- Í∏∞ÏóÖ Îì±Í∏â & ÌèâÌåê Ï†ïÎ≥¥ -->
                    <div style="background: rgba(255, 255, 255, 0.05); border-radius: 10px; padding: 20px; margin-bottom: 30px;">
                        <h3 style="color: var(--primary); margin-bottom: 15px;">üìä Í∏∞ÏóÖ ÌèâÍ∞Ä</h3>
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-label">Ïã†Ïö©Îì±Í∏â</div>
                                <div class="stat-value" id="creditRating">BBB</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">Í∏∞ÏóÖ ÌèâÌåê</div>
                                <div class="stat-value" id="companyReputation">75Ï†ê</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">ESG Ï†êÏàò</div>
                                <div class="stat-value" id="esgScore">50Ï†ê</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">ÏãúÏû• Ï†êÏú†Ïú®</div>
                                <div class="stat-value" id="marketSharePercent">5.0%</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- R&D ÌîÑÎ°úÏ†ùÌä∏ ÌòÑÌô© -->
                    <div id="rdProjectsSection" style="display: none; background: rgba(16, 185, 129, 0.1); border-radius: 10px; padding: 20px; margin-bottom: 30px;">
                        <h3 style="color: var(--success); margin-bottom: 15px;">üî¨ R&D ÌîÑÎ°úÏ†ùÌä∏</h3>
                        <div id="rdProjectsList">
                            <!-- R&D ÌîÑÎ°úÏ†ùÌä∏ Î™©Î°ù -->
                        </div>
                    </div>
                    
                    <!-- Í≤ΩÏüÅÏÇ¨ ÌòÑÌô© -->
                    <div style="background: rgba(239, 68, 68, 0.1); border-radius: 10px; padding: 20px; margin-bottom: 30px;">
                        <h3 style="color: var(--danger); margin-bottom: 15px;">‚öîÔ∏è ÏóÖÍ≥Ñ Í≤ΩÏüÅ ÌòÑÌô©</h3>
                        <div id="competitorsList">
                            <!-- Í≤ΩÏüÅÏÇ¨ Î™©Î°ù -->
                        </div>
                    </div>
                    
                    <!-- ÏÉÅÏû• Ï†ïÎ≥¥ -->
                    <div id="publicCompanyInfo" style="display: none; background: rgba(99, 102, 241, 0.1); border: 1px solid rgba(99, 102, 241, 0.3); border-radius: 10px; padding: 20px; margin-bottom: 30px;">
                        <h3 style="color: var(--primary); margin-bottom: 15px;">üèõÔ∏è ÏÉÅÏû• Í∏∞ÏóÖ Ï†ïÎ≥¥</h3>
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-label">Ï£ºÏãù ÏãúÏÑ∏</div>
                                <div class="stat-value" id="stockPrice">0Ïõê</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">ÏãúÍ∞ÄÏ¥ùÏï°</div>
                                <div class="stat-value" id="marketCap">0</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">Î≥¥Ïú† ÏßÄÎ∂Ñ</div>
                                <div class="stat-value" id="ownershipPercent">100%</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">Î∞úÌñâ Ï£ºÏãù Ïàò</div>
                                <div class="stat-value" id="totalShares">0Ï£º</div>
                            </div>
                        </div>
                    </div>
                    
                    <div id="myBusinesses">
                        <!-- ÏÇ¨ÏóÖ Î™©Î°ù -->
                    </div>
                </div>
                
                <!-- Investment Section -->
                <div id="investments-section" class="content-section" style="display: none;">
                    <div class="content-header">
                        <h2 class="content-title">Ìà¨Ïûê Ìè¨Ìä∏Ìè¥Î¶¨Ïò§</h2>
                        <p class="content-subtitle">Îã§ÏñëÌïú Ìà¨Ïûê ÏÉÅÌíà Í¥ÄÎ¶¨</p>
                    </div>
                    
                    <!-- Ìà¨ÏûêÏûê Ï†ÑÏö© Í∏∞Îä• -->
                    <div class="stats-grid" style="margin-bottom: 30px;">
                        <div class="stat-card">
                            <div class="stat-label">Ï¥ù Ìà¨ÏûêÏï°</div>
                            <div class="stat-value" id="totalInvestment">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Ìà¨Ïûê ÏàòÏùµÎ•†</div>
                            <div class="stat-value" id="investmentReturn" style="color: var(--success);">0%</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Î≥¥Ïú† Ï¢ÖÎ™©</div>
                            <div class="stat-value" id="stockCount">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Ïõî Î∞∞ÎãπÍ∏à</div>
                            <div class="stat-value" id="dividends" style="color: var(--success);">0</div>
                        </div>
                    </div>
                    
                    <div class="action-grid" style="margin-bottom: 30px; display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                        <button class="action-btn" onclick="openStockMarket()">
                            üìä Ï£ºÏãù ÏãúÏû•
                        </button>
                        <button class="action-btn" onclick="openCryptoMarket()">
                            ‚Çø ÏïîÌò∏ÌôîÌèê ÏãúÏû•
                        </button>
                        <button class="action-btn" onclick="openForexMarket()">
                            üí± Ïô∏Ìôò(ÌôòÏú®) Ìà¨Ïûê
                        </button>
                        <button class="action-btn" onclick="openCommodityMarket()">
                            ü•á ÏõêÏûêÏû¨ Ìà¨Ïûê
                        </button>
                        <button class="action-btn" onclick="openFuturesMarket()">
                            üìä ÏÑ†Î¨ºÌà¨Ïûê (Î†àÎ≤ÑÎ¶¨ÏßÄ)
                        </button>
                        <button class="action-btn" onclick="openRealEstateModal()">
                            üè† Î∂ÄÎèôÏÇ∞ Ìà¨Ïûê
                        </button>
                        <button class="action-btn" onclick="openLandMarketplace()">
                            üè™ ÌÜ†ÏßÄ Îß§Îß§ ÏãúÏû•
                        </button>
                        <button class="action-btn" onclick="sellInvestments()">
                            üí∏ Ìà¨Ïûê ÏÉÅÌíà Îß§Í∞Å
                        </button>
                        <button class="action-btn" onclick="showPortfolioAnalysis()">
                            üìà Ìè¨Ìä∏Ìè¥Î¶¨Ïò§ Î∂ÑÏÑù
                        </button>
                    </div>
                    
                    <div id="investmentPortfolio">
                        <!-- Ìà¨Ïûê Ìè¨Ìä∏Ìè¥Î¶¨Ïò§ -->
                    </div>
                </div>
                
                <!-- Work Section -->
                <div id="work-section" class="content-section" style="display: none;">
                    <div class="content-header">
                        <h2 class="content-title">ÏßÅÏû• ÏÉùÌôú</h2>
                        <p class="content-subtitle">ÏïàÏ†ïÏ†ÅÏù∏ ÏàòÏûÖÍ≥º Í≤ΩÎ†• Í¥ÄÎ¶¨</p>
                    </div>
                    
                    <!-- ÏßÅÏû•Ïù∏ Ï†ÑÏö© Í∏∞Îä• -->
                    <div class="stats-grid" style="margin-bottom: 30px;">
                        <div class="stat-card">
                            <div class="stat-label">Ïõî Í∏âÏó¨</div>
                            <div class="stat-value" id="monthlySalary" style="color: var(--success);">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Í≤ΩÎ†•</div>
                            <div class="stat-value" id="workExperience">0ÎÖÑ</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">ÏßÅÍ∏â</div>
                            <div class="stat-value" id="jobTitle">ÏÇ¨Ïõê</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Ïó∞Ï∞®/Î≥¥ÎÑàÏä§</div>
                            <div class="stat-value" id="bonusAvailable">0</div>
                        </div>
                    </div>
                    
                    <div class="action-grid" style="margin-bottom: 30px;">
                        <button class="action-btn" onclick="workOvertime()">
                            ‚è∞ ÏïºÍ∑ºÌïòÍ∏∞
                        </button>
                        <button class="action-btn" onclick="attendTraining()">
                            üéì ÍµêÏú° Î∞õÍ∏∞
                        </button>
                        <button class="action-btn" onclick="requestPromotion()">
                            üìà ÏäπÏßÑ Ïã†Ï≤≠
                        </button>
                        <button class="action-btn" onclick="changeJob()">
                            üîÑ Ïù¥ÏßÅÌïòÍ∏∞
                        </button>
                    </div>
                    
                    <div id="workHistory">
                        <!-- Í∑ºÎ¨¥ Ïù¥Î†• -->
                    </div>
                </div>
                
                <!-- Loans Section -->
                <div id="loans-section" class="content-section" style="display: none;">
                    <div class="content-header">
                        <h2 class="content-title">ÎåÄÏ∂ú Í¥ÄÎ¶¨</h2>
                        <p class="content-subtitle">ÎÇ¥ ÎåÄÏ∂ú ÌòÑÌô©</p>
                    </div>
                    
                    <div id="myLoans">
                        <!-- ÎåÄÏ∂ú Î™©Î°ù -->
                    </div>
                </div>
                
                <!-- Leaderboard Section -->
                <!-- P2P Í±∞Îûò ÏÑπÏÖò -->
                <div id="p2p-section" class="content-section" style="display: none;">
                    <div class="content-header">
                        <h2 class="content-title">ü§ù P2P ÎßàÏºìÌîåÎ†àÏù¥Ïä§</h2>
                        <p class="content-subtitle">ÌîåÎ†àÏù¥Ïñ¥Í∞Ñ ÏûêÏÇ∞/ÏÇ¨ÏóÖÏ≤¥ Í±∞Îûò</p>
                    </div>

                    <!-- P2P Í±∞Îûò ÌÉ≠ Î©îÎâ¥ -->
                    <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                        <button class="btn" onclick="showP2PTab('browse')" id="p2pBrowseTab" style="background: var(--primary);">
                            üõí Îß§Î¨º ÎëòÎü¨Î≥¥Í∏∞
                        </button>
                        <button class="btn btn-secondary" onclick="showP2PTab('sell')" id="p2pSellTab">
                            üí∞ ÎÇ¥ ÏûêÏÇ∞ ÌåêÎß§
                        </button>
                        <button class="btn btn-secondary" onclick="showP2PTab('history')" id="p2pHistoryTab">
                            üìã Í±∞Îûò ÎÇ¥Ïó≠
                        </button>
                    </div>

                    <!-- Îß§Î¨º ÎëòÎü¨Î≥¥Í∏∞ ÌÉ≠ -->
                    <div id="p2pBrowseContent">
                        <div style="display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap;">
                            <button class="btn btn-sm" onclick="filterP2PListings('all')" id="filterAll" style="background: var(--primary);">Ï†ÑÏ≤¥</button>
                            <button class="btn btn-sm btn-secondary" onclick="filterP2PListings('business')" id="filterBusiness">ÏÇ¨ÏóÖÏ≤¥</button>
                            <button class="btn btn-sm btn-secondary" onclick="filterP2PListings('investment')" id="filterInvestment">Ìà¨ÏûêÏûêÏÇ∞</button>
                            <button class="btn btn-sm btn-secondary" onclick="filterP2PListings('land')" id="filterLand">Î∂ÄÎèôÏÇ∞</button>
                        </div>
                        
                        <div id="p2pListings">
                            <!-- Îß§Î¨º Î™©Î°ùÏù¥ Ïó¨Í∏∞Ïóê ÌëúÏãúÎê©ÎãàÎã§ -->
                        </div>
                    </div>

                    <!-- ÎÇ¥ ÏûêÏÇ∞ ÌåêÎß§ ÌÉ≠ -->
                    <div id="p2pSellContent" style="display: none;">
                        <h3 style="color: var(--primary); margin-bottom: 15px;">ÌåêÎß§Ìï† ÏûêÏÇ∞ ÏÑ†ÌÉù</h3>
                        
                        <div style="margin-bottom: 20px;">
                            <h4 style="color: #cbd5e1; margin-bottom: 10px;">ÎÇ¥ ÏÇ¨ÏóÖÏ≤¥</h4>
                            <div id="myBusinessesToSell">
                                <!-- ÎÇ¥ ÏÇ¨ÏóÖÏ≤¥ Î™©Î°ù -->
                            </div>
                        </div>

                        <div style="margin-bottom: 20px;">
                            <h4 style="color: #cbd5e1; margin-bottom: 10px;">ÎÇ¥ Ìà¨ÏûêÏûêÏÇ∞</h4>
                            <div id="myInvestmentsToSell">
                                <!-- ÎÇ¥ Ìà¨ÏûêÏûêÏÇ∞ Î™©Î°ù -->
                            </div>
                        </div>
                    </div>

                    <!-- Í±∞Îûò ÎÇ¥Ïó≠ ÌÉ≠ -->
                    <div id="p2pHistoryContent" style="display: none;">
                        <h3 style="color: var(--primary); margin-bottom: 15px;">ÎÇòÏùò Í±∞Îûò ÎÇ¥Ïó≠</h3>
                        <div id="p2pTransactionHistory">
                            <!-- Í±∞Îûò ÎÇ¥Ïó≠Ïù¥ Ïó¨Í∏∞Ïóê ÌëúÏãúÎê©ÎãàÎã§ -->
                        </div>
                    </div>
                </div>

                <!-- ÎÖ∏ÎèôÏãúÏû• ÏÑπÏÖò -->
                <div id="labor-section" class="content-section" style="display: none;">
                    <div class="content-header">
                        <h2 class="content-title">üë• ÎÖ∏ÎèôÏãúÏû•</h2>
                        <p class="content-subtitle">ÌîåÎ†àÏù¥Ïñ¥Í∞Ñ Í≥†Ïö©/Íµ¨ÏßÅ ÏãúÏä§ÌÖú</p>
                    </div>

                    <!-- ÎÖ∏ÎèôÏãúÏû• ÌÉ≠ Î©îÎâ¥ -->
                    <div style="display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap;">
                        <button class="btn" onclick="showLaborTab('jobs')" id="laborJobsTab" style="background: var(--primary);">
                            üîç Íµ¨Ïù∏Í≥µÍ≥†
                        </button>
                        <button class="btn btn-secondary" onclick="showLaborTab('hire')" id="laborHireTab">
                            üìù ÏßÅÏõê Ï±ÑÏö©
                        </button>
                        <button class="btn btn-secondary" onclick="showLaborTab('my-jobs')" id="laborMyJobsTab">
                            üíº ÎÇ¥ Í≥†Ïö©ÌòÑÌô©
                        </button>
                        <button class="btn btn-secondary" onclick="showLaborTab('freelance')" id="laborFreelanceTab">
                            üéØ ÌîÑÎ¶¨ÎûúÏä§
                        </button>
                    </div>

                    <!-- Íµ¨Ïù∏Í≥µÍ≥† ÌÉ≠ -->
                    <div id="laborJobsContent">
                        <div style="display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap;">
                            <select id="jobSkillFilter" onchange="filterJobPostings()" style="padding: 8px; border-radius: 6px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: #e2e8f0;">
                                <option value="all">Î™®Îì† ÏßÅÏ¢Ö</option>
                                <option value="programming">Í∞úÎ∞ú</option>
                                <option value="design">ÎîîÏûêÏù∏</option>
                                <option value="marketing">ÎßàÏºÄÌåÖ</option>
                                <option value="sales">ÏòÅÏóÖ</option>
                                <option value="management">Í¥ÄÎ¶¨</option>
                            </select>
                            <select id="jobLevelFilter" onchange="filterJobPostings()" style="padding: 8px; border-radius: 6px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: #e2e8f0;">
                                <option value="all">Î™®Îì† Î†àÎ≤®</option>
                                <option value="junior">Ïã†ÏûÖ</option>
                                <option value="mid">Ï§ëÍ∏â</option>
                                <option value="senior">Í≥†Í∏â</option>
                                <option value="lead">ÌåÄÏû•Í∏â</option>
                                <option value="executive">ÏûÑÏõêÍ∏â</option>
                            </select>
                        </div>
                        
                        <div id="jobPostingsList">
                            <!-- Íµ¨Ïù∏Í≥µÍ≥† Î™©Î°ù -->
                        </div>
                    </div>

                    <!-- ÏßÅÏõê Ï±ÑÏö© ÌÉ≠ -->
                    <div id="laborHireContent" style="display: none;">
                        <h3 style="color: var(--primary); margin-bottom: 15px;">Íµ¨Ïù∏Í≥µÍ≥† ÏûëÏÑ±</h3>
                        
                        <div style="background: rgba(34, 34, 34, 0.6); border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                            <div style="margin-bottom: 15px;">
                                <label style="display: block; color: #cbd5e1; margin-bottom: 8px;">Ìè¨ÏßÄÏÖòÎ™Ö</label>
                                <input type="text" id="jobTitle" placeholder="Ïòà: ÏãúÎãàÏñ¥ Í∞úÎ∞úÏûê, ÎßàÏºÄÌåÖ Îß§ÎãàÏ†Ä" 
                                       style="width: 100%; padding: 10px; border-radius: 6px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: #e2e8f0;">
                            </div>
                            
                            <div style="margin-bottom: 15px;">
                                <label style="display: block; color: #cbd5e1; margin-bottom: 8px;">ÏöîÍµ¨ Ïä§ÌÇ¨</label>
                                <select id="jobSkill" style="width: 100%; padding: 10px; border-radius: 6px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: #e2e8f0;">
                                    <option value="programming">Í∞úÎ∞ú</option>
                                    <option value="design">ÎîîÏûêÏù∏</option>
                                    <option value="marketing">ÎßàÏºÄÌåÖ</option>
                                    <option value="sales">ÏòÅÏóÖ</option>
                                    <option value="management">Í¥ÄÎ¶¨</option>
                                    <option value="accounting">ÌöåÍ≥Ñ</option>
                                    <option value="legal">Î≤ïÎ¨¥</option>
                                    <option value="engineering">ÏóîÏßÄÎãàÏñ¥ÎßÅ</option>
                                    <option value="research">Ïó∞Íµ¨</option>
                                    <option value="consulting">Ïª®ÏÑ§ÌåÖ</option>
                                </select>
                            </div>
                            
                            <div style="margin-bottom: 15px;">
                                <label style="display: block; color: #cbd5e1; margin-bottom: 8px;">Í≤ΩÌóò Î†àÎ≤®</label>
                                <select id="jobLevel" onchange="updateSalaryRange()" style="width: 100%; padding: 10px; border-radius: 6px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: #e2e8f0;">
                                    <option value="junior">Ïã†ÏûÖ (2,500~4,000 ÎπÑÌä∏ÌÅ¨Î†àÎîß)</option>
                                    <option value="mid">Ï§ëÍ∏â (4,000~7,000 ÎπÑÌä∏ÌÅ¨Î†àÎîß)</option>
                                    <option value="senior">Í≥†Í∏â (7,000~12,000 ÎπÑÌä∏ÌÅ¨Î†àÎîß)</option>
                                    <option value="lead">ÌåÄÏû•Í∏â (12,000~20,000 ÎπÑÌä∏ÌÅ¨Î†àÎîß)</option>
                                    <option value="executive">ÏûÑÏõêÍ∏â (20,000~50,000 ÎπÑÌä∏ÌÅ¨Î†àÎîß)</option>
                                </select>
                            </div>
                            
                            <div style="margin-bottom: 15px;">
                                <label style="display: block; color: #cbd5e1; margin-bottom: 8px;">ÏõîÍ∏âÏó¨ (ÎπÑÌä∏ÌÅ¨Î†àÎîß)</label>
                                <input type="number" id="jobSalary" placeholder="3500" min="1000" 
                                       style="width: 100%; padding: 10px; border-radius: 6px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: #e2e8f0;">
                                <div style="color: #94a3b8; font-size: 0.9rem; margin-top: 5px;" id="salaryGuideline">
                                    Ïã†ÏûÖ Í∂åÏû• Î≤îÏúÑ: 2,500~4,000 ÎπÑÌä∏ÌÅ¨Î†àÎîß
                                </div>
                            </div>
                            
                            <div style="margin-bottom: 20px;">
                                <label style="display: block; color: #cbd5e1; margin-bottom: 8px;">ÏóÖÎ¨¥ ÏÑ§Î™Ö</label>
                                <textarea id="jobDescription" placeholder="ÏóÖÎ¨¥ ÎÇ¥Ïö©, Í∑ºÎ¨¥ Ï°∞Í±¥ Îì±ÏùÑ ÏÑ§Î™ÖÌï¥Ï£ºÏÑ∏Ïöî..." 
                                          style="width: 100%; height: 80px; padding: 10px; border-radius: 6px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: #e2e8f0; resize: vertical;"></textarea>
                            </div>
                            
                            <button class="btn" onclick="postJob()" style="width: 100%;">
                                Íµ¨Ïù∏Í≥µÍ≥† Îì±Î°ùÌïòÍ∏∞
                            </button>
                        </div>

                        <div id="myBusinessesForHiring">
                            <h4 style="color: #cbd5e1; margin-bottom: 10px;">ÎÇ¥ ÏÇ¨ÏóÖÏ≤¥Î≥Ñ ÏßÅÏõê ÌòÑÌô©</h4>
                            <!-- ÏÇ¨ÏóÖÏ≤¥Î≥Ñ ÏßÅÏõê ÌòÑÌô© -->
                        </div>
                    </div>

                    <!-- ÎÇ¥ Í≥†Ïö©ÌòÑÌô© ÌÉ≠ -->
                    <div id="laborMyJobsContent" style="display: none;">
                        <div style="display: flex; gap: 20px; margin-bottom: 20px;">
                            <div style="flex: 1;">
                                <h3 style="color: var(--success); margin-bottom: 15px;">üíº ÎÇ¥Í∞Ä Í≥†Ïö©Ìïú ÏßÅÏõêÎì§</h3>
                                <div id="myEmployeesList">
                                    <!-- ÎÇ¥ ÏßÅÏõê Î™©Î°ù -->
                                </div>
                            </div>
                            <div style="flex: 1;">
                                <h3 style="color: var(--primary); margin-bottom: 15px;">üè¢ ÎÇ¥ ÏßÅÏû• Ï†ïÎ≥¥</h3>
                                <div id="myEmploymentStatus">
                                    <!-- ÎÇ¥ Í≥†Ïö© ÏÉÅÌÉú -->
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ÌîÑÎ¶¨ÎûúÏä§ ÌÉ≠ -->
                    <div id="laborFreelanceContent" style="display: none;">
                        <h3 style="color: var(--warning); margin-bottom: 15px;">üéØ ÌîÑÎ¶¨ÎûúÏä§ ÌîÑÎ°úÏ†ùÌä∏</h3>
                        <div id="freelanceJobsList">
                            <!-- ÌîÑÎ¶¨ÎûúÏä§ Î™©Î°ù -->
                        </div>
                    </div>
                </div>

                <div id="leaderboard-section" class="content-section" style="display: none;">
                    <div class="content-header">
                        <h2 class="content-title">Î¶¨ÎçîÎ≥¥Îìú</h2>
                        <p class="content-subtitle">Top 10 ÌîåÎ†àÏù¥Ïñ¥</p>
                    </div>
                    
                    <div class="leaderboard-list" id="leaderboardList">
                        <!-- Î¶¨ÎçîÎ≥¥Îìú -->
                    </div>
                </div>
            </div>
            
            <!-- Right Sidebar - Market -->
            <div class="market-sidebar">
                <h3 class="market-title">üìà Ïã§ÏãúÍ∞Ñ ÏãúÏû•</h3>
                
                <!-- Ï£ºÏãù ÏãúÏû• -->
                <div style="margin-bottom: 20px;">
                    <h4 style="color: #cbd5e1; margin-bottom: 10px; font-size: 0.9rem;">üìä Ï£ºÏãù ÏãúÏû•</h4>
                    <div id="stockMarket">
                        <!-- Ï£ºÏãù Î™©Î°ù -->
                    </div>
                </div>
                
                <!-- ÏïîÌò∏ÌôîÌèê ÏãúÏû• -->
                <div style="margin-bottom: 20px;">
                    <h4 style="color: #cbd5e1; margin-bottom: 10px; font-size: 0.9rem;">‚Çø ÏïîÌò∏ÌôîÌèê</h4>
                    <div id="cryptoMarket">
                        <!-- ÏïîÌò∏ÌôîÌèê Î™©Î°ù -->
                    </div>
                </div>
                
                <!-- Í≤ΩÏ†ú ÏßÄÌëú -->
                <div>
                    <h4 style="color: #cbd5e1; margin-bottom: 10px; font-size: 0.9rem;">üìä Í≤ΩÏ†ú ÏßÄÌëú</h4>
                    <div class="market-item">
                        <div class="market-item-header">
                            <span class="market-item-name">ÏΩîÏä§Ìîº</span>
                            <span class="market-item-price" id="kospiIndex">2,400</span>
                        </div>
                        <div class="market-item-change" id="kospiChange">+0.5%</div>
                    </div>
                    <div class="market-item">
                        <div class="market-item-header">
                            <span class="market-item-name">USD/KRW</span>
                            <span class="market-item-price" id="usdkrw">1,320</span>
                        </div>
                        <div class="market-item-change" id="usdkrwChange">-0.2%</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Notification -->
    <div class="notification" id="notification">
        <div id="notificationText"></div>
    </div>
    
    <!-- IPO Modal -->
    <div id="ipoModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 2000; justify-content: center; align-items: center;">
        <div style="background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%); border: 1px solid rgba(255,255,255,0.1); border-radius: 20px; padding: 40px; max-width: 500px; width: 90%;">
            <h2 style="text-align: center; margin-bottom: 30px; color: var(--primary);">üèõÔ∏è Í∏∞ÏóÖÍ≥µÍ∞ú (IPO)</h2>
            
            <div style="margin-bottom: 20px;">
                <div style="background: rgba(255,255,255,0.05); padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <span>Í∏∞ÏóÖÍ∞ÄÏπò:</span>
                        <span id="ipoCompanyValue">0</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <span>ÏÉÅÏû• ÎπÑÏö©:</span>
                        <span>50,000 ÎπÑÌä∏ÌÅ¨Î†àÎîß</span>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <span>IPO ÌîÑÎ¶¨ÎØ∏ÏóÑ:</span>
                        <span style="color: var(--success);">+40%</span>
                    </div>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 10px; color: #cbd5e1;">Í≥µÍ∞ú ÏßÄÎ∂ÑÏú® ÏÑ†ÌÉù (1.0% - 49.0%)</label>
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <input type="range" id="equitySlider" min="1" max="49" step="0.5" value="30" 
                               style="flex: 1;" oninput="updateIPOCalculation()">
                        <input type="number" id="equityInput" min="1" max="49" step="0.5" value="30" 
                               style="width: 80px; padding: 5px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 5px; color: white;" 
                               oninput="updateIPOCalculation()">
                        <span style="color: #94a3b8;">%</span>
                    </div>
                </div>
                
                <div style="background: rgba(99,102,241,0.1); padding: 15px; border-radius: 10px; margin-bottom: 20px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                        <span>Ï°∞Îã¨ ÏòàÏÉÅÏï°:</span>
                        <span id="expectedRaise" style="color: var(--success); font-weight: 700;">0</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                        <span>ÏòàÏÉÅ Ï£ºÍ∞Ä:</span>
                        <span id="expectedStockPrice">0Ïõê</span>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <span>Î≥¥Ïú† ÏßÄÎ∂Ñ:</span>
                        <span id="remainingOwnership">70.0%</span>
                    </div>
                </div>
            </div>
            
            <div style="display: flex; gap: 15px;">
                <button class="btn btn-secondary" style="flex: 1;" onclick="closeIPOModal()">Ï∑®ÏÜå</button>
                <button class="btn" style="flex: 1;" onclick="executeIPO()">ÏÉÅÏû•ÌïòÍ∏∞</button>
            </div>
        </div>
    </div>
    
    <!-- Rights Offering Modal -->
    <div id="rightsModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 2000; justify-content: center; align-items: center;">
        <div style="background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%); border: 1px solid rgba(255,255,255,0.1); border-radius: 20px; padding: 40px; max-width: 500px; width: 90%;">
            <h2 style="text-align: center; margin-bottom: 30px; color: var(--success);">üíé Ïú†ÏÉÅÏ¶ùÏûê</h2>
            
            <div style="margin-bottom: 20px;">
                <div style="background: rgba(255,255,255,0.05); padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <span>ÌòÑÏû¨ Ï£ºÍ∞Ä:</span>
                        <span id="currentStockPrice">0Ïõê</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <span>ÌòÑÏû¨ ÏßÄÎ∂ÑÏú®:</span>
                        <span id="currentOwnership">0%</span>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <span>ÏãúÍ∞ÄÏ¥ùÏï°:</span>
                        <span id="currentMarketCap">0</span>
                    </div>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 10px; color: #cbd5e1;">Ï∂îÍ∞Ä ÏßÄÎ∂Ñ Ìù¨ÏÑùÎ•† (1.0% - 30.0%)</label>
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <input type="range" id="rightsEquitySlider" min="1" max="30" step="0.5" value="10" 
                               style="flex: 1;" oninput="updateRightsCalculation()">
                        <input type="number" id="rightsEquityInput" min="1" max="30" step="0.5" value="10" 
                               style="width: 80px; padding: 5px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 5px; color: white;" 
                               oninput="updateRightsCalculation()">
                        <span style="color: #94a3b8;">%</span>
                    </div>
                </div>
                
                <div style="background: rgba(16,185,129,0.1); padding: 15px; border-radius: 10px; margin-bottom: 20px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                        <span>ÏòàÏÉÅ Ï°∞Îã¨Ïï°:</span>
                        <span id="rightsExpectedRaise" style="color: var(--success); font-weight: 700;">0</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                        <span>Ï¶ùÏûê ÌõÑ ÏßÄÎ∂Ñ:</span>
                        <span id="rightsNewOwnership">0%</span>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <span>Ïã†Ï£º Î∞úÌñâÍ∞Ä:</span>
                        <span id="rightsPrice">0Ïõê</span>
                    </div>
                </div>
            </div>
            
            <div style="display: flex; gap: 15px;">
                <button class="btn btn-secondary" style="flex: 1;" onclick="closeRightsModal()">Ï∑®ÏÜå</button>
                <button class="btn" style="flex: 1;" onclick="executeRightsOffering()">Ï¶ùÏûêÌïòÍ∏∞</button>
            </div>
        </div>
    </div>
    
    <!-- M&A Modal -->
    <div id="maModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 2000; justify-content: center; align-items: center;">
        <div style="background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%); border: 1px solid rgba(255,255,255,0.1); border-radius: 20px; padding: 40px; max-width: 600px; width: 90%; max-height: 80vh; overflow-y: auto;">
            <h2 style="text-align: center; margin-bottom: 30px; color: var(--warning);">ü§ù M&A ÏÑºÌÑ∞</h2>
            
            <div style="margin-bottom: 30px;">
                <h3 style="margin-bottom: 15px; color: #cbd5e1;">üí∞ Ïù∏Ïàò Í∞ÄÎä•Ìïú Í∏∞ÏóÖÎì§</h3>
                <div id="acquisitionTargets">
                    <!-- Ïù∏Ïàò ÎåÄÏÉÅ Î™©Î°ù -->
                </div>
            </div>
            
            <div style="display: flex; gap: 15px;">
                <button class="btn btn-secondary" style="flex: 1;" onclick="closeMAModal()">Îã´Í∏∞</button>
            </div>
        </div>
    </div>
    
    <!-- R&D Modal -->
    <div id="rdModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 2000; justify-content: center; align-items: center;">
        <div style="background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%); border: 1px solid rgba(255,255,255,0.1); border-radius: 20px; padding: 40px; max-width: 600px; width: 90%; max-height: 80vh; overflow-y: auto;">
            <h2 style="text-align: center; margin-bottom: 30px; color: var(--success);">üî¨ Ïó∞Íµ¨Í∞úÎ∞úÏÑºÌÑ∞</h2>
            
            <div style="margin-bottom: 30px;">
                <h3 style="margin-bottom: 15px; color: #cbd5e1;">üöÄ Ïã†Í∑ú R&D ÌîÑÎ°úÏ†ùÌä∏</h3>
                <div id="availableRDProjects">
                    <!-- Í∞ÄÎä•Ìïú R&D ÌîÑÎ°úÏ†ùÌä∏Îì§ -->
                </div>
            </div>
            
            <div style="margin-bottom: 30px;">
                <h3 style="margin-bottom: 15px; color: #cbd5e1;">üìã ÏßÑÌñâÏ§ëÏù∏ ÌîÑÎ°úÏ†ùÌä∏</h3>
                <div id="activeRDProjects">
                    <!-- ÏßÑÌñâÏ§ëÏù∏ R&D ÌîÑÎ°úÏ†ùÌä∏Îì§ -->
                </div>
            </div>
            
            <div style="display: flex; gap: 15px;">
                <button class="btn btn-secondary" style="flex: 1;" onclick="closeRDModal()">Îã´Í∏∞</button>
            </div>
        </div>
    </div>
    
    <!-- Real Estate Investment Modal -->
    <div id="realEstateModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 2000; justify-content: center; align-items: center;">
        <div style="background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%); border: 1px solid rgba(255,255,255,0.1); border-radius: 20px; padding: 40px; max-width: 700px; width: 90%; max-height: 80vh; overflow-y: auto;">
            <h2 style="text-align: center; margin-bottom: 30px; color: var(--primary);">üè† Î∂ÄÎèôÏÇ∞ Ìà¨Ïûê ÏÑ†ÌÉù</h2>
            
            <div class="action-grid" style="grid-template-columns: repeat(2, 1fr); gap: 20px; margin-bottom: 30px;">
                <div class="business-card" style="cursor: pointer;" onclick="buySpecificRealEstate('apartment')">
                    <div class="business-header">
                        <div class="business-name">üè¢ ÏïÑÌååÌä∏</div>
                        <div style="color: var(--success);">ÏïàÏ†ïÌòï</div>
                    </div>
                    <div style="font-size: 0.9rem; color: #94a3b8; margin: 10px 0;">
                        <div>‚Ä¢ Ìà¨ÏûêÍ∏àÏï°: 300Îßå ~ 500Îßå ÎπÑÌä∏ÌÅ¨Î†àÎîß</div>
                        <div>‚Ä¢ ÏàòÏùµÎ•†: 5~12% (ÏïàÏ†ïÏ†Å)</div>
                        <div>‚Ä¢ ÏõîÏÑ∏ÏàòÏùµ: 0.3%/Ïõî (ÌòÑÏã§Ï†Å)</div>
                        <div>‚Ä¢ Î¶¨Ïä§ÌÅ¨: ÎÇÆÏùå</div>
                    </div>
                </div>
                
                <div class="business-card" style="cursor: pointer;" onclick="buySpecificRealEstate('officetel')">
                    <div class="business-header">
                        <div class="business-name">üè¨ Ïò§ÌîºÏä§ÌÖî</div>
                        <div style="color: var(--warning);">Í∑†ÌòïÌòï</div>
                    </div>
                    <div style="font-size: 0.9rem; color: #94a3b8; margin: 10px 0;">
                        <div>‚Ä¢ Ìà¨ÏûêÍ∏àÏï°: 150Îßå ~ 300Îßå ÎπÑÌä∏ÌÅ¨Î†àÎîß</div>
                        <div>‚Ä¢ ÏàòÏùµÎ•†: 3~18% (Ï§ëÏúÑÌóò)</div>
                        <div>‚Ä¢ ÏõîÏÑ∏ÏàòÏùµ: 0.25%/Ïõî (ÌòÑÏã§Ï†Å)</div>
                        <div>‚Ä¢ Î¶¨Ïä§ÌÅ¨: Î≥¥ÌÜµ</div>
                    </div>
                </div>
                
                <div class="business-card" style="cursor: pointer;" onclick="buySpecificRealEstate('commercial')">
                    <div class="business-header">
                        <div class="business-name">üè™ ÏÉÅÍ∞Ä</div>
                        <div style="color: var(--danger);">Í≥µÍ≤©Ìòï</div>
                    </div>
                    <div style="font-size: 0.9rem; color: #94a3b8; margin: 10px 0;">
                        <div>‚Ä¢ Ìà¨ÏûêÍ∏àÏï°: 250Îßå ~ 750Îßå ÎπÑÌä∏ÌÅ¨Î†àÎîß</div>
                        <div>‚Ä¢ ÏàòÏùµÎ•†: -5~25% (Í≥†ÏúÑÌóò)</div>
                        <div>‚Ä¢ ÏõîÏÑ∏ÏàòÏùµ: 0.4%/Ïõî (ÏÑ±Í≥µÏãú)</div>
                        <div>‚Ä¢ Î¶¨Ïä§ÌÅ¨: ÎÜíÏùå</div>
                    </div>
                </div>
                
                <div class="business-card" style="cursor: pointer;" onclick="openLandModal()">
                    <div class="business-header">
                        <div class="business-name">üèûÔ∏è ÌÜ†ÏßÄ</div>
                        <div style="color: var(--primary);">Í∞úÎ∞úÌòï</div>
                    </div>
                    <div style="font-size: 0.9rem; color: #94a3b8; margin: 10px 0;">
                        <div>‚Ä¢ ÏßÄÏó≠Î≥Ñ Í∞ÄÍ≤© Ï∞®Î≥ÑÌôî</div>
                        <div>‚Ä¢ ÌïúÏ†ïÎêú ÌÜ†ÏßÄ Í≥µÍ∏â</div>
                        <div>‚Ä¢ <strong style="color: var(--danger);">ÏµúÏÜå 1000Ìèâ Ïù¥ÏÉÅ Íµ¨Îß§</strong></div>
                        <div>‚Ä¢ <strong style="color: var(--warning);">ÏßÑÏûÖÎπÑÏö©: ÏµúÏÜå 350Îßå ÎπÑÌä∏ÌÅ¨Î†àÎîß</strong></div>
                        <div>‚Ä¢ <span id="totalLandStatus">Ï¥ù 100ÎßåÌèâ Ï§ë 100ÎßåÌèâ ÎÇ®Ïùå</span></div>
                    </div>
                </div>
            </div>
            
            <div style="display: flex; gap: 15px;">
                <button class="btn btn-secondary" style="flex: 1;" onclick="closeRealEstateModal()">Ï∑®ÏÜå</button>
            </div>
        </div>
    </div>
    
    <!-- Land Investment Modal -->
    <div id="landModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 2001; justify-content: center; align-items: center;">
        <div style="background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%); border: 1px solid rgba(255,255,255,0.1); border-radius: 20px; padding: 40px; max-width: 800px; width: 90%; max-height: 80vh; overflow-y: auto;">
            <h2 style="text-align: center; margin-bottom: 20px; color: var(--primary);">üèûÔ∏è ÌÜ†ÏßÄ Ìà¨Ïûê ÏÑ†ÌÉù</h2>
            
            <div style="text-align: center; margin-bottom: 30px; padding: 15px; background: rgba(59, 130, 246, 0.1); border-radius: 10px;">
                <div style="font-size: 1.1rem; font-weight: bold; color: var(--primary);" id="landMarketStatus">
                    Ï†ÑÍµ≠ ÌÜ†ÏßÄ ÌòÑÌô©: Ï¥ù 100ÎßåÌèâ Ï§ë 100ÎßåÌèâ ÎÇ®Ïùå
                </div>
                <div style="font-size: 0.9rem; color: #94a3b8; margin-top: 5px;">
                    ÌÜ†ÏßÄÎäî ÌïúÏ†ïÏ†ÅÏù¥Î©∞ Îã§Î•∏ Ìà¨ÏûêÏûêÎì§Í≥º Í≤ΩÏüÅÌï¥Ïïº Ìï©ÎãàÎã§
                </div>
            </div>
            
            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 30px;" id="landRegionsList">
                <!-- ÏßÄÏó≠Î≥Ñ ÌÜ†ÏßÄ Î™©Î°ù -->
            </div>
            
            <div style="margin-bottom: 30px; padding: 15px; background: rgba(255, 255, 255, 0.05); border-radius: 10px;">
                <h4 style="color: var(--warning); margin-bottom: 10px;">üìã ÌÜ†ÏßÄ Ìà¨Ïûê Í∞ÄÏù¥Îìú</h4>
                <div style="font-size: 0.9rem; color: #94a3b8; line-height: 1.5;">
                    ‚Ä¢ <strong>ÌèâÏàò ÏÑ†ÌÉù:</strong> 1000Ìèâ~50000ÌèâÍπåÏßÄ Ìà¨Ïûê Í∞ÄÎä• (ÏµúÏÜå 1000Ìèâ)<br>
                    ‚Ä¢ <strong>ÏßÑÏûÖÎπÑÏö©:</strong> ÏµúÏ†Ä 350Îßå ÎπÑÌä∏ÌÅ¨Î†àÎîß (ÏßÄÎ∞© 1000Ìèâ) ~ ÏµúÎåÄ 1650Îßå ÎπÑÌä∏ÌÅ¨Î†àÎîß (Í∞ïÎÇ® 1000Ìèâ)<br>
                    ‚Ä¢ <strong>Í∞ÄÍ≤© Í≤∞Ï†ï:</strong> (Í∏∞Î≥∏Í∞ÄÍ≤© 5000ÎπÑÌä∏ÌÅ¨Î†àÎîß/Ìèâ √ó ÏßÄÏó≠Î∞∞Ïàò √ó ÌèâÏàò) + Ìù¨ÏÜåÏÑ± ÌîÑÎ¶¨ÎØ∏ÏóÑ<br>
                    ‚Ä¢ <strong>Í∞úÎ∞ú Ï°∞Í±¥:</strong> ÏàòÏùµÎ•† 10% Ïù¥ÏÉÅ Ïãú Ïõî 1% Í∞úÎ∞úÏàòÏùµ Î∞úÏÉù<br>
                    ‚Ä¢ <strong>Ìù¨ÏÜåÏÑ±:</strong> ÌÜ†ÏßÄÍ∞Ä Î∂ÄÏ°±Ìï†ÏàòÎ°ù Í∏∞ÌïòÍ∏âÏàòÏ†Å Í∞ÄÍ≤© ÏÉÅÏäπ üöÄ
                </div>
            </div>
            
            <div style="display: flex; gap: 15px;">
                <button class="btn btn-secondary" style="flex: 1;" onclick="closeLandModal()">Ï∑®ÏÜå</button>
            </div>
        </div>
    </div>
    
    <!-- Land Purchase Detail Modal -->
    <div id="landDetailModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 2002; justify-content: center; align-items: center;">
        <div style="background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%); border: 1px solid rgba(255,255,255,0.1); border-radius: 20px; padding: 40px; max-width: 500px; width: 90%;">
            <h3 style="text-align: center; margin-bottom: 20px; color: var(--primary);" id="landDetailTitle">ÌÜ†ÏßÄ Íµ¨Îß§</h3>
            
            <div style="margin-bottom: 20px; padding: 15px; background: rgba(255, 255, 255, 0.05); border-radius: 10px;">
                <div id="landDetailInfo">
                    <!-- ÏÑ†ÌÉùÎêú ÌÜ†ÏßÄ Ï†ïÎ≥¥ -->
                </div>
            </div>
            
            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 10px; color: #cbd5e1;">Íµ¨Îß§Ìï† ÌèâÏàò ÏÑ†ÌÉù:</label>
                <input type="range" id="landSizeSlider" min="1000" max="50000" value="1000" 
                       style="width: 100%; margin-bottom: 10px;"
                       oninput="updateLandCalculation()">
                <div style="display: flex; justify-content: space-between; color: #94a3b8; font-size: 0.9rem;">
                    <span>1000Ìèâ (ÏµúÏÜå)</span>
                    <span id="selectedLandSize">1000Ìèâ</span>
                    <span>50000Ìèâ (5ÎßåÌèâ)</span>
                </div>
            </div>
            
            <div style="margin-bottom: 20px; padding: 15px; background: rgba(59, 130, 246, 0.1); border-radius: 10px;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                    <span>Í∏∞Î≥∏ Í∞ÄÍ≤©:</span>
                    <span id="landBasePrice">200,000 ÎπÑÌä∏ÌÅ¨Î†àÎîß</span>
                </div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                    <span>ÏßÄÏó≠ ÌîÑÎ¶¨ÎØ∏ÏóÑ:</span>
                    <span id="landRegionPrice">+100,000 ÎπÑÌä∏ÌÅ¨Î†àÎîß</span>
                </div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                    <span>Ìù¨ÏÜåÏÑ± ÌîÑÎ¶¨ÎØ∏ÏóÑ:</span>
                    <span id="landScarcityPrice">+50,000 ÎπÑÌä∏ÌÅ¨Î†àÎîß</span>
                </div>
                <hr style="border: 1px solid rgba(255,255,255,0.1); margin: 10px 0;">
                <div style="display: flex; justify-content: space-between; font-weight: bold; color: var(--warning);">
                    <span>Ï¥ù Íµ¨Îß§Í∞ÄÍ≤©:</span>
                    <span id="landTotalPrice">350,000 ÎπÑÌä∏ÌÅ¨Î†àÎîß</span>
                </div>
            </div>
            
            <div style="display: flex; gap: 15px;">
                <button class="btn btn-secondary" style="flex: 1;" onclick="closeLandDetailModal()">Ï∑®ÏÜå</button>
                <button class="btn" style="flex: 1;" onclick="confirmLandPurchase()" id="landPurchaseBtn">Íµ¨Îß§ÌïòÍ∏∞</button>
            </div>
        </div>
    </div>
    
    <!-- Land Marketplace Modal -->
    <div id="landMarketplaceModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 2001; justify-content: center; align-items: center;">
        <div style="background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%); border: 1px solid rgba(255,255,255,0.1); border-radius: 20px; padding: 40px; max-width: 900px; width: 90%; max-height: 85vh; overflow-y: auto;">
            <h2 style="text-align: center; margin-bottom: 20px; color: var(--primary);">üè™ ÌÜ†ÏßÄ Îß§Îß§ ÏãúÏû•</h2>
            
            <div style="display: flex; gap: 20px; margin-bottom: 30px;">
                <button class="btn" onclick="showMarketplaceBuy()" id="marketplaceBuyBtn" style="flex: 1;">Îß§Ïàò (Íµ¨Îß§ÌïòÍ∏∞)</button>
                <button class="btn btn-secondary" onclick="showMarketplaceSell()" id="marketplaceSellBtn" style="flex: 1;">Îß§ÎèÑ (ÌåêÎß§ÌïòÍ∏∞)</button>
            </div>
            
            <!-- Îß§Ïàò ÏÑπÏÖò -->
            <div id="marketplaceBuySection">
                <h3 style="color: var(--success); margin-bottom: 15px;">üí∞ Îß§Ïàò Í∞ÄÎä•Ìïú ÌÜ†ÏßÄ</h3>
                <div id="landForSaleList">
                    <!-- ÌåêÎß§Ï§ëÏù∏ ÌÜ†ÏßÄ Î™©Î°ù -->
                </div>
            </div>
            
            <!-- Îß§ÎèÑ ÏÑπÏÖò -->
            <div id="marketplaceSellSection" style="display: none;">
                <h3 style="color: var(--warning); margin-bottom: 15px;">üìã ÎÇ¥ Î≥¥Ïú† ÌÜ†ÏßÄ</h3>
                <div id="myLandList">
                    <!-- ÎÇ¥Í∞Ä Î≥¥Ïú†Ìïú ÌÜ†ÏßÄ Î™©Î°ù -->
                </div>
            </div>
            
            <div style="display: flex; gap: 15px; margin-top: 30px;">
                <button class="btn btn-secondary" style="flex: 1;" onclick="closeLandMarketplace()">Îã´Í∏∞</button>
            </div>
        </div>
    </div>
    
    <!-- Land Sale Modal -->
    <div id="landSaleModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 2002; justify-content: center; align-items: center;">
        <div style="background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%); border: 1px solid rgba(255,255,255,0.1); border-radius: 20px; padding: 40px; max-width: 500px; width: 90%;">
            <h3 style="text-align: center; margin-bottom: 20px; color: var(--warning);">üí∏ ÌÜ†ÏßÄ Îß§ÎèÑ</h3>
            
            <div style="margin-bottom: 20px; padding: 15px; background: rgba(255, 255, 255, 0.05); border-radius: 10px;">
                <div id="saleItemInfo">
                    <!-- Îß§ÎèÑÌï† ÌÜ†ÏßÄ Ï†ïÎ≥¥ -->
                </div>
            </div>
            
            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 10px; color: #cbd5e1;">Îß§ÎèÑ Í∞ÄÍ≤© ÏÑ§Ï†ï:</label>
                <input type="range" id="salePriceSlider" min="10" max="1000" value="100" 
                       style="width: 100%; margin-bottom: 10px;"
                       oninput="updateSalePrice()">
                <div style="display: flex; justify-content: space-between; color: #94a3b8; font-size: 0.9rem;">
                    <span>10% (Ìè≠ÌÉÑÏÑ∏Ïùº)</span>
                    <span id="salePricePercent">100% (ÌòÑÏû¨Í∞Ä)</span>
                    <span>1000% (Ìà¨Í∏∞)</span>
                </div>
            </div>
            
            <div style="margin-bottom: 20px; padding: 15px; background: rgba(59, 130, 246, 0.1); border-radius: 10px;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                    <span>Íµ¨Îß§ ÎãπÏãú Í∞ÄÍ≤©:</span>
                    <span id="originalPurchasePrice">0 ÎπÑÌä∏ÌÅ¨Î†àÎîß</span>
                </div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                    <span>ÌòÑÏû¨ ÏãúÏÑ∏:</span>
                    <span id="currentMarketPrice">0 ÎπÑÌä∏ÌÅ¨Î†àÎîß</span>
                </div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                    <span>Îß§ÎèÑ Í∞ÄÍ≤©:</span>
                    <span id="finalSalePrice" style="font-weight: bold; color: var(--warning);">0 ÎπÑÌä∏ÌÅ¨Î†àÎîß</span>
                </div>
                <hr style="border: 1px solid rgba(255,255,255,0.1); margin: 10px 0;">
                <div style="display: flex; justify-content: space-between; font-weight: bold;">
                    <span>ÏòàÏÉÅ ÏÜêÏùµ:</span>
                    <span id="expectedProfit" style="color: var(--success);">+0 ÎπÑÌä∏ÌÅ¨Î†àÎîß</span>
                </div>
            </div>
            
            <div style="display: flex; gap: 15px;">
                <button class="btn btn-secondary" style="flex: 1;" onclick="closeLandSaleModal()">Ï∑®ÏÜå</button>
                <button class="btn" style="flex: 1;" onclick="confirmLandSale()" id="confirmSaleBtn">Îß§ÎèÑÌïòÍ∏∞</button>
            </div>
        </div>
    </div>
    
    <!-- Stock Market Modal -->
    <div id="stockMarketModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 2001; justify-content: center; align-items: center;">
        <div style="background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%); border: 1px solid rgba(255,255,255,0.1); border-radius: 20px; padding: 40px; max-width: 800px; width: 90%; max-height: 85vh; overflow-y: auto;">
            <h2 style="text-align: center; margin-bottom: 20px; color: var(--primary);">üìä Ï£ºÏãù ÏãúÏû•</h2>
            
            <div style="margin-bottom: 30px; padding: 15px; background: rgba(59, 130, 246, 0.1); border-radius: 10px; text-align: center;">
                <div style="font-size: 1.1rem; font-weight: bold; color: var(--primary);">
                    KOSPI: <span id="stockModalKospi">2,400</span> 
                    (<span id="stockModalKospiChange" style="color: var(--success);">+0.00%</span>)
                </div>
                <div style="font-size: 0.9rem; color: #94a3b8; margin-top: 5px;">
                    Ïã§ÏãúÍ∞Ñ Ï£ºÏãù ÏãúÏû• ÌòÑÌô©
                </div>
            </div>
            
            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 30px;" id="stocksList">
                <!-- Ï£ºÏãù Î™©Î°ù -->
            </div>
            
            <div style="display: flex; gap: 15px;">
                <button class="btn btn-secondary" style="flex: 1;" onclick="closeStockMarket()">Îã´Í∏∞</button>
            </div>
        </div>
    </div>
    
    <!-- Crypto Market Modal -->
    <div id="cryptoMarketModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 2001; justify-content: center; align-items: center;">
        <div style="background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%); border: 1px solid rgba(255,255,255,0.1); border-radius: 20px; padding: 40px; max-width: 800px; width: 90%; max-height: 85vh; overflow-y: auto;">
            <h2 style="text-align: center; margin-bottom: 20px; color: var(--warning);">‚Çø ÏïîÌò∏ÌôîÌèê ÏãúÏû•</h2>
            
            <div style="margin-bottom: 30px; padding: 15px; background: rgba(245, 158, 11, 0.1); border-radius: 10px; text-align: center;">
                <div style="font-size: 1.1rem; font-weight: bold; color: var(--warning);">
                    ÏïîÌò∏ÌôîÌèê ÏãúÏû• Ï¥ùÏï°: <span id="cryptoMarketCap">‚Ç©2,847Ï°∞</span>
                </div>
                <div style="font-size: 0.9rem; color: #94a3b8; margin-top: 5px;">
                    24ÏãúÍ∞Ñ Î≥ÄÎèôÎ•† Í∏∞Ï§Ä
                </div>
            </div>
            
            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 30px;" id="cryptosList">
                <!-- ÏïîÌò∏ÌôîÌèê Î™©Î°ù -->
            </div>
            
            <div style="display: flex; gap: 15px;">
                <button class="btn btn-secondary" style="flex: 1;" onclick="closeCryptoMarket()">Îã´Í∏∞</button>
            </div>
        </div>
    </div>
    
    <!-- Investment Detail Modal -->
    <div id="investmentDetailModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 2002; justify-content: center; align-items: center;">
        <div style="background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%); border: 1px solid rgba(255,255,255,0.1); border-radius: 20px; padding: 40px; max-width: 500px; width: 90%;">
            <h3 style="text-align: center; margin-bottom: 20px;" id="investmentDetailTitle">Ìà¨Ïûê ÏÉÅÌíà Íµ¨Îß§</h3>
            
            <div style="margin-bottom: 20px; padding: 15px; background: rgba(255, 255, 255, 0.05); border-radius: 10px;">
                <div id="investmentDetailInfo">
                    <!-- ÏÑ†ÌÉùÎêú Ìà¨Ïûê ÏÉÅÌíà Ï†ïÎ≥¥ -->
                </div>
            </div>
            
            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 10px; color: #cbd5e1;">Ìà¨Ïûê Í∏àÏï° ÏÑ§Ï†ï:</label>
                <input type="range" id="investmentAmountSlider" min="500000" max="10000000" value="1000000" 
                       style="width: 100%; margin-bottom: 10px;"
                       oninput="updateInvestmentAmount()">
                <div style="display: flex; justify-content: space-between; color: #94a3b8; font-size: 0.9rem;">
                    <span>50Îßå ÎπÑÌä∏ÌÅ¨Î†àÎîß</span>
                    <span id="selectedInvestmentAmount">100Îßå ÎπÑÌä∏ÌÅ¨Î†àÎîß</span>
                    <span>1000Îßå ÎπÑÌä∏ÌÅ¨Î†àÎîß</span>
                </div>
            </div>
            
            <div style="margin-bottom: 20px; padding: 15px; background: rgba(59, 130, 246, 0.1); border-radius: 10px;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                    <span>Ìà¨Ïûê Í∏àÏï°:</span>
                    <span id="finalInvestmentAmount" style="font-weight: bold; color: var(--primary);">1,000,000 ÎπÑÌä∏ÌÅ¨Î†àÎîß</span>
                </div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                    <span>ÏòàÏÉÅ Ïõî ÏàòÏùµ:</span>
                    <span id="expectedMonthlyReturn">2,000 ÎπÑÌä∏ÌÅ¨Î†àÎîß</span>
                </div>
                <div style="display: flex; justify-content: space-between;">
                    <span>ÏòàÏÉÅ Ïó∞ ÏàòÏùµÎ•†:</span>
                    <span id="expectedAnnualReturn">+12%</span>
                </div>
            </div>
            
            <div style="display: flex; gap: 15px;">
                <button class="btn btn-secondary" style="flex: 1;" onclick="closeInvestmentDetail()">Ï∑®ÏÜå</button>
                <button class="btn" style="flex: 1;" onclick="confirmInvestment()" id="confirmInvestmentBtn">Ìà¨ÏûêÌïòÍ∏∞</button>
            </div>
        </div>
    </div>

    <script>
        // Î≥ÄÏàò ÏÑ†Ïñ∏
        let supabaseClient = null;
        
        // Î®ºÏ†Ä ÌïÑÏöîÌïú Ìï®ÏàòÎì§ÏùÑ Ï†ïÏùò
        function playDemo() {
            gameState.isDemo = true;
            showNotification('Îç∞Î™® Î™®ÎìúÎ°ú ÌîåÎ†àÏù¥Ìï©ÎãàÎã§', 'info');
            showRoleSelection();
        }

        function showSupabaseSetup() {
            console.log('showSupabaseSetup Ìï®Ïàò Ïã§ÌñâÎê®');
            const supabaseSetupDiv = document.getElementById('supabaseSetup');
            if (supabaseSetupDiv) {
                supabaseSetupDiv.style.display = 'block';
                console.log('supabaseSetup div ÌëúÏãúÎê®');
            } else {
                console.error('supabaseSetup divÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏùå');
            }
        }

        function setupSupabase() {
            const url = document.getElementById('supabaseUrl').value;
            const key = document.getElementById('supabaseKey').value;
            
            if (!url || !key) {
                showNotification('Supabase URLÍ≥º KeyÎ•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî', 'error');
                return;
            }
            
            try {
                const { createClient } = supabase;
                supabaseClient = createClient(url, key);
                
                localStorage.setItem('supabaseUrl', url);
                localStorage.setItem('supabaseKey', key);
                
                showNotification('Supabase Ïó∞Í≤∞ ÏÑ±Í≥µ!', 'success');
                document.getElementById('setupScreen').style.display = 'none';
                document.getElementById('loginScreen').style.display = 'flex';
            } catch (error) {
                showNotification('Supabase Ïó∞Í≤∞ Ïã§Ìå®: ' + error.message, 'error');
            }
        }

        function showNotification(message, type = 'info') {
            const notification = document.getElementById('notification');
            const notificationText = document.getElementById('notificationText');
            
            notificationText.textContent = message;
            notification.className = `notification ${type} show`;
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        function showRoleSelection() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('roleSelection').style.display = 'block';
        }

        function setupEventListeners() {
            // Ï≤´ ÌôîÎ©¥ Î≤ÑÌäºÎì§
            document.getElementById('playDemoBtn')?.addEventListener('click', playDemo);
            document.getElementById('supabaseSetupBtn')?.addEventListener('click', function() {
                console.log('Supabase Ïó∞ÎèôÌïòÍ∏∞ Î≤ÑÌäº ÌÅ¥Î¶≠Îê®');
                showSupabaseSetup();
            });
            
            // Supabase ÏÑ§Ï†ï Î≤ÑÌäºÎì§
            document.getElementById('setupSupabaseBtn')?.addEventListener('click', setupSupabase);
            document.getElementById('cancelSupabaseBtn')?.addEventListener('click', function() {
                document.getElementById('supabaseSetup').style.display = 'none';
            });
            
            // Î°úÍ∑∏Ïù∏ ÌôîÎ©¥ Î≤ÑÌäºÎì§
            document.getElementById('loginBtn')?.addEventListener('click', login);
            document.getElementById('loginHelpBtn')?.addEventListener('click', showLoginHelp);
            document.getElementById('loginAsGuestBtn')?.addEventListener('click', loginAsGuest);
            
            console.log('Î™®Îì† Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑàÍ∞Ä ÏÑ§Ï†ïÎêòÏóàÏäµÎãàÎã§');
        }

        function showLoginHelp() {
            showNotification('Ïù¥Î©îÏùºÍ≥º ÎãâÎÑ§ÏûÑ, ÎπÑÎ∞ÄÎ≤àÌò∏Î•º ÏûÖÎ†•ÌïòÎ©¥ ÏûêÎèôÏúºÎ°ú Í≥ÑÏ†ïÏù¥ ÏÉùÏÑ±Îê©ÎãàÎã§!', 'info');
        }

        function login() {
            const email = document.getElementById('email').value || 'demo@demo.com';
            const username = document.getElementById('username').value || 'Player' + Math.floor(Math.random() * 1000);
            
            if (username.length < 3) {
                showNotification('ÏÇ¨Ïö©ÏûêÎ™ÖÏùÄ 3Ïûê Ïù¥ÏÉÅÏù¥Ïñ¥Ïïº Ìï©ÎãàÎã§', 'error');
                return;
            }
            
            gameState.currentUser = {
                id: 'demo_' + Date.now(),
                username: username,
                email: email,
                game_balance: 1000,
                role: null
            };
            
            updateUserDisplay();
            showRoleSelection();
        }

        function loginAsGuest() {
            gameState.isDemo = true;
            gameState.currentUser = {
                id: 'guest_' + Date.now(),
                username: 'Guest_' + Math.floor(Math.random() * 10000),
                email: 'guest@demo.com',
                game_balance: 500,
                role: null
            };
            
            updateUserDisplay();
            showRoleSelection();
        }

        let gameState = {
            currentUser: null,
            selectedRole: null,
            isDemo: false,
            economy: {
                totalUsers: 0,
                totalEconomy: 0,
                totalBusinesses: 0,
                totalLoans: 0,
                // Ïù∏ÌîåÎ†àÏù¥ÏÖò/ÎîîÌîåÎ†àÏù¥ÏÖò ÏãúÏä§ÌÖú
                inflationRate: 2.5, // Ïó∞Í∞Ñ Ïù∏ÌîåÎ†àÏù¥ÏÖòÏú® (%)
                cumulativeInflation: 1.0, // ÎàÑÏ†Å Ïù∏ÌîåÎ†àÏù¥ÏÖò ÏßÄÏàò (1.0 = Í∏∞Ï§Ä)
                priceLevel: 1.0, // ÌòÑÏû¨ Î¨ºÍ∞Ä ÏàòÏ§Ä
                // Í≤ΩÍ∏∞ ÏÇ¨Ïù¥ÌÅ¥
                economicCycle: {
                    phase: 'expansion', // expansion, peak, contraction, trough
                    duration: 0, // ÌòÑÏû¨ Íµ≠Î©¥ ÏßÄÏÜç Í∏∞Í∞Ñ (Ïõî)
                    intensity: 0.5, // Í≤ΩÍ∏∞ Í∞ïÎèÑ (-1~1, -1=Ïã¨Í∞ÅÌïú Î∂àÌô©, 1=Í≥ºÏó¥ Ìò∏Ìô©)
                    gdpGrowthRate: 3.2, // GDP ÏÑ±Ïû•Î•† (%)
                    unemploymentRate: 4.5, // Ïã§ÏóÖÎ•† (%)
                    consumerConfidence: 75 // ÏÜåÎπÑÏûê Ïã†Î¢∞ÎèÑ (0-100)
                },
                // Í≤ΩÏ†ú ÏßÄÌëúÎì§
                indicators: {
                    interestRate: 3.5, // Í∏∞Ï§Ä Í∏àÎ¶¨ (%)
                    bondYield: 4.2, // 10ÎÖÑ Íµ≠Ï±Ñ ÏàòÏùµÎ•†
                    commodityIndex: 100, // ÏõêÏûêÏû¨ ÏßÄÏàò
                    realEstateIndex: 100, // Î∂ÄÎèôÏÇ∞ ÏßÄÏàò
                    manufacturingIndex: 52.5 // Ï†úÏ°∞ÏóÖ PMI
                }
            },
            bankSettings: {
                baseRate: 5.0,
                loanRate: 8.0,
                depositRate: 3.0,
                bankAssets: 1000000,
                policy: 'balanced',
                totalLoansIssued: 0,
                totalDeposits: 850000,
                bankRating: 'AAA',
                marketShare: 25.0
            },
            roleData: {
                businesses: [],
                investments: [],
                workHistory: [],
                workStats: {
                    salary: 3000,
                    experience: 0,
                    position: 'ÏÇ¨Ïõê',
                    bonuses: 0
                },
                publicCompany: null, // ÏÉÅÏû• Í∏∞ÏóÖ Ï†ïÎ≥¥
                companyRating: {
                    creditRating: 'BBB',
                    reputation: 75,
                    esgScore: 50,
                    marketShare: 5.0
                },
                rdProjects: [],
                competitors: [],
                // Ï∫êÌîºÌÉàÎ¶¨Ï¶ò Ïä§ÌÉÄÏùº Í≤ΩÏ†ú ÏãúÏä§ÌÖú
                supplyChain: {
                    rawMaterials: [], // ÏõêÏûêÏû¨ ÏÉùÏÇ∞ÏóÖÏ≤¥ (ÎÜçÏû•, Í¥ëÏÇ∞, Î™©Ïû•)
                    manufacturers: [], // Ï†úÏ°∞ÏóÖÏ≤¥ (Í≥µÏû•, Í∞ÄÍ≥µÏóÖÏ≤¥)
                    distributors: [], // Ïú†ÌÜµÏóÖÏ≤¥ (ÎèÑÎß§Ï†ê, Î¨ºÎ•òÏÑºÌÑ∞)
                    retailers: [], // ÏÜåÎß§ÏóÖÏ≤¥ (ÏÜåÎß§Ï†ê, ÎåÄÎ¶¨Ï†ê)
                    contracts: [], // Í≥µÍ∏â Í≥ÑÏïΩÎì§
                    inventory: new Map(), // Ïû¨Í≥† Í¥ÄÎ¶¨
                    marketPrices: new Map() // ÏÉÅÌíàÎ≥Ñ ÏãúÏû• Í∞ÄÍ≤©
                },
                // ÎÖ∏ÎèôÏûê Í¥ÄÎ¶¨ ÏãúÏä§ÌÖú
                workforce: {
                    workers: [], // Ï†ÑÏ≤¥ ÎÖ∏ÎèôÏûê Î™©Î°ù
                    jobMarket: [], // Íµ¨Ïù∏ ÏãúÏû•
                    unions: [], // ÎÖ∏ÎèôÏ°∞Ìï© Î™©Î°ù
                    trainingPrograms: [], // ÍµêÏú° ÌîÑÎ°úÍ∑∏Îû®
                    satisfactionFactors: {
                        baseSalary: 100, // Í∏∞Î≥∏ Í∏âÏó¨ ÎßåÏ°±ÎèÑ Í∏∞Ï§Ä
                        benefits: 50, // Î≥µÎ¶¨ÌõÑÏÉù ÏàòÏ§Ä
                        workEnvironment: 50, // Í∑ºÎ¨¥ÌôòÍ≤Ω ÏàòÏ§Ä
                        growthOpportunity: 50 // ÏÑ±Ïû•Í∏∞Ìöå ÏàòÏ§Ä
                    }
                }
            },
            landMarket: {
                totalLand: 1000000, // 100Îßå Ìèâ Ï¥ù ÌÜ†ÏßÄ
                availableLand: 1000000, // ÎÇ®ÏùÄ ÌÜ†ÏßÄ
                landPricePerUnit: 5000, // ÌèâÎãπ Í∏∞Î≥∏ Í∞ÄÍ≤© (ÎπÑÌä∏ÌÅ¨Î†àÎîß) - 25Î∞∞ ÏÉÅÏäπ
                regions: [
                    { name: 'Í∞ïÎÇ®Íµ¨', priceMultiplier: 3.0, available: 50000, total: 50000 },
                    { name: 'ÏÑúÏ¥àÍµ¨', priceMultiplier: 2.5, available: 60000, total: 60000 },
                    { name: 'ÏÜ°ÌååÍµ¨', priceMultiplier: 2.2, available: 70000, total: 70000 },
                    { name: 'ÎßàÌè¨Íµ¨', priceMultiplier: 1.8, available: 80000, total: 80000 },
                    { name: 'ÏÑ±ÎèôÍµ¨', priceMultiplier: 1.5, available: 90000, total: 90000 },
                    { name: 'Í≤ΩÍ∏∞ÎèÑ', priceMultiplier: 1.2, available: 150000, total: 150000 },
                    { name: 'Ïù∏Ï≤ú', priceMultiplier: 1.0, available: 200000, total: 200000 },
                    { name: 'ÏßÄÎ∞©', priceMultiplier: 0.7, available: 300000, total: 300000 }
                ],
                marketplace: [] // Îß§Îß§ ÏãúÏû•Ïóê Ïò¨ÎùºÏò® ÌÜ†ÏßÄÎì§
            },
            p2pMarket: {
                listings: [], // Îß§Î¨º Î™©Î°ù
                transactions: [], // Í±∞Îûò ÎÇ¥Ïó≠
                escrow: [], // ÏóêÏä§ÌÅ¨Î°ú (Í±∞Îûò Ï§ëÏù∏ Ìï≠Î™©)
                fees: {
                    businessSale: 0.05, // ÏÇ¨ÏóÖÏ≤¥ Îß§Îß§ ÏàòÏàòÎ£å 5%
                    assetSale: 0.03, // ÏûêÏÇ∞ Îß§Îß§ ÏàòÏàòÎ£å 3%
                    landSale: 0.04 // Î∂ÄÎèôÏÇ∞ Îß§Îß§ ÏàòÏàòÎ£å 4%
                }
            },
            laborMarket: {
                jobPostings: [], // Íµ¨Ïù∏ Í≥µÍ≥†
                applications: [], // Íµ¨ÏßÅ ÏßÄÏõê
                contracts: [], // Í≥†Ïö© Í≥ÑÏïΩ
                freelanceJobs: [], // ÌîÑÎ¶¨ÎûúÏä§ ÏùºÏûêÎ¶¨
                skills: [ // Ïä§ÌÇ¨ ÏãúÏä§ÌÖú
                    'programming', 'design', 'marketing', 'sales', 'management',
                    'accounting', 'legal', 'engineering', 'research', 'consulting'
                ],
                salaryRanges: { // ÏßÅÏ¢ÖÎ≥Ñ ÌèâÍ∑† Í∏âÏó¨
                    'junior': { min: 2500, max: 4000 },
                    'mid': { min: 4000, max: 7000 },
                    'senior': { min: 7000, max: 12000 },
                    'lead': { min: 12000, max: 20000 },
                    'executive': { min: 20000, max: 50000 }
                }
            },
            resourceSystem: {
                resources: new Map([ // ÏûêÏõê ÌòÑÌô©
                    ['raw_materials', { current: 1000000, max: 1000000, regenerationRate: 100 }],
                    ['energy', { current: 800000, max: 1000000, regenerationRate: 150 }],
                    ['technology', { current: 500000, max: 1000000, regenerationRate: 50 }],
                    ['human_capital', { current: 900000, max: 1000000, regenerationRate: 80 }],
                    ['infrastructure', { current: 700000, max: 1000000, regenerationRate: 30 }]
                ]),
                globalConsumption: 0, // Ï†ÑÏ≤¥ ÏÜåÎ™®Îüâ
                scarcityEffects: new Map(), // Ìù¨ÏÜåÏÑ±Ïóê Îî∞Î•∏ Ìö®Í≥º
                priceMultipliers: new Map() // ÏûêÏõê Î∂ÄÏ°±Ïãú Í∞ÄÍ≤© ÏÉÅÏäπ
            },
            countrySystem: {
                population: 52000000, // 5Ï≤ú2Î∞±ÎßåÎ™Ö (ÌïúÍµ≠ Í∏∞Ï§Ä)
                economicActivity: 0.75, // Í≤ΩÏ†úÌôúÏÑ±ÎèÑ (0-1)
                gdpPerCapita: 35000, // 1Ïù∏Îãπ GDP (Îã¨Îü¨)
                unemploymentRate: 3.2, // Ïã§ÏóÖÎ•†
                consumerSpending: 0.8, // ÏÜåÎπÑÏßÄÏ∂ú ÏßÄÏàò
                businessFormationRate: 0.15, // Ï∞ΩÏóÖÎ•†
                innovationIndex: 0.7, // ÌòÅÏã†ÏßÄÏàò
                regions: [
                    { name: 'ÏÑúÏö∏ÌäπÎ≥ÑÏãú', population: 9700000, economicWeight: 0.25, businessBonus: 1.3 },
                    { name: 'Í≤ΩÍ∏∞ÎèÑ', population: 13500000, economicWeight: 0.22, businessBonus: 1.1 },
                    { name: 'Î∂ÄÏÇ∞Í¥ëÏó≠Ïãú', population: 3400000, economicWeight: 0.08, businessBonus: 0.95 },
                    { name: 'ÎåÄÍµ¨Í¥ëÏó≠Ïãú', population: 2400000, economicWeight: 0.05, businessBonus: 0.9 },
                    { name: 'Ïù∏Ï≤úÍ¥ëÏó≠Ïãú', population: 3000000, economicWeight: 0.07, businessBonus: 1.05 },
                    { name: 'Í∏∞ÌÉÄÏßÄÏó≠', population: 20000000, economicWeight: 0.33, businessBonus: 0.8 }
                ]
            },
            stockMarket: {
                stocks: [
                    { name: 'ÏÇºÏÑ±Ï†ÑÏûê', price: 75000, change: 0, sector: 'tech', dividend: 0.25, description: 'Î∞òÎèÑÏ≤¥, Ïä§ÎßàÌä∏Ìè∞ Í∏ÄÎ°úÎ≤å 1ÏúÑ' },
                    { name: 'SKÌïòÏù¥ÎãâÏä§', price: 120000, change: 0, sector: 'tech', dividend: 0.18, description: 'Î©îÎ™®Î¶¨ Î∞òÎèÑÏ≤¥ Ï†ÑÎ¨∏Í∏∞ÏóÖ' },
                    { name: 'ÎÑ§Ïù¥Î≤Ñ', price: 180000, change: 0, sector: 'tech', dividend: 0.15, description: 'Íµ≠ÎÇ¥ ÏµúÎåÄ Í≤ÄÏÉâÌè¨ÌÑ∏' },
                    { name: 'LGÌôîÌïô', price: 450000, change: 0, sector: 'chemical', dividend: 0.22, description: 'Î∞∞ÌÑ∞Î¶¨, ÌôîÌïôÏÜåÏû¨ ÏÑ†ÎèÑÍ∏∞ÏóÖ' },
                    { name: 'ÌòÑÎåÄÏ∞®', price: 190000, change: 0, sector: 'auto', dividend: 0.35, description: 'Í∏ÄÎ°úÎ≤å ÏôÑÏÑ±Ï∞® Ï†úÏ°∞ÏóÖÏ≤¥' },
                    { name: 'LGÏ†ÑÏûê', price: 95000, change: 0, sector: 'electronics', dividend: 0.28, description: 'Í∞ÄÏ†Ñ, Ï†ÑÏûêÏ†úÌíà Í∏ÄÎ°úÎ≤å Î∏åÎûúÎìú' },
                    { name: 'Ìè¨Ïä§ÏΩî', price: 380000, change: 0, sector: 'steel', dividend: 0.45, description: 'Ï≤†Í∞ï ÏóÖÍ≥Ñ ÏÑ†ÎèÑÍ∏∞ÏóÖ' },
                    { name: 'KBÍ∏àÏúµ', price: 52000, change: 0, sector: 'finance', dividend: 0.55, description: 'Íµ≠ÎÇ¥ Ï£ºÏöî Í∏àÏúµÏßÄÏ£ºÏÇ¨' },
                    { name: 'Ïã†ÌïúÏßÄÏ£º', price: 41000, change: 0, sector: 'finance', dividend: 0.48, description: 'Ï¢ÖÌï© Í∏àÏúµÏÑúÎπÑÏä§ Í∑∏Î£π' },
                    { name: 'Í∏∞ÏïÑ', price: 87000, change: 0, sector: 'auto', dividend: 0.32, description: 'Í∏ÄÎ°úÎ≤å ÏûêÎèôÏ∞® Î∏åÎûúÎìú' },
                    { name: 'Ïπ¥Ïπ¥Ïò§', price: 82000, change: 0, sector: 'tech', dividend: 0.08, description: 'Î™®Î∞îÏùº ÌîåÎû´Ìèº ÏÑ†ÎèÑÍ∏∞ÏóÖ' },
                    { name: 'NFLX', price: 520000, change: 0, sector: 'media', dividend: 0, description: 'Í∏ÄÎ°úÎ≤å Ïä§Ìä∏Î¶¨Î∞ç ÏÑúÎπÑÏä§' },
                    { name: 'AAPL', price: 195000, change: 0, sector: 'tech', dividend: 0.12, description: 'ÏïÑÏù¥Ìè∞, Îß•Î∂Å Ï†úÏ°∞ÏÇ¨' },
                    { name: 'TSLA', price: 240000, change: 0, sector: 'auto', dividend: 0, description: 'Ï†ÑÍ∏∞Ï∞® Î∞è ÏóêÎÑàÏßÄ ÏÜîÎ£®ÏÖò' },
                    { name: 'NVDA', price: 890000, change: 0, sector: 'tech', dividend: 0.05, description: 'AI Ïπ© Ï†ÑÎ¨∏Í∏∞ÏóÖ' }
                ],
                cryptos: [
                    // Î©îÏù¥Ï†Ä ÏïîÌò∏ÌôîÌèê (1-10)
                    { name: 'Bitcoin', symbol: 'BTC', price: 65000000, change: 0, marketCap: 1280000000000, description: 'ÏµúÏ¥àÏù¥Ïûê ÏµúÎåÄ ÏïîÌò∏ÌôîÌèê' },
                    { name: 'Ethereum', symbol: 'ETH', price: 4500000, change: 0, marketCap: 540000000000, description: 'Ïä§ÎßàÌä∏ Ïª®Ìä∏ÎûôÌä∏ ÌîåÎû´Ìèº' },
                    { name: 'Tether', symbol: 'USDT', price: 1320, change: 0, marketCap: 95000000000, description: 'Îã¨Îü¨ Ïó∞Îèô Ïä§ÌÖåÏù¥Î∏îÎπÑÌä∏ÌÅ¨Î†àÎîß' },
                    { name: 'BNB', symbol: 'BNB', price: 380000, change: 0, marketCap: 58000000000, description: 'Î∞îÏù¥ÎÇ∏Ïä§ Í±∞ÎûòÏÜå ÌÜ†ÌÅ∞' },
                    { name: 'XRP', symbol: 'XRP', price: 820, change: 0, marketCap: 46000000000, description: 'Íµ≠Ï†úÏÜ°Í∏à ÏÜîÎ£®ÏÖò' },
                    { name: 'Solana', symbol: 'SOL', price: 180000, change: 0, marketCap: 85000000000, description: 'Í≥†ÏÜç Î∏îÎ°ùÏ≤¥Ïù∏ ÌîåÎû´Ìèº' },
                    { name: 'USD Coin', symbol: 'USDC', price: 1320, change: 0, marketCap: 32000000000, description: 'Í∑úÏ†ú Ï§ÄÏàò Ïä§ÌÖåÏù¥Î∏îÎπÑÌä∏ÌÅ¨Î†àÎîß' },
                    { name: 'Cardano', symbol: 'ADA', price: 650, change: 0, marketCap: 23000000000, description: 'ÏßÄÏÜçÍ∞ÄÎä•Ìïú Î∏îÎ°ùÏ≤¥Ïù∏' },
                    { name: 'Dogecoin', symbol: 'DOGE', price: 150, change: 0, marketCap: 22000000000, description: 'Î∞àÏóêÏÑú ÏãúÏûëÎêú ÏïîÌò∏ÌôîÌèê' },
                    { name: 'TRON', symbol: 'TRX', price: 140, change: 0, marketCap: 12000000000, description: 'ÏóîÌÑ∞ÌÖåÏù∏Î®ºÌä∏ Ï§ëÏã¨ ÌîåÎû´Ìèº' },

                    // Î†àÏù¥Ïñ¥1 Î∏îÎ°ùÏ≤¥Ïù∏ (11-20)
                    { name: 'Avalanche', symbol: 'AVAX', price: 42000, change: 0, marketCap: 15000000000, description: 'Í≥†ÏÑ±Îä• Ïä§ÎßàÌä∏ Ïª®Ìä∏ÎûôÌä∏' },
                    { name: 'Polygon', symbol: 'MATIC', price: 1200, change: 0, marketCap: 11000000000, description: 'Ïù¥ÎçîÎ¶¨ÏõÄ ÌôïÏû• ÏÜîÎ£®ÏÖò' },
                    { name: 'Chainlink', symbol: 'LINK', price: 19000, change: 0, marketCap: 11000000000, description: 'ÌÉàÏ§ëÏïôÌôî Ïò§ÎùºÌÅ¥ ÎÑ§Ìä∏ÏõåÌÅ¨' },
                    { name: 'Litecoin', symbol: 'LTC', price: 95000, change: 0, marketCap: 7000000000, description: 'ÎπÑÌä∏ÎπÑÌä∏ÌÅ¨Î†àÎîßÏùò ÏùÄ' },
                    { name: 'Near Protocol', symbol: 'NEAR', price: 6800, change: 0, marketCap: 6500000000, description: 'Í∞úÎ∞úÏûê ÏπúÌôîÏ†Å ÌîåÎû´Ìèº' },
                    { name: 'Internet Computer', symbol: 'ICP', price: 13000, change: 0, marketCap: 6000000000, description: 'ÌÉàÏ§ëÏïôÌôî Ïù∏ÌÑ∞ÎÑ∑' },
                    { name: 'Aptos', symbol: 'APT', price: 12500, change: 0, marketCap: 5800000000, description: 'Î©îÌÉÄÏùò Diem ÌõÑÍ≥ÑÏûê' },
                    { name: 'Arbitrum', symbol: 'ARB', price: 2100, change: 0, marketCap: 5500000000, description: 'Ïù¥ÎçîÎ¶¨ÏõÄ Î†àÏù¥Ïñ¥2' },
                    { name: 'VeChain', symbol: 'VET', price: 34, change: 0, marketCap: 2500000000, description: 'Í≥µÍ∏âÎßù Ï∂îÏ†Å ÌîåÎû´Ìèº' },
                    { name: 'Algorand', symbol: 'ALGO', price: 270, change: 0, marketCap: 2200000000, description: 'ÏàúÏàò ÏßÄÎ∂ÑÏ¶ùÎ™Ö Î∏îÎ°ùÏ≤¥Ïù∏' },

                    // DeFi ÌÜ†ÌÅ∞ (21-30)
                    { name: 'Uniswap', symbol: 'UNI', price: 8900, change: 0, marketCap: 5300000000, description: 'ÌÉàÏ§ëÏïôÌôî Í±∞ÎûòÏÜå' },
                    { name: 'Aave', symbol: 'AAVE', price: 135000, change: 0, marketCap: 2000000000, description: 'ÌÉàÏ§ëÏïôÌôî ÎåÄÏ∂ú ÌîåÎû´Ìèº' },
                    { name: 'Maker', symbol: 'MKR', price: 1850000, change: 0, marketCap: 1800000000, description: 'DAI Ïä§ÌÖåÏù¥Î∏îÎπÑÌä∏ÌÅ¨Î†àÎîß Î∞úÌñâ' },
                    { name: 'Compound', symbol: 'COMP', price: 68000, change: 0, marketCap: 450000000, description: 'ÏûêÎèôÌôîÎêú ÎåÄÏ∂ú ÌîÑÎ°úÌÜ†ÏΩú' },
                    { name: 'SushiSwap', symbol: 'SUSHI', price: 1450, change: 0, marketCap: 380000000, description: 'Ïª§ÎÆ§ÎãàÌã∞ Ï£ºÎèÑ DEX' },
                    { name: 'Curve', symbol: 'CRV', price: 580, change: 0, marketCap: 650000000, description: 'Ïä§ÌÖåÏù¥Î∏îÎπÑÌä∏ÌÅ¨Î†àÎîß ÏµúÏ†ÅÌôî AMM' },
                    { name: 'PancakeSwap', symbol: 'CAKE', price: 3200, change: 0, marketCap: 480000000, description: 'BSC ÏµúÎåÄ DEX' },
                    { name: 'Synthetix', symbol: 'SNX', price: 3800, change: 0, marketCap: 720000000, description: 'Ìï©ÏÑ± ÏûêÏÇ∞ ÌîÑÎ°úÌÜ†ÏΩú' },
                    { name: '1inch', symbol: '1INCH', price: 560, change: 0, marketCap: 560000000, description: 'DEX Ïñ¥Í∑∏Î¶¨Í≤åÏù¥ÌÑ∞' },
                    { name: 'Balancer', symbol: 'BAL', price: 3400, change: 0, marketCap: 200000000, description: 'ÏûêÎèô Ìè¨Ìä∏Ìè¥Î¶¨Ïò§ Í¥ÄÎ¶¨' },

                    // Í≤åÏûÑ/Î©îÌÉÄÎ≤ÑÏä§ ÌÜ†ÌÅ∞ (31-40)
                    { name: 'Axie Infinity', symbol: 'AXS', price: 8500, change: 0, marketCap: 800000000, description: 'P2E Í≤åÏûÑÏùò ÏÑ†Íµ¨Ïûê' },
                    { name: 'The Sandbox', symbol: 'SAND', price: 650, change: 0, marketCap: 1200000000, description: 'Í∞ÄÏÉÅÏÑ∏Í≥Ñ ÌîåÎû´Ìèº' },
                    { name: 'Decentraland', symbol: 'MANA', price: 680, change: 0, marketCap: 1100000000, description: 'VR Î©îÌÉÄÎ≤ÑÏä§ ÌîåÎû´Ìèº' },
                    { name: 'Gala', symbol: 'GALA', price: 45, change: 0, marketCap: 1500000000, description: 'Î∏îÎ°ùÏ≤¥Ïù∏ Í≤åÏûÑ ÏÉùÌÉúÍ≥Ñ' },
                    { name: 'Enjin Coin', symbol: 'ENJ', price: 380, change: 0, marketCap: 320000000, description: 'Í≤åÏûÑ NFT ÌîåÎû´Ìèº' },
                    { name: 'Immutable X', symbol: 'IMX', price: 2100, change: 0, marketCap: 2800000000, description: 'NFT Ï†ÑÏö© Î†àÏù¥Ïñ¥2' },
                    { name: 'Flow', symbol: 'FLOW', price: 1200, change: 0, marketCap: 1200000000, description: 'NBA Top Shot ÌîåÎû´Ìèº' },
                    { name: 'WAX', symbol: 'WAXP', price: 85, change: 0, marketCap: 380000000, description: 'Í≤åÏûÑ Ï†ÑÏö© Î∏îÎ°ùÏ≤¥Ïù∏' },
                    { name: 'Smooth Love Potion', symbol: 'SLP', price: 5, change: 0, marketCap: 120000000, description: 'Axie Infinity Í≤åÏûÑ ÌÜ†ÌÅ∞' },
                    { name: 'STEPN', symbol: 'GMT', price: 280, change: 0, marketCap: 180000000, description: 'Move-to-Earn Ïï±' },

                    // Î∞àÎπÑÌä∏ÌÅ¨Î†àÎîß & Í∏∞ÌÉÄ (41-50)
                    { name: 'Shiba Inu', symbol: 'SHIB', price: 0.03, change: 0, marketCap: 17000000000, description: 'ÎèÑÏßÄ ÌÇ¨Îü¨ Î∞àÎπÑÌä∏ÌÅ¨Î†àÎîß' },
                    { name: 'Pepe', symbol: 'PEPE', price: 0.000025, change: 0, marketCap: 4200000000, description: 'Í∞úÍµ¨Î¶¨ Î∞à ÌÜ†ÌÅ∞' },
                    { name: 'Floki', symbol: 'FLOKI', price: 0.0003, change: 0, marketCap: 2800000000, description: 'ÏùºÎ°† Î®∏Ïä§ÌÅ¨Ïùò Í∞ú Ïù¥Î¶Ñ' },
                    { name: 'Bonk', symbol: 'BONK', price: 0.00005, change: 0, marketCap: 3200000000, description: 'ÏÜîÎùºÎÇò Î∞àÎπÑÌä∏ÌÅ¨Î†àÎîß' },
                    { name: 'SafeMoon', symbol: 'SAFEMOON', price: 0.0008, change: 0, marketCap: 480000000, description: 'BSC Î∞àÎπÑÌä∏ÌÅ¨Î†àÎîß' },
                    { name: 'Basic Attention Token', symbol: 'BAT', price: 320, change: 0, marketCap: 480000000, description: 'Î∏åÎ†àÏù¥Î∏å Î∏åÎùºÏö∞Ï†Ä ÌÜ†ÌÅ∞' },
                    { name: 'Chiliz', symbol: 'CHZ', price: 125, change: 0, marketCap: 1100000000, description: 'Ïä§Ìè¨Ï∏† Ìå¨ ÌÜ†ÌÅ∞' },
                    { name: 'Theta', symbol: 'THETA', price: 1850, change: 0, marketCap: 1850000000, description: 'ÌÉàÏ§ëÏïôÌôî ÎπÑÎîîÏò§ Ïä§Ìä∏Î¶¨Î∞ç' },
                    { name: 'Holo', symbol: 'HOT', price: 0.35, change: 0, marketCap: 730000000, description: 'P2P Î∂ÑÏÇ∞ Ïª¥Ìì®ÌåÖ' },
                    { name: 'Helium', symbol: 'HNT', price: 8500, change: 0, marketCap: 1400000000, description: 'IoT Î¨¥ÏÑ† ÎÑ§Ìä∏ÏõåÌÅ¨' },

                    // AI & Î®∏Ïã†Îü¨Îãù ÌÜ†ÌÅ∞ (51-60)
                    { name: 'Render', symbol: 'RNDR', price: 9800, change: 0, marketCap: 3600000000, description: 'GPU Î†åÎçîÎßÅ ÎÑ§Ìä∏ÏõåÌÅ¨' },
                    { name: 'Fetch.ai', symbol: 'FET', price: 2100, change: 0, marketCap: 1800000000, description: 'AI ÏûêÏú® Í≤ΩÏ†ú ÏóêÏù¥Ï†ÑÌä∏' },
                    { name: 'SingularityNET', symbol: 'AGIX', price: 520, change: 0, marketCap: 680000000, description: 'AI ÎßàÏºìÌîåÎ†àÏù¥Ïä§' },
                    { name: 'Ocean Protocol', symbol: 'OCEAN', price: 780, change: 0, marketCap: 420000000, description: 'Îç∞Ïù¥ÌÑ∞ Í≤ΩÏ†ú ÌîÑÎ°úÌÜ†ÏΩú' },
                    { name: 'Numeraire', symbol: 'NMR', price: 21000, change: 0, marketCap: 130000000, description: 'Ìó§ÏßÄÌéÄÎìú AI ÌÜ†ÌÅ∞' },
                    { name: 'iExec RLC', symbol: 'RLC', price: 2400, change: 0, marketCap: 180000000, description: 'Î∂ÑÏÇ∞ ÌÅ¥ÎùºÏö∞Îìú Ïª¥Ìì®ÌåÖ' },
                    { name: 'Cortex', symbol: 'CTXC', price: 420, change: 0, marketCap: 95000000, description: 'AI Î∏îÎ°ùÏ≤¥Ïù∏ ÌîåÎû´Ìèº' },
                    { name: 'Matrix AI Network', symbol: 'MAN', price: 85, change: 0, marketCap: 45000000, description: 'AI Í∏∞Î∞ò Î∏îÎ°ùÏ≤¥Ïù∏' },
                    { name: 'DeepBrain Chain', symbol: 'DBC', price: 15, change: 0, marketCap: 38000000, description: 'AI ÌõàÎ†® ÌîåÎû´Ìèº' },
                    { name: 'Artificial Superintelligence', symbol: 'ASI', price: 1800, change: 0, marketCap: 2200000000, description: 'AI ÌÜµÌï© ÌÜ†ÌÅ∞' },

                    // Ïù∏ÌîÑÎùº & Ïò§ÎùºÌÅ¥ ÌÜ†ÌÅ∞ (61-70)
                    { name: 'Filecoin', symbol: 'FIL', price: 8200, change: 0, marketCap: 4600000000, description: 'ÌÉàÏ§ëÏïôÌôî Ïä§ÌÜ†Î¶¨ÏßÄ' },
                    { name: 'Arweave', symbol: 'AR', price: 28000, change: 0, marketCap: 1800000000, description: 'ÏòÅÍµ¨ Îç∞Ïù¥ÌÑ∞ Ïä§ÌÜ†Î¶¨ÏßÄ' },
                    { name: 'Storj', symbol: 'STORJ', price: 850, change: 0, marketCap: 320000000, description: 'Î∂ÑÏÇ∞ ÌÅ¥ÎùºÏö∞Îìú Ïä§ÌÜ†Î¶¨ÏßÄ' },
                    { name: 'Band Protocol', symbol: 'BAND', price: 1900, change: 0, marketCap: 190000000, description: 'ÌÅ¨Î°úÏä§Ï≤¥Ïù∏ Ïò§ÎùºÌÅ¥' },
                    { name: 'API3', symbol: 'API3', price: 2800, change: 0, marketCap: 280000000, description: 'Ï≤´ Î≤àÏß∏ ÌååÌã∞ Ïò§ÎùºÌÅ¥' },
                    { name: 'The Graph', symbol: 'GRT', price: 280, change: 0, marketCap: 2600000000, description: 'Ïù∏Îç±Ïã± ÌîÑÎ°úÌÜ†ÏΩú' },
                    { name: 'Livepeer', symbol: 'LPT', price: 18000, change: 0, marketCap: 550000000, description: 'ÌÉàÏ§ëÏïôÌôî ÎπÑÎîîÏò§ Ïù∏ÌîÑÎùº' },
                    { name: 'Siacoin', symbol: 'SC', price: 8.5, change: 0, marketCap: 480000000, description: 'Î∂ÑÏÇ∞ Ïä§ÌÜ†Î¶¨ÏßÄ' },
                    { name: 'Golem', symbol: 'GLM', price: 650, change: 0, marketCap: 650000000, description: 'Î∂ÑÏÇ∞ Ïª¥Ìì®ÌåÖ ÌååÏõå' },
                    { name: 'PowerLedger', symbol: 'POWR', price: 480, change: 0, marketCap: 240000000, description: 'P2P ÏóêÎÑàÏßÄ Í±∞Îûò' },

                    // ÌîÑÎùºÏù¥Î≤ÑÏãú ÎπÑÌä∏ÌÅ¨Î†àÎîß (71-80)
                    { name: 'Monero', symbol: 'XMR', price: 185000, change: 0, marketCap: 3400000000, description: 'ÏôÑÏ†Ñ ÏùµÎ™Ö ÏïîÌò∏ÌôîÌèê' },
                    { name: 'Zcash', symbol: 'ZEC', price: 38000, change: 0, marketCap: 580000000, description: 'zk-SNARK ÌîÑÎùºÏù¥Î≤ÑÏãú' },
                    { name: 'Dash', symbol: 'DASH', price: 42000, change: 0, marketCap: 480000000, description: 'Ï¶âÏãú Í±∞Îûò ÌîÑÎùºÏù¥Î≤ÑÏãú ÎπÑÌä∏ÌÅ¨Î†àÎîß' },
                    { name: 'Secret', symbol: 'SCRT', price: 680, change: 0, marketCap: 420000000, description: 'ÌîÑÎùºÏù¥Î≤ÑÏãú Ïä§ÎßàÌä∏ Ïª®Ìä∏ÎûôÌä∏' },
                    { name: 'Oasis Network', symbol: 'ROSE', price: 125, change: 0, marketCap: 780000000, description: 'ÌîÑÎùºÏù¥Î≤ÑÏãú Î≥¥Ïû• ÌîåÎû´Ìèº' },
                    { name: 'Horizen', symbol: 'ZEN', price: 14500, change: 0, marketCap: 180000000, description: 'ÌîÑÎùºÏù¥Î≤ÑÏãú Í∏∞Î∞ò ÌîåÎû´Ìèº' },
                    { name: 'PIVX', symbol: 'PIVX', price: 680, change: 0, marketCap: 45000000, description: 'ÌîÑÎùºÏù¥Î≤ÑÏãú ÏßÄÎ∂ÑÏ¶ùÎ™Ö' },
                    { name: 'Beam', symbol: 'BEAM', price: 85, change: 0, marketCap: 48000000, description: 'ÌôïÏû•Í∞ÄÎä•Ìïú ÌîÑÎùºÏù¥Î≤ÑÏãú ÎπÑÌä∏ÌÅ¨Î†àÎîß' },
                    { name: 'Grin', symbol: 'GRIN', price: 58, change: 0, marketCap: 32000000, description: 'MimbleWimble ÌîÑÎ°úÌÜ†ÏΩú' },
                    { name: 'Firo', symbol: 'FIRO', price: 2800, change: 0, marketCap: 38000000, description: 'Í∏àÏúµ ÌîÑÎùºÏù¥Î≤ÑÏãú' },

                    // Î†àÏù¥Ïñ¥2 & Ïä§ÏºÄÏùºÎßÅ (81-90)
                    { name: 'Optimism', symbol: 'OP', price: 3200, change: 0, marketCap: 3200000000, description: 'Ïù¥ÎçîÎ¶¨ÏõÄ Î†àÏù¥Ïñ¥2 ÏÜîÎ£®ÏÖò' },
                    { name: 'Loopring', symbol: 'LRC', price: 420, change: 0, marketCap: 520000000, description: 'zkRollup DEX ÌîÑÎ°úÌÜ†ÏΩú' },
                    { name: 'StarkNet', symbol: 'STRK', price: 850, change: 0, marketCap: 6800000000, description: 'zk-STARK Î†àÏù¥Ïñ¥2' },
                    { name: 'Metis', symbol: 'METIS', price: 58000, change: 0, marketCap: 380000000, description: 'Ïù¥ÎçîÎ¶¨eum Î†àÏù¥Ïñ¥2' },
                    { name: 'Boba Network', symbol: 'BOBA', price: 380, change: 0, marketCap: 95000000, description: 'ÌïòÏù¥Î∏åÎ¶¨Îìú Î†àÏù¥Ïñ¥2' },
                    { name: 'OMG Network', symbol: 'OMG', price: 680, change: 0, marketCap: 95000000, description: 'ÌîåÎùºÏ¶àÎßà Ïä§ÏºÄÏùºÎßÅ' },
                    { name: 'Skale', symbol: 'SKL', price: 85, change: 0, marketCap: 320000000, description: 'Î©ÄÌã∞Ï≤¥Ïù∏ ÎÑ§Ìä∏ÏõåÌÅ¨' },
                    { name: 'Cartesi', symbol: 'CTSI', price: 280, change: 0, marketCap: 190000000, description: 'Î¶¨ÎàÖÏä§ dApp ÌîåÎû´Ìèº' },
                    { name: 'xDAI', symbol: 'STAKE', price: 1200, change: 0, marketCap: 95000000, description: 'Ïä§ÌÖåÏù¥Î∏î Ï≤¥Ïù∏' },
                    { name: 'Hermez', symbol: 'HEZ', price: 850, change: 0, marketCap: 85000000, description: 'zk-Rollup ÎÑ§Ìä∏ÏõåÌÅ¨' },

                    // Ï§ëÏïôÍ±∞ÎûòÏÜå ÌÜ†ÌÅ∞ (91-100)
                    { name: 'FTX Token', symbol: 'FTT', price: 2800, change: 0, marketCap: 950000000, description: 'FTX Í±∞ÎûòÏÜå ÌÜ†ÌÅ∞' },
                    { name: 'KuCoin Token', symbol: 'KCS', price: 12500, change: 0, marketCap: 1200000000, description: 'Ïø†ÎπÑÌä∏ÌÅ¨Î†àÎîß Í±∞ÎûòÏÜå ÌÜ†ÌÅ∞' },
                    { name: 'Huobi Token', symbol: 'HT', price: 850, change: 0, marketCap: 180000000, description: 'ÌõÑÏò§ÎπÑ Í±∞ÎûòÏÜå ÌÜ†ÌÅ∞' },
                    { name: 'Crypto.com Coin', symbol: 'CRO', price: 150, change: 0, marketCap: 3800000000, description: 'Crypto.com ÏÉùÌÉúÍ≥Ñ' },
                    { name: 'Gate Token', symbol: 'GT', price: 8500, change: 0, marketCap: 850000000, description: 'Gate.io Í±∞ÎûòÏÜå ÌÜ†ÌÅ∞' },
                    { name: 'MEXC Token', symbol: 'MX', price: 4200, change: 0, marketCap: 680000000, description: 'MEXC Í±∞ÎûòÏÜå ÌÜ†ÌÅ∞' },
                    { name: 'Biswap', symbol: 'BSW', price: 185, change: 0, marketCap: 85000000, description: 'BSC DEX ÌÜ†ÌÅ∞' },
                    { name: 'Bitget Token', symbol: 'BGB', price: 1200, change: 0, marketCap: 1800000000, description: 'Bitget Í±∞ÎûòÏÜå ÌÜ†ÌÅ∞' },
                    { name: 'OKB', symbol: 'OKB', price: 58000, change: 0, marketCap: 3500000000, description: 'OKX Í±∞ÎûòÏÜå ÌÜ†ÌÅ∞' },
                    { name: 'LEO Token', symbol: 'LEO', price: 8200, change: 0, marketCap: 7600000000, description: 'Bitfinex Í±∞ÎûòÏÜå ÌÜ†ÌÅ∞' },

                    // ÏÜåÏÖú & Ï∞ΩÏûëÏûê ÌÜ†ÌÅ∞ (101-110)
                    { name: 'Rally', symbol: 'RLY', price: 28, change: 0, marketCap: 85000000, description: 'Ï∞ΩÏûëÏûê Í≤ΩÏ†ú ÌîåÎû´Ìèº' },
                    { name: 'BitClout', symbol: 'CLOUT', price: 1200, change: 0, marketCap: 180000000, description: 'ÏÜåÏÖú Î∏îÎ°ùÏ≤¥Ïù∏' },
                    { name: 'Friend.tech', symbol: 'FRIEND', price: 850, change: 0, marketCap: 420000000, description: 'ÏÜåÏÖúÌååÏù¥ ÌîåÎû´Ìèº' },
                    { name: 'Lens Protocol', symbol: 'LENS', price: 2800, change: 0, marketCap: 280000000, description: 'ÌÉàÏ§ëÏïôÌôî ÏÜåÏÖú Í∑∏ÎûòÌîÑ' },
                    { name: 'Mirror', symbol: 'MIR', price: 480, change: 0, marketCap: 38000000, description: 'ÌÉàÏ§ëÏïôÌôî ÌçºÎ∏îÎ¶¨Ïã±' },
                    { name: 'Audius', symbol: 'AUDIO', price: 280, change: 0, marketCap: 190000000, description: 'ÏùåÏïÖ Ïä§Ìä∏Î¶¨Î∞ç ÌîåÎû´Ìèº' },
                    { name: 'Steem', symbol: 'STEEM', price: 380, change: 0, marketCap: 140000000, description: 'ÏÜåÏÖú Î∏îÎ°ùÏ≤¥Ïù∏ ÌîåÎû´Ìèº' },
                    { name: 'Hive', symbol: 'HIVE', price: 580, change: 0, marketCap: 220000000, description: 'ÌÉàÏ§ëÏïôÌôî ÏÜåÏÖú ÎØ∏ÎîîÏñ¥' },
                    { name: 'Minds', symbol: 'MINDS', price: 125, change: 0, marketCap: 28000000, description: 'Ïò§ÌîàÏÜåÏä§ ÏÜåÏÖú ÎÑ§Ìä∏ÏõåÌÅ¨' },
                    { name: 'Steemit', symbol: 'SBD', price: 1200, change: 0, marketCap: 12000000, description: 'Ïä§ÌåÄ Îã¨Îü¨' },

                    // Ïã§ÌóòÏ†Å & ÏÉàÎ°úÏö¥ ÌîÑÎ°úÏ†ùÌä∏ (111-120)
                    { name: 'Worldcoin', symbol: 'WLD', price: 3200, change: 0, marketCap: 1200000000, description: 'Í∏ÄÎ°úÎ≤å UBI ÌîÑÎ°úÏ†ùÌä∏' },
                    { name: 'Bitcoin Ordinals', symbol: 'ORDI', price: 58000, change: 0, marketCap: 1200000000, description: 'ÎπÑÌä∏ÎπÑÌä∏ÌÅ¨Î†àÎîß NFT' },
                    { name: 'Kaspa', symbol: 'KAS', price: 185, change: 0, marketCap: 4500000000, description: 'DAG Î∏îÎ°ùÏ≤¥Ïù∏' },
                    { name: 'Sei', symbol: 'SEI', price: 680, change: 0, marketCap: 2800000000, description: 'Í±∞Îûò ÌäπÌôî Î†àÏù¥Ïñ¥1' },
                    { name: 'Celestia', symbol: 'TIA', price: 8500, change: 0, marketCap: 1400000000, description: 'Î™®ÎìàÎü¨ Î∏îÎ°ùÏ≤¥Ïù∏' },
                    { name: 'Pendle', symbol: 'PENDLE', price: 7200, change: 0, marketCap: 1100000000, description: 'ÏàòÏùµÎ•† ÌÜ†ÌÅ¨ÎÇòÏù¥Ï†úÏù¥ÏÖò' },
                    { name: 'JasmyCoin', symbol: 'JASMY', price: 42, change: 0, marketCap: 2000000000, description: 'ÏùºÎ≥∏ IoT ÌîåÎû´Ìèº' },
                    { name: 'Stacks', symbol: 'STX', price: 2800, change: 0, marketCap: 4100000000, description: 'ÎπÑÌä∏ÎπÑÌä∏ÌÅ¨Î†àÎîß Ïä§ÎßàÌä∏ Ïª®Ìä∏ÎûôÌä∏' },
                    { name: 'Radix', symbol: 'XRD', price: 58, change: 0, marketCap: 680000000, description: 'DeFi ÌäπÌôî Î†àÏù¥Ïñ¥1' },
                    { name: 'MultiversX', symbol: 'EGLD', price: 38000, change: 0, marketCap: 980000000, description: 'Í≥†ÏÑ±Îä• ÏÉ§Îî© Î∏îÎ°ùÏ≤¥Ïù∏' }
                ],
                kospi: 2400,
                kospiChange: 0,
                usdkrw: 1320,
                usdkrwChange: 0
            }
        };
        
        // Í∏∞ÌÉÄ Ìï®ÏàòÎì§ (Ï§ëÎ≥µ Ï†úÍ±∞Îê®)
        
        function showRoleSelection() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('roleSelection').style.display = 'block';
        }
        
        function selectRole(role) {
            document.querySelectorAll('.role-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            document.getElementById(`role-${role}`).classList.add('selected');
            gameState.selectedRole = role;
        }
        
        function confirmRole() {
            if (!gameState.selectedRole) {
                showNotification('Ïó≠Ìï†ÏùÑ ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî', 'error');
                return;
            }
            
            gameState.currentUser.role = gameState.selectedRole;
            
            // Ïó≠Ìï† Î≥¥ÎÑàÏä§
            switch (gameState.selectedRole) {
                case 'banker':
                    gameState.currentUser.game_balance += 10000;
                    break;
                case 'entrepreneur':
                    gameState.currentUser.game_balance += 5000;
                    break;
                case 'investor':
                    gameState.currentUser.game_balance += 7000;
                    break;
                case 'worker':
                    gameState.currentUser.game_balance += 2000;
                    break;
            }
            
            showGame();
        }
        
        async function showGame() {
            document.getElementById('roleSelection').style.display = 'none';
            document.getElementById('gameContainer').style.display = 'block';
            
            // UI ÏóÖÎç∞Ïù¥Ìä∏
            document.getElementById('userAvatar').textContent = gameState.currentUser.username[0].toUpperCase();
            document.getElementById('userName').textContent = gameState.currentUser.username;
            
            const roleNames = {
                'banker': 'ÏùÄÌñâÏû•',
                'entrepreneur': 'ÏÇ¨ÏóÖÍ∞Ä',
                'investor': 'Ìà¨ÏûêÏûê',
                'worker': 'ÏßÅÏû•Ïù∏'
            };
            document.getElementById('userRole').textContent = roleNames[gameState.currentUser.role] || 'ÏãúÎØº';
            
            // Ï∫êÌîºÌÉàÎ¶¨Ï¶ò ÏãúÏû• Í∞ÄÍ≤© Ï¥àÍ∏∞Ìôî
            initializeMarketPrices();
            
            // Ïó≠Ìï†Î≥Ñ Î©îÎâ¥ ÌëúÏãú - Î™®Îì† Ïó≠Ìï†Ïù¥ ÏÇ¨ÏóÖÍ≥º Ìà¨Ïûê Í∏∞Îä• ÏÇ¨Ïö© Í∞ÄÎä•
            initializeBusinessData(); // Î™®Îì† Ïó≠Ìï†Ïóê ÏÇ¨ÏóÖ Îç∞Ïù¥ÌÑ∞ Ï¥àÍ∏∞Ìôî
            initializeInvestmentData(); // Î™®Îì† Ïó≠Ìï†Ïóê Ìà¨Ïûê Îç∞Ïù¥ÌÑ∞ Ï¥àÍ∏∞Ìôî
            document.getElementById('investmentMenu').style.display = 'block'; // Î™®Îì† Ïó≠Ìï†Ïù¥ Ìà¨Ïûê Î©îÎâ¥ ÏÇ¨Ïö© Í∞ÄÎä•
            
            if (gameState.currentUser.role === 'banker') {
                document.getElementById('bankMenu').style.display = 'block';
                updateBankDisplay();
            } else if (gameState.currentUser.role === 'worker') {
                document.getElementById('workMenu').style.display = 'block';
                initializeWorkData();
            }
            
            updateDisplay();
            updateUserDisplay(); // ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥ ÌëúÏãú
            
            // SupabaseÏóêÏÑú Í∏∞Ï°¥ Îç∞Ïù¥ÌÑ∞ Î°úÎìú ÏãúÎèÑ
            if (supabaseClient && !gameState.isDemo) {
                const cloudLoaded = await loadGameStateFromSupabase();
                if (!cloudLoaded) {
                    // ÌÅ¥ÎùºÏö∞ÎìúÏóê Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏúºÎ©¥ Î°úÏª¨ Îç∞Ïù¥ÌÑ∞ ÏãúÎèÑ
                    loadGameState();
                }
            } else {
                // Îç∞Î™® Î™®ÎìúÏù¥Í±∞ÎÇò Supabase Ïó∞Í≤∞Ïù¥ ÏóÜÏúºÎ©¥ Î°úÏª¨ Îç∞Ïù¥ÌÑ∞Îßå
                loadGameState();
            }
            
            startIncomeSystem(); // ÏûêÎèô ÏàòÏùµ ÏãúÏä§ÌÖú ÏãúÏûë
            startEconomicSystem(); // Í≤ΩÏ†ú ÏÇ¨Ïù¥ÌÅ¥ ÏãúÏä§ÌÖú ÏãúÏûë
            startResourceSystem(); // ÏûêÏõê ÏãúÏä§ÌÖú ÏãúÏûë
            updateMarketDisplay(); // ÏãúÏû• Îç∞Ïù¥ÌÑ∞ ÏóÖÎç∞Ïù¥Ìä∏
            startMarketSystem(); // ÏãúÏû• Î≥ÄÎèô ÏãúÏä§ÌÖú ÏãúÏûë
            startAutoSave(); // ÏûêÎèô Ï†ÄÏû• ÏãúÏä§ÌÖú ÏãúÏûë
            showNotification(`ÌôòÏòÅÌï©ÎãàÎã§, ${gameState.currentUser.username}Îãò!`, 'success');
        }
        
        // Ï£ºÏãù ÏãúÏû• ÏóÖÎç∞Ïù¥Ìä∏ Ìï®Ïàò
        function updateMarketDisplay() {
            // Ï£ºÏãù ÏãúÏû• ÏóÖÎç∞Ïù¥Ìä∏
            const stockMarketDiv = document.getElementById('stockMarket');
            stockMarketDiv.innerHTML = '';
            
            gameState.stockMarket.stocks.forEach(stock => {
                const stockItem = document.createElement('div');
                stockItem.className = 'market-item';
                const changeColor = stock.change >= 0 ? 'var(--success)' : 'var(--danger)';
                const changeSign = stock.change >= 0 ? '+' : '';
                
                stockItem.innerHTML = `
                    <div class="market-item-header">
                        <span class="market-item-name">${stock.name}</span>
                        <span class="market-item-price">${stock.price.toLocaleString()}Ïõê</span>
                    </div>
                    <div class="market-item-change" style="color: ${changeColor}">${changeSign}${stock.change.toFixed(2)}%</div>
                `;
                stockMarketDiv.appendChild(stockItem);
            });
            
            // ÏïîÌò∏ÌôîÌèê ÏãúÏû• ÏóÖÎç∞Ïù¥Ìä∏
            const cryptoMarketDiv = document.getElementById('cryptoMarket');
            cryptoMarketDiv.innerHTML = '';
            
            gameState.stockMarket.cryptos.forEach(crypto => {
                const cryptoItem = document.createElement('div');
                cryptoItem.className = 'market-item';
                const changeColor = crypto.change >= 0 ? 'var(--success)' : 'var(--danger)';
                const changeSign = crypto.change >= 0 ? '+' : '';
                
                cryptoItem.innerHTML = `
                    <div class="market-item-header">
                        <span class="market-item-name">${crypto.name}</span>
                        <span class="market-item-price">‚Ç©${crypto.price.toLocaleString()}</span>
                    </div>
                    <div class="market-item-change" style="color: ${changeColor}">${changeSign}${crypto.change.toFixed(2)}%</div>
                `;
                cryptoMarketDiv.appendChild(cryptoItem);
            });
            
            // Í≤ΩÏ†ú ÏßÄÌëú ÏóÖÎç∞Ïù¥Ìä∏
            document.getElementById('kospiIndex').textContent = gameState.stockMarket.kospi.toLocaleString();
            document.getElementById('kospiChange').textContent = (gameState.stockMarket.kospiChange >= 0 ? '+' : '') + 
                gameState.stockMarket.kospiChange.toFixed(2) + '%';
            document.getElementById('kospiChange').style.color = gameState.stockMarket.kospiChange >= 0 ? 'var(--success)' : 'var(--danger)';
            
            document.getElementById('usdkrw').textContent = gameState.stockMarket.usdkrw.toLocaleString();
            document.getElementById('usdkrwChange').textContent = (gameState.stockMarket.usdkrwChange >= 0 ? '+' : '') + 
                gameState.stockMarket.usdkrwChange.toFixed(2) + '%';
            document.getElementById('usdkrwChange').style.color = gameState.stockMarket.usdkrwChange >= 0 ? 'var(--success)' : 'var(--danger)';
        }
        
        // Ï£ºÏãù ÏãúÏû• Î≥ÄÎèô ÏãúÏä§ÌÖú
        function startMarketSystem() {
            setInterval(() => {
                // Ï£ºÏãù Í∞ÄÍ≤© Î≥ÄÎèô (ÏùºÏùº ÏµúÎåÄ 30%)
                gameState.stockMarket.stocks.forEach(stock => {
                    // ÎàÑÏ†Å ÏùºÏùº Î≥ÄÎèôÎ•† Ï∂îÏ†Å
                    if (!stock.dailyChangeAccumulated) stock.dailyChangeAccumulated = 0;
                    
                    const volatility = stock.sector === 'tech' ? 0.08 : 0.05; // ÌÖåÌÅ¨ Ï£ºÏãùÏù¥ Îçî Î≥ÄÎèôÏÑ± ÌÅº
                    let priceChange = (Math.random() - 0.5) * volatility * 2;
                    
                    // ÏùºÏùº ÏµúÎåÄ 30% Ï†úÌïú
                    const maxDailyChange = 0.3;
                    if (Math.abs(stock.dailyChangeAccumulated + priceChange) > maxDailyChange) {
                        priceChange = Math.sign(priceChange) * (maxDailyChange - Math.abs(stock.dailyChangeAccumulated));
                    }
                    
                    stock.dailyChangeAccumulated += priceChange;
                    stock.change = priceChange * 100;
                    stock.price = Math.max(stock.price * (1 + priceChange), 1000);
                });
                
                // ÏïîÌò∏ÌôîÌèê Í∞ÄÍ≤© Î≥ÄÎèô (Ï†úÌïú ÏóÜÏùå)
                gameState.stockMarket.cryptos.forEach(crypto => {
                    const priceChange = (Math.random() - 0.5) * 0.2; // ¬±10% Î≥ÄÎèô (Îçî ÌÅ∞ Î≥ÄÎèôÏÑ±)
                    crypto.change = priceChange * 100;
                    crypto.price = Math.max(crypto.price * (1 + priceChange), 1);
                });
                
                // ÏΩîÏä§Ìîº ÏßÄÏàò Î≥ÄÎèô (ÏµúÎåÄ 5%)
                let kospiChange = (Math.random() - 0.5) * 0.1; // ¬±5% Î≥ÄÎèô
                if (!gameState.stockMarket.kospiDailyChange) gameState.stockMarket.kospiDailyChange = 0;
                
                const maxKospiChange = 0.05;
                if (Math.abs(gameState.stockMarket.kospiDailyChange + kospiChange) > maxKospiChange) {
                    kospiChange = Math.sign(kospiChange) * (maxKospiChange - Math.abs(gameState.stockMarket.kospiDailyChange));
                }
                
                gameState.stockMarket.kospiDailyChange += kospiChange;
                gameState.stockMarket.kospiChange = kospiChange * 100;
                gameState.stockMarket.kospi = Math.max(gameState.stockMarket.kospi * (1 + kospiChange), 1000);
                
                // ÌôòÏú® Î≥ÄÎèô (ÏµúÎåÄ 3%)
                let usdChange = (Math.random() - 0.5) * 0.06; // ¬±3% Î≥ÄÎèô
                if (!gameState.stockMarket.usdkrwDailyChange) gameState.stockMarket.usdkrwDailyChange = 0;
                
                const maxUsdChange = 0.03;
                if (Math.abs(gameState.stockMarket.usdkrwDailyChange + usdChange) > maxUsdChange) {
                    usdChange = Math.sign(usdChange) * (maxUsdChange - Math.abs(gameState.stockMarket.usdkrwDailyChange));
                }
                
                gameState.stockMarket.usdkrwDailyChange += usdChange;
                gameState.stockMarket.usdkrwChange = usdChange * 100;
                gameState.stockMarket.usdkrw = Math.max(gameState.stockMarket.usdkrw * (1 + usdChange), 1000);
                
                updateMarketDisplay();
                
                // ÏãúÏû• ÏÉÅÌô©Ïóê Îî∞Î•∏ ÏÇ¨ÏóÖ Í∞ÄÏπò ÏòÅÌñ•
                if (gameState.currentUser && gameState.currentUser.role === 'entrepreneur') {
                    applyMarketEffectToBusiness();
                }
            }, 8000); // 8Ï¥àÎßàÎã§ ÏãúÏû• Î≥ÄÎèô
        }
        
        // ÏãúÏû• ÏÉÅÌô©Ïù¥ ÏÇ¨ÏóÖÏóê ÎØ∏ÏπòÎäî ÏòÅÌñ•
        function applyMarketEffectToBusiness() {
            if (gameState.roleData.businesses.length === 0) return;
            
            // ÏΩîÏä§Ìîº ÏßÄÏàòÏóê Îî∞Î•∏ Ï†ÑÏ≤¥Ï†ÅÏù∏ ÏãúÏû• ÏòÅÌñ•
            const marketSentiment = gameState.stockMarket.kospiChange;
            
            gameState.roleData.businesses.forEach(business => {
                // ÏÇ¨ÏóÖ Ï¢ÖÎ•òÏóê Îî∞Î•∏ ÏãúÏû• ÎØºÍ∞êÎèÑ
                let marketSensitivity = 0.002; // Í∏∞Î≥∏ ÎØºÍ∞êÎèÑ
                
                if (business.name.includes('IT') || business.name.includes('Ïä§ÌÉÄÌä∏ÏóÖ')) {
                    // IT Í¥ÄÎ†® ÏÇ¨ÏóÖÏùÄ ÌÖåÌÅ¨ Ï£ºÏãùÍ≥º Ïó∞Îèô
                    const techStocks = gameState.stockMarket.stocks.filter(s => s.sector === 'tech');
                    const avgTechChange = techStocks.reduce((sum, s) => sum + s.change, 0) / techStocks.length;
                    marketSensitivity = 0.005;
                    
                    const techEffect = avgTechChange * marketSensitivity;
                    business.value = Math.max(Math.floor(business.value * (1 + techEffect / 100)), 1000);
                    
                    if (Math.abs(avgTechChange) > 3) { // ÌÅ∞ Î≥ÄÎèô Ïãú ÏïåÎ¶º
                        const direction = avgTechChange > 0 ? 'ÏÉÅÏäπ' : 'ÌïòÎùΩ';
                        showNotification(`üìà ÌÖåÌÅ¨ ÏãúÏû• ${direction}ÏúºÎ°ú ${business.name} Í∞ÄÏπò Î≥ÄÎèô`, avgTechChange > 0 ? 'info' : 'warning');
                    }
                    
                } else if (business.name.includes('ÏùåÏãùÏ†ê') || business.name.includes('Ïπ¥Ìéò')) {
                    // Ïô∏ÏãùÏóÖÏùÄ ÌôòÏú®Í≥º Î∞òÎåÄÎ°ú Ïó∞Îèô (ÌôòÏú® ÏÉÅÏäπ Ïãú ÎÇ¥Ïàò Ï¶ùÍ∞Ä)
                    const usdEffect = -gameState.stockMarket.usdkrwChange * 0.003;
                    business.value = Math.max(Math.floor(business.value * (1 + usdEffect / 100)), 1000);
                    
                } else {
                    // ÏùºÎ∞ò ÏÇ¨ÏóÖÏùÄ ÏΩîÏä§ÌîºÏôÄ Ïó∞Îèô
                    const kospiEffect = marketSentiment * marketSensitivity;
                    business.value = Math.max(Math.floor(business.value * (1 + kospiEffect / 100)), 1000);
                }
                
                // Í∑πÎã®Ï†ÅÏù∏ ÏãúÏû• ÏÉÅÌô©ÏóêÏÑúÎäî ÌäπÎ≥Ñ Ïù¥Î≤§Ìä∏
                if (Math.abs(marketSentiment) > 3) { // ÏΩîÏä§Ìîº 3% Ïù¥ÏÉÅ Î≥ÄÎèô
                    if (Math.random() < 0.1) { // 10% ÌôïÎ•†
                        if (marketSentiment > 0) {
                            // Ìò∏Ìô© Ïù¥Î≤§Ìä∏
                            business.profit = Math.floor(business.profit * 1.1);
                            business.value = Math.floor(business.value * 1.05);
                            showNotification(`üìà Í≤ΩÏ†ú Ìò∏Ìô©ÏúºÎ°ú ${business.name}Ïùò Ïã§Ï†ÅÏù¥ Í∞úÏÑ†ÎêòÏóàÏäµÎãàÎã§!`, 'success');
                        } else {
                            // Î∂àÌô© Ïù¥Î≤§Ìä∏
                            business.profit = Math.max(Math.floor(business.profit * 0.9), 50);
                            business.value = Math.max(Math.floor(business.value * 0.95), 1000);
                            showNotification(`üìâ Í≤ΩÏ†ú Î∂àÌô©ÏúºÎ°ú ${business.name}Ïù¥ ÌÉÄÍ≤©ÏùÑ Î∞õÏïòÏäµÎãàÎã§.`, 'warning');
                        }
                    }
                }
            });
            
            updateBusinessDisplay();
        }
        
        // Í∏∞ÏóÖ ÏÉÅÏû• ÏãúÏä§ÌÖú (ÏÉàÎ°úÏö¥ Î™®Îã¨ Î∞©Ïãù)
        function goPublic() {
            if (gameState.roleData.businesses.length === 0) {
                showNotification('ÏÉÅÏû•Ìï† ÏÇ¨ÏóÖÏù¥ ÏóÜÏäµÎãàÎã§', 'error');
                return;
            }
            
            openIPOModal();
        }

        function openIPOModal() {
            const modalContent = `
                <h2 style="text-align: center; margin-bottom: 30px; color: var(--primary);">üèõÔ∏è Í∏∞ÏóÖÍ≥µÍ∞ú (IPO)</h2>
                
                <div style="margin-bottom: 20px;">
                    <p style="text-align: center; color: #cbd5e1; margin-bottom: 20px;">
                        ÏÉÅÏû•Ìï† Í∏∞ÏóÖÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî. ÏÉÅÏû•ÏùÑ ÌÜµÌï¥ ÏûêÍ∏àÏùÑ Ï°∞Îã¨ÌïòÍ≥† Í∏∞ÏóÖÏùÑ ÏÑ±Ïû•ÏãúÌÇ¨ Ïàò ÏûàÏäµÎãàÎã§.
                    </p>
                </div>

                <div id="ipoBusinesses" style="display: grid; gap: 15px; margin-bottom: 30px;">
                    <!-- ÏÉÅÏû• Í∞ÄÎä•Ìïú ÏÇ¨ÏóÖÎì§Ïù¥ Ïó¨Í∏∞Ïóê ÌëúÏãúÎê©ÎãàÎã§ -->
                </div>
            `;
            
            showModal(modalContent);
            loadIPOBusinesses();
        }

        function loadIPOBusinesses() {
            const container = document.getElementById('ipoBusinesses');
            if (!container) return;

            const eligibleBusinesses = gameState.roleData.businesses.filter(business => {
                return business.value >= 100000 && !business.isPublic; // ÏµúÏÜå 10Îßå ÎπÑÌä∏ÌÅ¨Î†àÎîß Í∞ÄÏπò, ÎπÑÏÉÅÏû• Í∏∞ÏóÖÎßå
            });

            if (eligibleBusinesses.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #64748b;">
                        <div style="font-size: 2rem; margin-bottom: 15px;">üìà</div>
                        <h3 style="color: var(--warning); margin-bottom: 10px;">ÏÉÅÏû• Í∞ÄÎä•Ìïú Í∏∞ÏóÖÏù¥ ÏóÜÏäµÎãàÎã§</h3>
                        <p style="margin-bottom: 20px;">ÏÉÅÏû•ÏùÑ ÏúÑÌï¥ÏÑúÎäî:</p>
                        <ul style="text-align: left; max-width: 300px; margin: 0 auto;">
                            <li>ÏµúÏÜå Í∏∞ÏóÖ Í∞ÄÏπò 100,000 ÎπÑÌä∏ÌÅ¨Î†àÎîß</li>
                            <li>ÎπÑÏÉÅÏû• Í∏∞ÏóÖÏù¥Ïñ¥Ïïº Ìï®</li>
                            <li>ÏÉÅÏû• ÎπÑÏö© 50,000 ÎπÑÌä∏ÌÅ¨Î†àÎîß ÌïÑÏöî</li>
                        </ul>
                    </div>
                `;
                return;
            }

            container.innerHTML = eligibleBusinesses.map(business => {
                const ipoValue = Math.floor(business.value * 1.4); // IPO ÌîÑÎ¶¨ÎØ∏ÏóÑ 40%
                const minEquity = 25; // ÏµúÏÜå 25% ÏßÄÎ∂Ñ Í≥µÍ∞ú
                const maxEquity = 75; // ÏµúÎåÄ 75% ÏßÄÎ∂Ñ Í≥µÍ∞ú
                const ipoCost = 50000;
                const canAfford = gameState.currentUser.game_balance >= ipoCost;
                
                return `
                    <div class="ipo-business-card ${canAfford ? '' : 'disabled'}" 
                         onclick="${canAfford ? `selectBusinessForIPO(${business.id})` : ''}"
                         style="
                            padding: 20px;
                            background: ${canAfford ? 'rgba(255,255,255,0.05)' : 'rgba(255,255,255,0.02)'};
                            border: 1px solid ${canAfford ? 'rgba(255,255,255,0.1)' : 'rgba(255,255,255,0.05)'};
                            border-radius: 12px;
                            cursor: ${canAfford ? 'pointer' : 'not-allowed'};
                            transition: all 0.3s ease;
                            opacity: ${canAfford ? '1' : '0.5'};
                         "
                         onmouseover="this.style.backgroundColor='${canAfford ? 'rgba(255,255,255,0.08)' : 'rgba(255,255,255,0.02)'}'"
                         onmouseout="this.style.backgroundColor='${canAfford ? 'rgba(255,255,255,0.05)' : 'rgba(255,255,255,0.02)'}'">
                        
                        <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 15px;">
                            <div>
                                <h3 style="color: var(--primary); margin: 0; margin-bottom: 5px;">${business.name}</h3>
                                <p style="color: #94a3b8; margin: 0; font-size: 0.9rem;">Î†àÎ≤® ${business.level} | ${business.sector} | ÏÑ§Î¶Ω ${business.founded}ÎÖÑ</p>
                            </div>
                            <div style="text-align: right;">
                                <div style="color: var(--success); font-weight: 600; font-size: 1.1rem;">
                                    ${ipoValue.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß
                                </div>
                                <div style="color: #64748b; font-size: 0.8rem;">
                                    IPO ÌèâÍ∞ÄÍ∞ÄÏπò
                                </div>
                            </div>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-bottom: 15px; font-size: 0.85rem;">
                            <div>
                                <span style="color: #64748b;">Ïõî ÏàòÏùµ:</span>
                                <div style="color: var(--success); font-weight: 600;">${business.profit.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß</div>
                            </div>
                            <div>
                                <span style="color: #64748b;">ÏßÅÏõê Ïàò:</span>
                                <div style="color: #e2e8f0; font-weight: 600;">${business.employees}Î™Ö</div>
                            </div>
                            <div>
                                <span style="color: #64748b;">ÌòÑÏû¨ Í∞ÄÏπò:</span>
                                <div style="color: #cbd5e1; font-weight: 600;">${business.value.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß</div>
                            </div>
                        </div>

                        <div style="background: rgba(99, 102, 241, 0.1); border: 1px solid rgba(99, 102, 241, 0.2); border-radius: 8px; padding: 12px; font-size: 0.85rem;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                <span style="color: #64748b;">ÏòàÏÉÅ ÏûêÍ∏àÏ°∞Îã¨ (${minEquity}%~${maxEquity}%):</span>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span style="color: var(--success); font-weight: 600;">
                                    ${Math.floor(ipoValue * minEquity / 100).toLocaleString()} ~ ${Math.floor(ipoValue * maxEquity / 100).toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß
                                </span>
                            </div>
                            ${!canAfford ? `<div style="color: var(--danger); font-size: 0.8rem; margin-top: 8px;">‚ö†Ô∏è ÏÉÅÏû• ÎπÑÏö© ${ipoCost.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß Î∂ÄÏ°±</div>` : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }

        function selectBusinessForIPO(businessId) {
            const business = gameState.roleData.businesses.find(b => b.id === businessId);
            if (!business) return;

            const ipoValue = Math.floor(business.value * 1.4); // IPO ÌîÑÎ¶¨ÎØ∏ÏóÑ 40%
            const ipoCost = 50000;

            const modalContent = `
                <h2 style="text-align: center; margin-bottom: 30px; color: var(--primary);">üèõÔ∏è ${business.name} IPO ÏÑ§Ï†ï</h2>
                
                <div style="background: rgba(99, 102, 241, 0.1); border: 1px solid rgba(99, 102, 241, 0.3); border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px; font-size: 0.9rem;">
                        <div><span style="color: #64748b;">ÌöåÏÇ¨Î™Ö:</span> <span style="color: #e2e8f0; font-weight: 600;">${business.name}</span></div>
                        <div><span style="color: #64748b;">ÏóÖÏ¢Ö:</span> <span style="color: #e2e8f0; font-weight: 600;">${business.sector}</span></div>
                        <div><span style="color: #64748b;">ÌòÑÏû¨ Í∞ÄÏπò:</span> <span style="color: #e2e8f0; font-weight: 600;">${business.value.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß</span></div>
                        <div><span style="color: #64748b;">IPO ÌèâÍ∞ÄÍ∞ÄÏπò:</span> <span style="color: var(--success); font-weight: 600;">${ipoValue.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß</span></div>
                    </div>
                    <div style="background: rgba(16, 185, 129, 0.1); border: 1px solid rgba(16, 185, 129, 0.3); border-radius: 8px; padding: 12px;">
                        <div style="color: var(--success); font-weight: 600; margin-bottom: 5px;">üí∞ IPO ÌîÑÎ¶¨ÎØ∏ÏóÑ +40%</div>
                        <div style="color: #64748b; font-size: 0.85rem;">ÏÉÅÏû•ÏùÑ ÌÜµÌï¥ Í∏∞ÏóÖ Í∞ÄÏπòÍ∞Ä ${(business.value * 0.4).toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß ÏÉÅÏäπÌï©ÎãàÎã§</div>
                    </div>
                </div>

                <div style="background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                    <h3 style="color: var(--primary); margin-bottom: 15px;">üìä ÏßÄÎ∂Ñ Í≥µÍ∞ú ÏÑ§Ï†ï</h3>
                    
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; color: #cbd5e1; margin-bottom: 10px;">Í≥µÍ∞úÌï† ÏßÄÎ∂Ñ ÎπÑÏú®:</label>
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <input type="range" id="equitySlider" min="25" max="75" value="40" 
                                   style="flex: 1; height: 8px; background: rgba(255,255,255,0.2); border-radius: 4px; outline: none;"
                                   oninput="updateIPOPreview(${businessId})">
                            <input type="number" id="equityInput" min="25" max="75" value="40" 
                                   style="width: 80px; padding: 8px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); 
                                          border-radius: 4px; color: #e2e8f0; text-align: center;"
                                   oninput="updateIPOPreview(${businessId})">
                            <span style="color: #64748b;">%</span>
                        </div>
                    </div>

                    <div id="ipoPreview" style="background: rgba(99, 102, 241, 0.1); border: 1px solid rgba(99, 102, 241, 0.2); border-radius: 8px; padding: 15px;">
                        <!-- IPO ÎØ∏Î¶¨Î≥¥Í∏∞Í∞Ä Ïó¨Í∏∞Ïóê ÌëúÏãúÎê©ÎãàÎã§ -->
                    </div>
                </div>

                <div style="background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.3); border-radius: 12px; padding: 15px; margin-bottom: 20px;">
                    <div style="color: var(--danger); font-weight: 600; margin-bottom: 8px;">‚ö†Ô∏è IPO ÏúÑÌóò ÏÇ¨Ìï≠</div>
                    <ul style="color: #cbd5e1; font-size: 0.9rem; margin: 0; padding-left: 20px;">
                        <li>ÏÉÅÏû• ÌõÑ ÏßÄÎ∂Ñ ÎπÑÏú®ÎßåÌÅº Ïõî ÏàòÏùµÏù¥ Í∞êÏÜåÌï©ÎãàÎã§</li>
                        <li>ÏãúÏû• Î≥ÄÎèôÏóê Îî∞Îùº Ï£ºÏãù Í∞ÄÏπòÍ∞Ä Î≥ÄÌï† Ïàò ÏûàÏäµÎãàÎã§</li>
                        <li>ÏÉÅÏû• ÎπÑÏö© ${ipoCost.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîßÏù¥ ÏÜåÏöîÎê©ÎãàÎã§</li>
                        <li>ÏÉÅÏû• Ïã§Ìå® Ïãú ÎπÑÏö©Ïùò 50%Îßå ÌöåÏàòÎê©ÎãàÎã§</li>
                    </ul>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 30px;">
                    <button onclick="openIPOModal()" style="
                        padding: 12px 20px;
                        border: 1px solid rgba(255,255,255,0.2);
                        background: rgba(255,255,255,0.05);
                        color: #e2e8f0;
                        border-radius: 8px;
                        cursor: pointer;
                        transition: all 0.3s ease;
                    ">Îã§Î•∏ Í∏∞ÏóÖ ÏÑ†ÌÉù</button>
                    
                    <button onclick="executeIPO(${businessId})" style="
                        padding: 12px 20px;
                        border: none;
                        background: var(--primary);
                        color: white;
                        border-radius: 8px;
                        cursor: pointer;
                        font-weight: 600;
                        transition: all 0.3s ease;
                    ">IPO ÏßÑÌñâ</button>
                </div>
            `;

            showModal(modalContent);
            updateIPOPreview(businessId);
        }

        function updateIPOPreview(businessId) {
            const business = gameState.roleData.businesses.find(b => b.id === businessId);
            if (!business) return;

            const slider = document.getElementById('equitySlider');
            const input = document.getElementById('equityInput');
            const preview = document.getElementById('ipoPreview');

            if (!slider || !input || !preview) return;

            // Ïä¨ÎùºÏù¥ÎçîÏôÄ ÏûÖÎ†•Í∞í ÎèôÍ∏∞Ìôî
            const equityPercent = parseFloat(slider.value);
            input.value = equityPercent;
            slider.value = equityPercent;

            const ipoValue = Math.floor(business.value * 1.4);
            const fundingAmount = Math.floor(ipoValue * equityPercent / 100);
            const remainingEquity = 100 - equityPercent;
            const newMonthlyProfit = Math.floor(business.profit * (remainingEquity / 100));
            const profitReduction = business.profit - newMonthlyProfit;

            preview.innerHTML = `
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; font-size: 0.9rem;">
                    <div>
                        <span style="color: #64748b;">Ï°∞Îã¨ ÏûêÍ∏à:</span>
                        <div style="color: var(--success); font-weight: 600; font-size: 1.1rem;">${fundingAmount.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß</div>
                    </div>
                    <div>
                        <span style="color: #64748b;">Î≥¥Ïú† ÏßÄÎ∂Ñ:</span>
                        <div style="color: #e2e8f0; font-weight: 600; font-size: 1.1rem;">${remainingEquity}%</div>
                    </div>
                    <div>
                        <span style="color: #64748b;">Ïã†Í∑ú Ïõî ÏàòÏùµ:</span>
                        <div style="color: var(--success); font-weight: 600;">${newMonthlyProfit.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß</div>
                    </div>
                    <div>
                        <span style="color: #64748b;">ÏàòÏùµ Í∞êÏÜå:</span>
                        <div style="color: var(--danger); font-weight: 600;">-${profitReduction.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß</div>
                    </div>
                </div>
            `;
        }

        function executeIPO(businessId) {
            const business = gameState.roleData.businesses.find(b => b.id === businessId);
            if (!business) return;

            const equityPercent = parseFloat(document.getElementById('equityInput').value);
            const ipoCost = 50000;

            if (gameState.currentUser.game_balance < ipoCost) {
                showNotification(`IPO ÏßÑÌñâÏùÑ ÏúÑÌï¥ ${ipoCost.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîßÏù¥ ÌïÑÏöîÌï©ÎãàÎã§`, 'error');
                return;
            }

            gameState.currentUser.game_balance -= ipoCost;

            // IPO ÏÑ±Í≥µÎ•†: Í∏∞ÏóÖ Î†àÎ≤®Í≥º Í∞ÄÏπòÏóê Îî∞Îùº Í≤∞Ï†ï
            const baseSuccessRate = 0.7;
            const levelBonus = business.level * 0.05;
            const valueBonus = business.value > 500000 ? 0.1 : business.value > 200000 ? 0.05 : 0;
            const successRate = Math.min(baseSuccessRate + levelBonus + valueBonus, 0.95);

            const isSuccess = Math.random() < successRate;

            closeModal();

            if (isSuccess) {
                // IPO ÏÑ±Í≥µ
                const ipoValue = Math.floor(business.value * 1.4);
                const fundingAmount = Math.floor(ipoValue * equityPercent / 100);
                const remainingEquity = 100 - equityPercent;

                gameState.currentUser.game_balance += fundingAmount;
                business.profit = Math.floor(business.profit * (remainingEquity / 100));
                business.value = ipoValue;
                business.isPublic = true;
                business.publicShares = Math.floor(business.shares * equityPercent / 100);
                business.stockPrice = Math.floor(ipoValue / business.shares);

                // ÏÉÅÏû• Í∏∞ÏóÖ Ï†ïÎ≥¥ ÏóÖÎç∞Ïù¥Ìä∏
                gameState.roleData.publicCompany = {
                    businessId: business.id,
                    name: business.name,
                    stockPrice: business.stockPrice,
                    shares: business.publicShares,
                    equityPercent: equityPercent,
                    ipoDate: new Date().toISOString().split('T')[0]
                };

                updateBusinessDisplay();
                updateDisplay();
                showNotification(`üéâ ${business.name} IPO ÏÑ±Í≥µ! ${fundingAmount.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîßÏùÑ Ï°∞Îã¨ÌñàÏäµÎãàÎã§!`, 'success');
            } else {
                // IPO Ïã§Ìå®
                const recoveredAmount = Math.floor(ipoCost * 0.5);
                gameState.currentUser.game_balance += recoveredAmount;
                updateDisplay();
                showNotification(`‚ùå ${business.name} IPO Ïã§Ìå®... ÏãúÏû• ÏÉÅÌô©Ïù¥ Ï¢ãÏßÄ ÏïäÏäµÎãàÎã§. ${recoveredAmount.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîßÎßå ÌöåÏàòÌñàÏäµÎãàÎã§.`, 'error');
            }
        }
        
        // IPO Í≥ÑÏÇ∞ ÏóÖÎç∞Ïù¥Ìä∏
        function updateIPOCalculation() {
            const slider = document.getElementById('equitySlider');
            const input = document.getElementById('equityInput');
            
            // Ïä¨ÎùºÏù¥ÎçîÏôÄ ÏûÖÎ†•Í∞í ÎèôÍ∏∞Ìôî
            if (document.activeElement === slider) {
                input.value = slider.value;
            } else if (document.activeElement === input) {
                slider.value = input.value;
            }
            
            const equityPercent = parseFloat(input.value);
            const mainBusiness = gameState.roleData.businesses[0];
            
            // 40% IPO ÌîÑÎ¶¨ÎØ∏ÏóÑ Ï†ÅÏö©
            const companyValueWithPremium = Math.floor(mainBusiness.value * 1.4);
            const totalShares = 1000000;
            const stockPrice = Math.floor(companyValueWithPremium / totalShares);
            const capitalRaise = Math.floor(companyValueWithPremium * (equityPercent / 100));
            const remainingOwnership = 100 - equityPercent;
            
            document.getElementById('expectedRaise').textContent = capitalRaise.toLocaleString() + ' ÎπÑÌä∏ÌÅ¨Î†àÎîß';
            document.getElementById('expectedStockPrice').textContent = stockPrice.toLocaleString() + 'Ïõê';
            document.getElementById('remainingOwnership').textContent = remainingOwnership.toFixed(1) + '%';
        }
        
        // IPO Ïã§Ìñâ
        function executeIPO() {
            const equityPercent = parseFloat(document.getElementById('equityInput').value);
            const mainBusiness = gameState.roleData.businesses[0];
            const ipoCost = 50000;
            
            // ÏÉÅÏû• ÏßÑÌñâ
            gameState.currentUser.game_balance -= ipoCost;
            
            // 40% IPO ÌîÑÎ¶¨ÎØ∏ÏóÑÏúºÎ°ú ÏûêÎ≥∏ Ï°∞Îã¨
            const companyValueWithPremium = Math.floor(mainBusiness.value * 1.4);
            const capitalRaise = Math.floor(companyValueWithPremium * (equityPercent / 100));
            gameState.currentUser.game_balance += capitalRaise;
            
            // ÏÉÅÏû• Í∏∞ÏóÖ Ï†ïÎ≥¥ ÏÉùÏÑ±
            const totalShares = 1000000; // Ï¥ù Î∞úÌñâ Ï£ºÏãù 100ÎßåÏ£º
            const sharesOffered = Math.floor(totalShares * (equityPercent / 100));
            const stockPrice = Math.floor(companyValueWithPremium / totalShares);
            
            gameState.roleData.publicCompany = {
                name: mainBusiness.name,
                sector: mainBusiness.type,
                stockPrice: stockPrice,
                totalShares: totalShares,
                publicShares: sharesOffered,
                ownerShares: totalShares - sharesOffered,
                marketCap: stockPrice * totalShares,
                baseValue: mainBusiness.value,
                dailyChangeAccumulated: 0
            };
            
            // ÏÇ¨ÏóÖ Ï†ïÎ≥¥ ÏóÖÎç∞Ïù¥Ìä∏ (ÏÉÅÏû• Ìö®Í≥º)
            mainBusiness.value = Math.floor(mainBusiness.value * 1.3); // 30% Í∞ÄÏπò Ï¶ùÍ∞Ä
            mainBusiness.profit = Math.floor(mainBusiness.profit * 1.2); // 20% ÏàòÏùµ Ï¶ùÍ∞Ä
            mainBusiness.isPublic = true;
            
            // Ï£ºÏãù ÏãúÏû•Ïóê Ï∂îÍ∞Ä
            gameState.stockMarket.stocks.push({
                name: mainBusiness.name,
                price: stockPrice,
                change: 0,
                sector: mainBusiness.type,
                isUserCompany: true,
                dailyChangeAccumulated: 0
            });
            
            closeIPOModal();
            updateBusinessDisplay();
            updatePublicCompanyDisplay();
            updateMarketDisplay();
            
            showNotification(`üéâ ${mainBusiness.name} ÏÉÅÏû• ÏÑ±Í≥µ!\nÏ°∞Îã¨Ïï°: +${capitalRaise.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß\nÏßÄÎ∂Ñ Ìù¨ÏÑù: ${equityPercent}%\nÏ£ºÏãù ÏãúÏÑ∏: ${stockPrice.toLocaleString()}Ïõê`, 'success');
        }
        
        // IPO Î™®Îã¨ Îã´Í∏∞
        function closeIPOModal() {
            document.getElementById('ipoModal').style.display = 'none';
        }
        
        // Ïú†ÏÉÅÏ¶ùÏûê ÏãúÏä§ÌÖú
        function rightOffering() {
            if (!gameState.roleData.publicCompany) {
                showNotification('ÏÉÅÏû•Îêú Í∏∞ÏóÖÏù¥ ÏóÜÏäµÎãàÎã§', 'error');
                return;
            }
            
            const company = gameState.roleData.publicCompany;
            
            // Ï¶ùÏûê Î™®Îã¨ Ïó¥Í∏∞
            document.getElementById('currentStockPrice').textContent = company.stockPrice.toLocaleString() + 'Ïõê';
            document.getElementById('currentOwnership').textContent = ((company.ownerShares / company.totalShares) * 100).toFixed(1) + '%';
            document.getElementById('currentMarketCap').textContent = company.marketCap.toLocaleString() + ' ÎπÑÌä∏ÌÅ¨Î†àÎîß';
            document.getElementById('rightsModal').style.display = 'flex';
            updateRightsCalculation();
        }
        
        // Ï¶ùÏûê Í≥ÑÏÇ∞ ÏóÖÎç∞Ïù¥Ìä∏
        function updateRightsCalculation() {
            const slider = document.getElementById('rightsEquitySlider');
            const input = document.getElementById('rightsEquityInput');
            
            // Ïä¨ÎùºÏù¥ÎçîÏôÄ ÏûÖÎ†•Í∞í ÎèôÍ∏∞Ìôî
            if (document.activeElement === slider) {
                input.value = slider.value;
            } else if (document.activeElement === input) {
                slider.value = input.value;
            }
            
            const additionalEquity = parseFloat(input.value);
            const company = gameState.roleData.publicCompany;
            
            // ÌòÑÏû¨ ÏÜåÏú† ÏßÄÎ∂ÑÏú®
            const currentOwnershipPercent = (company.ownerShares / company.totalShares) * 100;
            
            // Ï¶ùÏûê ÌõÑ ÏßÄÎ∂ÑÏú® Í≥ÑÏÇ∞ (Ìù¨ÏÑù Ìö®Í≥º)
            const newOwnershipPercent = currentOwnershipPercent * (100 / (100 + additionalEquity));
            
            // Ïã†Ï£º Î∞úÌñâÍ∞Ä (ÌòÑÏû¨ Ï£ºÍ∞ÄÏùò 85% - Ìï†Ïù∏ Î∞úÌñâ)
            const rightsPrice = Math.floor(company.stockPrice * 0.85);
            
            // Ï°∞Îã¨ ÏòàÏÉÅÏï°
            const newShares = Math.floor(company.totalShares * (additionalEquity / 100));
            const expectedRaise = newShares * rightsPrice;
            
            document.getElementById('rightsExpectedRaise').textContent = expectedRaise.toLocaleString() + ' ÎπÑÌä∏ÌÅ¨Î†àÎîß';
            document.getElementById('rightsNewOwnership').textContent = newOwnershipPercent.toFixed(1) + '%';
            document.getElementById('rightsPrice').textContent = rightsPrice.toLocaleString() + 'Ïõê';
        }
        
        // Ïú†ÏÉÅÏ¶ùÏûê Ïã§Ìñâ
        function executeRightsOffering() {
            const additionalEquity = parseFloat(document.getElementById('rightsEquityInput').value);
            const company = gameState.roleData.publicCompany;
            
            // Ïã†Ï£º Î∞úÌñâ Í≥ÑÏÇ∞
            const rightsPrice = Math.floor(company.stockPrice * 0.85);
            const newShares = Math.floor(company.totalShares * (additionalEquity / 100));
            const capitalRaise = newShares * rightsPrice;
            
            // ÏûêÎ≥∏ Ï°∞Îã¨
            gameState.currentUser.game_balance += capitalRaise;
            
            // Ï£ºÏãù Ï†ïÎ≥¥ ÏóÖÎç∞Ïù¥Ìä∏
            company.totalShares += newShares;
            company.publicShares += newShares; // Î™®Îì† Ïã†Ï£ºÎäî Í≥µÍ∞úÎê®
            company.marketCap = company.stockPrice * company.totalShares;
            
            // Ï£ºÏãù ÏãúÏû•ÏóêÏÑú ÏóÖÎç∞Ïù¥Ìä∏
            const marketStock = gameState.stockMarket.stocks.find(s => s.isUserCompany);
            if (marketStock) {
                // Ï¶ùÏûêÎ°ú Ïù∏Ìïú Ï£ºÍ∞Ä ÌïòÎùΩ (10-15%)
                const priceDecline = 0.85 + Math.random() * 0.1; // 85-95%
                company.stockPrice = Math.floor(company.stockPrice * priceDecline);
                marketStock.price = company.stockPrice;
                marketStock.change = ((priceDecline - 1) * 100);
            }
            
            closeRightsModal();
            updatePublicCompanyDisplay();
            updateMarketDisplay();
            
            showNotification(`üíé Ïú†ÏÉÅÏ¶ùÏûê ÏôÑÎ£å!\nÏ°∞Îã¨Ïï°: +${capitalRaise.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß\nÏã†Ï£º Î∞úÌñâ: ${newShares.toLocaleString()}Ï£º\nÏßÄÎ∂Ñ Ìù¨ÏÑù: ${additionalEquity}%`, 'success');
        }
        
        // Ï¶ùÏûê Î™®Îã¨ Îã´Í∏∞
        function closeRightsModal() {
            document.getElementById('rightsModal').style.display = 'none';
        }
        
        // ÏûêÏÇ¨Ï£º Îß§ÏûÖ
        function buyBackShares() {
            if (!gameState.roleData.publicCompany) {
                showNotification('ÏÉÅÏû•Îêú Í∏∞ÏóÖÏù¥ ÏóÜÏäµÎãàÎã§', 'error');
                return;
            }
            
            const company = gameState.roleData.publicCompany;
            const sharesAvailable = company.publicShares;
            
            if (sharesAvailable === 0) {
                showNotification('Îß§ÏûÖ Í∞ÄÎä•Ìïú Í≥µÍ∞ú Ï£ºÏãùÏù¥ ÏóÜÏäµÎãàÎã§', 'info');
                return;
            }
            
            const sharesToBuy = Math.min(50000, sharesAvailable); // ÏµúÎåÄ 5ÎßåÏ£º
            const buybackCost = sharesToBuy * company.stockPrice;
            
            if (gameState.currentUser.game_balance < buybackCost) {
                showNotification(`ÏûêÏÇ¨Ï£º Îß§ÏûÖÏóê ${buybackCost.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîßÏù¥ ÌïÑÏöîÌï©ÎãàÎã§`, 'error');
                return;
            }
            
            // ÏûêÏÇ¨Ï£º Îß§ÏûÖ Ïã§Ìñâ
            gameState.currentUser.game_balance -= buybackCost;
            company.ownerShares += sharesToBuy;
            company.publicShares -= sharesToBuy;
            
            // Ï£ºÏãù Í∞ÄÍ≤© ÏÉÅÏäπ Ìö®Í≥º (10-20%)
            const priceIncrease = 1.1 + Math.random() * 0.1;
            company.stockPrice = Math.floor(company.stockPrice * priceIncrease);
            company.marketCap = company.stockPrice * company.totalShares;
            
            // Ï£ºÏãù ÏãúÏû•ÏóêÏÑú Í∞ÄÍ≤© ÏóÖÎç∞Ïù¥Ìä∏
            const marketStock = gameState.stockMarket.stocks.find(s => s.isUserCompany);
            if (marketStock) {
                const oldPrice = marketStock.price;
                marketStock.price = company.stockPrice;
                marketStock.change = ((marketStock.price / oldPrice) - 1) * 100;
            }
            
            updatePublicCompanyDisplay();
            updateMarketDisplay();
            
            showNotification(`ÏûêÏÇ¨Ï£º ${sharesToBuy.toLocaleString()}Ï£º Îß§ÏûÖ ÏôÑÎ£å!\nÏßÄÎ∂ÑÏú®: ${((company.ownerShares / company.totalShares) * 100).toFixed(1)}%\nÏ£ºÍ∞Ä ÏÉÅÏäπ: +${((priceIncrease - 1) * 100).toFixed(1)}%`, 'success');
        }
        
        // ÏÉÅÏû• Í∏∞ÏóÖ Ï†ïÎ≥¥ ÏóÖÎç∞Ïù¥Ìä∏
        function updatePublicCompanyDisplay() {
            const company = gameState.roleData.publicCompany;
            if (!company) {
                document.getElementById('publicCompanyInfo').style.display = 'none';
                return;
            }
            
            document.getElementById('publicCompanyInfo').style.display = 'block';
            document.getElementById('stockPrice').textContent = company.stockPrice.toLocaleString() + 'Ïõê';
            document.getElementById('marketCap').textContent = company.marketCap.toLocaleString();
            document.getElementById('ownershipPercent').textContent = ((company.ownerShares / company.totalShares) * 100).toFixed(1) + '%';
            document.getElementById('totalShares').textContent = company.totalShares.toLocaleString() + 'Ï£º';
        }
        
        function showSection(section) {
            document.querySelectorAll('.content-section').forEach(sec => {
                sec.style.display = 'none';
            });
            
            document.getElementById(`${section}-section`).style.display = 'block';
            
            document.querySelectorAll('.menu-item').forEach(item => {
                item.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Î¶¨ÎçîÎ≥¥Îìú ÏÑπÏÖòÏù∏ Í≤ΩÏö∞ Îç∞Ïù¥ÌÑ∞ Î°úÎìú
            if (section === 'leaderboard') {
                loadLeaderboard();
            } else if (section === 'p2p') {
                loadP2PMarketplace();
            } else if (section === 'labor') {
                loadLaborMarket();
            }
        }

        function loadLeaderboard() {
            // Í∞ÄÏÉÅÏùò Î¶¨ÎçîÎ≥¥Îìú Îç∞Ïù¥ÌÑ∞ ÏÉùÏÑ±
            const leaderboardData = [
                { rank: 1, username: 'Ìà¨ÏûêÏôïÍπÄÏî®', role: 'investor', balance: 15420000, businesses: 8 },
                { rank: 2, username: 'ÏÇ¨ÏóÖÍ∞ÄÎ∞ïÏî®', role: 'entrepreneur', balance: 12800000, businesses: 12 },
                { rank: 3, username: 'ÏùÄÌñâÍ∞ÄÏù¥Ïî®', role: 'banker', balance: 11200000, businesses: 5 },
                { rank: 4, username: 'ÏõåÏª§ÏµúÏî®', role: 'worker', balance: 8900000, businesses: 3 },
                { rank: 5, username: 'Ï∫êÌîºÌÉàÏ†ïÏî®', role: 'entrepreneur', balance: 7600000, businesses: 9 },
                { rank: 6, username: 'Í∏àÏúµÏ†ÑÎ¨∏Í∞Ä', role: 'banker', balance: 6800000, businesses: 4 },
                { rank: 7, username: 'Ïä§ÌÉÄÌä∏ÏóÖÌôçÏî®', role: 'entrepreneur', balance: 5900000, businesses: 7 },
                { rank: 8, username: 'Ìà¨ÏûêÎßàÎãàÏïÑ', role: 'investor', balance: 4700000, businesses: 2 },
                { rank: 9, username: 'ÏßÅÏû•Ïù∏Í∞ïÏî®', role: 'worker', balance: 3800000, businesses: 1 },
                { rank: 10, username: 'ÎπÑÏ¶àÎãàÏä§ÌÇπ', role: 'entrepreneur', balance: 3200000, businesses: 6 }
            ];

            // ÌòÑÏû¨ ÏÇ¨Ïö©Ïûê Ï∂îÍ∞Ä (11ÏúÑÎ°ú)
            if (gameState.currentUser) {
                leaderboardData.push({
                    rank: 11,
                    username: gameState.currentUser.username,
                    role: gameState.currentUser.role,
                    balance: gameState.roleData.balance,
                    businesses: gameState.roleData.businesses ? gameState.roleData.businesses.length : 0,
                    isCurrentUser: true
                });
            }

            const roleNames = {
                'entrepreneur': 'ÏÇ¨ÏóÖÍ∞Ä',
                'banker': 'ÏùÄÌñâÍ∞Ä',
                'investor': 'Ìà¨ÏûêÏûê',
                'worker': 'ÏßÅÏû•Ïù∏'
            };

            const roleColors = {
                'entrepreneur': '#ef4444',
                'banker': '#3b82f6',
                'investor': '#10b981',
                'worker': '#f59e0b'
            };

            const leaderboardHtml = leaderboardData.map(player => `
                <div style="
                    background: ${player.isCurrentUser ? 'linear-gradient(135deg, rgba(99, 102, 241, 0.2), rgba(139, 92, 246, 0.2))' : 'rgba(71, 85, 105, 0.1)'};
                    border: ${player.isCurrentUser ? '2px solid var(--primary)' : '1px solid rgba(71, 85, 105, 0.3)'};
                    border-radius: 12px; padding: 15px; margin-bottom: 10px;
                    display: flex; align-items: center; justify-content: space-between;
                    ${player.isCurrentUser ? 'position: relative; transform: scale(1.02);' : ''}
                ">
                    ${player.isCurrentUser ? '<div style="position: absolute; top: -8px; left: 50%; transform: translateX(-50%); background: var(--primary); color: white; padding: 4px 12px; border-radius: 15px; font-size: 0.7rem; font-weight: 600;">ÎÇ¥ ÏàúÏúÑ</div>' : ''}
                    
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <div style="
                            background: ${player.rank <= 3 ? (player.rank === 1 ? '#fbbf24' : player.rank === 2 ? '#94a3b8' : '#cd7f32') : '#64748b'};
                            color: white; width: 35px; height: 35px; border-radius: 50%;
                            display: flex; align-items: center; justify-content: center;
                            font-weight: bold; font-size: ${player.rank <= 3 ? '1.1rem' : '0.9rem'};
                        ">
                            ${player.rank <= 3 ? (player.rank === 1 ? 'ü•á' : player.rank === 2 ? 'ü•à' : 'ü•â') : player.rank}
                        </div>
                        
                        <div>
                            <div style="color: #e2e8f0; font-weight: bold; margin-bottom: 4px;">${player.username}</div>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <span style="
                                    background: ${roleColors[player.role]}; color: white;
                                    padding: 2px 8px; border-radius: 12px; font-size: 0.7rem; font-weight: 600;
                                ">${roleNames[player.role]}</span>
                                <span style="color: #94a3b8; font-size: 0.8rem;">ÏÇ¨ÏóÖ ${player.businesses}Í∞ú</span>
                            </div>
                        </div>
                    </div>
                    
                    <div style="text-align: right;">
                        <div style="color: var(--success); font-weight: bold; font-size: 1.1rem;">
                            ${player.balance.toLocaleString()}
                        </div>
                        <div style="color: #94a3b8; font-size: 0.8rem;">ÎπÑÌä∏ÌÅ¨Î†àÎîß</div>
                    </div>
                </div>
            `).join('');

            document.getElementById('leaderboardList').innerHTML = leaderboardHtml;
        }
        
        // P2P ÎßàÏºìÌîåÎ†àÏù¥Ïä§ Í¥ÄÎ†® Ìï®ÏàòÎì§
        function loadP2PMarketplace() {
            // Í∞ÄÏÉÅÏùò P2P Í±∞Îûò Îç∞Ïù¥ÌÑ∞ ÏÉùÏÑ± (ÌòÑÏã§Ï†ÅÏù∏ ÌîåÎ†àÏù¥Ïñ¥Í∞Ñ Í±∞Îûò ÏãúÎÆ¨Î†àÏù¥ÏÖò)
            generateSampleP2PListings();
            displayP2PListings('all');
            updateP2PSellableAssets();
        }
        
        function generateSampleP2PListings() {
            // Í∏∞Ï°¥ Î™©Î°ù Ï¥àÍ∏∞Ìôî ÌõÑ ÏÉàÎ°úÏö¥ ÏÉòÌîå Îç∞Ïù¥ÌÑ∞ ÏÉùÏÑ±
            gameState.p2pMarket.listings = [];
            
            const sampleBusinesses = [
                { name: 'AI Ïä§ÌÉÄÌä∏ÏóÖ', type: 'business', subType: 'tech_startup', profit: 8500, employees: 12, value: 180000, price: 220000, sellerName: 'TechGuru2024', description: 'ChatGPT Í≤ΩÏüÅ ÏÑúÎπÑÏä§ Í∞úÎ∞ú Ï§ë. Ïõî 8.5M ÏàòÏùµ, ÏÑ±Ïû•ÏÑ± ÎÜíÏùå' },
                { name: 'Í∞ïÎÇ® Ïπ¥Ìéò', type: 'business', subType: 'cafe', profit: 4200, employees: 6, value: 85000, price: 110000, sellerName: 'CafeKing', description: 'Í∞ïÎÇ®Ïó≠ ÎèÑÎ≥¥ 2Î∂Ñ, Îã®Í≥® ÎßéÏùå. ÏïàÏ†ïÏ†Å ÏàòÏùµ Î≥¥Ïû•' },
                { name: 'EÏª§Î®∏Ïä§ ÏáºÌïëÎ™∞', type: 'business', subType: 'ecommerce', profit: 12000, employees: 8, value: 250000, price: 320000, sellerName: 'ShopMaster', description: 'Ìå®ÏÖò Ï†ÑÎ¨∏Î™∞, Ïõî 1200ÎßåÏõê ÏàòÏùµ. Î∏åÎûúÎìú Í∞ÄÏπò ÎÜíÏùå' },
                { name: 'Ï†úÏ°∞ÏóÖÏ≤¥', type: 'business', subType: 'manufacturing', profit: 15000, employees: 25, value: 400000, price: 480000, sellerName: 'Factory_Owner', description: 'ÏûêÎèôÏ∞® Î∂ÄÌíà Ï†úÏ°∞. ÎåÄÍ∏∞ÏóÖ ÎÇ©Ìíà Í≥ÑÏïΩ Î≥¥Ïú†' }
            ];
            
            const sampleInvestments = [
                { name: 'ÏÇºÏÑ±Ï†ÑÏûê ÎåÄÎüâ Î≥¥Ïú†', type: 'investment', subType: 'stock', amount: 500000, returnRate: 0.15, price: 580000, sellerName: 'StockPro', description: 'ÏÇºÏÑ±Ï†ÑÏûê Ï£ºÏãù ÎåÄÎüâ Î≥¥Ïú†Î∂Ñ. 15% ÏàòÏùµÎ•† Îã¨ÏÑ±' },
                { name: 'Bitcoin Ìè¨ÏßÄÏÖò', type: 'investment', subType: 'crypto', amount: 800000, returnRate: 0.25, price: 1050000, sellerName: 'CryptoWhale', description: 'ÎπÑÌä∏ÎπÑÌä∏ÌÅ¨Î†àÎîß 80ÎßåÏõê Ïñ¥Ïπò, 25% ÏàòÏùµ Ï§ë' },
                { name: 'Î∂ÄÎèôÏÇ∞ Ìà¨Ïûê', type: 'investment', subType: 'realestate', amount: 1200000, returnRate: 0.08, price: 1300000, sellerName: 'RealEstate_King', description: 'Í∞ïÎÇ® Ïò§ÌîºÏä§ÌÖî, Ïõî ÏûÑÎåÄÏàòÏùµ 8%' },
                { name: 'Tech ETF Ìè¨Ìä∏Ìè¥Î¶¨Ïò§', type: 'investment', subType: 'stock', amount: 350000, returnRate: 0.18, price: 420000, sellerName: 'ETF_Investor', description: 'NASDAQ ÌÖåÌÅ¨ ETF Î∂ÑÏÇ∞Ìà¨Ïûê' }
            ];
            
            // ÏÇ¨ÏóÖÏ≤¥ÏôÄ Ìà¨Ïûê ÏûêÏÇ∞ÏùÑ P2P Î™©Î°ùÏóê Ï∂îÍ∞Ä
            [...sampleBusinesses, ...sampleInvestments].forEach((item, index) => {
                gameState.p2pMarket.listings.push({
                    id: `p2p_${Date.now()}_${index}`,
                    ...item,
                    listedAt: new Date(Date.now() - Math.random() * 86400000 * 7), // ÏµúÍ∑º 7Ïùº ÎÇ¥ Îì±Î°ù
                    views: Math.floor(Math.random() * 50) + 5,
                    sellerId: `user_${Math.floor(Math.random() * 1000)}`
                });
            });
        }
        
        function showP2PTab(tab) {
            // ÌÉ≠ Î≤ÑÌäº Ïä§ÌÉÄÏùº ÏóÖÎç∞Ïù¥Ìä∏
            document.querySelectorAll('#p2p-section .btn').forEach(btn => {
                btn.className = btn.className.includes('p2p') ? 'btn btn-secondary' : btn.className;
            });
            document.getElementById(`p2p${tab.charAt(0).toUpperCase() + tab.slice(1)}Tab`).className = 'btn';
            
            // ÌÉ≠ Ïª®ÌÖêÏ∏† ÌëúÏãú/Ïà®ÍπÄ
            document.getElementById('p2pBrowseContent').style.display = tab === 'browse' ? 'block' : 'none';
            document.getElementById('p2pSellContent').style.display = tab === 'sell' ? 'block' : 'none';
            document.getElementById('p2pHistoryContent').style.display = tab === 'history' ? 'block' : 'none';
            
            if (tab === 'browse') {
                displayP2PListings('all');
            } else if (tab === 'sell') {
                updateP2PSellableAssets();
            } else if (tab === 'history') {
                displayP2PTransactionHistory();
            }
        }
        
        function filterP2PListings(category) {
            // ÌïÑÌÑ∞ Î≤ÑÌäº Ïä§ÌÉÄÏùº ÏóÖÎç∞Ïù¥Ìä∏
            document.querySelectorAll('#p2pBrowseContent .btn-sm').forEach(btn => {
                btn.className = 'btn btn-sm btn-secondary';
            });
            document.getElementById(`filter${category.charAt(0).toUpperCase() + category.slice(1)}`).className = 'btn btn-sm';
            document.getElementById(`filter${category.charAt(0).toUpperCase() + category.slice(1)}`).style.background = 'var(--primary)';
            
            displayP2PListings(category);
        }
        
        function displayP2PListings(category) {
            const listings = gameState.p2pMarket.listings.filter(item => {
                if (category === 'all') return true;
                if (category === 'business') return item.type === 'business';
                if (category === 'investment') return item.type === 'investment';
                if (category === 'land') return item.type === 'land';
                return true;
            });
            
            const listingsHtml = listings.map(listing => {
                const typeIcon = listing.type === 'business' ? 'üè¢' : listing.type === 'investment' ? 'üìà' : 'üè†';
                const typeText = listing.type === 'business' ? 'ÏÇ¨ÏóÖÏ≤¥' : listing.type === 'investment' ? 'Ìà¨ÏûêÏûêÏÇ∞' : 'Î∂ÄÎèôÏÇ∞';
                
                return `
                    <div class="business-card" style="margin-bottom: 15px; cursor: pointer;" onclick="showP2PBuyModal(${JSON.stringify(listing).replace(/"/g, '&quot;')})">
                        <div class="business-header">
                            <div class="business-name">${typeIcon} ${listing.name}</div>
                            <div style="color: var(--primary); font-weight: bold;">${listing.price.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß</div>
                        </div>
                        <div style="font-size: 0.9rem; color: #94a3b8; margin: 8px 0;">
                            <div style="margin-bottom: 5px;">
                                <span style="background: rgba(59, 130, 246, 0.2); color: #60a5fa; padding: 2px 8px; border-radius: 12px; font-size: 0.8rem; margin-right: 8px;">
                                    ${typeText}
                                </span>
                                <span style="color: #cbd5e1;">ÌåêÎß§Ïûê: ${listing.sellerName}</span>
                            </div>
                            ${listing.type === 'business' ? `
                                <div>‚Ä¢ Ïõî ÏàòÏùµ: ${listing.profit.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß | ÏßÅÏõê: ${listing.employees}Î™Ö</div>
                                <div>‚Ä¢ Í∏∞ÏóÖ Í∞ÄÏπò: ${listing.value.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß</div>
                            ` : `
                                <div>‚Ä¢ Ìà¨ÏûêÍ∏à: ${listing.amount.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß | ÏàòÏùµÎ•†: ${(listing.returnRate * 100).toFixed(1)}%</div>
                            `}
                            <div style="font-size: 0.8rem; color: #64748b; margin-top: 8px;">
                                ${listing.description}
                            </div>
                            <div style="font-size: 0.8rem; color: #64748b; margin-top: 5px; display: flex; justify-content: space-between;">
                                <span>üëÄ ${listing.views}Ìöå Ï°∞Ìöå</span>
                                <span>üìÖ ${new Date(listing.listedAt).toLocaleDateString()}</span>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            document.getElementById('p2pListings').innerHTML = listings.length > 0 ? listingsHtml : 
                '<div style="text-align: center; color: #64748b; padding: 40px;">Îì±Î°ùÎêú Îß§Î¨ºÏù¥ ÏóÜÏäµÎãàÎã§.</div>';
        }
        
        function updateP2PSellableAssets() {
            // ÎÇ¥ ÏÇ¨ÏóÖÏ≤¥ Î™©Î°ù
            const businessesHtml = gameState.roleData.businesses.map(business => `
                <div class="business-card" style="margin-bottom: 10px;">
                    <div class="business-header">
                        <div class="business-name">üè¢ ${business.name}</div>
                        <div style="color: var(--success);">${(business.value * 1.2).toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß (Í∂åÏû•)</div>
                    </div>
                    <div style="font-size: 0.9rem; color: #94a3b8; margin: 8px 0;">
                        <div>‚Ä¢ Ïõî ÏàòÏùµ: ${business.profit.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß</div>
                        <div>‚Ä¢ ÏßÅÏõê: ${business.employees}Î™Ö</div>
                    </div>
                    <button class="btn btn-sm" onclick="showP2PSellModal(${JSON.stringify(business).replace(/"/g, '&quot;')}, 'business')" style="width: 100%; margin-top: 10px;">
                        ÌåêÎß§ Îì±Î°ùÌïòÍ∏∞
                    </button>
                </div>
            `).join('');
            
            // ÎÇ¥ Ìà¨ÏûêÏûêÏÇ∞ Î™©Î°ù
            const investmentsHtml = gameState.roleData.investments.map(investment => `
                <div class="business-card" style="margin-bottom: 10px;">
                    <div class="business-header">
                        <div class="business-name">üìà ${investment.name}</div>
                        <div style="color: var(--success);">${Math.floor(investment.amount * (1 + investment.returnRate)).toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß (Í∂åÏû•)</div>
                    </div>
                    <div style="font-size: 0.9rem; color: #94a3b8; margin: 8px 0;">
                        <div>‚Ä¢ Ìà¨ÏûêÍ∏à: ${investment.amount.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß</div>
                        <div>‚Ä¢ ÌòÑÏû¨ ÏàòÏùµÎ•†: ${(investment.returnRate * 100).toFixed(1)}%</div>
                    </div>
                    <button class="btn btn-sm" onclick="showP2PSellModal(${JSON.stringify(investment).replace(/"/g, '&quot;')}, 'investment')" style="width: 100%; margin-top: 10px;">
                        ÌåêÎß§ Îì±Î°ùÌïòÍ∏∞
                    </button>
                </div>
            `).join('');
            
            document.getElementById('myBusinessesToSell').innerHTML = businessesHtml.length > 0 ? businessesHtml : 
                '<div style="text-align: center; color: #64748b; padding: 20px;">Î≥¥Ïú†Ìïú ÏÇ¨ÏóÖÏ≤¥Í∞Ä ÏóÜÏäµÎãàÎã§.</div>';
                
            document.getElementById('myInvestmentsToSell').innerHTML = investmentsHtml.length > 0 ? investmentsHtml : 
                '<div style="text-align: center; color: #64748b; padding: 20px;">Î≥¥Ïú†Ìïú Ìà¨ÏûêÏûêÏÇ∞Ïù¥ ÏóÜÏäµÎãàÎã§.</div>';
        }
        
        function displayP2PTransactionHistory() {
            // Í∞ÄÏÉÅÏùò Í±∞Îûò ÎÇ¥Ïó≠ Îç∞Ïù¥ÌÑ∞
            const sampleHistory = [
                { type: 'buy', item: 'Tech Ïä§ÌÉÄÌä∏ÏóÖ', price: 150000, date: new Date(Date.now() - 86400000 * 2), counterparty: 'InvestorPro' },
                { type: 'sell', item: 'ÏÇºÏÑ±Ï†ÑÏûê Ï£ºÏãù', price: 280000, date: new Date(Date.now() - 86400000 * 5), counterparty: 'StockTrader' },
                { type: 'buy', item: 'Í∞ïÎÇ® Î∂ÄÎèôÏÇ∞', price: 1200000, date: new Date(Date.now() - 86400000 * 10), counterparty: 'RealtyKing' }
            ];
            
            const historyHtml = sampleHistory.map(transaction => {
                const typeIcon = transaction.type === 'buy' ? 'üõí' : 'üí∞';
                const typeText = transaction.type === 'buy' ? 'Íµ¨Îß§' : 'ÌåêÎß§';
                const typeColor = transaction.type === 'buy' ? 'var(--danger)' : 'var(--success)';
                
                return `
                    <div class="business-card" style="margin-bottom: 10px;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <div style="color: ${typeColor}; font-weight: bold; margin-bottom: 5px;">
                                    ${typeIcon} ${typeText}: ${transaction.item}
                                </div>
                                <div style="color: #94a3b8; font-size: 0.9rem;">
                                    ${transaction.type === 'buy' ? 'Íµ¨Îß§Ï≤ò' : 'ÌåêÎß§Ï≤ò'}: ${transaction.counterparty}
                                </div>
                                <div style="color: #64748b; font-size: 0.8rem;">
                                    ${transaction.date.toLocaleDateString()}
                                </div>
                            </div>
                            <div style="color: ${typeColor}; font-weight: bold; font-size: 1.1rem;">
                                ${transaction.type === 'buy' ? '-' : '+'}${transaction.price.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            document.getElementById('p2pTransactionHistory').innerHTML = historyHtml.length > 0 ? historyHtml :
                '<div style="text-align: center; color: #64748b; padding: 40px;">Í±∞Îûò ÎÇ¥Ïó≠Ïù¥ ÏóÜÏäµÎãàÎã§.</div>';
        }
        
        function updateP2PSellPreview() {
            const price = parseInt(document.getElementById('p2pSellPrice').value) || 0;
            const type = window.currentP2PSellType || 'business';
            const fee = Math.floor(price * gameState.p2pMarket.fees[type + 'Sale']);
            const netReceive = price - fee;
            
            document.getElementById('sellPriceDisplay').textContent = price.toLocaleString() + ' ÎπÑÌä∏ÌÅ¨Î†àÎîß';
            document.getElementById('sellFeeDisplay').textContent = '-' + fee.toLocaleString() + ' ÎπÑÌä∏ÌÅ¨Î†àÎîß';
            document.getElementById('netReceiveDisplay').textContent = netReceive.toLocaleString() + ' ÎπÑÌä∏ÌÅ¨Î†àÎîß';
        }
        
        function confirmP2PBuy(listingId) {
            const listing = gameState.p2pMarket.listings.find(l => l.id === listingId);
            if (!listing) {
                showNotification('Îß§Î¨ºÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§', 'error');
                return;
            }
            
            const fee = listing.price * gameState.p2pMarket.fees[listing.type + 'Sale'];
            const totalCost = listing.price + fee;
            
            if (gameState.currentUser.game_balance < totalCost) {
                showNotification('Íµ¨Îß§ ÏûêÍ∏àÏù¥ Î∂ÄÏ°±Ìï©ÎãàÎã§', 'error');
                return;
            }
            
            // Í≤∞Ï†ú Ï≤òÎ¶¨
            gameState.currentUser.game_balance -= totalCost;
            
            // ÏûêÏÇ∞ Ï∂îÍ∞Ä
            if (listing.type === 'business') {
                gameState.roleData.businesses.push({
                    id: Date.now(),
                    name: listing.name,
                    type: listing.subType,
                    profit: listing.profit,
                    employees: listing.employees,
                    value: listing.value,
                    monthlyExpenses: Math.floor(listing.profit * 0.6)
                });
            } else if (listing.type === 'investment') {
                gameState.roleData.investments.push({
                    type: listing.subType,
                    name: listing.name,
                    amount: listing.amount,
                    returnRate: listing.returnRate,
                    dividends: Math.floor(listing.amount * 0.002)
                });
            }
            
            // Í±∞Îûò ÎÇ¥Ïó≠ Ï∂îÍ∞Ä
            gameState.p2pMarket.transactions.push({
                type: 'buy',
                itemId: listing.id,
                itemName: listing.name,
                price: listing.price,
                fee: fee,
                buyerId: gameState.currentUser.username,
                sellerId: listing.sellerId,
                date: new Date()
            });
            
            // Îß§Î¨º Î™©Î°ùÏóêÏÑú Ï†úÍ±∞
            gameState.p2pMarket.listings = gameState.p2pMarket.listings.filter(l => l.id !== listingId);
            
            closeModal();
            showNotification(`${listing.name} Íµ¨Îß§ ÏôÑÎ£å! (Ï¥ù ${totalCost.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß Í≤∞Ï†ú)`, 'success');
            updateDisplay();
            loadP2PMarketplace(); // Î™©Î°ù ÏÉàÎ°úÍ≥†Ïπ®
        }
        
        function confirmP2PSell(assetId, type) {
            const price = parseInt(document.getElementById('p2pSellPrice').value);
            const description = document.getElementById('p2pSellDescription').value;
            
            if (!price || price < 1000) {
                showNotification('ÏµúÏÜå 1,000 ÎπÑÌä∏ÌÅ¨Î†àÎîß Ïù¥ÏÉÅÏúºÎ°ú ÏÑ§Ï†ïÌï¥Ï£ºÏÑ∏Ïöî', 'error');
                return;
            }
            
            let asset;
            if (type === 'business') {
                asset = gameState.roleData.businesses.find(b => b.id === assetId || b.name === assetId);
            } else if (type === 'investment') {
                asset = gameState.roleData.investments.find(i => i.name === assetId);
            }
            
            if (!asset) {
                showNotification('ÏûêÏÇ∞ÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§', 'error');
                return;
            }
            
            // P2P Îß§Î¨ºÎ°ú Îì±Î°ù
            const listing = {
                id: `p2p_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
                name: asset.name,
                type: type,
                subType: asset.type || 'unknown',
                price: price,
                description: description,
                sellerName: gameState.currentUser.username,
                sellerId: gameState.currentUser.username,
                listedAt: new Date(),
                views: 0,
                ...asset
            };
            
            gameState.p2pMarket.listings.push(listing);
            
            // ÎÇ¥ ÏûêÏÇ∞ÏóêÏÑú Ï†úÍ±∞
            if (type === 'business') {
                gameState.roleData.businesses = gameState.roleData.businesses.filter(b => b.id !== asset.id && b.name !== asset.name);
            } else if (type === 'investment') {
                gameState.roleData.investments = gameState.roleData.investments.filter(i => i.name !== asset.name);
            }
            
            closeModal();
            showNotification(`${asset.name} ÌåêÎß§ Îì±Î°ù ÏôÑÎ£å! (${price.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß)`, 'success');
            updateDisplay();
            showP2PTab('sell'); // ÌåêÎß§ ÌÉ≠ ÏÉàÎ°úÍ≥†Ïπ®
        }
        
        // ÎÖ∏ÎèôÏãúÏû• Í¥ÄÎ†® Ìï®ÏàòÎì§
        function loadLaborMarket() {
            generateSampleJobPostings();
            displayJobPostings();
            updateMyBusinessesForHiring();
            showLaborTab('jobs');
        }
        
        function generateSampleJobPostings() {
            // ÏÉòÌîå Íµ¨Ïù∏Í≥µÍ≥† ÏÉùÏÑ±
            gameState.laborMarket.jobPostings = [
                {
                    id: 'job_1', title: 'ÌíÄÏä§ÌÉù Í∞úÎ∞úÏûê', skill: 'programming', level: 'senior',
                    salary: 8500, company: 'TechCorp', employer: 'DevMaster2024',
                    description: 'React/Node.js Í∏∞Î∞ò Ïõπ ÏÑúÎπÑÏä§ Í∞úÎ∞ú. ÏõêÍ≤©Í∑ºÎ¨¥ Í∞ÄÎä•, Ïä§ÌÜ°ÏòµÏÖò Ï†úÍ≥µ',
                    postedAt: new Date(Date.now() - 86400000 * 2), applicants: 12
                },
                {
                    id: 'job_2', title: 'UI/UX ÎîîÏûêÏù¥ÎÑà', skill: 'design', level: 'mid',
                    salary: 5500, company: 'DesignStudio', employer: 'CreativeGuru',
                    description: 'Î™®Î∞îÏùº Ïï± UI ÎîîÏûêÏù∏ Ï†ÑÎ¨∏. Figma, Adobe XD ÌïÑÏàò',
                    postedAt: new Date(Date.now() - 86400000 * 1), applicants: 8
                },
                {
                    id: 'job_3', title: 'ÎîîÏßÄÌÑ∏ ÎßàÏºÄÌåÖ Îß§ÎãàÏ†Ä', skill: 'marketing', level: 'lead',
                    salary: 12000, company: 'MarketingPro', employer: 'GrowthHacker',
                    description: 'ÌçºÌè¨Î®ºÏä§ ÎßàÏºÄÌåÖ Ï†ÑÎûµ ÏàòÎ¶Ω Î∞è Ïã§Ìñâ. Google Ads, Facebook Ads Í≤ΩÌóò ÌïÑÏàò',
                    postedAt: new Date(Date.now() - 86400000 * 3), applicants: 15
                },
                {
                    id: 'job_4', title: 'ÏòÅÏóÖ Îã¥ÎãπÏûê', skill: 'sales', level: 'junior',
                    salary: 3200, company: 'ÏÑ∏ÏùºÏ¶àÏª¥ÌçºÎãà', employer: 'SalesKing',
                    description: 'B2B ÏòÅÏóÖ, Ïù∏ÏÑºÌã∞Î∏å Î≥ÑÎèÑ ÏßÄÍ∏â. Ïã†ÏûÖ ÌôòÏòÅ',
                    postedAt: new Date(Date.now() - 86400000 * 4), applicants: 6
                },
                {
                    id: 'job_5', title: 'CTO (ÏµúÍ≥†Í∏∞Ïà†Ï±ÖÏûÑÏûê)', skill: 'management', level: 'executive',
                    salary: 35000, company: 'AIÏä§ÌÉÄÌä∏ÏóÖ', employer: 'StartupFounder',
                    description: 'Í∏∞Ïà†ÌåÄ Î¶¨Îìú Î∞è ÏïÑÌÇ§ÌÖçÏ≤ò ÏÑ§Í≥Ñ. 10ÎÖÑ+ Í≤ΩÌóò ÌïÑÏàò',
                    postedAt: new Date(Date.now() - 86400000 * 5), applicants: 3
                },
                {
                    id: 'job_6', title: 'ÌöåÍ≥Ñ Îã¥ÎãπÏûê', skill: 'accounting', level: 'mid',
                    salary: 4800, company: 'ÌöåÍ≥ÑÎ≤ïÏù∏', employer: 'AccountingPro',
                    description: 'Ï†ÑÏÇ∞ÏÑ∏Î¨¥, Ïû¨Î¨¥Ï†úÌëú ÏûëÏÑ±. ÌöåÍ≥ÑÏÇ¨ Ïö∞ÎåÄ',
                    postedAt: new Date(Date.now() - 86400000 * 6), applicants: 10
                }
            ];
        }
        
        function showLaborTab(tab) {
            // ÌÉ≠ Î≤ÑÌäº Ïä§ÌÉÄÏùº ÏóÖÎç∞Ïù¥Ìä∏
            document.querySelectorAll('[id^="labor"][id$="Tab"]').forEach(btn => {
                btn.className = 'btn btn-secondary';
            });
            document.getElementById(`labor${tab.charAt(0).toUpperCase() + tab.slice(1).replace('-', '')}Tab`).className = 'btn';
            
            // ÌÉ≠ Ïª®ÌÖêÏ∏† ÌëúÏãú/Ïà®ÍπÄ
            document.getElementById('laborJobsContent').style.display = tab === 'jobs' ? 'block' : 'none';
            document.getElementById('laborHireContent').style.display = tab === 'hire' ? 'block' : 'none';
            document.getElementById('laborMyJobsContent').style.display = tab === 'my-jobs' ? 'block' : 'none';
            document.getElementById('laborFreelanceContent').style.display = tab === 'freelance' ? 'block' : 'none';
            
            if (tab === 'jobs') {
                displayJobPostings();
            } else if (tab === 'hire') {
                updateMyBusinessesForHiring();
            } else if (tab === 'my-jobs') {
                displayMyEmploymentInfo();
            } else if (tab === 'freelance') {
                displayFreelanceJobs();
            }
        }
        
        function filterJobPostings() {
            displayJobPostings();
        }
        
        function displayJobPostings() {
            const skillFilter = document.getElementById('jobSkillFilter')?.value || 'all';
            const levelFilter = document.getElementById('jobLevelFilter')?.value || 'all';
            
            const filteredJobs = gameState.laborMarket.jobPostings.filter(job => {
                const skillMatch = skillFilter === 'all' || job.skill === skillFilter;
                const levelMatch = levelFilter === 'all' || job.level === levelFilter;
                return skillMatch && levelMatch;
            });
            
            const skillNames = {
                'programming': 'Í∞úÎ∞ú', 'design': 'ÎîîÏûêÏù∏', 'marketing': 'ÎßàÏºÄÌåÖ',
                'sales': 'ÏòÅÏóÖ', 'management': 'Í¥ÄÎ¶¨', 'accounting': 'ÌöåÍ≥Ñ',
                'legal': 'Î≤ïÎ¨¥', 'engineering': 'ÏóîÏßÄÎãàÏñ¥ÎßÅ', 'research': 'Ïó∞Íµ¨', 'consulting': 'Ïª®ÏÑ§ÌåÖ'
            };
            
            const levelNames = {
                'junior': 'Ïã†ÏûÖ', 'mid': 'Ï§ëÍ∏â', 'senior': 'Í≥†Í∏â', 'lead': 'ÌåÄÏû•Í∏â', 'executive': 'ÏûÑÏõêÍ∏â'
            };
            
            const jobsHtml = filteredJobs.map(job => `
                <div class="business-card" style="margin-bottom: 15px; cursor: pointer;" onclick="showJobApplicationModal('${job.id}')">
                    <div class="business-header">
                        <div class="business-name">üíº ${job.title}</div>
                        <div style="color: var(--success); font-weight: bold;">${job.salary.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß/Ïõî</div>
                    </div>
                    <div style="font-size: 0.9rem; color: #94a3b8; margin: 8px 0;">
                        <div style="margin-bottom: 8px; display: flex; gap: 10px; flex-wrap: wrap;">
                            <span style="background: rgba(59, 130, 246, 0.2); color: #60a5fa; padding: 2px 8px; border-radius: 12px; font-size: 0.8rem;">
                                ${skillNames[job.skill] || job.skill}
                            </span>
                            <span style="background: rgba(34, 197, 94, 0.2); color: #4ade80; padding: 2px 8px; border-radius: 12px; font-size: 0.8rem;">
                                ${levelNames[job.level] || job.level}
                            </span>
                            <span style="color: #cbd5e1;">üè¢ ${job.company}</span>
                        </div>
                        <div style="margin-bottom: 8px;">
                            üë§ Ï±ÑÏö©Îã¥ÎãπÏûê: ${job.employer}
                        </div>
                        <div style="color: #e2e8f0; margin-bottom: 8px;">
                            ${job.description}
                        </div>
                        <div style="font-size: 0.8rem; color: #64748b; display: flex; justify-content: space-between;">
                            <span>üìã ÏßÄÏõêÏûê ${job.applicants}Î™Ö</span>
                            <span>üìÖ ${job.postedAt.toLocaleDateString()}</span>
                        </div>
                    </div>
                </div>
            `).join('');
            
            document.getElementById('jobPostingsList').innerHTML = jobsHtml.length > 0 ? jobsHtml : 
                '<div style="text-align: center; color: #64748b; padding: 40px;">Í≤ÄÏÉâ Ï°∞Í±¥Ïóê ÎßûÎäî Íµ¨Ïù∏Í≥µÍ≥†Í∞Ä ÏóÜÏäµÎãàÎã§.</div>';
        }
        
        function updateSalaryRange() {
            const level = document.getElementById('jobLevel')?.value;
            const ranges = gameState.laborMarket.salaryRanges[level];
            if (ranges) {
                document.getElementById('salaryGuideline').textContent = 
                    `${level} Í∂åÏû• Î≤îÏúÑ: ${ranges.min.toLocaleString()}~${ranges.max.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß`;
            }
        }
        
        function postJob() {
            const title = document.getElementById('jobTitle')?.value;
            const skill = document.getElementById('jobSkill')?.value;
            const level = document.getElementById('jobLevel')?.value;
            const salary = parseInt(document.getElementById('jobSalary')?.value);
            const description = document.getElementById('jobDescription')?.value;
            
            if (!title || !salary || salary < 1000) {
                showNotification('Î™®Îì† ÌïÑÎìúÎ•º Ïò¨Î∞îÎ•¥Í≤å ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî (ÏµúÏÜå Í∏âÏó¨ 1,000 ÎπÑÌä∏ÌÅ¨Î†àÎîß)', 'error');
                return;
            }
            
            if (gameState.roleData.businesses.length === 0) {
                showNotification('Íµ¨Ïù∏Í≥µÍ≥†Î•º Îì±Î°ùÌïòÎ†§Î©¥ ÏÇ¨ÏóÖÏ≤¥Í∞Ä ÌïÑÏöîÌï©ÎãàÎã§', 'error');
                return;
            }
            
            const newJob = {
                id: `job_${Date.now()}`,
                title: title,
                skill: skill,
                level: level,
                salary: salary,
                company: gameState.roleData.businesses[0].name, // Ï≤´ Î≤àÏß∏ ÏÇ¨ÏóÖÏ≤¥
                employer: gameState.currentUser.username,
                description: description,
                postedAt: new Date(),
                applicants: 0,
                isMyPosting: true
            };
            
            gameState.laborMarket.jobPostings.unshift(newJob);
            
            // Ìèº Ï¥àÍ∏∞Ìôî
            document.getElementById('jobTitle').value = '';
            document.getElementById('jobSalary').value = '';
            document.getElementById('jobDescription').value = '';
            
            showNotification('Íµ¨Ïù∏Í≥µÍ≥†Í∞Ä Îì±Î°ùÎêòÏóàÏäµÎãàÎã§!', 'success');
            showLaborTab('jobs'); // Íµ¨Ïù∏Í≥µÍ≥† ÌÉ≠ÏúºÎ°ú Ïù¥Îèô
        }
        
        function updateMyBusinessesForHiring() {
            const businessesHtml = gameState.roleData.businesses.map(business => `
                <div class="business-card" style="margin-bottom: 10px;">
                    <div class="business-header">
                        <div class="business-name">üè¢ ${business.name}</div>
                        <div style="color: var(--primary);">${business.employees}Î™Ö Í≥†Ïö©Ï§ë</div>
                    </div>
                    <div style="font-size: 0.9rem; color: #94a3b8; margin: 8px 0;">
                        <div>‚Ä¢ Ïõî Í∏âÏó¨ ÏßÄÏ∂ú: ${Math.floor(business.employees * 3000).toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß (Ï∂îÏ†ï)</div>
                        <div>‚Ä¢ ÏÇ¨ÏóÖÏ≤¥ ÏàòÏùµ: ${business.profit.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß/Ïõî</div>
                        <div style="color: ${business.profit > business.employees * 3000 ? 'var(--success)' : 'var(--danger)'};">
                            ‚Ä¢ Í∏âÏó¨ ÎåÄÎπÑ ÏàòÏùµ: ${business.profit > business.employees * 3000 ? 'ÌùëÏûê' : 'Ï†ÅÏûê'}
                        </div>
                    </div>
                </div>
            `).join('');
            
            document.getElementById('myBusinessesForHiring').innerHTML = businessesHtml.length > 0 ? 
                '<h4 style="color: #cbd5e1; margin-bottom: 10px;">ÎÇ¥ ÏÇ¨ÏóÖÏ≤¥Î≥Ñ ÏßÅÏõê ÌòÑÌô©</h4>' + businessesHtml : 
                '<div style="text-align: center; color: #64748b; padding: 20px;">Î≥¥Ïú†Ìïú ÏÇ¨ÏóÖÏ≤¥Í∞Ä ÏóÜÏäµÎãàÎã§.</div>';
        }
        
        function displayMyEmploymentInfo() {
            // ÎÇ¥Í∞Ä Í≥†Ïö©Ìïú ÏßÅÏõêÎì§
            const myEmployees = gameState.laborMarket.contracts.filter(contract => 
                contract.employerId === gameState.currentUser.username
            );
            
            const employeesHtml = myEmployees.map(contract => `
                <div class="business-card" style="margin-bottom: 10px;">
                    <div class="business-header">
                        <div class="business-name">üë§ ${contract.employeeName}</div>
                        <div style="color: var(--success);">${contract.salary.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß/Ïõî</div>
                    </div>
                    <div style="font-size: 0.9rem; color: #94a3b8; margin: 8px 0;">
                        <div>‚Ä¢ ÏßÅÏ±Ö: ${contract.title}</div>
                        <div>‚Ä¢ ÏûÖÏÇ¨Ïùº: ${contract.startDate.toLocaleDateString()}</div>
                        <div>‚Ä¢ Í∑ºÎ¨¥Í∏∞Í∞Ñ: ${Math.floor((Date.now() - contract.startDate) / (1000 * 60 * 60 * 24))}Ïùº</div>
                    </div>
                    <button class="btn btn-sm" onclick="terminateEmployee('${contract.id}')" style="background: var(--danger); margin-top: 8px;">
                        Í≥ÑÏïΩ Ìï¥ÏßÄ
                    </button>
                </div>
            `).join('');
            
            // ÎÇ¥ Í≥†Ïö© ÏÉÅÌÉú
            const myJob = gameState.laborMarket.contracts.find(contract => 
                contract.employeeId === gameState.currentUser.username
            );
            
            const employmentStatusHtml = myJob ? `
                <div class="business-card">
                    <div class="business-header">
                        <div class="business-name">üè¢ ${myJob.company}</div>
                        <div style="color: var(--success);">${myJob.salary.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß/Ïõî</div>
                    </div>
                    <div style="font-size: 0.9rem; color: #94a3b8; margin: 8px 0;">
                        <div>‚Ä¢ ÏßÅÏ±Ö: ${myJob.title}</div>
                        <div>‚Ä¢ ÏÉÅÏÇ¨: ${myJob.employerName}</div>
                        <div>‚Ä¢ ÏûÖÏÇ¨Ïùº: ${myJob.startDate.toLocaleDateString()}</div>
                        <div>‚Ä¢ Í∑ºÎ¨¥Í∏∞Í∞Ñ: ${Math.floor((Date.now() - myJob.startDate) / (1000 * 60 * 60 * 24))}Ïùº</div>
                    </div>
                    <button class="btn btn-sm btn-secondary" onclick="quitJob('${myJob.id}')" style="margin-top: 8px;">
                        Ìá¥ÏÇ¨ÌïòÍ∏∞
                    </button>
                </div>
            ` : '<div style="text-align: center; color: #64748b; padding: 40px;">ÌòÑÏû¨ Ï∑®ÏóÖÌïòÏßÄ ÏïäÏùÄ ÏÉÅÌÉúÏûÖÎãàÎã§.</div>';
            
            document.getElementById('myEmployeesList').innerHTML = employeesHtml.length > 0 ? employeesHtml : 
                '<div style="text-align: center; color: #64748b; padding: 20px;">Í≥†Ïö©Ìïú ÏßÅÏõêÏù¥ ÏóÜÏäµÎãàÎã§.</div>';
                
            document.getElementById('myEmploymentStatus').innerHTML = employmentStatusHtml;
        }
        
        function displayFreelanceJobs() {
            const freelanceJobs = [
                { title: 'ÏõπÏÇ¨Ïù¥Ìä∏ Î¶¨Îâ¥Ïñº', skill: 'design', payment: 15000, duration: '2Ï£º', client: 'WebCompany', description: 'Í∏∞ÏóÖ ÏõπÏÇ¨Ïù¥Ìä∏ UI/UX Í∞úÏÑ†' },
                { title: 'SEO ÏµúÏ†ÅÌôî', skill: 'marketing', payment: 8000, duration: '1Ï£º', client: 'SEOExpert', description: 'Í≤ÄÏÉâÏóîÏßÑ ÏµúÏ†ÅÌôî Î∞è ÌÇ§ÏõåÎìú Î∂ÑÏÑù' },
                { title: 'Î™®Î∞îÏùº Ïï± Í∞úÎ∞ú', skill: 'programming', payment: 25000, duration: '1Í∞úÏõî', client: 'AppStudio', description: 'React Native Í∏∞Î∞ò Î™®Î∞îÏùº Ïï±' },
                { title: 'ÏòÅÏóÖ ÌîÑÎ†àÏ††ÌÖåÏù¥ÏÖò', skill: 'sales', payment: 5000, duration: '3Ïùº', client: 'SalesTeam', description: 'B2B ÏòÅÏóÖÏö© PPT Ï†úÏûë' }
            ];
            
            const skillNames = {
                'programming': 'Í∞úÎ∞ú', 'design': 'ÎîîÏûêÏù∏', 'marketing': 'ÎßàÏºÄÌåÖ', 'sales': 'ÏòÅÏóÖ'
            };
            
            const freelanceHtml = freelanceJobs.map((job, index) => `
                <div class="business-card" style="margin-bottom: 15px; cursor: pointer;" onclick="applyFreelance(${index})">
                    <div class="business-header">
                        <div class="business-name">üéØ ${job.title}</div>
                        <div style="color: var(--warning); font-weight: bold;">${job.payment.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß</div>
                    </div>
                    <div style="font-size: 0.9rem; color: #94a3b8; margin: 8px 0;">
                        <div style="margin-bottom: 8px; display: flex; gap: 10px; flex-wrap: wrap;">
                            <span style="background: rgba(245, 158, 11, 0.2); color: #fbbf24; padding: 2px 8px; border-radius: 12px; font-size: 0.8rem;">
                                ${skillNames[job.skill]}
                            </span>
                            <span style="color: #cbd5e1;">‚è±Ô∏è ${job.duration}</span>
                            <span style="color: #cbd5e1;">üë§ ${job.client}</span>
                        </div>
                        <div style="color: #e2e8f0;">
                            ${job.description}
                        </div>
                    </div>
                </div>
            `).join('');
            
            document.getElementById('freelanceJobsList').innerHTML = freelanceHtml;
        }
        
        function showJobApplicationModal(jobId) {
            const job = gameState.laborMarket.jobPostings.find(j => j.id === jobId);
            if (!job) return;
            
            if (job.employer === gameState.currentUser.username) {
                showNotification('Î≥∏Ïù∏Ïù¥ Ïò¨Î¶∞ Íµ¨Ïù∏Í≥µÍ≥†ÏóêÎäî ÏßÄÏõêÌï† Ïàò ÏóÜÏäµÎãàÎã§', 'error');
                return;
            }
            
            // Ïù¥ÎØ∏ Ï∑®ÏóÖÏ§ëÏù∏ÏßÄ ÌôïÏù∏
            const hasJob = gameState.laborMarket.contracts.some(contract => 
                contract.employeeId === gameState.currentUser.username && contract.isActive
            );
            
            const skillNames = { 'programming': 'Í∞úÎ∞ú', 'design': 'ÎîîÏûêÏù∏', 'marketing': 'ÎßàÏºÄÌåÖ', 'sales': 'ÏòÅÏóÖ', 'management': 'Í¥ÄÎ¶¨', 'accounting': 'ÌöåÍ≥Ñ' };
            const levelNames = { 'junior': 'Ïã†ÏûÖ', 'mid': 'Ï§ëÍ∏â', 'senior': 'Í≥†Í∏â', 'lead': 'ÌåÄÏû•Í∏â', 'executive': 'ÏûÑÏõêÍ∏â' };
            
            const modalContent = `
                <h2 style="text-align: center; margin-bottom: 30px; color: var(--primary);">üìã ÏûÖÏÇ¨ÏßÄÏõê</h2>
                
                <div style="background: rgba(59, 130, 246, 0.1); border: 1px solid rgba(59, 130, 246, 0.3); border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                    <div style="margin-bottom: 15px;">
                        <div style="font-size: 1.2rem; font-weight: bold; color: var(--primary);">${job.title}</div>
                        <div style="color: #94a3b8; font-size: 0.9rem;">ÌöåÏÇ¨: ${job.company} | Îã¥ÎãπÏûê: ${job.employer}</div>
                    </div>
                    <div style="margin-bottom: 15px; display: flex; gap: 10px;">
                        <span style="background: rgba(59, 130, 246, 0.2); color: #60a5fa; padding: 2px 8px; border-radius: 12px; font-size: 0.8rem;">
                            ${skillNames[job.skill]}
                        </span>
                        <span style="background: rgba(34, 197, 94, 0.2); color: #4ade80; padding: 2px 8px; border-radius: 12px; font-size: 0.8rem;">
                            ${levelNames[job.level]}
                        </span>
                    </div>
                    <div style="color: #e2e8f0; margin-bottom: 15px;">
                        ${job.description}
                    </div>
                    <div style="color: var(--success); font-size: 1.1rem; font-weight: bold;">
                        ÏõîÍ∏â: ${job.salary.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß
                    </div>
                </div>

                ${hasJob ? `
                    <div style="background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.3); border-radius: 12px; padding: 15px; margin-bottom: 20px; text-align: center;">
                        <div style="color: var(--danger); font-weight: bold;">‚ö†Ô∏è Ïù¥ÎØ∏ Ï∑®ÏóÖÏ§ëÏûÖÎãàÎã§</div>
                        <div style="color: #94a3b8; font-size: 0.9rem; margin-top: 5px;">ÌòÑÏû¨ ÏßÅÏû•ÏùÑ Ìá¥ÏÇ¨Ìïú ÌõÑ ÏßÄÏõêÌïòÏã§ Ïàò ÏûàÏäµÎãàÎã§.</div>
                    </div>
                ` : ''}

                <div style="display: flex; gap: 15px; margin-top: 20px;">
                    <button onclick="closeModal()" class="btn btn-secondary" style="flex: 1;">Ï∑®ÏÜå</button>
                    <button onclick="applyForJob('${job.id}')" 
                            ${hasJob ? 'disabled class="btn btn-secondary"' : 'class="btn"'} 
                            style="flex: 1;">
                        ${hasJob ? 'Ï∑®ÏóÖÏ§ë' : 'ÏßÄÏõêÌïòÍ∏∞'}
                    </button>
                </div>
            `;
            
            showModal(modalContent);
        }
        
        function applyForJob(jobId) {
            const job = gameState.laborMarket.jobPostings.find(j => j.id === jobId);
            if (!job) return;
            
            // ÏßÄÏõêÏûê Ïàò Ï¶ùÍ∞Ä
            job.applicants += 1;
            
            // ÏûêÎèô Ï±ÑÏö© ÌôïÎ•† (70%)
            if (Math.random() < 0.7) {
                // Í≥†Ïö© Í≥ÑÏïΩ ÏÉùÏÑ±
                const contract = {
                    id: `contract_${Date.now()}`,
                    jobId: jobId,
                    employeeId: gameState.currentUser.username,
                    employeeName: gameState.currentUser.username,
                    employerId: job.employer,
                    employerName: job.employer,
                    company: job.company,
                    title: job.title,
                    salary: job.salary,
                    startDate: new Date(),
                    isActive: true
                };
                
                gameState.laborMarket.contracts.push(contract);
                
                closeModal();
                showNotification(`Ï∂ïÌïòÌï©ÎãàÎã§! ${job.company}Ïóê ${job.title}Î°ú Ï∑®ÏóÖÌïòÏÖ®ÏäµÎãàÎã§!`, 'success');
                
                // Íµ¨Ïù∏Í≥µÍ≥† Ï†úÍ±∞ (1Î™Ö Ï±ÑÏö© ÏôÑÎ£å)
                gameState.laborMarket.jobPostings = gameState.laborMarket.jobPostings.filter(j => j.id !== jobId);
            } else {
                closeModal();
                showNotification('ÏßÄÏõêÏÑúÍ∞Ä Ï†ëÏàòÎêòÏóàÏßÄÎßå ÏïÑÏâΩÍ≤åÎèÑ Ï±ÑÏö©ÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§.', 'info');
            }
            
            displayJobPostings();
        }
        
        function applyFreelance(index) {
            const jobs = [
                { title: 'ÏõπÏÇ¨Ïù¥Ìä∏ Î¶¨Îâ¥Ïñº', skill: 'design', payment: 15000, duration: '2Ï£º', client: 'WebCompany', description: 'Í∏∞ÏóÖ ÏõπÏÇ¨Ïù¥Ìä∏ UI/UX Í∞úÏÑ†' },
                { title: 'SEO ÏµúÏ†ÅÌôî', skill: 'marketing', payment: 8000, duration: '1Ï£º', client: 'SEOExpert', description: 'Í≤ÄÏÉâÏóîÏßÑ ÏµúÏ†ÅÌôî Î∞è ÌÇ§ÏõåÎìú Î∂ÑÏÑù' },
                { title: 'Î™®Î∞îÏùº Ïï± Í∞úÎ∞ú', skill: 'programming', payment: 25000, duration: '1Í∞úÏõî', client: 'AppStudio', description: 'React Native Í∏∞Î∞ò Î™®Î∞îÏùº Ïï±' },
                { title: 'ÏòÅÏóÖ ÌîÑÎ†àÏ††ÌÖåÏù¥ÏÖò', skill: 'sales', payment: 5000, duration: '3Ïùº', client: 'SalesTeam', description: 'B2B ÏòÅÏóÖÏö© PPT Ï†úÏûë' }
            ];
            
            const job = jobs[index];
            if (Math.random() < 0.6) { // 60% ÏÑ±Í≥µÎ•†
                gameState.currentUser.game_balance += job.payment;
                showNotification(`ÌîÑÎ¶¨ÎûúÏä§ ÌîÑÎ°úÏ†ùÌä∏ "${job.title}" ÏôÑÎ£å! +${job.payment.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß`, 'success');
                updateDisplay();
            } else {
                showNotification(`ÌîÑÎ¶¨ÎûúÏä§ ÌîÑÎ°úÏ†ùÌä∏ "${job.title}"Ïóê ÏÑ†Ï†ïÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§.`, 'info');
            }
        }
        
        function terminateEmployee(contractId) {
            if (!confirm('Ï†ïÎßê Ïù¥ ÏßÅÏõêÍ≥ºÏùò Í≥ÑÏïΩÏùÑ Ìï¥ÏßÄÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) return;
            
            const contract = gameState.laborMarket.contracts.find(c => c.id === contractId);
            if (contract) {
                contract.isActive = false;
                contract.endDate = new Date();
                showNotification(`${contract.employeeName}ÎãòÍ≥ºÏùò Í≥†Ïö©Í≥ÑÏïΩÏù¥ Ìï¥ÏßÄÎêòÏóàÏäµÎãàÎã§.`, 'info');
                displayMyEmploymentInfo();
            }
        }
        
        function quitJob(contractId) {
            if (!confirm('Ï†ïÎßê Ìá¥ÏÇ¨ÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) return;
            
            const contract = gameState.laborMarket.contracts.find(c => c.id === contractId);
            if (contract) {
                contract.isActive = false;
                contract.endDate = new Date();
                showNotification(`${contract.company}ÏóêÏÑú Ìá¥ÏÇ¨ÌñàÏäµÎãàÎã§.`, 'info');
                displayMyEmploymentInfo();
            }
        }
        
        // ÏûêÏõê ÏãúÏä§ÌÖú Í¥ÄÎ¶¨
        function startResourceSystem() {
            setInterval(() => {
                updateResourceConsumption();
                regenerateResources();
                updateResourceEffects();
                updateCountryEconomics();
            }, 15000); // 15Ï¥àÎßàÎã§ ÏûêÏõê ÏãúÏä§ÌÖú ÏóÖÎç∞Ïù¥Ìä∏
        }
        
        function updateResourceConsumption() {
            // ÌîåÎ†àÏù¥Ïñ¥ ÌôúÎèôÏóê Îî∞Î•∏ ÏûêÏõê ÏÜåÎ™® Í≥ÑÏÇ∞
            let totalConsumption = {
                raw_materials: 0,
                energy: 0,
                technology: 0,
                human_capital: 0,
                infrastructure: 0
            };
            
            // ÏÇ¨ÏóÖÏ≤¥ Ïö¥ÏòÅÏúºÎ°ú Ïù∏Ìïú ÏûêÏõê ÏÜåÎ™®
            const totalBusinesses = Object.keys(gameState.roleData || {}).reduce((count, key) => {
                return count + ((gameState.roleData[key]?.businesses || []).length);
            }, 0);
            
            // Ìà¨Ïûê ÌôúÎèôÏúºÎ°ú Ïù∏Ìïú ÏûêÏõê ÏÜåÎ™®  
            const totalInvestments = Object.keys(gameState.roleData || {}).reduce((count, key) => {
                return count + ((gameState.roleData[key]?.investments || []).length);
            }, 0);
            
            // ÏùÄÌñâ ÌôúÎèôÏúºÎ°ú Ïù∏Ìïú ÏûêÏõê ÏÜåÎ™®
            const bankAssets = gameState.bankSettings?.bankAssets || 0;
            
            // Í∏∞Î≥∏ ÏÜåÎ™®Îüâ + ÌôúÎèôÏóê ÎπÑÎ°ÄÌïú ÏÜåÎ™®Îüâ
            totalConsumption.raw_materials = 50 + (totalBusinesses * 15) + (totalInvestments * 5);
            totalConsumption.energy = 80 + (totalBusinesses * 25) + (bankAssets / 100000);
            totalConsumption.technology = 20 + (totalInvestments * 8) + (totalBusinesses * 3);
            totalConsumption.human_capital = 30 + (gameState.laborMarket?.contracts?.filter(c => c.isActive)?.length * 10 || 0);
            totalConsumption.infrastructure = 40 + (totalBusinesses * 12) + (totalInvestments * 4);
            
            // Í≤ΩÏ†ú ÌôúÏÑ±ÎèÑÏóê Îî∞Î•∏ ÏÜåÎ™®Îüâ Ï°∞Ï†ï
            const economicActivity = gameState.countrySystem.economicActivity;
            Object.keys(totalConsumption).forEach(resource => {
                totalConsumption[resource] = Math.floor(totalConsumption[resource] * economicActivity);
            });
            
            // ÏûêÏõê ÏÜåÎ™® Ï†ÅÏö©
            gameState.resourceSystem.resources.forEach((resourceData, resourceName) => {
                const consumption = totalConsumption[resourceName] || 0;
                resourceData.current = Math.max(0, resourceData.current - consumption);
            });
            
            gameState.resourceSystem.globalConsumption = Object.values(totalConsumption).reduce((sum, val) => sum + val, 0);
        }
        
        function regenerateResources() {
            // ÏûêÏõêÎ≥Ñ Ïû¨ÏÉùÏÇ∞
            gameState.resourceSystem.resources.forEach((resourceData, resourceName) => {
                // Í∏∞Î≥∏ Ïû¨ÏÉùÏÇ∞Ïú®Ïóê Í≤ΩÏ†ú ÌôúÏÑ±ÎèÑ Î∞òÏòÅ
                const baseRegenRate = resourceData.regenerationRate;
                const economicBonus = gameState.countrySystem.economicActivity * 0.5; // ÏµúÎåÄ 50% Î≥¥ÎÑàÏä§
                const actualRegenRate = Math.floor(baseRegenRate * (1 + economicBonus));
                
                // ÏûêÏõê Ïû¨ÏÉùÏÇ∞ (ÏµúÎåÄÏπò Ï¥àÍ≥º Î∂àÍ∞Ä)
                resourceData.current = Math.min(resourceData.max, resourceData.current + actualRegenRate);
                
                // ÏûêÏõê Ìù¨ÏÜåÏÑ± Í≥ÑÏÇ∞ (ÌòÑÏû¨Îüâ/ÏµúÎåÄÎüâ)
                const scarcityLevel = resourceData.current / resourceData.max;
                gameState.resourceSystem.scarcityEffects.set(resourceName, scarcityLevel);
                
                // Ìù¨ÏÜåÏÑ±Ïóê Îî∞Î•∏ Í∞ÄÍ≤© Î∞∞Ïàò (ÏûêÏõêÏù¥ Î∂ÄÏ°±Ìï†ÏàòÎ°ù ÎπÑÏã∏Ïßê)
                const priceMultiplier = 2.0 - scarcityLevel; // 1.0 ~ 2.0 Î∞∞
                gameState.resourceSystem.priceMultipliers.set(resourceName, priceMultiplier);
            });
        }
        
        function updateResourceEffects() {
            // ÏûêÏõê Î∂ÄÏ°±Ïù¥ Í≤åÏûÑ Í≤ΩÏ†úÏóê ÎØ∏ÏπòÎäî ÏòÅÌñ•
            const avgScarcity = Array.from(gameState.resourceSystem.scarcityEffects.values()).reduce((sum, val) => sum + val, 0) / 5;
            
            // ÏûêÏõê Î∂ÄÏ°±Ïãú ÏÇ¨ÏóÖ ÏàòÏùµ Í∞êÏÜå
            if (avgScarcity < 0.3) { // ÌèâÍ∑† ÏûêÏõêÎüâÏù¥ 30% Ïù¥Ìïò
                gameState.roleData.businesses?.forEach(business => {
                    business.profit = Math.max(business.profit * 0.95, 100); // 5% Í∞êÏÜå, ÏµúÏÜå 100
                });
                
                // Í≤ΩÏ†ú ÌôúÏÑ±ÎèÑ Í∞êÏÜå
                gameState.countrySystem.economicActivity = Math.max(0.1, gameState.countrySystem.economicActivity * 0.98);
                
                if (Math.random() < 0.1) { // 10% ÌôïÎ•†Î°ú Í≤ΩÍ≥† Î©îÏãúÏßÄ
                    showNotification('‚ö†Ô∏è ÏûêÏõê Î∂ÄÏ°±ÏúºÎ°ú Í≤ΩÏ†ú ÌôúÎèôÏù¥ ÎëîÌôîÎêòÍ≥† ÏûàÏäµÎãàÎã§!', 'warning');
                }
            }
            
            // ÏûêÏõê ÌíçÎ∂ÄÏãú ÏÇ¨ÏóÖ ÏàòÏùµ Ï¶ùÍ∞Ä
            if (avgScarcity > 0.8) { // ÌèâÍ∑† ÏûêÏõêÎüâÏù¥ 80% Ïù¥ÏÉÅ
                gameState.roleData.businesses?.forEach(business => {
                    business.profit = Math.floor(business.profit * 1.02); // 2% Ï¶ùÍ∞Ä
                });
                
                // Í≤ΩÏ†ú ÌôúÏÑ±ÎèÑ Ï¶ùÍ∞Ä
                gameState.countrySystem.economicActivity = Math.min(1.0, gameState.countrySystem.economicActivity * 1.01);
            }
            
            // ÌäπÏ†ï ÏûêÏõê Î∂ÄÏ°±Ïãú Ìï¥Îãπ ÏóÖÏ¢Ö ÏòÅÌñ•
            const energyScarcity = gameState.resourceSystem.scarcityEffects.get('energy');
            if (energyScarcity < 0.2) { // ÏóêÎÑàÏßÄ 20% Ïù¥Ìïò
                gameState.roleData.businesses?.forEach(business => {
                    if (business.type === 'manufacturing' || business.type === 'tech_startup') {
                        business.monthlyExpenses = Math.floor(business.monthlyExpenses * 1.2); // Ïö¥ÏòÅÎπÑ 20% Ï¶ùÍ∞Ä
                    }
                });
            }
            
            const technologyScarcity = gameState.resourceSystem.scarcityEffects.get('technology');
            if (technologyScarcity < 0.2) { // Í∏∞Ïà† ÏûêÏõê 20% Ïù¥Ìïò
                gameState.stockMarket.stocks.forEach(stock => {
                    if (stock.sector === 'tech') {
                        stock.price *= 0.995; // Í∏∞Ïà†Ï£º Í∞ÄÍ≤© ÌïòÎùΩ
                    }
                });
            }
        }
        
        function updateCountryEconomics() {
            const country = gameState.countrySystem;
            
            // Í≤ΩÏ†ú ÌôúÏÑ±ÎèÑÏóê Îî∞Î•∏ Ïù∏Íµ¨ ÎèôÏ†Å Î≥ÄÌôî
            const economicGrowth = (country.economicActivity - 0.5) * 0.02; // -1% ~ +1%
            country.population = Math.max(45000000, Math.floor(country.population * (1 + economicGrowth / 12))); // ÏõîÎã®ÏúÑ
            
            // GDP per capita Î≥ÄÌôî
            const gdpGrowth = country.economicActivity * 0.005 + (Math.random() - 0.5) * 0.01;
            country.gdpPerCapita = Math.max(20000, Math.floor(country.gdpPerCapita * (1 + gdpGrowth)));
            
            // Ïã§ÏóÖÎ•† Ï°∞Ï†ï
            const unemploymentChange = (0.5 - country.economicActivity) * 0.1;
            country.unemploymentRate = Math.max(1.5, Math.min(15.0, country.unemploymentRate + unemploymentChange));
            
            // ÏÜåÎπÑÏßÄÏ∂ú ÏßÄÏàò Ï°∞Ï†ï
            const spendingChange = (country.economicActivity - 0.5) * 0.02;
            country.consumerSpending = Math.max(0.3, Math.min(1.2, country.consumerSpending + spendingChange));
            
            // Ï∞ΩÏóÖÎ•† Ï°∞Ï†ï (Í≤ΩÏ†ú ÌôúÏÑ±ÎèÑÏôÄ Ïó∞Í¥Ä)
            country.businessFormationRate = Math.max(0.05, Math.min(0.3, 0.1 + (country.economicActivity - 0.5) * 0.4));
            
            // ÏßÄÏó≠Î≥Ñ Í≤ΩÏ†ú Í∞ÄÏ§ëÏπò Ï°∞Ï†ï
            country.regions.forEach(region => {
                const regionGrowth = (country.economicActivity - 0.5) * 0.01 * (Math.random() + 0.5);
                region.economicWeight = Math.max(0.01, Math.min(0.4, region.economicWeight + regionGrowth));
                
                // ÏÇ¨ÏóÖ Î≥¥ÎÑàÏä§ Ï°∞Ï†ï
                if (region.name === 'ÏÑúÏö∏ÌäπÎ≥ÑÏãú' || region.name === 'Í≤ΩÍ∏∞ÎèÑ') {
                    region.businessBonus = Math.max(0.8, Math.min(1.5, 1.0 + (country.economicActivity - 0.5)));
                }
            });
            
            // Í≤ΩÏ†ú ÏßÄÌëúÍ∞Ä ÏÇ¨ÏóÖ ÏÑ±Í≥µÎ•†Ïóê ÎØ∏ÏπòÎäî ÏòÅÌñ• Í≥ÑÏÇ∞
            updateBusinessSuccessRates();
        }
        
        function updateBusinessSuccessRates() {
            const country = gameState.countrySystem;
            
            // Í∏∞Î≥∏ ÏÑ±Í≥µÎ•†Ïóê Í≤ΩÏ†ú ÏßÄÌëú Î∞òÏòÅ
            const economicMultiplier = 
                (country.economicActivity * 0.3) + 
                (country.consumerSpending * 0.2) + 
                (country.businessFormationRate * 0.2) + 
                ((10 - country.unemploymentRate) / 10 * 0.15) + 
                (country.innovationIndex * 0.15);
                
            // ÏÇ¨ÏóÖ ÏãúÏûëÏãú ÏÑ±Í≥µ ÌôïÎ•† Ï°∞Ï†ï (Ï†ÄÏû•Ìï¥ÏÑú ÎÇòÏ§ëÏóê ÏÇ¨Ïö©)
            gameState.countrySystem.currentBusinessSuccessRate = Math.max(0.3, Math.min(1.2, economicMultiplier));
            
            // ÏûêÏõê Î∂ÄÏ°±Ïù¥ ÏÇ¨ÏóÖÏóê ÎØ∏ÏπòÎäî Ï∂îÍ∞Ä ÏòÅÌñ•
            const resourceAvailability = Array.from(gameState.resourceSystem.scarcityEffects.values()).reduce((sum, val) => sum + val, 0) / 5;
            gameState.countrySystem.resourceSuccessBonus = Math.max(0.5, Math.min(1.5, resourceAvailability));
            
            // Í∑πÎã®Ï†Å ÏÉÅÌô©ÏóêÏÑú ÏïåÎ¶º
            if (economicMultiplier < 0.4) {
                if (Math.random() < 0.05) { // 5% ÌôïÎ•†
                    showNotification('üìâ Í≤ΩÍ∏∞Ïπ®Ï≤¥Î°ú Ï∞ΩÏóÖ ÌôòÍ≤ΩÏù¥ ÏïÖÌôîÎêòÏóàÏäµÎãàÎã§', 'error');
                }
            } else if (economicMultiplier > 1.0) {
                if (Math.random() < 0.05) { // 5% ÌôïÎ•†
                    showNotification('üìà Í≤ΩÏ†úÌò∏Ìô©ÏúºÎ°ú Ï∞ΩÏóÖ Í∏∞ÌöåÍ∞Ä ÎäòÏñ¥ÎÇ¨ÏäµÎãàÎã§!', 'success');
                }
            }
        }
        
        // Í≤åÏûÑÏùò Í∏∞Ï°¥ ÎπÑÏ¶àÎãàÏä§ ÏÉùÏÑ± Ìï®ÏàòÏóê Í≤ΩÏ†ú ÏßÄÌëú Î∞òÏòÅ
        function getBusinessSuccessBonus() {
            const baseRate = gameState.countrySystem?.currentBusinessSuccessRate || 1.0;
            const resourceBonus = gameState.countrySystem?.resourceSuccessBonus || 1.0;
            return Math.min(2.0, baseRate * resourceBonus); // ÏµúÎåÄ 2Î∞∞
        }
        
        // ÏûêÏõê ÏÉÅÌÉúÎ•º UIÏóê ÌëúÏãúÌïòÎäî Ìï®Ïàò
        function displayResourceStatus() {
            const resources = gameState.resourceSystem.resources;
            let statusHtml = '<h4 style="color: var(--primary); margin-bottom: 15px;">üè≠ Íµ≠Í∞Ä ÏûêÏõê ÌòÑÌô©</h4>';
            
            const resourceNames = {
                'raw_materials': 'ÏõêÏûêÏû¨',
                'energy': 'ÏóêÎÑàÏßÄ', 
                'technology': 'Í∏∞Ïà†Î†•',
                'human_capital': 'Ïù∏Ï†ÅÏûêÏõê',
                'infrastructure': 'Ïù∏ÌîÑÎùº'
            };
            
            const resourceIcons = {
                'raw_materials': 'üè≠',
                'energy': '‚ö°',
                'technology': 'üíª', 
                'human_capital': 'üë•',
                'infrastructure': 'üèóÔ∏è'
            };
            
            resources.forEach((data, name) => {
                const percentage = (data.current / data.max * 100).toFixed(1);
                const scarcityLevel = data.current / data.max;
                const statusColor = scarcityLevel > 0.6 ? 'var(--success)' : scarcityLevel > 0.3 ? 'var(--warning)' : 'var(--danger)';
                
                statusHtml += `
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; padding: 8px; background: rgba(255,255,255,0.05); border-radius: 6px;">
                        <span>${resourceIcons[name]} ${resourceNames[name]}</span>
                        <span style="color: ${statusColor}; font-weight: bold;">${percentage}%</span>
                    </div>
                `;
            });
            
            return statusHtml;
        }
        
        function startBusiness() {
            if (gameState.currentUser.game_balance < 10000) {
                showNotification('ÏÇ¨ÏóÖ ÏãúÏûëÏóêÎäî ÏµúÏÜå 10,000 ÎπÑÌä∏ÌÅ¨Î†àÎîßÏù¥ ÌïÑÏöîÌï©ÎãàÎã§', 'error');
                return;
            }
            
            const businessTypes = [
                { name: 'Ïπ¥Ìéò', profit: 2000, value: 15000, employees: 2 },
                { name: 'Ìé∏ÏùòÏ†ê', profit: 1800, value: 12000, employees: 1 },
                { name: 'Ïò®ÎùºÏù∏ ÏáºÌïëÎ™∞', profit: 3500, value: 25000, employees: 3 },
                { name: 'ÏùåÏãùÏ†ê', profit: 2800, value: 20000, employees: 4 },
                { name: 'IT Ïä§ÌÉÄÌä∏ÏóÖ', profit: 4500, value: 35000, employees: 5 }
            ];
            const businessTemplate = businessTypes[Math.floor(Math.random() * businessTypes.length)];
            
            // Í≤ΩÏ†ú ÏßÄÌëúÏóê Îî∞Î•∏ ÏÇ¨ÏóÖ ÏÑ±Í≥µÎ•† Ï†ÅÏö©
            const successBonus = getBusinessSuccessBonus();
            const isSuccess = Math.random() < (0.7 * successBonus); // Í∏∞Î≥∏ 70% ÏÑ±Í≥µÎ•†Ïóê Í≤ΩÏ†ú Î≥¥ÎÑàÏä§ Ï†ÅÏö©
            
            gameState.currentUser.game_balance -= 10000;
            
            if (isSuccess) {
                // ÏÑ±Í≥µÏãú ÏÇ¨ÏóÖÏ≤¥Î•º roleDataÏóê Ï∂îÍ∞Ä
                const newBusiness = {
                    id: Date.now(),
                    name: businessTemplate.name + ' (' + Math.floor(Math.random() * 1000) + 'Ìò∏Ï†ê)',
                    type: businessTemplate.name,
                    profit: Math.floor(businessTemplate.profit * successBonus),
                    value: Math.floor(businessTemplate.value * successBonus),
                    employees: businessTemplate.employees,
                    monthlyExpenses: Math.floor(businessTemplate.profit * 0.6)
                };
                
                if (!gameState.roleData.businesses) {
                    gameState.roleData.businesses = [];
                }
                gameState.roleData.businesses.push(newBusiness);
                
                showNotification(`${businessTemplate.name} ÏÇ¨ÏóÖ ÏÑ±Í≥µ! Ïõî ${newBusiness.profit.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß ÏàòÏùµ ÏòàÏÉÅ`, 'success');
            } else {
                showNotification(`${businessTemplate.name} ÏÇ¨ÏóÖÏù¥ Ïã§Ìå®ÌñàÏäµÎãàÎã§... (Í≤ΩÏ†ú Ïó¨Í±¥ Î∂àÎ¶¨)`, 'error');
            }
            updateDisplay();
        }
        
        function applyLoan() {
            const loanAmount = prompt('ÎåÄÏ∂ú Í∏àÏï°ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî (ÏµúÎåÄ 50,000 ÎπÑÌä∏ÌÅ¨Î†àÎîß):');
            if (!loanAmount || isNaN(loanAmount)) return;
            
            const amount = parseInt(loanAmount);
            if (amount > 50000) {
                showNotification('ÏµúÎåÄ ÎåÄÏ∂ú ÌïúÎèÑÎäî 50,000 ÎπÑÌä∏ÌÅ¨Î†àÎîßÏûÖÎãàÎã§', 'error');
                return;
            }
            
            gameState.currentUser.game_balance += amount;
            showNotification(`ÎåÄÏ∂ú ÏäπÏù∏! ${amount.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîßÏùÑ Î∞õÏïòÏäµÎãàÎã§.`, 'success');
            updateDisplay();
        }
        
        function refreshData() {
            // Îç∞Î™® Îç∞Ïù¥ÌÑ∞ ÏóÖÎç∞Ïù¥Ìä∏
            gameState.economy.totalUsers = Math.floor(Math.random() * 100) + 50;
            gameState.economy.totalEconomy = Math.floor(Math.random() * 1000000) + 500000;
            gameState.economy.totalBusinesses = Math.floor(Math.random() * 50) + 20;
            gameState.economy.totalLoans = Math.floor(Math.random() * 200000) + 100000;
            
            updateDisplay();
            showNotification('Îç∞Ïù¥ÌÑ∞Î•º ÏÉàÎ°úÍ≥†Ïπ®ÌñàÏäµÎãàÎã§', 'success');
        }
        
        function adjustRate(type, change) {
            if (gameState.currentUser.role !== 'banker') {
                showNotification('ÏùÄÌñâÏû•Îßå Í∏àÎ¶¨Î•º Ï°∞Ï†ïÌï† Ïàò ÏûàÏäµÎãàÎã§', 'error');
                return;
            }
            
            switch(type) {
                case 'base':
                    gameState.bankSettings.baseRate = Math.round((gameState.bankSettings.baseRate + change) * 10) / 10;
                    gameState.bankSettings.baseRate = Math.max(0, Math.min(20, gameState.bankSettings.baseRate));
                    break;
                case 'loan':
                    gameState.bankSettings.loanRate = Math.round((gameState.bankSettings.loanRate + change) * 10) / 10;
                    gameState.bankSettings.loanRate = Math.max(0, Math.min(30, gameState.bankSettings.loanRate));
                    break;
                case 'deposit':
                    gameState.bankSettings.depositRate = Math.round((gameState.bankSettings.depositRate + change) * 10) / 10;
                    gameState.bankSettings.depositRate = Math.max(0, Math.min(20, gameState.bankSettings.depositRate));
                    break;
            }
            
            updateBankDisplay();
            showNotification(`Í∏àÎ¶¨Í∞Ä ${change > 0 ? 'Ïù∏ÏÉÅ' : 'Ïù∏Ìïò'}ÎêòÏóàÏäµÎãàÎã§`, 'success');
        }
        
        function setBankPolicy(policy) {
            if (gameState.currentUser.role !== 'banker') {
                showNotification('ÏùÄÌñâÏû•Îßå Ï†ïÏ±ÖÏùÑ Î≥ÄÍ≤ΩÌï† Ïàò ÏûàÏäµÎãàÎã§', 'error');
                return;
            }
            
            gameState.bankSettings.policy = policy;
            
            switch(policy) {
                case 'conservative':
                    gameState.bankSettings.baseRate = 3.0;
                    gameState.bankSettings.loanRate = 5.0;
                    gameState.bankSettings.depositRate = 2.0;
                    showNotification('Î≥¥ÏàòÏ†Å Ï†ïÏ±Ö: ÎÇÆÏùÄ Í∏àÎ¶¨, ÏïàÏ†ïÏ†Å Ïö¥ÏòÅ', 'info');
                    break;
                case 'balanced':
                    gameState.bankSettings.baseRate = 5.0;
                    gameState.bankSettings.loanRate = 8.0;
                    gameState.bankSettings.depositRate = 3.0;
                    showNotification('Í∑†Ìòï Ï†ïÏ±Ö: Ï†ÅÏ†ï Í∏àÎ¶¨, Í∑†Ìòï ÏÑ±Ïû•', 'info');
                    break;
                case 'aggressive':
                    gameState.bankSettings.baseRate = 8.0;
                    gameState.bankSettings.loanRate = 12.0;
                    gameState.bankSettings.depositRate = 5.0;
                    showNotification('Í≥µÍ≤©Ï†Å Ï†ïÏ±Ö: ÎÜíÏùÄ Í∏àÎ¶¨, Îπ†Î•∏ ÏÑ±Ïû•', 'info');
                    break;
            }
            
            updateBankDisplay();
        }
        
        function updateBankDisplay() {
            document.getElementById('baseRate').textContent = gameState.bankSettings.baseRate.toFixed(1) + '%';
            document.getElementById('loanRate').textContent = gameState.bankSettings.loanRate.toFixed(1) + '%';
            document.getElementById('depositRate').textContent = gameState.bankSettings.depositRate.toFixed(1) + '%';
            document.getElementById('bankAssets').textContent = gameState.bankSettings.bankAssets.toLocaleString();
            
            // ÏùÄÌñâ ÌÜµÍ≥Ñ ÏóÖÎç∞Ïù¥Ìä∏
            if (document.getElementById('totalLoansIssued')) {
                document.getElementById('totalLoansIssued').textContent = gameState.bankSettings.totalLoansIssued.toLocaleString();
                document.getElementById('totalDeposits').textContent = gameState.bankSettings.totalDeposits.toLocaleString();
                document.getElementById('bankRating').textContent = gameState.bankSettings.bankRating;
                document.getElementById('marketShare').textContent = gameState.bankSettings.marketShare.toFixed(1) + '%';
            }
        }
        
        // ÏùÄÌñâÏû• Í≥†Í∏â Í∏∞Îä•Îì§
        function issueGovernmentBond() {
            if (gameState.currentUser.role !== 'banker') {
                showNotification('ÏùÄÌñâÏû•Îßå Íµ≠Ï±ÑÎ•º Î∞úÌñâÌï† Ïàò ÏûàÏäµÎãàÎã§', 'error');
                return;
            }
            
            const bondAmount = 100000;
            const bondRate = gameState.bankSettings.baseRate + 1.0;
            
            gameState.bankSettings.bankAssets += bondAmount;
            gameState.bankSettings.totalDeposits += bondAmount;
            gameState.currentUser.game_balance += Math.floor(bondAmount * 0.02); // ÏàòÏàòÎ£å
            
            gameState.economy.totalEconomy += bondAmount;
            
            updateBankDisplay();
            updateDisplay();
            showNotification(`Íµ≠Ï±Ñ ${bondAmount.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß Î∞úÌñâ ÏôÑÎ£å! (Í∏àÎ¶¨: ${bondRate.toFixed(1)}%)`, 'success');
        }
        
        function adjustMoneySupply() {
            if (gameState.currentUser.role !== 'banker') {
                showNotification('ÏùÄÌñâÏû•Îßå ÌÜµÌôîÎüâÏùÑ Ï°∞Ï†àÌï† Ïàò ÏûàÏäµÎãàÎã§', 'error');
                return;
            }
            
            const supplyChange = Math.floor(Math.random() * 200000) + 50000;
            const isIncrease = Math.random() > 0.5;
            
            if (isIncrease) {
                gameState.economy.totalEconomy += supplyChange;
                gameState.bankSettings.bankAssets += Math.floor(supplyChange * 0.1);
                showNotification(`ÌÜµÌôîÎüâ ÌôïÎåÄ: +${supplyChange.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß`, 'info');
            } else {
                gameState.economy.totalEconomy = Math.max(0, gameState.economy.totalEconomy - supplyChange);
                showNotification(`ÌÜµÌôîÎüâ Ï∂ïÏÜå: -${supplyChange.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß`, 'warning');
            }
            
            // Í∏àÎ¶¨Ïóê ÏòÅÌñ•
            if (isIncrease) {
                gameState.bankSettings.baseRate = Math.max(0.1, gameState.bankSettings.baseRate - 0.2);
            } else {
                gameState.bankSettings.baseRate = Math.min(15.0, gameState.bankSettings.baseRate + 0.3);
            }
            
            updateBankDisplay();
            updateDisplay();
        }
        
        function provideLoanGuarantee() {
            if (gameState.currentUser.role !== 'banker') {
                showNotification('ÏùÄÌñâÏû•Îßå ÎåÄÏ∂ú Î≥¥Ï¶ùÏùÑ Ï†úÍ≥µÌï† Ïàò ÏûàÏäµÎãàÎã§', 'error');
                return;
            }
            
            const guaranteeAmount = 50000;
            const guaranteeFee = Math.floor(guaranteeAmount * 0.03);
            
            if (gameState.bankSettings.bankAssets < guaranteeAmount) {
                showNotification('ÏùÄÌñâ ÏûêÏÇ∞Ïù¥ Î∂ÄÏ°±Ìï©ÎãàÎã§', 'error');
                return;
            }
            
            gameState.bankSettings.totalLoansIssued += guaranteeAmount;
            gameState.currentUser.game_balance += guaranteeFee;
            gameState.bankSettings.marketShare += 0.5;
            
            // Ïã†Ïö©ÎèÑ Ìñ•ÏÉÅ
            if (gameState.bankSettings.marketShare > 30 && gameState.bankSettings.bankRating === 'AA') {
                gameState.bankSettings.bankRating = 'AAA';
                showNotification('ÏùÄÌñâ Ïã†Ïö©Îì±Í∏âÏù¥ AAAÎ°ú ÏÉÅÏäπÌñàÏäµÎãàÎã§!', 'success');
            }
            
            updateBankDisplay();
            updateDisplay();
            showNotification(`Ï§ëÏÜåÍ∏∞ÏóÖ ÎåÄÏ∂ú Î≥¥Ï¶ù ÏôÑÎ£å! ÏàòÏàòÎ£å: ${guaranteeFee.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß`, 'success');
        }
        
        function createSpecialProduct() {
            if (gameState.currentUser.role !== 'banker') {
                showNotification('ÏùÄÌñâÏû•Îßå ÌäπÎ≥Ñ ÏÉÅÌíàÏùÑ Ï∂úÏãúÌï† Ïàò ÏûàÏäµÎãàÎã§', 'error');
                return;
            }
            
            const products = [
                { name: 'Í≥†ÏàòÏùµ Ï†ïÍ∏∞ÏòàÍ∏à', revenue: 30000, cost: 10000 },
                { name: 'Ìà¨ÏûêÏó∞Í≥ÑÏÉÅÌíà', revenue: 50000, cost: 20000 },
                { name: 'Ïô∏ÌôîÏòàÍ∏à', revenue: 25000, cost: 8000 },
                { name: 'Íµ¨Ï°∞ÌôîÏÉÅÌíà', revenue: 80000, cost: 35000 }
            ];
            
            const product = products[Math.floor(Math.random() * products.length)];
            
            if (gameState.bankSettings.bankAssets < product.cost) {
                showNotification('ÏÉÅÌíà Ï∂úÏãú ÎπÑÏö©Ïù¥ Î∂ÄÏ°±Ìï©ÎãàÎã§', 'error');
                return;
            }
            
            gameState.bankSettings.bankAssets -= product.cost;
            gameState.bankSettings.totalDeposits += product.revenue;
            gameState.currentUser.game_balance += Math.floor(product.revenue * 0.05); // ÏàòÏàòÎ£å
            
            updateBankDisplay();
            updateDisplay();
            showNotification(`${product.name} Ï∂úÏãú ÏôÑÎ£å! ÏàúÏùµ: ${(product.revenue - product.cost).toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß`, 'success');
        }
        
        function updateDisplay() {
            // ÏßÅÏóÖÎ≥Ñ Ï¥ù ÏûêÏÇ∞ Í≥ÑÏÇ∞
            let totalAssets = gameState.currentUser.game_balance;
            
            // ÏÇ¨ÏóÖÍ∞Ä: ÏÇ¨ÏóÖ Í∞ÄÏπò Ìè¨Ìï®
            if (gameState.currentUser.role === 'entrepreneur') {
                const businessValue = gameState.roleData.businesses.reduce((sum, b) => sum + b.value, 0);
                totalAssets += businessValue;
                
                // ÏÇ¨ÏóÖÍ∞Ä Ï†ÑÏö© ÏóÖÎç∞Ïù¥Ìä∏
                if (document.getElementById('businessCount')) {
                    updateBusinessDisplay();
                }
            }
            
            // Ìà¨ÏûêÏûê: Ìà¨Ïûê ÏÉÅÌíà Í∞ÄÏπò Ìè¨Ìï®
            if (gameState.currentUser.role === 'investor') {
                const investmentValue = gameState.roleData.investments.reduce((sum, i) => 
                    sum + Math.floor(i.amount * (1 + i.returnRate)), 0);
                totalAssets += investmentValue;
                
                // Ìà¨ÏûêÏûê Ï†ÑÏö© ÏóÖÎç∞Ïù¥Ìä∏
                if (document.getElementById('totalInvestment')) {
                    updateInvestmentDisplay();
                }
            }
            
            // ÏßÅÏû•Ïù∏: Ïó∞Î¥âÏùò ÏùºÎ∂ÄÎ•º ÏûêÏÇ∞ÏúºÎ°ú Í≥ÑÏÇ∞
            if (gameState.currentUser.role === 'worker') {
                totalAssets += gameState.roleData.workStats.bonuses;
                
                // ÏßÅÏû•Ïù∏ Ï†ÑÏö© ÏóÖÎç∞Ïù¥Ìä∏
                if (document.getElementById('monthlySalary')) {
                    updateWorkDisplay();
                }
            }
            
            document.getElementById('gameBalance').textContent = gameState.currentUser.game_balance.toLocaleString();
            document.getElementById('totalAssets').textContent = totalAssets.toLocaleString();
            
            // Ïã†Ïö©Ï†êÏàò Í≥ÑÏÇ∞ (Ï¥ù ÏûêÏÇ∞ Í∏∞Î∞ò)
            const creditScore = 500 + Math.floor(totalAssets / 100);
            const creditGrade = creditScore >= 800 ? 'AAA' : 
                               creditScore >= 700 ? 'AA' :
                               creditScore >= 600 ? 'A' :
                               creditScore >= 500 ? 'BBB' : 'BB';
            
            document.getElementById('creditGrade').textContent = creditGrade;
            document.getElementById('creditScore').textContent = creditScore;
            
            document.getElementById('totalUsers').textContent = gameState.economy.totalUsers;
            document.getElementById('totalEconomy').textContent = gameState.economy.totalEconomy.toLocaleString();
            document.getElementById('totalBusinesses').textContent = gameState.economy.totalBusinesses;
            document.getElementById('totalLoans').textContent = gameState.economy.totalLoans.toLocaleString();
        }
        
        // ÏßÅÏóÖÎ≥Ñ ÏûêÎèô ÏàòÏùµ ÏãúÏä§ÌÖú
        function startIncomeSystem() {
            setInterval(() => {
                if (!gameState.currentUser) return;
                
                // ÏÇ¨ÏóÖÍ∞Ä: ÏÇ¨ÏóÖ ÏàòÏùµ
                if (gameState.currentUser.role === 'entrepreneur') {
                    const totalProfit = gameState.roleData.businesses.reduce((sum, b) => sum + b.profit, 0);
                    const totalExpenses = gameState.roleData.businesses.reduce((sum, b) => sum + b.monthlyExpenses, 0);
                    const netProfit = totalProfit - totalExpenses;
                    
                    if (netProfit > 0) {
                        gameState.currentUser.game_balance += Math.floor(netProfit / 30); // ÏùºÏùº ÏàòÏùµ
                        if (Math.random() < 0.1) { // 10% ÌôïÎ•†Î°ú ÏïåÎ¶º
                            showNotification(`ÏÇ¨ÏóÖ ÏàòÏùµ: +${Math.floor(netProfit / 30).toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß`, 'success');
                        }
                    }
                    
                    // ÎûúÎç§ ÏÇ¨ÏóÖ Ïù¥Î≤§Ìä∏ (Îß§Ïö∞ ÎÇÆÏùÄ ÌôïÎ•†)
                    if (Math.random() < 0.002 && gameState.roleData.businesses.length > 0) { // 0.2% ÌôïÎ•†
                        triggerBusinessEvent();
                    }
                }
                
                // Ìà¨ÏûêÏûê: Î∞∞ÎãπÍ∏à Î∞è ÏàòÏùµ
                if (gameState.currentUser.role === 'investor') {
                    const dailyDividends = gameState.roleData.investments.reduce((sum, i) => sum + Math.floor(i.dividends / 30), 0);
                    if (dailyDividends > 0) {
                        gameState.currentUser.game_balance += dailyDividends;
                        if (Math.random() < 0.1) { // 10% ÌôïÎ•†Î°ú ÏïåÎ¶º
                            showNotification(`Ìà¨Ïûê ÏàòÏùµ: +${dailyDividends.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß`, 'success');
                        }
                    }
                    
                    // Ìà¨Ïûê Í∞ÄÍ≤© Î≥ÄÎèô (ÌÉÄÏûÖÎ≥Ñ Ï∞®Î≥ÑÌôî)
                    gameState.roleData.investments.forEach(investment => {
                        let priceChange;
                        
                        if (investment.type === 'realestate' && investment.riskFactor) {
                            // Î∂ÄÎèôÏÇ∞ÏùÄ Î¶¨Ïä§ÌÅ¨ Ìå©ÌÑ∞Ïóê Îî∞Îùº Î≥ÄÎèôÏÑ± Ï°∞Ï†ï (ÌòÑÏã§Ï†ÅÏúºÎ°ú ÎÇÆÏ∂§)
                            const volatility = investment.riskFactor * 0.005; // 0.8~2.0 * 0.5% = 0.4%~1% (ÌòÑÏã§Ï†Å)
                            priceChange = (Math.random() - 0.5) * volatility;
                        } else if (investment.type === 'crypto') {
                            // ÏïîÌò∏ÌôîÌèêÎäî ÎÜíÏùÄ Î≥ÄÎèôÏÑ±
                            const volatility = investment.volatility || 0.08;
                            priceChange = (Math.random() - 0.5) * volatility; // ÎÜíÏùÄ Î≥ÄÎèôÏÑ±
                        } else if (investment.type === 'stock') {
                            // Ï£ºÏãùÏùÄ Î≥¥ÌÜµ Î≥ÄÎèôÏÑ±
                            const volatility = investment.volatility || 0.02;
                            priceChange = (Math.random() - 0.5) * volatility; // Î≥¥ÌÜµ Î≥ÄÎèôÏÑ±
                        } else if (investment.type === 'forex') {
                            // Ïô∏ÌôòÏùÄ ÎÇÆÏùÄ Î≥ÄÎèôÏÑ±
                            const volatility = investment.volatility || 0.03;
                            priceChange = (Math.random() - 0.5) * volatility; // ¬±1.5%
                        } else if (investment.type === 'commodity') {
                            // ÏõêÏûêÏû¨Îäî Ï§ëÍ∞Ñ Î≥ÄÎèôÏÑ±
                            const volatility = investment.volatility || 0.05;
                            priceChange = (Math.random() - 0.5) * volatility; // ¬±2.5%
                        } else if (investment.type === 'futures') {
                            // ÏÑ†Î¨ºÏùÄ Í∑πÎèÑÎ°ú ÎÜíÏùÄ Î≥ÄÎèôÏÑ± (Î†àÎ≤ÑÎ¶¨ÏßÄ Î∞òÏòÅ)
                            const volatility = investment.volatility || 0.1;
                            const rawChange = (Math.random() - 0.5) * volatility;
                            
                            // Ìè¨ÏßÄÏÖòÏóê Îî∞Î•∏ ÏàòÏùµ/ÏÜêÏã§ Í≥ÑÏÇ∞
                            if (investment.position === 'short') {
                                priceChange = -rawChange; // Ïàè Ìè¨ÏßÄÏÖòÏùÄ Î∞òÎåÄ Î∞©Ìñ•
                            } else {
                                priceChange = rawChange; // Î°± Ìè¨ÏßÄÏÖò
                            }
                            
                            // Î†àÎ≤ÑÎ¶¨ÏßÄ Ï†ÅÏö©
                            priceChange = priceChange * investment.leverage;
                            
                            // ÎßàÏßÑÏΩú Ï≤¥ÌÅ¨
                            const currentReturn = investment.returnRate + priceChange;
                            if (currentReturn <= investment.marginCallThreshold) {
                                // ÎßàÏßÑÏΩú Î∞úÏÉù - Ìè¨ÏßÄÏÖò Ï≤≠ÏÇ∞
                                investment.isActive = false;
                                investment.returnRate = -0.99; // 99% ÏÜêÏã§ (Í±∞Ïùò Ï†ÑÏï° ÏÜêÏã§)
                                setTimeout(() => {
                                    showNotification(`üö® ÎßàÏßÑÏΩú! ${investment.name} Ìè¨ÏßÄÏÖòÏù¥ Ï≤≠ÏÇ∞ÎêòÏóàÏäµÎãàÎã§!`, 'error');
                                }, Math.random() * 3000);
                                return; // Ï∂îÍ∞Ä Î≥ÄÎèô ÏóÜÏùå
                            }
                        } else {
                            // Í∏∞ÌÉÄ Ìà¨ÏûêÎäî Í∏∞Î≥∏ Î≥ÄÎèôÏÑ±
                            priceChange = (Math.random() - 0.5) * 0.02; // ¬±1%
                        }
                        
                        investment.returnRate += priceChange;
                        
                        // Ìà¨ÏûêÏÉÅÌíàÎ≥Ñ Î∞∞ÎãπÍ∏à Ïû¨Ï°∞Ï†ï (ÌòÑÏã§Ï†ÅÏúºÎ°ú Ï°∞Ï†ï)
                        if (investment.type === 'realestate') {
                            if (investment.subType === 'commercial') {
                                investment.dividends = investment.returnRate > 0 ? Math.floor(investment.amount * 0.004) : 0; // 0.4%/Ïõî
                            } else if (investment.subType === 'land') {
                                investment.dividends = investment.returnRate > 0.1 ? Math.floor(investment.amount * 0.001) : 0; // 0.1%/Ïõî
                            } else if (investment.subType === 'apartment') {
                                investment.dividends = Math.floor(investment.amount * 0.003); // 0.3%/Ïõî
                            } else if (investment.subType === 'officetel') {
                                investment.dividends = Math.floor(investment.amount * 0.0025); // 0.25%/Ïõî
                            }
                        } else if (investment.type === 'stock') {
                            // Ï£ºÏãù Î∞∞ÎãπÍ∏àÏùÄ Í≥†Ï†ï (ÌòÑÏã§Ï†Å)
                            investment.dividends = Math.floor(investment.amount * 0.002); // 0.2%/Ïõî Í≥†Ï†ï
                        }
                        // ÏïîÌò∏ÌôîÌèêÎäî Î∞∞ÎãπÍ∏à ÏóÜÏùå
                    });
                }
                
                // ÏßÅÏû•Ïù∏: Ï†ïÍ∏∞ Í∏âÏó¨
                if (gameState.currentUser.role === 'worker') {
                    const dailySalary = Math.floor(gameState.roleData.workStats.salary / 30);
                    gameState.currentUser.game_balance += dailySalary;
                    
                    // Í≤ΩÎ†• Ï¶ùÍ∞Ä
                    if (Math.random() < 0.01) { // 1% ÌôïÎ•†Î°ú Í≤ΩÎ†• Ï¶ùÍ∞Ä
                        gameState.roleData.workStats.experience += 1;
                        if (Math.random() < 0.3) { // 30% ÌôïÎ•†Î°ú Í∏âÏó¨ Ïù∏ÏÉÅ
                            gameState.roleData.workStats.salary += 100;
                            showNotification('ÏÑ±Í≥ºÍ∞Ä Ï¢ãÏïÑ Í∏âÏó¨Í∞Ä Ïù∏ÏÉÅÎêòÏóàÏäµÎãàÎã§!', 'success');
                        }
                    }
                }
                
                // ÏùÄÌñâÏû•: ÏùÄÌñâ ÏàòÏùµ
                if (gameState.currentUser.role === 'banker') {
                    const bankProfit = Math.floor(gameState.bankSettings.bankAssets * 0.001); // 0.1% ÏùºÏùº ÏàòÏùµ
                    gameState.currentUser.game_balance += bankProfit;
                    gameState.bankSettings.bankAssets += bankProfit;
                    
                    if (Math.random() < 0.1) { // 10% ÌôïÎ•†Î°ú ÏïåÎ¶º
                        showNotification(`ÏùÄÌñâ ÏàòÏùµ: +${bankProfit.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß`, 'success');
                    }
                }
                
                // ÏãúÏû• Í≤ΩÏüÅ ÏãúÎÆ¨Î†àÏù¥ÏÖò (ÎÇÆÏùÄ ÌôïÎ•†Î°ú)
                if (gameState.currentUser.role === 'entrepreneur' && Math.random() < 0.05) { // 5% ÌôïÎ•†
                    simulateMarketCompetition();
                }
                
                // AI ÌÜ†ÏßÄ Íµ¨Îß§ ÏãúÎÆ¨Î†àÏù¥ÏÖò (Ìà¨ÏûêÏûê Ïó≠Ìï†Ïùº Îïå)
                if (gameState.currentUser.role === 'investor' && Math.random() < 0.03) { // 3% ÌôïÎ•†
                    simulateLandMarket();
                }
                
                updateDisplay();
            }, 5000); // 5Ï¥àÎßàÎã§ ÏàòÏùµ Î∞úÏÉù
        }
        
        // Í≤ΩÏ†ú ÏÇ¨Ïù¥ÌÅ¥ Í¥ÄÎ¶¨ ÏãúÏä§ÌÖú
        function startEconomicSystem() {
            setInterval(() => {
                updateInflation();
                updateEconomicCycle();
                updateEconomicIndicators();
                updateEconomyDisplay();
            }, 10000); // 10Ï¥àÎßàÎã§ Í≤ΩÏ†ú ÏßÄÌëú ÏóÖÎç∞Ïù¥Ìä∏
        }
        
        // Ïù∏ÌîåÎ†àÏù¥ÏÖò/ÎîîÌîåÎ†àÏù¥ÏÖò ÏóÖÎç∞Ïù¥Ìä∏
        function updateInflation() {
            const cycle = gameState.economy.economicCycle;
            
            // Í≤ΩÍ∏∞ Íµ≠Î©¥Ïóê Îî∞Î•∏ Ïù∏ÌîåÎ†àÏù¥ÏÖò Ï°∞Ï†ï
            let baseInflation = 2.5; // Í∏∞Î≥∏ Ïù∏ÌîåÎ†àÏù¥ÏÖò 2.5%
            
            switch(cycle.phase) {
                case 'expansion':
                    baseInflation += cycle.intensity * 2.0; // ÌôïÏû•Í∏∞: +0~4%
                    break;
                case 'peak':
                    baseInflation += cycle.intensity * 3.0; // Ï†ïÏ†ê: +0~6% (Í≥ºÏó¥ ÏúÑÌóò)
                    break;
                case 'contraction':
                    baseInflation -= Math.abs(cycle.intensity) * 2.5; // ÏàòÏ∂ïÍ∏∞: -5~0%
                    break;
                case 'trough':
                    baseInflation -= Math.abs(cycle.intensity) * 3.0; // Ï†ÄÏ†ê: -6~0% (ÎîîÌîåÎ†àÏù¥ÏÖò ÏúÑÌóò)
                    break;
            }
            
            // ÎûúÎç§ Î≥ÄÎèô Ï∂îÍ∞Ä (¬±0.5%)
            const randomFactor = (Math.random() - 0.5) * 1.0;
            gameState.economy.inflationRate = Math.max(-3.0, Math.min(10.0, baseInflation + randomFactor));
            
            // ÎàÑÏ†Å Ïù∏ÌîåÎ†àÏù¥ÏÖò Ï†ÅÏö© (Îß§Î≤à 0.1% Ï†ÅÏö©)
            const monthlyInflation = gameState.economy.inflationRate / 1200; // Ïó∞Í∞Ñ ‚Üí ÏõîÍ∞Ñ Î≥ÄÌôò ÌõÑ 10Ï¥àÍ∞ÑÍ≤© Ï†ÅÏö©
            gameState.economy.cumulativeInflation *= (1 + monthlyInflation);
            gameState.economy.priceLevel = gameState.economy.cumulativeInflation;
            
            // Î¨ºÍ∞Ä ÏÉÅÏäπÏúºÎ°ú Î™®Îì† Í∞ÄÍ≤©Ïóê ÏòÅÌñ•
            applyInflationEffects(monthlyInflation);
        }
        
        // Í≤ΩÍ∏∞ ÏÇ¨Ïù¥ÌÅ¥ ÏóÖÎç∞Ïù¥Ìä∏
        function updateEconomicCycle() {
            const cycle = gameState.economy.economicCycle;
            cycle.duration += 1; // Í∏∞Í∞Ñ Ï¶ùÍ∞Ä (10Ï¥à = 1Îã®ÏúÑ)
            
            // Í≤ΩÍ∏∞ Íµ≠Î©¥ Ï†ÑÌôò Î°úÏßÅ
            switch(cycle.phase) {
                case 'expansion':
                    // ÌôïÏû•Í∏∞ ‚Üí Ï†ïÏ†ê (18-36Í∞úÏõî)
                    if (cycle.duration > 18 + Math.random() * 18) {
                        cycle.phase = 'peak';
                        cycle.duration = 0;
                        cycle.intensity = 0.7 + Math.random() * 0.3; // 0.7~1.0
                        showNotification('üìà Í≤ΩÍ∏∞Í∞Ä Ï†ïÏ†êÏóê ÎèÑÎã¨ÌñàÏäµÎãàÎã§!', 'info');
                    } else {
                        cycle.intensity = Math.min(1.0, cycle.intensity + (Math.random() * 0.1));
                    }
                    break;
                    
                case 'peak':
                    // Ï†ïÏ†ê ‚Üí ÏàòÏ∂ïÍ∏∞ (3-9Í∞úÏõî)
                    if (cycle.duration > 3 + Math.random() * 6) {
                        cycle.phase = 'contraction';
                        cycle.duration = 0;
                        cycle.intensity = -0.1;
                        showNotification('üìâ Í≤ΩÍ∏∞ Ïπ®Ï≤¥Í∞Ä ÏãúÏûëÎêòÏóàÏäµÎãàÎã§', 'warning');
                    }
                    break;
                    
                case 'contraction':
                    // ÏàòÏ∂ïÍ∏∞ ‚Üí Ï†ÄÏ†ê (6-18Í∞úÏõî)
                    if (cycle.duration > 6 + Math.random() * 12) {
                        cycle.phase = 'trough';
                        cycle.duration = 0;
                        cycle.intensity = -0.7 - Math.random() * 0.3; // -1.0~-0.7
                        showNotification('üìä Í≤ΩÍ∏∞Í∞Ä Ï†ÄÏ†êÏóê ÎèÑÎã¨ÌñàÏäµÎãàÎã§', 'error');
                    } else {
                        cycle.intensity = Math.max(-1.0, cycle.intensity - (Math.random() * 0.1));
                    }
                    break;
                    
                case 'trough':
                    // Ï†ÄÏ†ê ‚Üí ÌôïÏû•Í∏∞ (3-12Í∞úÏõî)
                    if (cycle.duration > 3 + Math.random() * 9) {
                        cycle.phase = 'expansion';
                        cycle.duration = 0;
                        cycle.intensity = 0.1;
                        showNotification('üöÄ Í≤ΩÍ∏∞ ÌöåÎ≥µÏù¥ ÏãúÏûëÎêòÏóàÏäµÎãàÎã§!', 'success');
                    }
                    break;
            }
            
            // Í≤ΩÍ∏∞ Í∞ïÎèÑÏóê Îî∞Î•∏ Í≤ΩÏ†ú ÏßÄÌëú ÏóÖÎç∞Ïù¥Ìä∏
            updateGDPAndEmployment();
        }
        
        // GDPÏôÄ Í≥†Ïö© ÏßÄÌëú ÏóÖÎç∞Ïù¥Ìä∏
        function updateGDPAndEmployment() {
            const cycle = gameState.economy.economicCycle;
            
            // GDP ÏÑ±Ïû•Î•† (Í≤ΩÍ∏∞ Í∞ïÎèÑÏóê ÎπÑÎ°Ä)
            const baseGDP = 2.5;
            cycle.gdpGrowthRate = baseGDP + (cycle.intensity * 4.0) + (Math.random() - 0.5) * 1.0;
            cycle.gdpGrowthRate = Math.max(-8.0, Math.min(12.0, cycle.gdpGrowthRate));
            
            // Ïã§ÏóÖÎ•† (Í≤ΩÍ∏∞ Í∞ïÎèÑÏóê Î∞òÎπÑÎ°Ä)
            const baseUnemployment = 5.0;
            cycle.unemploymentRate = baseUnemployment - (cycle.intensity * 3.0) + (Math.random() - 0.5) * 0.5;
            cycle.unemploymentRate = Math.max(2.0, Math.min(15.0, cycle.unemploymentRate));
            
            // ÏÜåÎπÑÏûê Ïã†Î¢∞ÎèÑ
            const baseConfidence = 60;
            cycle.consumerConfidence = baseConfidence + (cycle.intensity * 25) + (Math.random() - 0.5) * 10;
            cycle.consumerConfidence = Math.max(20, Math.min(100, cycle.consumerConfidence));
        }
        
        // Í∏∞ÌÉÄ Í≤ΩÏ†ú ÏßÄÌëú ÏóÖÎç∞Ïù¥Ìä∏
        function updateEconomicIndicators() {
            const indicators = gameState.economy.indicators;
            const cycle = gameState.economy.economicCycle;
            
            // Í∏∞Ï§Ä Í∏àÎ¶¨ (Ïù∏ÌîåÎ†àÏù¥ÏÖòÍ≥º Í≤ΩÍ∏∞Ïóê Îî∞Îùº Ï°∞Ï†ï)
            let targetRate = 2.0 + gameState.economy.inflationRate * 0.5;
            if (cycle.phase === 'contraction' || cycle.phase === 'trough') {
                targetRate -= 2.0; // Ïπ®Ï≤¥Í∏∞ÏóêÎäî Í∏àÎ¶¨ Ïù∏Ìïò
            }
            indicators.interestRate += (targetRate - indicators.interestRate) * 0.1; // Ï†êÏßÑÏ†Å Ï°∞Ï†ï
            indicators.interestRate = Math.max(0.0, Math.min(10.0, indicators.interestRate));
            
            // Íµ≠Ï±Ñ ÏàòÏùµÎ•†
            indicators.bondYield = indicators.interestRate + 0.5 + (Math.random() - 0.5) * 0.3;
            
            // ÏõêÏûêÏû¨ ÏßÄÏàò
            const commodityChange = (Math.random() - 0.5) * 10 * (1 + Math.abs(cycle.intensity));
            indicators.commodityIndex += commodityChange;
            indicators.commodityIndex = Math.max(50, Math.min(200, indicators.commodityIndex));
            
            // Î∂ÄÎèôÏÇ∞ ÏßÄÏàò
            const realEstateChange = cycle.intensity * 5 + (Math.random() - 0.5) * 8;
            indicators.realEstateIndex += realEstateChange;
            indicators.realEstateIndex = Math.max(60, Math.min(300, indicators.realEstateIndex));
            
            // Ï†úÏ°∞ÏóÖ PMI
            const pmiBase = 50 + cycle.intensity * 15;
            indicators.manufacturingIndex += (pmiBase - indicators.manufacturingIndex) * 0.2;
            indicators.manufacturingIndex = Math.max(25, Math.min(75, indicators.manufacturingIndex));
        }
        
        // Ïù∏ÌîåÎ†àÏù¥ÏÖò Ìö®Í≥º Ï†ÅÏö©
        function applyInflationEffects(monthlyInflation) {
            if (Math.abs(monthlyInflation) < 0.001) return; // ÎØ∏ÎØ∏Ìïú Î≥ÄÎèôÏùÄ Î¨¥Ïãú
            
            // Ï£ºÏãù Í∞ÄÍ≤©Ïóê ÏòÅÌñ• (Ïù∏ÌîåÎ†àÏù¥ÏÖòÏóê ÏùºÎ∂Ä Ïó∞Îèô)
            gameState.stockMarket.stocks.forEach(stock => {
                if (Math.random() < 0.3) { // 30% ÌôïÎ•†Î°ú Ï†ÅÏö©
                    stock.price *= (1 + monthlyInflation * 0.7);
                }
            });
            
            // ÏïîÌò∏ÌôîÌèêÎäî Ïù∏ÌîåÎ†àÏù¥ÏÖò Ìó§ÏßÄ ÏûêÏÇ∞ÏúºÎ°ú Îçî ÌÅ∞ ÏòÅÌñ•
            gameState.stockMarket.cryptos.forEach(crypto => {
                if (Math.random() < 0.2) { // 20% ÌôïÎ•†Î°ú Ï†ÅÏö©
                    crypto.price *= (1 + monthlyInflation * 1.2);
                }
            });
            
            // Î∂ÄÎèôÏÇ∞ Í∞ÄÍ≤© ÏòÅÌñ•
            gameState.landMarket.landPricePerUnit *= (1 + monthlyInflation * 0.8);
            
            // ÏÇ¨ÏóÖ ÎπÑÏö© Ï¶ùÍ∞Ä
            gameState.roleData.businesses.forEach(business => {
                business.monthlyExpenses = Math.floor(business.monthlyExpenses * (1 + monthlyInflation * 0.9));
            });
        }
        
        // Í≤ΩÏ†ú ÏßÄÌëú ÌëúÏãú ÏóÖÎç∞Ïù¥Ìä∏
        function updateEconomyDisplay() {
            const economy = gameState.economy;
            const cycle = economy.economicCycle;
            const indicators = economy.indicators;
            
            // Ïù∏ÌîåÎ†àÏù¥ÏÖòÏú® ÌëúÏãú
            const inflationEl = document.getElementById('inflationRate');
            if (inflationEl) {
                inflationEl.textContent = economy.inflationRate.toFixed(1) + '%';
                inflationEl.style.color = economy.inflationRate > 4 ? 'var(--danger)' : 
                                         economy.inflationRate < 0 ? 'var(--warning)' : 'var(--success)';
            }
            
            // Í≤ΩÍ∏∞ Íµ≠Î©¥ ÌëúÏãú
            const phaseEl = document.getElementById('economicPhase');
            if (phaseEl) {
                const phaseNames = {
                    'expansion': 'ÌôïÏû•Í∏∞',
                    'peak': 'Ï†ïÏ†ê',
                    'contraction': 'Ïπ®Ï≤¥Í∏∞',
                    'trough': 'Ï†ÄÏ†ê'
                };
                phaseEl.textContent = phaseNames[cycle.phase];
                phaseEl.style.color = cycle.phase === 'expansion' || cycle.phase === 'peak' ? 'var(--success)' : 'var(--danger)';
            }
            
            // GDP ÏÑ±Ïû•Î•†
            const gdpEl = document.getElementById('gdpGrowth');
            if (gdpEl) {
                gdpEl.textContent = cycle.gdpGrowthRate.toFixed(1) + '%';
                gdpEl.style.color = cycle.gdpGrowthRate > 0 ? 'var(--success)' : 'var(--danger)';
            }
            
            // Ïã§ÏóÖÎ•†
            const unemploymentEl = document.getElementById('unemploymentRate');
            if (unemploymentEl) {
                unemploymentEl.textContent = cycle.unemploymentRate.toFixed(1) + '%';
                unemploymentEl.style.color = cycle.unemploymentRate < 5 ? 'var(--success)' : 'var(--danger)';
            }
            
            // Í∏∞Ï§ÄÍ∏àÎ¶¨
            const rateEl = document.getElementById('interestRate');
            if (rateEl) {
                rateEl.textContent = indicators.interestRate.toFixed(1) + '%';
            }
            
            // ÏÜåÎπÑÏûê Ïã†Î¢∞ÎèÑ
            const confidenceEl = document.getElementById('consumerConfidence');
            if (confidenceEl) {
                confidenceEl.textContent = Math.round(cycle.consumerConfidence);
                confidenceEl.style.color = cycle.consumerConfidence > 70 ? 'var(--success)' : 
                                          cycle.consumerConfidence < 40 ? 'var(--danger)' : 'var(--warning)';
            }
            
            // ÏûêÏõê ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
            const resourceEl = document.getElementById('resourceStatus');
            if (resourceEl) {
                resourceEl.innerHTML = displayResourceStatus();
            }
            
            // Íµ≠Í∞Ä Í≤ΩÏ†ú ÏßÄÌëú ÏóÖÎç∞Ïù¥Ìä∏
            const country = gameState.countrySystem;
            
            const populationEl = document.getElementById('countryPopulation');
            if (populationEl) {
                populationEl.textContent = (country.population / 1000000).toFixed(1) + 'Î∞±ÎßåÎ™Ö';
            }
            
            const activityEl = document.getElementById('economicActivity');
            if (activityEl) {
                activityEl.textContent = (country.economicActivity * 100).toFixed(1) + '%';
                activityEl.style.color = country.economicActivity > 0.7 ? 'var(--success)' : 
                                        country.economicActivity < 0.4 ? 'var(--danger)' : 'var(--warning)';
            }
            
            const gdpPerCapitaEl = document.getElementById('gdpPerCapita');
            if (gdpPerCapitaEl) {
                gdpPerCapitaEl.textContent = '$' + country.gdpPerCapita.toLocaleString();
            }
            
            const spendingEl = document.getElementById('consumerSpendingIndex');
            if (spendingEl) {
                spendingEl.textContent = (country.consumerSpending * 100).toFixed(1) + '%';
                spendingEl.style.color = country.consumerSpending > 0.8 ? 'var(--success)' : 
                                        country.consumerSpending < 0.5 ? 'var(--danger)' : 'var(--warning)';
            }
            
            const formationEl = document.getElementById('businessFormation');
            if (formationEl) {
                formationEl.textContent = (country.businessFormationRate * 100).toFixed(1) + '%';
                formationEl.style.color = country.businessFormationRate > 0.2 ? 'var(--success)' : 
                                         country.businessFormationRate < 0.1 ? 'var(--danger)' : 'var(--warning)';
            }
        }
        
        // ÎûúÎç§ ÏÇ¨ÏóÖ Ïù¥Î≤§Ìä∏ ÏãúÏä§ÌÖú (Ï¢ãÏùå 51%, ÎÇòÏÅ® 49%)
        function triggerBusinessEvent() {
            if (gameState.roleData.businesses.length === 0) return;
            
            const isGoodEvent = Math.random() < 0.51; // 51% Ï¢ãÏùÄ Ïù¥Î≤§Ìä∏
            const business = gameState.roleData.businesses[Math.floor(Math.random() * gameState.roleData.businesses.length)];
            
            if (isGoodEvent) {
                // Ï¢ãÏùÄ Ïù¥Î≤§Ìä∏Îì§
                const goodEvents = [
                    {
                        title: 'üéâ ÎåÄÎ∞ï Îß§Ï∂ú',
                        description: 'ÏòàÏÉÅÏπò Î™ªÌïú Ïù∏Í∏∞Î°ú Îß§Ï∂úÏù¥ Í∏âÏ¶ùÌñàÏäµÎãàÎã§!',
                        effect: () => {
                            const bonus = Math.floor(business.profit * 2);
                            gameState.currentUser.game_balance += bonus;
                            business.profit = Math.floor(business.profit * 1.1); // 10% ÏòÅÍµ¨ Ï¶ùÍ∞Ä
                            return bonus;
                        }
                    },
                    {
                        title: '‚≠ê VIP Í≥†Í∞ù Ïú†Ïπò',
                        description: 'Ïú†Î™Ö Ïù∏ÏÇ¨Í∞Ä Îã®Í≥®Ïù¥ ÎêòÏóàÏäµÎãàÎã§!',
                        effect: () => {
                            const bonus = Math.floor(business.profit * 1.5);
                            gameState.currentUser.game_balance += bonus;
                            business.value = Math.floor(business.value * 1.1); // 10% Í∞ÄÏπò Ï¶ùÍ∞Ä
                            return bonus;
                        }
                    },
                    {
                        title: 'üèÜ ÏóÖÍ≥Ñ 1ÏúÑ Îã¨ÏÑ±',
                        description: 'Ìï¥Îãπ ÏóÖÏ¢ÖÏóêÏÑú 1ÏúÑÎ•º Îã¨ÏÑ±ÌñàÏäµÎãàÎã§!',
                        effect: () => {
                            const bonus = Math.floor(business.value * 0.2);
                            gameState.currentUser.game_balance += bonus;
                            business.profit = Math.floor(business.profit * 1.2); // 20% ÏòÅÍµ¨ Ï¶ùÍ∞Ä
                            business.value = Math.floor(business.value * 1.5); // 50% Í∞ÄÏπò Ï¶ùÍ∞Ä
                            return bonus;
                        }
                    },
                    {
                        title: 'üí∞ Ï†ïÎ∂Ä ÏßÄÏõêÍ∏à',
                        description: 'Ï†ïÎ∂ÄÏóêÏÑú Ïö∞Ïàò Í∏∞ÏóÖ ÏßÄÏõêÍ∏àÏùÑ ÏßÄÍ∏âÌñàÏäµÎãàÎã§!',
                        effect: () => {
                            const bonus = Math.floor(Math.random() * 20000) + 10000;
                            gameState.currentUser.game_balance += bonus;
                            return bonus;
                        }
                    }
                ];
                
                const event = goodEvents[Math.floor(Math.random() * goodEvents.length)];
                const bonus = event.effect();
                showNotification(`${event.title}\n${business.name}: ${event.description} (+${bonus.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß)`, 'success');
                
            } else {
                // ÎÇòÏÅú Ïù¥Î≤§Ìä∏Îì§
                const badEvents = [
                    {
                        title: 'üî• ÌôîÏû¨ ÏÇ¨Í≥†',
                        description: 'ÏûëÏùÄ ÌôîÏû¨Î°ú Ïù∏Ìïú ÌîºÌï¥Í∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.',
                        effect: () => {
                            const loss = Math.floor(business.value * 0.1);
                            gameState.currentUser.game_balance = Math.max(0, gameState.currentUser.game_balance - loss);
                            business.profit = Math.max(Math.floor(business.profit * 0.9), 100); // 10% Í∞êÏÜå
                            business.value = Math.max(Math.floor(business.value * 0.85), 1000); // 15% Í∞ÄÏπò Í∞êÏÜå
                            return loss;
                        }
                    },
                    {
                        title: 'üìâ Í≤ΩÍ∏∞ Ïπ®Ï≤¥',
                        description: 'Í≤ΩÏ†ú Î∂àÌô©ÏúºÎ°ú Îß§Ï∂úÏù¥ Í∞êÏÜåÌñàÏäµÎãàÎã§.',
                        effect: () => {
                            const loss = Math.floor(business.profit * 1.5);
                            gameState.currentUser.game_balance = Math.max(0, gameState.currentUser.game_balance - loss);
                            business.profit = Math.max(Math.floor(business.profit * 0.85), 50); // 15% Í∞êÏÜå
                            return loss;
                        }
                    },
                    {
                        title: 'üí∏ ÎåÄÌòï Í≥†Í∞ù Ïù¥ÌÉà',
                        description: 'Ï£ºÏöî Í≥†Í∞ùÏù¥ Í≤ΩÏüÅÏóÖÏ≤¥Î°ú Îñ†ÎÇ¨ÏäµÎãàÎã§.',
                        effect: () => {
                            const loss = Math.floor(business.profit * 2);
                            gameState.currentUser.game_balance = Math.max(0, gameState.currentUser.game_balance - loss);
                            business.profit = Math.max(Math.floor(business.profit * 0.8), 100); // 20% Í∞êÏÜå
                            return loss;
                        }
                    },
                    {
                        title: '‚öñÔ∏è Î≤ïÏ†Å Î∂ÑÏüÅ',
                        description: 'ÏÜåÏÜ°Ïóê ÌúòÎßêÎ†§ Î≥ÄÌò∏ÏÇ¨ÎπÑÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.',
                        effect: () => {
                            const loss = Math.floor(Math.random() * 15000) + 5000;
                            gameState.currentUser.game_balance = Math.max(0, gameState.currentUser.game_balance - loss);
                            return loss;
                        }
                    },
                    {
                        title: 'üèÉ ÌïµÏã¨ ÏßÅÏõê Ìá¥ÏÇ¨',
                        description: 'Ï§ëÏöîÌïú ÏßÅÏõêÏù¥ Í∞ëÏûêÍ∏∞ Í∑∏ÎßåÎíÄÏäµÎãàÎã§.',
                        effect: () => {
                            if (business.employees > 1) {
                                business.employees -= 1;
                                business.profit = Math.max(Math.floor(business.profit * 0.9), 50); // 10% Í∞êÏÜå
                            }
                            const loss = Math.floor(business.profit * 0.5);
                            gameState.currentUser.game_balance = Math.max(0, gameState.currentUser.game_balance - loss);
                            return loss;
                        }
                    }
                ];
                
                const event = badEvents[Math.floor(Math.random() * badEvents.length)];
                const loss = event.effect();
                showNotification(`${event.title}\n${business.name}: ${event.description} (-${loss.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß)`, 'error');
            }
            
            updateBusinessDisplay();
            updateDisplay();
        }
        
        
        // ÏßÅÏóÖÎ≥Ñ Ï¥àÍ∏∞Ìôî Ìï®ÏàòÎì§
        function initializeBusinessData() {
            if (gameState.roleData.businesses.length === 0) {
                // Í∏∞Î≥∏ ÏÇ¨ÏóÖ ÌïòÎÇò ÏÉùÏÑ±
                gameState.roleData.businesses.push({
                    id: 1,
                    name: 'Ïä§ÌÉÄÌä∏ÏóÖ',
                    type: 'tech',
                    level: 1,
                    profit: 2000,
                    employees: 2,
                    value: 15000,
                    monthlyExpenses: 800
                });
            }
            updateBusinessDisplay();
        }
        
        function initializeInvestmentData() {
            if (gameState.roleData.investments.length === 0) {
                // Í∏∞Î≥∏ Ìà¨Ïûê ÏÉÅÌíàÎì§
                gameState.roleData.investments.push(
                    { type: 'stock', name: 'ÏÇºÏÑ±Ï†ÑÏûê', amount: 5000, returnRate: 0.08, dividends: 200 },
                    { type: 'crypto', name: 'Bitcoin', amount: 3000, returnRate: 0.15, dividends: 0 }
                );
            }
            updateInvestmentDisplay();
        }
        
        function initializeWorkData() {
            if (gameState.roleData.workHistory.length === 0) {
                gameState.roleData.workHistory.push({
                    company: 'Tech Corp',
                    position: 'ÏÇ¨Ïõê',
                    startDate: new Date().toLocaleDateString(),
                    salary: 3000,
                    performance: 85
                });
            }
            updateWorkDisplay();
        }
        
        // ÏÇ¨ÏóÖÍ∞Ä Í∏∞Îä•Îì§
        function createNewBusiness() {
            openBusinessSelectionModal();
        }

        function openBusinessSelectionModal() {
            const modalContent = `
                <h2 style="text-align: center; margin-bottom: 30px; color: var(--primary);">üè™ ÏÉà ÏÇ¨ÏóÖ ÏãúÏûë</h2>
                
                <div style="margin-bottom: 20px;">
                    <p style="text-align: center; color: #cbd5e1; margin-bottom: 20px;">
                        Ï∞ΩÏóÖÌï† ÏÇ¨ÏóÖ Ï¢ÖÎ•òÎ•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî. Í∞Å ÏÇ¨ÏóÖÎßàÎã§ Ï¥àÍ∏∞ ÎπÑÏö©, ÏàòÏùµÏÑ±, ÏúÑÌóòÎèÑÍ∞Ä Îã§Î¶ÖÎãàÎã§.
                    </p>
                </div>

                <div id="businessTypes" style="display: grid; gap: 15px;">
                    <!-- ÏÇ¨ÏóÖ Ïú†ÌòïÎì§Ïù¥ Ïó¨Í∏∞Ïóê ÌëúÏãúÎê©ÎãàÎã§ -->
                </div>
            `;
            
            showModal(modalContent);
            loadBusinessTypes();
        }

        function loadBusinessTypes() {
            const businessTypes = [
                { 
                    id: 'cafe',
                    name: 'Ïπ¥Ìéò', 
                    cost: 15000, 
                    profit: 1500, 
                    employees: 3, 
                    risk: 'ÎÇÆÏùå',
                    description: 'ÏïàÏ†ïÏ†ÅÏù∏ ÏàòÏùµ, ÎÇÆÏùÄ ÏúÑÌóòÎèÑ',
                    successRate: 0.8,
                    sector: 'ÏÑúÎπÑÏä§ÏóÖ'
                },
                { 
                    id: 'tech_startup',
                    name: 'IT Ïä§ÌÉÄÌä∏ÏóÖ', 
                    cost: 25000, 
                    profit: 3000, 
                    employees: 5, 
                    risk: 'ÎÜíÏùå',
                    description: 'ÎÜíÏùÄ ÏàòÏùµ Ïû†Ïû¨Î†•, ÎÜíÏùÄ ÏúÑÌóòÎèÑ',
                    successRate: 0.6,
                    sector: 'IT'
                },
                { 
                    id: 'ecommerce',
                    name: 'Ïò®ÎùºÏù∏ ÏáºÌïëÎ™∞', 
                    cost: 20000, 
                    profit: 2500, 
                    employees: 4, 
                    risk: 'Ï§ëÍ∞Ñ',
                    description: 'ÌôïÏû•ÏÑ± Ï¢ãÏùå, Ï§ëÍ∞Ñ ÏúÑÌóòÎèÑ',
                    successRate: 0.7,
                    sector: 'Ï†ÑÏûêÏÉÅÍ±∞Îûò'
                },
                { 
                    id: 'restaurant',
                    name: 'ÏùåÏãùÏ†ê', 
                    cost: 30000, 
                    profit: 2800, 
                    employees: 6, 
                    risk: 'Ï§ëÍ∞Ñ',
                    description: 'ÏßÄÏó≠ Í∏∞Î∞ò ÏÇ¨ÏóÖ, ÏïàÏ†ïÏ†Å ÏàòÏöî',
                    successRate: 0.65,
                    sector: 'ÏùåÏãùÏóÖ'
                },
                { 
                    id: 'manufacturing',
                    name: 'Ï†úÏ°∞ÏóÖ', 
                    cost: 50000, 
                    profit: 4500, 
                    employees: 12, 
                    risk: 'Ï§ëÍ∞Ñ',
                    description: 'ÎåÄÍ∑úÎ™® Ìà¨Ïûê, ÏïàÏ†ïÏ†Å ÏàòÏùµ',
                    successRate: 0.75,
                    sector: 'Ï†úÏ°∞ÏóÖ'
                },
                { 
                    id: 'fintech',
                    name: 'ÌïÄÌÖåÌÅ¨', 
                    cost: 40000, 
                    profit: 5000, 
                    employees: 8, 
                    risk: 'Îß§Ïö∞ ÎÜíÏùå',
                    description: 'ÌòÅÏã†Ï†Å Í∏∞Ïà†, Îß§Ïö∞ ÎÜíÏùÄ ÏúÑÌóò-ÏàòÏùµ',
                    successRate: 0.45,
                    sector: 'Í∏àÏúµÍ∏∞Ïà†'
                },
                { 
                    id: 'logistics',
                    name: 'Î¨ºÎ•òÏóÖ', 
                    cost: 35000, 
                    profit: 3200, 
                    employees: 10, 
                    risk: 'ÎÇÆÏùå',
                    description: 'ÌïÑÏàò Ïù∏ÌîÑÎùº, ÏïàÏ†ïÏ†Å ÏàòÏöî',
                    successRate: 0.85,
                    sector: 'Î¨ºÎ•ò'
                },
                { 
                    id: 'consulting',
                    name: 'Ïª®ÏÑ§ÌåÖ', 
                    cost: 12000, 
                    profit: 1800, 
                    employees: 2, 
                    risk: 'ÎÇÆÏùå',
                    description: 'Ï†ÑÎ¨∏ÏÑ± Í∏∞Î∞ò, ÎÇÆÏùÄ Ï¥àÍ∏∞ ÎπÑÏö©',
                    successRate: 0.9,
                    sector: 'Ï†ÑÎ¨∏ÏÑúÎπÑÏä§'
                }
            ];

            const container = document.getElementById('businessTypes');
            if (!container) return;

            container.innerHTML = businessTypes.map(business => {
                const riskColor = business.risk === 'ÎÇÆÏùå' ? 'var(--success)' : 
                                 business.risk === 'Ï§ëÍ∞Ñ' ? 'var(--warning)' : 
                                 business.risk === 'ÎÜíÏùå' ? 'var(--danger)' : '#ff6b6b';
                
                const canAfford = gameState.currentUser.game_balance >= business.cost;
                
                return `
                    <div class="business-type-card ${canAfford ? '' : 'disabled'}" 
                         onclick="${canAfford ? `selectBusinessType('${business.id}')` : ''}"
                         style="
                            padding: 20px;
                            background: ${canAfford ? 'rgba(255,255,255,0.05)' : 'rgba(255,255,255,0.02)'};
                            border: 1px solid ${canAfford ? 'rgba(255,255,255,0.1)' : 'rgba(255,255,255,0.05)'};
                            border-radius: 12px;
                            cursor: ${canAfford ? 'pointer' : 'not-allowed'};
                            transition: all 0.3s ease;
                            opacity: ${canAfford ? '1' : '0.5'};
                         "
                         onmouseover="this.style.backgroundColor='${canAfford ? 'rgba(255,255,255,0.08)' : 'rgba(255,255,255,0.02)'}'"
                         onmouseout="this.style.backgroundColor='${canAfford ? 'rgba(255,255,255,0.05)' : 'rgba(255,255,255,0.02)'}'">
                        
                        <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px;">
                            <h3 style="color: var(--primary); margin: 0;">${business.name}</h3>
                            <span style="background: ${riskColor}; color: white; padding: 2px 8px; border-radius: 12px; font-size: 0.8rem;">
                                ${business.risk}
                            </span>
                        </div>
                        
                        <p style="color: #94a3b8; margin: 8px 0; font-size: 0.9rem;">${business.description}</p>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px; font-size: 0.85rem;">
                            <div>
                                <span style="color: #64748b;">Ï¥àÍ∏∞ ÎπÑÏö©:</span>
                                <div style="color: var(--danger); font-weight: 600;">${business.cost.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß</div>
                            </div>
                            <div>
                                <span style="color: #64748b;">Ïõî ÏòàÏÉÅÏàòÏùµ:</span>
                                <div style="color: var(--success); font-weight: 600;">${business.profit.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß</div>
                            </div>
                            <div>
                                <span style="color: #64748b;">ÌïÑÏöî ÏßÅÏõê:</span>
                                <div style="color: #e2e8f0; font-weight: 600;">${business.employees}Î™Ö</div>
                            </div>
                            <div>
                                <span style="color: #64748b;">ÏÑ±Í≥µÎ•†:</span>
                                <div style="color: var(--warning); font-weight: 600;">${Math.round(business.successRate * 100)}%</div>
                            </div>
                        </div>
                        
                        <div style="margin-top: 10px; padding-top: 10px; border-top: 1px solid rgba(255,255,255,0.1);">
                            <span style="color: #64748b; font-size: 0.8rem;">ÏóÖÏ¢Ö: ${business.sector}</span>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function selectBusinessType(businessId) {
            const businessTypes = [
                { id: 'cafe', name: 'Ïπ¥Ìéò', cost: 15000, profit: 1500, employees: 3, successRate: 0.8, sector: 'ÏÑúÎπÑÏä§ÏóÖ' },
                { id: 'tech_startup', name: 'IT Ïä§ÌÉÄÌä∏ÏóÖ', cost: 25000, profit: 3000, employees: 5, successRate: 0.6, sector: 'IT' },
                { id: 'ecommerce', name: 'Ïò®ÎùºÏù∏ ÏáºÌïëÎ™∞', cost: 20000, profit: 2500, employees: 4, successRate: 0.7, sector: 'Ï†ÑÏûêÏÉÅÍ±∞Îûò' },
                { id: 'restaurant', name: 'ÏùåÏãùÏ†ê', cost: 30000, profit: 2800, employees: 6, successRate: 0.65, sector: 'ÏùåÏãùÏóÖ' },
                { id: 'manufacturing', name: 'Ï†úÏ°∞ÏóÖ', cost: 50000, profit: 4500, employees: 12, successRate: 0.75, sector: 'Ï†úÏ°∞ÏóÖ' },
                { id: 'fintech', name: 'ÌïÄÌÖåÌÅ¨', cost: 40000, profit: 5000, employees: 8, successRate: 0.45, sector: 'Í∏àÏúµÍ∏∞Ïà†' },
                { id: 'logistics', name: 'Î¨ºÎ•òÏóÖ', cost: 35000, profit: 3200, employees: 10, successRate: 0.85, sector: 'Î¨ºÎ•ò' },
                { id: 'consulting', name: 'Ïª®ÏÑ§ÌåÖ', cost: 12000, profit: 1800, employees: 2, successRate: 0.9, sector: 'Ï†ÑÎ¨∏ÏÑúÎπÑÏä§' }
            ];
            
            const selectedBusiness = businessTypes.find(b => b.id === businessId);
            if (!selectedBusiness) return;

            if (gameState.currentUser.game_balance < selectedBusiness.cost) {
                showNotification(`${selectedBusiness.name} Ï∞ΩÏóÖÏóêÎäî ${selectedBusiness.cost.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîßÏù¥ ÌïÑÏöîÌï©ÎãàÎã§`, 'error');
                return;
            }

            // ÌôïÏù∏ Î™®Îã¨ ÌëúÏãú
            const confirmContent = `
                <h2 style="text-align: center; margin-bottom: 30px; color: var(--primary);">üè™ ÏÇ¨ÏóÖ Ï∞ΩÏóÖ ÌôïÏù∏</h2>
                
                <div style="background: rgba(99, 102, 241, 0.1); border: 1px solid rgba(99, 102, 241, 0.3); border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                    <h3 style="color: var(--primary); margin-bottom: 15px;">${selectedBusiness.name}</h3>
                    <div style="display: grid; gap: 10px; font-size: 0.9rem;">
                        <div><span style="color: #64748b;">Ï¥àÍ∏∞ Ìà¨ÏûêÍ∏à:</span> <span style="color: var(--danger); font-weight: 600;">${selectedBusiness.cost.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß</span></div>
                        <div><span style="color: #64748b;">ÏòàÏÉÅ Ïõî ÏàòÏùµ:</span> <span style="color: var(--success); font-weight: 600;">${selectedBusiness.profit.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß</span></div>
                        <div><span style="color: #64748b;">ÌïÑÏöî ÏßÅÏõê:</span> <span style="color: #e2e8f0; font-weight: 600;">${selectedBusiness.employees}Î™Ö</span></div>
                        <div><span style="color: #64748b;">ÏÑ±Í≥µ ÌôïÎ•†:</span> <span style="color: var(--warning); font-weight: 600;">${Math.round(selectedBusiness.successRate * 100)}%</span></div>
                        <div><span style="color: #64748b;">ÏóÖÏ¢Ö:</span> <span style="color: #e2e8f0; font-weight: 600;">${selectedBusiness.sector}</span></div>
                    </div>
                </div>

                <div style="background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.3); border-radius: 12px; padding: 15px; margin-bottom: 20px;">
                    <p style="color: var(--danger); font-size: 0.9rem; margin: 0;">
                        ‚ö†Ô∏è Ï∞ΩÏóÖÏùÄ ÏúÑÌóòÏùÑ ÏàòÎ∞òÌï©ÎãàÎã§. Ïã§Ìå®Ìï† Í≤ΩÏö∞ Ìà¨ÏûêÍ∏àÏùò 30%Îßå ÌöåÏàòÌï† Ïàò ÏûàÏäµÎãàÎã§.
                    </p>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 30px;">
                    <button onclick="closeModal()" style="
                        padding: 12px 20px;
                        border: 1px solid rgba(255,255,255,0.2);
                        background: rgba(255,255,255,0.05);
                        color: #e2e8f0;
                        border-radius: 8px;
                        cursor: pointer;
                        transition: all 0.3s ease;
                    ">Ï∑®ÏÜå</button>
                    
                    <button onclick="confirmBusinessCreation('${businessId}')" style="
                        padding: 12px 20px;
                        border: none;
                        background: var(--primary);
                        color: white;
                        border-radius: 8px;
                        cursor: pointer;
                        font-weight: 600;
                        transition: all 0.3s ease;
                    ">Ï∞ΩÏóÖÌïòÍ∏∞</button>
                </div>
            `;

            showModal(confirmContent);
        }

        function confirmBusinessCreation(businessId) {
            const businessTypes = [
                { id: 'cafe', name: 'Ïπ¥Ìéò', cost: 15000, profit: 1500, employees: 3, successRate: 0.8, sector: 'ÏÑúÎπÑÏä§ÏóÖ' },
                { id: 'tech_startup', name: 'IT Ïä§ÌÉÄÌä∏ÏóÖ', cost: 25000, profit: 3000, employees: 5, successRate: 0.6, sector: 'IT' },
                { id: 'ecommerce', name: 'Ïò®ÎùºÏù∏ ÏáºÌïëÎ™∞', cost: 20000, profit: 2500, employees: 4, successRate: 0.7, sector: 'Ï†ÑÏûêÏÉÅÍ±∞Îûò' },
                { id: 'restaurant', name: 'ÏùåÏãùÏ†ê', cost: 30000, profit: 2800, employees: 6, successRate: 0.65, sector: 'ÏùåÏãùÏóÖ' },
                { id: 'manufacturing', name: 'Ï†úÏ°∞ÏóÖ', cost: 50000, profit: 4500, employees: 12, successRate: 0.75, sector: 'Ï†úÏ°∞ÏóÖ' },
                { id: 'fintech', name: 'ÌïÄÌÖåÌÅ¨', cost: 40000, profit: 5000, employees: 8, successRate: 0.45, sector: 'Í∏àÏúµÍ∏∞Ïà†' },
                { id: 'logistics', name: 'Î¨ºÎ•òÏóÖ', cost: 35000, profit: 3200, employees: 10, successRate: 0.85, sector: 'Î¨ºÎ•ò' },
                { id: 'consulting', name: 'Ïª®ÏÑ§ÌåÖ', cost: 12000, profit: 1800, employees: 2, successRate: 0.9, sector: 'Ï†ÑÎ¨∏ÏÑúÎπÑÏä§' }
            ];
            
            const selectedBusiness = businessTypes.find(b => b.id === businessId);
            if (!selectedBusiness) return;

            gameState.currentUser.game_balance -= selectedBusiness.cost;
            
            const isSuccess = Math.random() < selectedBusiness.successRate;
            
            closeModal();
            
            if (isSuccess) {
                const newBusiness = {
                    id: Date.now(),
                    name: selectedBusiness.name,
                    type: 'business',
                    sector: selectedBusiness.sector,
                    level: 1,
                    profit: selectedBusiness.profit,
                    employees: selectedBusiness.employees,
                    value: selectedBusiness.cost,
                    monthlyExpenses: Math.floor(selectedBusiness.profit * 0.3),
                    founded: new Date().getFullYear(),
                    shares: 1000000, // 100ÎßåÏ£º (ÏÉÅÏû• Ï§ÄÎπÑÏö©)
                    publicShares: 0, // ÏÉÅÏû• ÌõÑ Í≥µÍ∞ú Ï£ºÏãùÏàò
                    isPublic: false
                };
                
                gameState.roleData.businesses.push(newBusiness);
                updateBusinessDisplay();
                updateDisplay();
                showNotification(`‚úÖ ${selectedBusiness.name} ÏÇ¨ÏóÖ Ï∞ΩÏóÖ ÏÑ±Í≥µ!`, 'success');
            } else {
                const recoveredAmount = Math.floor(selectedBusiness.cost * 0.3);
                gameState.currentUser.game_balance += recoveredAmount;
                updateDisplay();
                showNotification(`‚ùå ${selectedBusiness.name} ÏÇ¨ÏóÖ Ï∞ΩÏóÖ Ïã§Ìå®... ${recoveredAmount.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîßÎßå ÌöåÏàòÌñàÏäµÎãàÎã§.`, 'error');
            }
        }
        
        function expandBusiness() {
            if (gameState.roleData.businesses.length === 0) {
                showNotification('ÌôïÏû•Ìï† ÏÇ¨ÏóÖÏù¥ ÏóÜÏäµÎãàÎã§', 'error');
                return;
            }
            
            openBusinessExpansionModal();
        }

        function openBusinessExpansionModal() {
            const modalContent = `
                <h2 style="text-align: center; margin-bottom: 30px; color: var(--primary);">üìà ÏÇ¨ÏóÖ ÌôïÏû•</h2>
                
                <div style="margin-bottom: 20px;">
                    <p style="text-align: center; color: #cbd5e1; margin-bottom: 20px;">
                        ÌôïÏû•Ìï† ÏÇ¨ÏóÖÏùÑ ÏÑ†ÌÉùÌïòÍ≥† ÌôïÏû• Î∞©Î≤ïÏùÑ Í≤∞Ï†ïÌïòÏÑ∏Ïöî.
                    </p>
                </div>

                <div id="expansionBusinesses" style="display: grid; gap: 15px; margin-bottom: 30px;">
                    <!-- ÌôïÏû• Í∞ÄÎä•Ìïú ÏÇ¨ÏóÖÎì§Ïù¥ Ïó¨Í∏∞Ïóê ÌëúÏãúÎê©ÎãàÎã§ -->
                </div>
            `;
            
            showModal(modalContent);
            loadExpansionBusinesses();
        }

        function loadExpansionBusinesses() {
            const container = document.getElementById('expansionBusinesses');
            if (!container) return;

            container.innerHTML = gameState.roleData.businesses.map(business => {
                return `
                    <div class="expansion-business-card" 
                         onclick="selectBusinessForExpansion(${business.id})"
                         style="
                            padding: 20px;
                            background: rgba(255,255,255,0.05);
                            border: 1px solid rgba(255,255,255,0.1);
                            border-radius: 12px;
                            cursor: pointer;
                            transition: all 0.3s ease;
                         "
                         onmouseover="this.style.backgroundColor='rgba(255,255,255,0.08)'"
                         onmouseout="this.style.backgroundColor='rgba(255,255,255,0.05)'">
                        
                        <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 15px;">
                            <div>
                                <h3 style="color: var(--primary); margin: 0; margin-bottom: 5px;">${business.name}</h3>
                                <p style="color: #94a3b8; margin: 0; font-size: 0.9rem;">Î†àÎ≤® ${business.level} | ${business.sector}</p>
                            </div>
                            <div style="text-align: right;">
                                <div style="color: var(--success); font-weight: 600; font-size: 0.9rem;">
                                    ${business.profit.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß/Ïõî
                                </div>
                                <div style="color: #64748b; font-size: 0.8rem;">
                                    ÏßÅÏõê ${business.employees}Î™Ö
                                </div>
                            </div>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; font-size: 0.85rem;">
                            <div>
                                <span style="color: #64748b;">Í∏∞ÏóÖ Í∞ÄÏπò:</span>
                                <div style="color: #e2e8f0; font-weight: 600;">${business.value.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß</div>
                            </div>
                            <div>
                                <span style="color: #64748b;">Ïõî ÏßÄÏ∂ú:</span>
                                <div style="color: var(--warning); font-weight: 600;">${business.monthlyExpenses.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß</div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function selectBusinessForExpansion(businessId) {
            const business = gameState.roleData.businesses.find(b => b.id === businessId);
            if (!business) return;

            // ÌòÑÏû¨ ÏßÅÏõê ÏàòÏóê Îî∞Î•∏ ÏÑ±Í≥µÎ•† Î≥¥ÎÑàÏä§ Í≥ÑÏÇ∞
            const currentEmployees = business.employees || 5;
            const employeeBonus = calculateEmployeeBonus(currentEmployees);

            const expansionOptions = [
                {
                    id: 'basic_expansion',
                    name: 'Í∏∞Î≥∏ ÌôïÏû•',
                    description: 'Í∏∞Ï°¥ ÏÇ¨ÏóÖÏùÑ ÌôïÏû•Ìï©ÎãàÎã§',
                    cost: Math.floor(business.value * 0.5),
                    profitIncrease: 1.3,
                    valueIncrease: 1.3,
                    employeeIncrease: 2,
                    successRate: 0.7
                },
                {
                    id: 'premium_expansion',
                    name: 'ÌîÑÎ¶¨ÎØ∏ÏóÑ ÌôïÏû•',
                    description: 'Í≥†Í∏â Ïû•ÎπÑÏôÄ ÏãúÏÑ§Î°ú ÎåÄÌè≠ ÌôïÏû•Ìï©ÎãàÎã§',
                    cost: Math.floor(business.value * 0.8),
                    profitIncrease: 1.5,
                    valueIncrease: 1.6,
                    employeeIncrease: 4,
                    successRate: 0.6
                },
                {
                    id: 'tech_upgrade',
                    name: 'Í∏∞Ïà† ÏóÖÍ∑∏Î†àÏù¥Îìú',
                    description: 'ÏµúÏã† Í∏∞Ïà†ÏùÑ ÎèÑÏûÖÌïòÏó¨ Ìö®Ïú®ÏÑ±ÏùÑ ÎÜíÏûÖÎãàÎã§',
                    cost: Math.floor(business.value * 0.6),
                    profitIncrease: 1.4,
                    valueIncrease: 1.4,
                    employeeIncrease: 1,
                    successRate: 0.65
                },
                {
                    id: 'market_expansion',
                    name: 'ÏãúÏû• ÌôïÏû•',
                    description: 'ÏÉàÎ°úÏö¥ ÏßÄÏó≠Ïù¥ÎÇò Í≥†Í∞ùÏ∏µÏúºÎ°ú ÏßÑÏ∂úÌï©ÎãàÎã§',
                    cost: Math.floor(business.value * 0.7),
                    profitIncrease: 1.6,
                    valueIncrease: 1.5,
                    employeeIncrease: 3,
                    successRate: 0.55
                }
            ];

            const modalContent = `
                <h2 style="text-align: center; margin-bottom: 30px; color: var(--primary);">üìà ${business.name} ÌôïÏû• Î∞©Î≤ï</h2>
                
                <div style="background: rgba(99, 102, 241, 0.1); border: 1px solid rgba(99, 102, 241, 0.3); border-radius: 12px; padding: 15px; margin-bottom: 20px;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; font-size: 0.9rem;">
                        <div><span style="color: #64748b;">ÌòÑÏû¨ Î†àÎ≤®:</span> <span style="color: #e2e8f0; font-weight: 600;">Î†àÎ≤® ${business.level}</span></div>
                        <div><span style="color: #64748b;">Ïõî ÏàòÏùµ:</span> <span style="color: var(--success); font-weight: 600;">${business.profit.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß</span></div>
                        <div><span style="color: #64748b;">Í∏∞ÏóÖ Í∞ÄÏπò:</span> <span style="color: #e2e8f0; font-weight: 600;">${business.value.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß</span></div>
                        <div><span style="color: #64748b;">ÏßÅÏõê Ïàò:</span> <span style="color: #e2e8f0; font-weight: 600;">${business.employees}Î™Ö${employeeBonus > 0 ? ` (Î≥¥ÎÑàÏä§ +${Math.round(employeeBonus * 100)}%)` : ''}</span></div>
                    </div>
                    ${employeeBonus > 0 ? `
                        <div style="margin-top: 10px; padding: 8px; background: rgba(34, 197, 94, 0.1); border-radius: 8px; font-size: 0.8rem;">
                            üí™ <span style="color: var(--success);">ÏßÅÏõê Î≥¥ÎÑàÏä§ ÌôúÏÑ±Ìôî!</span> ÎßéÏùÄ ÏßÅÏõêÎì§Ïù¥ ÌôïÏû• ÏÑ±Í≥µÎ•†ÏùÑ ÎÜíÏó¨Ï§çÎãàÎã§.
                        </div>
                    ` : `
                        <div style="margin-top: 10px; padding: 8px; background: rgba(156, 163, 175, 0.1); border-radius: 8px; font-size: 0.8rem;">
                            üí° <span style="color: #94a3b8;">ÏßÅÏõê Î≥¥ÎÑàÏä§:</span> 15Î™Ö Ïù¥ÏÉÅÎ∂ÄÌÑ∞ ÌôïÏû• ÏÑ±Í≥µÎ•† Î≥¥ÎÑàÏä§Í∞Ä ÌôúÏÑ±ÌôîÎê©ÎãàÎã§.
                        </div>
                    `}
                </div>

                <div id="expansionOptions" style="display: grid; gap: 15px;">
                    ${expansionOptions.map(option => {
                        const canAfford = gameState.currentUser.game_balance >= option.cost;
                        const profitIncrease = Math.floor(business.profit * option.profitIncrease) - business.profit;
                        
                        return `
                            <div class="expansion-option ${canAfford ? '' : 'disabled'}" 
                                 onclick="${canAfford ? `confirmExpansion(${businessId}, '${option.id}')` : ''}"
                                 style="
                                    padding: 20px;
                                    background: ${canAfford ? 'rgba(255,255,255,0.05)' : 'rgba(255,255,255,0.02)'};
                                    border: 1px solid ${canAfford ? 'rgba(255,255,255,0.1)' : 'rgba(255,255,255,0.05)'};
                                    border-radius: 12px;
                                    cursor: ${canAfford ? 'pointer' : 'not-allowed'};
                                    transition: all 0.3s ease;
                                    opacity: ${canAfford ? '1' : '0.5'};
                                 "
                                 onmouseover="this.style.backgroundColor='${canAfford ? 'rgba(255,255,255,0.08)' : 'rgba(255,255,255,0.02)'}'"
                                 onmouseout="this.style.backgroundColor='${canAfford ? 'rgba(255,255,255,0.05)' : 'rgba(255,255,255,0.02)'}'">
                                
                                <h3 style="color: var(--primary); margin: 0 0 8px 0;">${option.name}</h3>
                                <p style="color: #94a3b8; margin: 0 0 15px 0; font-size: 0.9rem;">${option.description}</p>
                                
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px; font-size: 0.85rem;">
                                    <div>
                                        <span style="color: #64748b;">ÎπÑÏö©:</span>
                                        <div style="color: var(--danger); font-weight: 600;">${option.cost.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß</div>
                                    </div>
                                    <div>
                                        <span style="color: #64748b;">ÏàòÏùµ Ï¶ùÍ∞Ä:</span>
                                        <div style="color: var(--success); font-weight: 600;">+${profitIncrease.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß/Ïõî</div>
                                    </div>
                                    <div>
                                        <span style="color: #64748b;">ÏßÅÏõê Ï¶ùÍ∞Ä:</span>
                                        <div style="color: #e2e8f0; font-weight: 600;">+${option.employeeIncrease}Î™Ö</div>
                                    </div>
                                    <div>
                                        <span style="color: #64748b;">ÏÑ±Í≥µÎ•†:</span>
                                        <div style="color: var(--warning); font-weight: 600;">${Math.round(Math.min(95, (option.successRate + employeeBonus) * 100))}%${employeeBonus > 0 ? ` (+${Math.round(employeeBonus * 100)}%)` : ''}</div>
                                    </div>
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>

                <div style="margin-top: 20px; text-align: center;">
                    <button onclick="openBusinessExpansionModal()" style="
                        padding: 10px 20px;
                        border: 1px solid rgba(255,255,255,0.2);
                        background: rgba(255,255,255,0.05);
                        color: #e2e8f0;
                        border-radius: 8px;
                        cursor: pointer;
                        transition: all 0.3s ease;
                    ">Îã§Î•∏ ÏÇ¨ÏóÖ ÏÑ†ÌÉù</button>
                </div>
            `;

            showModal(modalContent);
        }

        function confirmExpansion(businessId, optionId) {
            const business = gameState.roleData.businesses.find(b => b.id === businessId);
            if (!business) return;

            // ÌòÑÏû¨ ÏßÅÏõê ÏàòÏóê Îî∞Î•∏ ÏÑ±Í≥µÎ•† Î≥¥ÎÑàÏä§ Í≥ÑÏÇ∞
            const currentEmployees = business.employees || 5;
            const employeeBonus = calculateEmployeeBonus(currentEmployees);
            
            const expansionOptions = [
                { id: 'basic_expansion', cost: Math.floor(business.value * 0.5), profitIncrease: 1.3, valueIncrease: 1.3, employeeIncrease: 2, successRate: 0.7 },
                { id: 'premium_expansion', cost: Math.floor(business.value * 0.8), profitIncrease: 1.5, valueIncrease: 1.6, employeeIncrease: 4, successRate: 0.6 },
                { id: 'tech_upgrade', cost: Math.floor(business.value * 0.6), profitIncrease: 1.4, valueIncrease: 1.4, employeeIncrease: 1, successRate: 0.65 },
                { id: 'market_expansion', cost: Math.floor(business.value * 0.7), profitIncrease: 1.6, valueIncrease: 1.5, employeeIncrease: 3, successRate: 0.55 }
            ];

            const selectedOption = expansionOptions.find(o => o.id === optionId);
            if (!selectedOption) return;

            if (gameState.currentUser.game_balance < selectedOption.cost) {
                showNotification(`ÌôïÏû• ÎπÑÏö©Ïù¥ Î∂ÄÏ°±Ìï©ÎãàÎã§. ${selectedOption.cost.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß ÌïÑÏöî`, 'error');
                return;
            }

            gameState.currentUser.game_balance -= selectedOption.cost;
            
            // ÏßÅÏõê Ïàò Î≥¥ÎÑàÏä§Î•º ÏÑ±Í≥µÎ•†Ïóê Ï†ÅÏö©
            const finalSuccessRate = Math.min(0.95, selectedOption.successRate + employeeBonus);
            const isSuccess = Math.random() < finalSuccessRate;
            
            closeModal();
            
            if (isSuccess) {
                business.level += 1;
                business.profit = Math.floor(business.profit * selectedOption.profitIncrease);
                business.value = Math.floor(business.value * selectedOption.valueIncrease);
                business.employees += selectedOption.employeeIncrease;
                business.monthlyExpenses = Math.floor(business.profit * 0.3);
                
                updateBusinessDisplay();
                updateDisplay();
                const bonusText = employeeBonus > 0 ? ` (ÏßÅÏõê Î≥¥ÎÑàÏä§ +${Math.round(employeeBonus * 100)}%)` : '';
                showNotification(`‚úÖ ${business.name} ÌôïÏû• ÏÑ±Í≥µ! Î†àÎ≤® ${business.level}Î°ú ÏóÖÍ∑∏Î†àÏù¥Îìú${bonusText}`, 'success');
            } else {
                const recoveredAmount = Math.floor(selectedOption.cost * 0.25);
                gameState.currentUser.game_balance += recoveredAmount;
                business.profit = Math.max(Math.floor(business.profit * 0.9), 100);
                business.value = Math.max(Math.floor(business.value * 0.85), 1000);
                business.monthlyExpenses = Math.floor(business.profit * 0.3);
                
                updateBusinessDisplay();
                updateDisplay();
                showNotification(`‚ùå ${business.name} ÌôïÏû• Ïã§Ìå®... ${recoveredAmount.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîßÎßå ÌöåÏàò, ÏÇ¨ÏóÖ ÏÜêÏã§ Î∞úÏÉù`, 'error');
            }
        }
        
        function hirEmployee() {
            if (gameState.roleData.businesses.length === 0) {
                showNotification('ÏßÅÏõêÏùÑ Ï±ÑÏö©Ìï† ÏÇ¨ÏóÖÏù¥ ÏóÜÏäµÎãàÎã§', 'error');
                return;
            }
            
            openHiringModal();
        }

        function openHiringModal() {
            const modalContent = `
                <h2 style="text-align: center; margin-bottom: 30px; color: var(--primary);">üë• ÏßÅÏõê Ï±ÑÏö©</h2>
                
                <div style="margin-bottom: 20px;">
                    <p style="text-align: center; color: #cbd5e1; margin-bottom: 20px;">
                        Ï±ÑÏö©Ìï† ÏÇ¨ÏóÖÍ≥º ÏßÅÏõê Ïú†ÌòïÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî.
                    </p>
                </div>

                <div id="hiringBusinesses" style="display: grid; gap: 15px; margin-bottom: 30px;">
                    <!-- Ï±ÑÏö© Í∞ÄÎä•Ìïú ÏÇ¨ÏóÖÎì§Ïù¥ Ïó¨Í∏∞Ïóê ÌëúÏãúÎê©ÎãàÎã§ -->
                </div>
            `;
            
            showModal(modalContent);
            loadHiringBusinesses();
        }

        function loadHiringBusinesses() {
            const container = document.getElementById('hiringBusinesses');
            if (!container) return;

            container.innerHTML = gameState.roleData.businesses.map(business => {
                return `
                    <div class="hiring-business-card" 
                         onclick="selectBusinessForHiring(${business.id})"
                         style="
                            padding: 20px;
                            background: rgba(255,255,255,0.05);
                            border: 1px solid rgba(255,255,255,0.1);
                            border-radius: 12px;
                            cursor: pointer;
                            transition: all 0.3s ease;
                         "
                         onmouseover="this.style.backgroundColor='rgba(255,255,255,0.08)'"
                         onmouseout="this.style.backgroundColor='rgba(255,255,255,0.05)'">
                        
                        <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 15px;">
                            <div>
                                <h3 style="color: var(--primary); margin: 0; margin-bottom: 5px;">${business.name}</h3>
                                <p style="color: #94a3b8; margin: 0; font-size: 0.9rem;">Î†àÎ≤® ${business.level} | ${business.sector}</p>
                            </div>
                            <div style="text-align: right;">
                                <div style="color: var(--success); font-weight: 600; font-size: 0.9rem;">
                                    ${business.profit.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß/Ïõî
                                </div>
                                <div style="color: #64748b; font-size: 0.8rem;">
                                    ÏßÅÏõê ${business.employees}Î™Ö
                                </div>
                            </div>
                        </div>
                        
                        <div style="background: rgba(99, 102, 241, 0.1); border: 1px solid rgba(99, 102, 241, 0.2); border-radius: 8px; padding: 10px; font-size: 0.85rem;">
                            <span style="color: #64748b;">Ï∂îÏ≤ú Ï±ÑÏö©: </span>
                            <span style="color: var(--primary); font-weight: 600;">
                                ${getRecommendedPosition(business)}
                            </span>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function getRecommendedPosition(business) {
            const recommendations = {
                'ÏÑúÎπÑÏä§ÏóÖ': ['Î∞îÎ¶¨Ïä§ÌÉÄ', 'Îß§Ïû• Îß§ÎãàÏ†Ä', 'Í≥†Í∞ù ÏÑúÎπÑÏä§ Îã¥Îãπ'],
                'IT': ['Í∞úÎ∞úÏûê', 'UX ÎîîÏûêÏù¥ÎÑà', 'Îç∞Ïù¥ÌÑ∞ Î∂ÑÏÑùÍ∞Ä'],
                'Ï†ÑÏûêÏÉÅÍ±∞Îûò': ['ÎßàÏºÄÌåÖ Ï†ÑÎ¨∏Í∞Ä', 'Î¨ºÎ•ò Í¥ÄÎ¶¨Ïûê', 'Í≥†Í∞ù ÏßÄÏõê'],
                'ÏùåÏãùÏóÖ': ['ÏÖ∞ÌîÑ', 'ÌôÄ Îß§ÎãàÏ†Ä', 'Ï£ºÎ∞© Î≥¥Ï°∞'],
                'Ï†úÏ°∞ÏóÖ': ['ÏÉùÏÇ∞ Í¥ÄÎ¶¨Ïûê', 'ÌíàÏßà Í≤ÄÏÇ¨Ïõê', 'Í∏∞Ïà†Ïûê'],
                'Í∏àÏúµÍ∏∞Ïà†': ['Í∏àÏúµ Î∂ÑÏÑùÍ∞Ä', 'AI ÏóîÏßÄÎãàÏñ¥', 'Ïª¥ÌîåÎùºÏù¥Ïñ∏Ïä§'],
                'Î¨ºÎ•ò': ['Ïö¥ÏÜ° Í¥ÄÎ¶¨Ïûê', 'Ï∞ΩÍ≥† Í¥ÄÎ¶¨Ïûê', 'Î∞∞ÏÜ° Í∏∞ÏÇ¨'],
                'Ï†ÑÎ¨∏ÏÑúÎπÑÏä§': ['Ïª®ÏÑ§ÌÑ¥Ìä∏', 'ÌîÑÎ°úÏ†ùÌä∏ Îß§ÎãàÏ†Ä', 'ÏòÅÏóÖ Îã¥Îãπ']
            };
            
            const positions = recommendations[business.sector] || ['ÏùºÎ∞ò ÏßÅÏõê', 'Í¥ÄÎ¶¨Ïûê', 'Ï†ÑÎ¨∏Í∞Ä'];
            return positions[Math.floor(Math.random() * positions.length)];
        }

        function selectBusinessForHiring(businessId) {
            const business = gameState.roleData.businesses.find(b => b.id === businessId);
            if (!business) return;

            const hiringOptions = [
                {
                    id: 'junior',
                    name: 'Ïã†ÏûÖ ÏßÅÏõê',
                    description: 'Í≤ΩÌóòÏùÄ Î∂ÄÏ°±ÌïòÏßÄÎßå Ïó¥Ï†ïÏ†ÅÏù∏ Ïã†ÏûÖ ÏßÅÏõê',
                    cost: 3000,
                    profitIncrease: 300,
                    successRate: 0.9,
                    salaryMultiplier: 0.8
                },
                {
                    id: 'experienced',
                    name: 'Í≤ΩÎ†• ÏßÅÏõê',
                    description: 'ÌíçÎ∂ÄÌïú Í≤ΩÌóòÏùÑ Í∞ÄÏßÑ Ï§ëÍ≤¨ ÏßÅÏõê',
                    cost: 6000,
                    profitIncrease: 600,
                    successRate: 0.75,
                    salaryMultiplier: 1.2
                },
                {
                    id: 'expert',
                    name: 'Ï†ÑÎ¨∏Í∞Ä',
                    description: 'Ìï¥Îãπ Î∂ÑÏïºÏùò Ï†ÑÎ¨∏Í∞ÄÍ∏â Ïù∏Ïû¨',
                    cost: 10000,
                    profitIncrease: 1000,
                    successRate: 0.6,
                    salaryMultiplier: 1.5
                },
                {
                    id: 'manager',
                    name: 'Í¥ÄÎ¶¨Ïûê',
                    description: 'ÌåÄÏùÑ Ïù¥ÎÅå Ïàò ÏûàÎäî Î¶¨ÎçîÏã≠ÏùÑ Í∞ÄÏßÑ Í¥ÄÎ¶¨Ïûê',
                    cost: 15000,
                    profitIncrease: 1500,
                    successRate: 0.5,
                    salaryMultiplier: 2.0
                }
            ];

            const modalContent = `
                <h2 style="text-align: center; margin-bottom: 30px; color: var(--primary);">üë• ${business.name} - ÏßÅÏõê Ï±ÑÏö©</h2>
                
                <div style="background: rgba(99, 102, 241, 0.1); border: 1px solid rgba(99, 102, 241, 0.3); border-radius: 12px; padding: 15px; margin-bottom: 20px;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; font-size: 0.9rem;">
                        <div><span style="color: #64748b;">ÌöåÏÇ¨:</span> <span style="color: #e2e8f0; font-weight: 600;">${business.name}</span></div>
                        <div><span style="color: #64748b;">ÏóÖÏ¢Ö:</span> <span style="color: #e2e8f0; font-weight: 600;">${business.sector}</span></div>
                        <div><span style="color: #64748b;">ÌòÑÏû¨ ÏßÅÏõê:</span> <span style="color: #e2e8f0; font-weight: 600;">${business.employees}Î™Ö</span></div>
                        <div><span style="color: #64748b;">Ïõî ÏàòÏùµ:</span> <span style="color: var(--success); font-weight: 600;">${business.profit.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß</span></div>
                    </div>
                </div>

                <div id="hiringOptions" style="display: grid; gap: 15px;">
                    ${hiringOptions.map(option => {
                        const canAfford = gameState.currentUser.game_balance >= option.cost;
                        
                        return `
                            <div class="hiring-option ${canAfford ? '' : 'disabled'}" 
                                 onclick="${canAfford ? `confirmHiring(${businessId}, '${option.id}')` : ''}"
                                 style="
                                    padding: 20px;
                                    background: ${canAfford ? 'rgba(255,255,255,0.05)' : 'rgba(255,255,255,0.02)'};
                                    border: 1px solid ${canAfford ? 'rgba(255,255,255,0.1)' : 'rgba(255,255,255,0.05)'};
                                    border-radius: 12px;
                                    cursor: ${canAfford ? 'pointer' : 'not-allowed'};
                                    transition: all 0.3s ease;
                                    opacity: ${canAfford ? '1' : '0.5'};
                                 "
                                 onmouseover="this.style.backgroundColor='${canAfford ? 'rgba(255,255,255,0.08)' : 'rgba(255,255,255,0.02)'}'"
                                 onmouseout="this.style.backgroundColor='${canAfford ? 'rgba(255,255,255,0.05)' : 'rgba(255,255,255,0.02)'}'">
                                
                                <h3 style="color: var(--primary); margin: 0 0 8px 0;">${option.name}</h3>
                                <p style="color: #94a3b8; margin: 0 0 15px 0; font-size: 0.9rem;">${option.description}</p>
                                
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px; font-size: 0.85rem;">
                                    <div>
                                        <span style="color: #64748b;">Ï±ÑÏö© ÎπÑÏö©:</span>
                                        <div style="color: var(--danger); font-weight: 600;">${option.cost.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß</div>
                                    </div>
                                    <div>
                                        <span style="color: #64748b;">ÏàòÏùµ Ï¶ùÍ∞Ä:</span>
                                        <div style="color: var(--success); font-weight: 600;">+${option.profitIncrease.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß/Ïõî</div>
                                    </div>
                                    <div>
                                        <span style="color: #64748b;">ÏÑ±Í≥µÎ•†:</span>
                                        <div style="color: var(--warning); font-weight: 600;">${Math.round(option.successRate * 100)}%</div>
                                    </div>
                                    <div>
                                        <span style="color: #64748b;">Í∏âÏó¨ ÏàòÏ§Ä:</span>
                                        <div style="color: #e2e8f0; font-weight: 600;">${option.salaryMultiplier}x</div>
                                    </div>
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>

                <div style="margin-top: 20px; text-align: center;">
                    <button onclick="openHiringModal()" style="
                        padding: 10px 20px;
                        border: 1px solid rgba(255,255,255,0.2);
                        background: rgba(255,255,255,0.05);
                        color: #e2e8f0;
                        border-radius: 8px;
                        cursor: pointer;
                        transition: all 0.3s ease;
                    ">Îã§Î•∏ ÏÇ¨ÏóÖ ÏÑ†ÌÉù</button>
                </div>
            `;

            showModal(modalContent);
        }

        function confirmHiring(businessId, optionId) {
            const business = gameState.roleData.businesses.find(b => b.id === businessId);
            if (!business) return;

            const hiringOptions = [
                { id: 'junior', cost: 3000, profitIncrease: 300, successRate: 0.9, salaryMultiplier: 0.8, name: 'Ïã†ÏûÖ ÏßÅÏõê' },
                { id: 'experienced', cost: 6000, profitIncrease: 600, successRate: 0.75, salaryMultiplier: 1.2, name: 'Í≤ΩÎ†• ÏßÅÏõê' },
                { id: 'expert', cost: 10000, profitIncrease: 1000, successRate: 0.6, salaryMultiplier: 1.5, name: 'Ï†ÑÎ¨∏Í∞Ä' },
                { id: 'manager', cost: 15000, profitIncrease: 1500, successRate: 0.5, salaryMultiplier: 2.0, name: 'Í¥ÄÎ¶¨Ïûê' }
            ];

            const selectedOption = hiringOptions.find(o => o.id === optionId);
            if (!selectedOption) return;

            if (gameState.currentUser.game_balance < selectedOption.cost) {
                showNotification(`Ï±ÑÏö© ÎπÑÏö©Ïù¥ Î∂ÄÏ°±Ìï©ÎãàÎã§. ${selectedOption.cost.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß ÌïÑÏöî`, 'error');
                return;
            }

            gameState.currentUser.game_balance -= selectedOption.cost;
            
            const isSuccess = Math.random() < selectedOption.successRate;
            
            closeModal();
            
            if (isSuccess) {
                business.employees += 1;
                business.profit += selectedOption.profitIncrease;
                business.monthlyExpenses += Math.floor(selectedOption.profitIncrease * selectedOption.salaryMultiplier * 0.5);
                business.value += selectedOption.profitIncrease * 10; // Ïù∏Ïû¨ Í∞ÄÏπò Î∞òÏòÅ
                
                updateBusinessDisplay();
                updateDisplay();
                showNotification(`‚úÖ ${selectedOption.name} Ï±ÑÏö© ÏÑ±Í≥µ! ${business.name}Ïùò Ïó≠ÎüâÏù¥ Í∞ïÌôîÎêòÏóàÏäµÎãàÎã§.`, 'success');
            } else {
                // Ïã§Ìå® Ïãú Ï±ÑÏö©ÎπÑÏùò 30%Îßå ÌöåÏàò
                const recoveredAmount = Math.floor(selectedOption.cost * 0.3);
                gameState.currentUser.game_balance += recoveredAmount;
                updateDisplay();
                showNotification(`‚ùå ${selectedOption.name} Ï±ÑÏö© Ïã§Ìå®... ${recoveredAmount.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîßÎßå ÌöåÏàòÌñàÏäµÎãàÎã§.`, 'error');
            }
        }
        
        function sellBusiness() {
            if (gameState.roleData.businesses.length === 0) {
                showNotification('Îß§Í∞ÅÌï† ÏÇ¨ÏóÖÏù¥ ÏóÜÏäµÎãàÎã§', 'error');
                return;
            }
            
            openSaleModal();
        }

        function openSaleModal() {
            const modalContent = `
                <h2 style="text-align: center; margin-bottom: 30px; color: var(--primary);">üí∞ ÏÇ¨ÏóÖ Îß§Í∞Å</h2>
                
                <div style="margin-bottom: 20px;">
                    <p style="text-align: center; color: #cbd5e1; margin-bottom: 20px;">
                        Îß§Í∞ÅÌï† ÏÇ¨ÏóÖÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî. ÏãúÏû• ÏÉÅÌô©Í≥º Í∏∞ÏóÖ ÏÑ±Í≥ºÏóê Îî∞Îùº Îß§Í∞ÅÍ∞ÄÍ∞Ä Í≤∞Ï†ïÎê©ÎãàÎã§.
                    </p>
                </div>

                <div id="saleBusinesses" style="display: grid; gap: 15px; margin-bottom: 30px;">
                    <!-- Îß§Í∞Å Í∞ÄÎä•Ìïú ÏÇ¨ÏóÖÎì§Ïù¥ Ïó¨Í∏∞Ïóê ÌëúÏãúÎê©ÎãàÎã§ -->
                </div>
            `;
            
            showModal(modalContent);
            loadSaleBusinesses();
        }

        function loadSaleBusinesses() {
            const container = document.getElementById('saleBusinesses');
            if (!container) return;

            container.innerHTML = gameState.roleData.businesses.map(business => {
                const marketMultiplier = 0.7 + Math.random() * 0.4; // 0.7~1.1 ÏãúÏû• ÏÉÅÌô©
                const performanceMultiplier = business.level >= 3 ? 1.1 : business.level >= 2 ? 1.0 : 0.9;
                const estimatedPrice = Math.floor(business.value * marketMultiplier * performanceMultiplier);
                const roi = business.profit > 0 ? Math.floor((estimatedPrice / (business.value || 1)) * 100) : 0;
                
                return `
                    <div class="sale-business-card" 
                         onclick="selectBusinessForSale(${business.id})"
                         style="
                            padding: 20px;
                            background: rgba(255,255,255,0.05);
                            border: 1px solid rgba(255,255,255,0.1);
                            border-radius: 12px;
                            cursor: pointer;
                            transition: all 0.3s ease;
                         "
                         onmouseover="this.style.backgroundColor='rgba(255,255,255,0.08)'"
                         onmouseout="this.style.backgroundColor='rgba(255,255,255,0.05)'">
                        
                        <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 15px;">
                            <div>
                                <h3 style="color: var(--primary); margin: 0; margin-bottom: 5px;">${business.name}</h3>
                                <p style="color: #94a3b8; margin: 0; font-size: 0.9rem;">Î†àÎ≤® ${business.level} | ${business.sector} | ÏÑ§Î¶Ω ${business.founded}ÎÖÑ</p>
                            </div>
                            <div style="text-align: right;">
                                <div style="color: var(--success); font-weight: 600; font-size: 1.1rem;">
                                    ${estimatedPrice.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß
                                </div>
                                <div style="color: ${roi >= 100 ? 'var(--success)' : roi >= 80 ? 'var(--warning)' : 'var(--danger)'}; font-size: 0.8rem;">
                                    ${roi}% ÌöåÏàòÏú®
                                </div>
                            </div>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-bottom: 15px; font-size: 0.85rem;">
                            <div>
                                <span style="color: #64748b;">Ïõî ÏàòÏùµ:</span>
                                <div style="color: var(--success); font-weight: 600;">${business.profit.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß</div>
                            </div>
                            <div>
                                <span style="color: #64748b;">ÏßÅÏõê Ïàò:</span>
                                <div style="color: #e2e8f0; font-weight: 600;">${business.employees}Î™Ö</div>
                            </div>
                            <div>
                                <span style="color: #64748b;">Í∏∞ÏóÖ Í∞ÄÏπò:</span>
                                <div style="color: #cbd5e1; font-weight: 600;">${business.value.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß</div>
                            </div>
                        </div>

                        <div style="background: ${roi >= 100 ? 'rgba(16, 185, 129, 0.1)' : roi >= 80 ? 'rgba(245, 158, 11, 0.1)' : 'rgba(239, 68, 68, 0.1)'}; 
                                    border: 1px solid ${roi >= 100 ? 'rgba(16, 185, 129, 0.3)' : roi >= 80 ? 'rgba(245, 158, 11, 0.3)' : 'rgba(239, 68, 68, 0.3)'}; 
                                    border-radius: 8px; padding: 10px; font-size: 0.85rem;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                <span style="color: #64748b;">ÏãúÏû• ÏÉÅÌô©:</span>
                                <span style="color: ${marketMultiplier >= 1.0 ? 'var(--success)' : marketMultiplier >= 0.9 ? 'var(--warning)' : 'var(--danger)'}; font-weight: 600;">
                                    ${marketMultiplier >= 1.0 ? 'Ìò∏Ìô©' : marketMultiplier >= 0.9 ? 'Î≥¥ÌÜµ' : 'Î∂àÌô©'}
                                </span>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span style="color: #64748b;">Í∏∞ÏóÖ ÏÑ±Í≥º:</span>
                                <span style="color: ${performanceMultiplier >= 1.1 ? 'var(--success)' : performanceMultiplier >= 1.0 ? 'var(--warning)' : 'var(--danger)'}; font-weight: 600;">
                                    ${performanceMultiplier >= 1.1 ? 'Ïö∞Ïàò' : performanceMultiplier >= 1.0 ? 'Î≥¥ÌÜµ' : 'Ï†ÄÏ°∞'}
                                </span>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function selectBusinessForSale(businessId) {
            const business = gameState.roleData.businesses.find(b => b.id === businessId);
            if (!business) return;

            const saleOptions = [
                {
                    id: 'quick_sale',
                    name: 'Îπ†Î•∏ Îß§Í∞Å',
                    description: 'ÏãúÏû•Í∞ÄÎ≥¥Îã§ ÎÇÆÏßÄÎßå Ï¶âÏãú ÌòÑÍ∏àÌôî',
                    multiplier: 0.7,
                    timeframe: 'Ï¶âÏãú',
                    risk: 'ÏóÜÏùå'
                },
                {
                    id: 'market_sale',
                    name: 'ÏãúÏû•Í∞Ä Îß§Í∞Å',
                    description: 'ÌòÑÏû¨ ÏãúÏû•Í∞ÄÎ°ú Îß§Í∞Å',
                    multiplier: 0.85,
                    timeframe: '1-2Ï£º',
                    risk: 'ÎÇÆÏùå'
                },
                {
                    id: 'premium_sale',
                    name: 'ÌîÑÎ¶¨ÎØ∏ÏóÑ Îß§Í∞Å',
                    description: 'Îçî ÎÇòÏùÄ Í∞ÄÍ≤©ÏùÑ ÏúÑÌï¥ ÏãúÍ∞ÑÏùÑ Ìà¨Ïûê',
                    multiplier: 1.0,
                    timeframe: '1-2Í∞úÏõî',
                    risk: 'Ï§ëÍ∞Ñ'
                },
                {
                    id: 'strategic_sale',
                    name: 'Ï†ÑÎûµÏ†Å Îß§Í∞Å',
                    description: 'Ï†ÑÎûµÏ†Å Ìà¨ÏûêÏûêÏóêÍ≤å ÎÜíÏùÄ Í∞ÄÍ≤©ÏúºÎ°ú Îß§Í∞Å',
                    multiplier: 1.2,
                    timeframe: '3-6Í∞úÏõî',
                    risk: 'ÎÜíÏùå'
                }
            ];

            const marketMultiplier = 0.7 + Math.random() * 0.4;
            const performanceMultiplier = business.level >= 3 ? 1.1 : business.level >= 2 ? 1.0 : 0.9;
            const basePrice = Math.floor(business.value * marketMultiplier * performanceMultiplier);

            const modalContent = `
                <h2 style="text-align: center; margin-bottom: 30px; color: var(--primary);">üí∞ ${business.name} Îß§Í∞Å Î∞©Î≤ï</h2>
                
                <div style="background: rgba(99, 102, 241, 0.1); border: 1px solid rgba(99, 102, 241, 0.3); border-radius: 12px; padding: 15px; margin-bottom: 20px;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; font-size: 0.9rem;">
                        <div><span style="color: #64748b;">ÌöåÏÇ¨Î™Ö:</span> <span style="color: #e2e8f0; font-weight: 600;">${business.name}</span></div>
                        <div><span style="color: #64748b;">ÏóÖÏ¢Ö:</span> <span style="color: #e2e8f0; font-weight: 600;">${business.sector}</span></div>
                        <div><span style="color: #64748b;">Î†àÎ≤®:</span> <span style="color: #e2e8f0; font-weight: 600;">${business.level}</span></div>
                        <div><span style="color: #64748b;">Ïõî ÏàòÏùµ:</span> <span style="color: var(--success); font-weight: 600;">${business.profit.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß</span></div>
                        <div><span style="color: #64748b;">ÏßÅÏõê Ïàò:</span> <span style="color: #e2e8f0; font-weight: 600;">${business.employees}Î™Ö</span></div>
                        <div><span style="color: #64748b;">Í∏∞ÏóÖ Í∞ÄÏπò:</span> <span style="color: #e2e8f0; font-weight: 600;">${business.value.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß</span></div>
                    </div>
                </div>

                <div id="saleOptions" style="display: grid; gap: 15px;">
                    ${saleOptions.map(option => {
                        const finalPrice = Math.floor(basePrice * option.multiplier);
                        const successRate = option.id === 'strategic_sale' ? 0.6 : 
                                          option.id === 'premium_sale' ? 0.8 : 
                                          option.id === 'market_sale' ? 0.9 : 1.0;
                        
                        return `
                            <div class="sale-option" 
                                 onclick="confirmSale(${businessId}, '${option.id}')"
                                 style="
                                    padding: 20px;
                                    background: rgba(255,255,255,0.05);
                                    border: 1px solid rgba(255,255,255,0.1);
                                    border-radius: 12px;
                                    cursor: pointer;
                                    transition: all 0.3s ease;
                                 "
                                 onmouseover="this.style.backgroundColor='rgba(255,255,255,0.08)'"
                                 onmouseout="this.style.backgroundColor='rgba(255,255,255,0.05)'">
                                
                                <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px;">
                                    <h3 style="color: var(--primary); margin: 0;">${option.name}</h3>
                                    <div style="text-align: right;">
                                        <div style="color: var(--success); font-weight: 600; font-size: 1.1rem;">
                                            ${finalPrice.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß
                                        </div>
                                        <div style="color: #64748b; font-size: 0.8rem;">
                                            ÏÑ±Í≥µÎ•† ${Math.round(successRate * 100)}%
                                        </div>
                                    </div>
                                </div>
                                
                                <p style="color: #94a3b8; margin: 0 0 15px 0; font-size: 0.9rem;">${option.description}</p>
                                
                                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; font-size: 0.85rem;">
                                    <div>
                                        <span style="color: #64748b;">ÏòàÏÉÅ Í∏∞Í∞Ñ:</span>
                                        <div style="color: #e2e8f0; font-weight: 600;">${option.timeframe}</div>
                                    </div>
                                    <div>
                                        <span style="color: #64748b;">ÏúÑÌóòÎèÑ:</span>
                                        <div style="color: ${option.risk === 'ÏóÜÏùå' ? 'var(--success)' : option.risk === 'ÎÇÆÏùå' ? 'var(--warning)' : option.risk === 'Ï§ëÍ∞Ñ' ? 'orange' : 'var(--danger)'}; font-weight: 600;">${option.risk}</div>
                                    </div>
                                    <div>
                                        <span style="color: #64748b;">Í∞ÄÍ≤© Î∞∞Ïàò:</span>
                                        <div style="color: #e2e8f0; font-weight: 600;">${option.multiplier}x</div>
                                    </div>
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>

                <div style="margin-top: 20px; text-align: center;">
                    <button onclick="openSaleModal()" style="
                        padding: 10px 20px;
                        border: 1px solid rgba(255,255,255,0.2);
                        background: rgba(255,255,255,0.05);
                        color: #e2e8f0;
                        border-radius: 8px;
                        cursor: pointer;
                        transition: all 0.3s ease;
                    ">Îã§Î•∏ ÏÇ¨ÏóÖ ÏÑ†ÌÉù</button>
                </div>
            `;

            showModal(modalContent);
        }

        function confirmSale(businessId, optionId) {
            const business = gameState.roleData.businesses.find(b => b.id === businessId);
            if (!business) return;

            const saleOptions = [
                { id: 'quick_sale', multiplier: 0.7, successRate: 1.0, name: 'Îπ†Î•∏ Îß§Í∞Å' },
                { id: 'market_sale', multiplier: 0.85, successRate: 0.9, name: 'ÏãúÏû•Í∞Ä Îß§Í∞Å' },
                { id: 'premium_sale', multiplier: 1.0, successRate: 0.8, name: 'ÌîÑÎ¶¨ÎØ∏ÏóÑ Îß§Í∞Å' },
                { id: 'strategic_sale', multiplier: 1.2, successRate: 0.6, name: 'Ï†ÑÎûµÏ†Å Îß§Í∞Å' }
            ];

            const selectedOption = saleOptions.find(o => o.id === optionId);
            if (!selectedOption) return;

            const marketMultiplier = 0.7 + Math.random() * 0.4;
            const performanceMultiplier = business.level >= 3 ? 1.1 : business.level >= 2 ? 1.0 : 0.9;
            const basePrice = Math.floor(business.value * marketMultiplier * performanceMultiplier);
            const finalPrice = Math.floor(basePrice * selectedOption.multiplier);

            const isSuccess = Math.random() < selectedOption.successRate;
            
            closeModal();
            
            if (isSuccess) {
                gameState.currentUser.game_balance += finalPrice;
                const businessIndex = gameState.roleData.businesses.findIndex(b => b.id === businessId);
                if (businessIndex > -1) {
                    gameState.roleData.businesses.splice(businessIndex, 1);
                }
                
                updateBusinessDisplay();
                updateDisplay();
                showNotification(`‚úÖ ${business.name} ${selectedOption.name} ÏÑ±Í≥µ! ${finalPrice.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîßÏùÑ ÌöçÎìùÌñàÏäµÎãàÎã§.`, 'success');
            } else {
                // Îß§Í∞Å Ïã§Ìå® Ïãú ÏïÑÎ¨¥Îü∞ Î≥ÄÌôî ÏóÜÏùå
                showNotification(`‚ùå ${business.name} ${selectedOption.name} Ïã§Ìå®... Ï†ÅÏ†àÌïú Íµ¨Îß§ÏûêÎ•º Ï∞æÏßÄ Î™ªÌñàÏäµÎãàÎã§.`, 'error');
            }
        }
        
        // Ìà¨ÏûêÏûê Í∏∞Îä•Îì§
        function buyStock() {
            const stocks = ['ÏÇºÏÑ±Ï†ÑÏûê', 'SKÌïòÏù¥ÎãâÏä§', 'ÎÑ§Ïù¥Î≤Ñ', 'Ïπ¥Ïπ¥Ïò§', 'LGÌôîÌïô'];
            const stock = stocks[Math.floor(Math.random() * stocks.length)];
            const cost = Math.floor(Math.random() * 3000000) + 1000000; // 100Îßå~400Îßå ÎπÑÌä∏ÌÅ¨Î†àÎîß (ÌòÑÏã§Ìôî)
            
            if (gameState.currentUser.game_balance < cost) {
                showNotification(`Ï£ºÏãù Íµ¨Îß§ÏóêÎäî ${cost.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîßÏù¥ ÌïÑÏöîÌï©ÎãàÎã§`, 'error');
                return;
            }
            
            gameState.currentUser.game_balance -= cost;
            gameState.roleData.investments.push({
                type: 'stock',
                name: stock,
                amount: cost,
                returnRate: (Math.random() * 0.15) + 0.03, // 3~18% (ÌòÑÏã§Ï†Å)
                dividends: Math.floor(cost * 0.002), // 0.2%/Ïõî (ÌòÑÏã§Ï†Å Î∞∞Îãπ)
                volatility: 0.02 // 2% Î≥ÄÎèôÏÑ±
            });
            
            updateInvestmentDisplay();
            updateDisplay();
            showNotification(`${stock} Ï£ºÏãù ${cost.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîßÏñ¥ÏπòÎ•º Íµ¨Îß§ÌñàÏäµÎãàÎã§!`, 'success');
        }
        
        function buyCrypto() {
            const cryptos = ['Bitcoin', 'Ethereum', 'Dogecoin', 'Cardano'];
            const crypto = cryptos[Math.floor(Math.random() * cryptos.length)];
            const cost = Math.floor(Math.random() * 2500000) + 500000; // 50Îßå~300Îßå ÎπÑÌä∏ÌÅ¨Î†àÎîß (ÌòÑÏã§Ìôî)
            
            if (gameState.currentUser.game_balance < cost) {
                showNotification(`ÏïîÌò∏ÌôîÌèê Íµ¨Îß§ÏóêÎäî ${cost.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîßÏù¥ ÌïÑÏöîÌï©ÎãàÎã§`, 'error');
                return;
            }
            
            gameState.currentUser.game_balance -= cost;
            gameState.roleData.investments.push({
                type: 'crypto',
                name: crypto,
                amount: cost,
                returnRate: (Math.random() * 0.6) - 0.2, // -20~40% (Í≥†ÏúÑÌóò)
                dividends: 0, // ÏïîÌò∏ÌôîÌèêÎäî Î∞∞Îãπ ÏóÜÏùå
                volatility: 0.08 // 8% ÎÜíÏùÄ Î≥ÄÎèôÏÑ±
            });
            
            updateInvestmentDisplay();
            updateDisplay();
            showNotification(`${crypto} ${cost.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîßÏñ¥ÏπòÎ•º Íµ¨Îß§ÌñàÏäµÎãàÎã§!`, 'success');
        }
        
        // Î∂ÄÎèôÏÇ∞ Ìà¨Ïûê Î™®Îã¨ Ìï®ÏàòÎì§
        function openRealEstateModal() {
            document.getElementById('realEstateModal').style.display = 'flex';
        }

        function closeRealEstateModal() {
            document.getElementById('realEstateModal').style.display = 'none';
        }

        function buySpecificRealEstate(type) {
            let property, cost, returnRate, dividends, riskFactor;
            
            switch(type) {
                case 'apartment':
                    property = 'üè¢ ÏïÑÌååÌä∏';
                    cost = Math.floor(Math.random() * 2000000) + 3000000; // 300Îßå~500Îßå ÎπÑÌä∏ÌÅ¨Î†àÎîß (25Î∞∞ ÏÉÅÏäπ)
                    returnRate = (Math.random() * 0.07) + 0.05; // 5~12%
                    dividends = Math.floor(cost * 0.003); // 0.3%/Ïõî (ÌòÑÏã§Ï†Å ÏàòÏùµÎ•†)
                    riskFactor = 0.8; // ÎÇÆÏùÄ Î¶¨Ïä§ÌÅ¨
                    break;
                case 'officetel':
                    property = 'üè¨ Ïò§ÌîºÏä§ÌÖî';
                    cost = Math.floor(Math.random() * 1500000) + 1500000; // 150Îßå~300Îßå ÎπÑÌä∏ÌÅ¨Î†àÎîß (25Î∞∞ ÏÉÅÏäπ)
                    returnRate = (Math.random() * 0.15) + 0.03; // 3~18%
                    dividends = Math.floor(cost * 0.0025); // 0.25%/Ïõî (ÌòÑÏã§Ï†Å ÏàòÏùµÎ•†)
                    riskFactor = 1.0; // Î≥¥ÌÜµ Î¶¨Ïä§ÌÅ¨
                    break;
                case 'commercial':
                    property = 'üè™ ÏÉÅÍ∞Ä';
                    cost = Math.floor(Math.random() * 5000000) + 2500000; // 250Îßå~750Îßå ÎπÑÌä∏ÌÅ¨Î†àÎîß (25Î∞∞ ÏÉÅÏäπ)
                    returnRate = (Math.random() * 0.30) - 0.05; // -5~25%
                    dividends = returnRate > 0 ? Math.floor(cost * 0.004) : 0; // 0.4%/Ïõî (ÏÑ±Í≥µÏãúÎßå, ÌòÑÏã§Ï†Å)
                    riskFactor = 1.5; // ÎÜíÏùÄ Î¶¨Ïä§ÌÅ¨
                    break;
                case 'land':
                    // ÌÜ†ÏßÄÎäî Î≥ÑÎèÑÏùò Î™®Îã¨ÏùÑ ÌÜµÌï¥ÏÑúÎßå Íµ¨Îß§ Í∞ÄÎä•
                    openLandModal();
                    closeRealEstateModal();
                    return;
            }
            
            if (gameState.currentUser.game_balance < cost) {
                showNotification(`${property} Íµ¨Îß§ÏóêÎäî ${cost.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîßÏù¥ ÌïÑÏöîÌï©ÎãàÎã§`, 'error');
                return;
            }
            
            gameState.currentUser.game_balance -= cost;
            const investment = {
                type: 'realestate',
                subType: type,
                name: property,
                amount: cost,
                returnRate: returnRate,
                dividends: dividends,
                riskFactor: riskFactor,
                originalReturnRate: returnRate // ÏõêÎûò ÏàòÏùµÎ•† Ï†ÄÏû•
            };
            
            gameState.roleData.investments.push(investment);
            
            updateInvestmentDisplay();
            updateDisplay();
            closeRealEstateModal();
            
            const resultMessage = returnRate < 0 ? 
                `${property} Ìà¨ÏûêÍ∞Ä ÏÜêÏã§ÏùÑ Î≥¥Í≥† ÏûàÏäµÎãàÎã§. (${(returnRate * 100).toFixed(1)}%)` :
                `${property}ÏùÑ ÏÑ±Í≥µÏ†ÅÏúºÎ°ú Íµ¨Îß§ÌñàÏäµÎãàÎã§! (ÏàòÏùµÎ•†: ${(returnRate * 100).toFixed(1)}%)`;
            
            showNotification(resultMessage, returnRate < 0 ? 'error' : 'success');
        }
        
        function sellInvestments() {
            if (gameState.roleData.investments.length === 0) {
                showNotification('Îß§Í∞ÅÌï† Ìà¨Ïûê ÏÉÅÌíàÏù¥ ÏóÜÏäµÎãàÎã§', 'error');
                return;
            }
            
            const investment = gameState.roleData.investments[0];
            const salePrice = Math.floor(investment.amount * (1 + investment.returnRate));
            
            if (confirm(`${investment.name}ÏùÑ ${salePrice.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîßÏóê Îß§Í∞ÅÌïòÏãúÍ≤†ÏäµÎãàÍπå?`)) {
                gameState.currentUser.game_balance += salePrice;
                gameState.roleData.investments.splice(0, 1);
                
                updateInvestmentDisplay();
                updateDisplay();
                showNotification(`Ìà¨Ïûê ÏÉÅÌíàÏùÑ Îß§Í∞ÅÌñàÏäµÎãàÎã§!`, 'success');
            }
        }

        // Ïô∏Ìôò Ìà¨Ïûê ÏãúÏû•
        function openForexMarket() {
            const forexPairs = [
                { pair: 'USD/KRW', rate: 1320.50, change: '+0.85%', trend: 'up' },
                { pair: 'EUR/KRW', rate: 1420.30, change: '-0.22%', trend: 'down' },
                { pair: 'JPY/KRW', rate: 8.95, change: '+1.12%', trend: 'up' },
                { pair: 'GBP/KRW', rate: 1650.80, change: '+0.45%', trend: 'up' },
                { pair: 'CHF/KRW', rate: 1480.20, change: '-0.67%', trend: 'down' },
                { pair: 'CAD/KRW', rate: 980.40, change: '+0.33%', trend: 'up' },
                { pair: 'AUD/KRW', rate: 890.60, change: '-0.89%', trend: 'down' },
                { pair: 'CNY/KRW', rate: 185.70, change: '+0.56%', trend: 'up' }
            ];

            const modalContent = `
                <h2 style="text-align: center; margin-bottom: 30px; color: var(--primary);">üí± Ïô∏Ìôò Ìà¨Ïûê ÏãúÏû•</h2>
                
                <div style="background: rgba(59, 130, 246, 0.1); border: 1px solid rgba(59, 130, 246, 0.3); border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                    <h3 style="color: var(--primary); margin: 0 0 15px 0;">üìä Ïã§ÏãúÍ∞Ñ ÌôòÏú® Ï†ïÎ≥¥</h3>
                    <div style="display: grid; gap: 12px;">
                        ${forexPairs.map(forex => `
                            <div style="
                                background: rgba(71, 85, 105, 0.1); border: 1px solid rgba(71, 85, 105, 0.3);
                                border-radius: 8px; padding: 15px; cursor: pointer;
                                display: flex; justify-content: space-between; align-items: center;
                            " onclick="buyForex('${forex.pair}', ${forex.rate})">
                                <div>
                                    <div style="color: #e2e8f0; font-weight: bold; margin-bottom: 4px;">${forex.pair}</div>
                                    <div style="color: #94a3b8; font-size: 0.9rem;">ÌôòÏú®: ${forex.rate.toLocaleString()}Ïõê</div>
                                </div>
                                <div style="text-align: right;">
                                    <div style="color: ${forex.trend === 'up' ? 'var(--success)' : 'var(--danger)'}; font-weight: bold;">
                                        ${forex.trend === 'up' ? '‚Üó' : '‚Üò'} ${forex.change}
                                    </div>
                                    <div style="color: #94a3b8; font-size: 0.8rem;">ÌÅ¥Î¶≠ÌïòÏó¨ Ìà¨Ïûê</div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>

                <div style="text-align: center;">
                    <button onclick="closeModal()" style="
                        padding: 12px 30px; background: rgba(71, 85, 105, 0.2);
                        color: #e2e8f0; border: 1px solid rgba(71, 85, 105, 0.3);
                        border-radius: 8px; cursor: pointer; font-size: 0.9rem;
                    ">Îã´Í∏∞</button>
                </div>
            `;

            showModal(modalContent);
        }

        function buyForex(pair, rate) {
            const investAmount = Math.floor(Math.random() * 5000000) + 1000000; // 100Îßå~600Îßå ÎπÑÌä∏ÌÅ¨Î†àÎîß
            
            if (gameState.currentUser.game_balance < investAmount) {
                showNotification(`Ïô∏Ìôò Ìà¨ÏûêÏóêÎäî ${investAmount.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîßÏù¥ ÌïÑÏöîÌï©ÎãàÎã§`, 'error');
                return;
            }

            if (confirm(`${pair}Ïóê ${investAmount.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîßÏùÑ Ìà¨ÏûêÌïòÏãúÍ≤†ÏäµÎãàÍπå?`)) {
                gameState.currentUser.game_balance -= investAmount;
                
                gameState.roleData.investments.push({
                    type: 'forex',
                    name: pair,
                    amount: investAmount,
                    rate: rate,
                    returnRate: (Math.random() * 0.1) - 0.05, // -5% ~ +5%
                    dividends: 0, // Ïô∏ÌôòÏùÄ Î∞∞Îãπ ÏóÜÏùå
                    volatility: 0.03 // 3% Î≥ÄÎèôÏÑ±
                });

                updateInvestmentDisplay();
                updateDisplay();
                closeModal();
                showNotification(`${pair} Ïô∏Ìôò ${investAmount.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß Ìà¨Ïûê ÏôÑÎ£å!`, 'success');
            }
        }

        // ÏõêÏûêÏû¨ Ìà¨Ïûê ÏãúÏû•
        function openCommodityMarket() {
            const commodities = [
                { name: 'Í∏à(Gold)', price: 65420, unit: 'gÎãπ', change: '+1.2%', trend: 'up' },
                { name: 'ÏùÄ(Silver)', price: 845, unit: 'gÎãπ', change: '+0.8%', trend: 'up' },
                { name: 'Íµ¨Î¶¨(Copper)', price: 8250, unit: 'kgÎãπ', change: '-0.5%', trend: 'down' },
                { name: 'ÏõêÏú†(WTI)', price: 78650, unit: 'Î∞∞Îü¥Îãπ', change: '+2.1%', trend: 'up' },
                { name: 'Ï≤úÏó∞Í∞ÄÏä§', price: 3420, unit: 'BTUÎãπ', change: '-1.5%', trend: 'down' },
                { name: 'Î∞Ä(Wheat)', price: 620, unit: 'Î∂ÄÏÖ∏Îãπ', change: '+0.7%', trend: 'up' },
                { name: 'ÎåÄÎëê(Soybean)', price: 1340, unit: 'Î∂ÄÏÖ∏Îãπ', change: '-0.3%', trend: 'down' },
                { name: 'Ïò•ÏàòÏàò(Corn)', price: 580, unit: 'Î∂ÄÏÖ∏Îãπ', change: '+1.8%', trend: 'up' }
            ];

            const modalContent = `
                <h2 style="text-align: center; margin-bottom: 30px; color: var(--primary);">ü•á ÏõêÏûêÏû¨ Ìà¨Ïûê ÏãúÏû•</h2>
                
                <div style="background: rgba(245, 158, 11, 0.1); border: 1px solid rgba(245, 158, 11, 0.3); border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                    <h3 style="color: var(--warning); margin: 0 0 15px 0;">üìà Ïã§ÏãúÍ∞Ñ ÏõêÏûêÏû¨ Í∞ÄÍ≤©</h3>
                    <div style="display: grid; gap: 12px;">
                        ${commodities.map(commodity => `
                            <div style="
                                background: rgba(71, 85, 105, 0.1); border: 1px solid rgba(71, 85, 105, 0.3);
                                border-radius: 8px; padding: 15px; cursor: pointer;
                                display: flex; justify-content: space-between; align-items: center;
                            " onclick="buyCommodity('${commodity.name}', ${commodity.price})">
                                <div>
                                    <div style="color: #e2e8f0; font-weight: bold; margin-bottom: 4px;">${commodity.name}</div>
                                    <div style="color: #94a3b8; font-size: 0.9rem;">${commodity.price.toLocaleString()}Ïõê ${commodity.unit}</div>
                                </div>
                                <div style="text-align: right;">
                                    <div style="color: ${commodity.trend === 'up' ? 'var(--success)' : 'var(--danger)'}; font-weight: bold;">
                                        ${commodity.trend === 'up' ? '‚Üó' : '‚Üò'} ${commodity.change}
                                    </div>
                                    <div style="color: #94a3b8; font-size: 0.8rem;">ÌÅ¥Î¶≠ÌïòÏó¨ Ìà¨Ïûê</div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>

                <div style="text-align: center;">
                    <button onclick="closeModal()" style="
                        padding: 12px 30px; background: rgba(71, 85, 105, 0.2);
                        color: #e2e8f0; border: 1px solid rgba(71, 85, 105, 0.3);
                        border-radius: 8px; cursor: pointer; font-size: 0.9rem;
                    ">Îã´Í∏∞</button>
                </div>
            `;

            showModal(modalContent);
        }

        function buyCommodity(commodity, price) {
            const investAmount = Math.floor(Math.random() * 8000000) + 2000000; // 200Îßå~1000Îßå ÎπÑÌä∏ÌÅ¨Î†àÎîß
            
            if (gameState.currentUser.game_balance < investAmount) {
                showNotification(`ÏõêÏûêÏû¨ Ìà¨ÏûêÏóêÎäî ${investAmount.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîßÏù¥ ÌïÑÏöîÌï©ÎãàÎã§`, 'error');
                return;
            }

            if (confirm(`${commodity}Ïóê ${investAmount.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîßÏùÑ Ìà¨ÏûêÌïòÏãúÍ≤†ÏäµÎãàÍπå?`)) {
                gameState.currentUser.game_balance -= investAmount;
                
                // ÏõêÏûêÏû¨ Ï¢ÖÎ•òÎ≥Ñ ÌäπÏÑ± ÏÑ§Ï†ï
                let volatility = 0.04; // Í∏∞Î≥∏ 4%
                let expectedReturn = 0;
                
                if (commodity.includes('Í∏à') || commodity.includes('ÏùÄ')) {
                    volatility = 0.025; // Í∑ÄÍ∏àÏÜçÏùÄ Î≥ÄÎèôÏÑ± ÎÇÆÏùå
                    expectedReturn = 0.02;
                } else if (commodity.includes('ÏõêÏú†') || commodity.includes('Ï≤úÏó∞Í∞ÄÏä§')) {
                    volatility = 0.08; // ÏóêÎÑàÏßÄÎäî Î≥ÄÎèôÏÑ± ÎÜíÏùå
                    expectedReturn = 0.05;
                } else {
                    volatility = 0.06; // ÎÜçÏÇ∞Î¨º/Í∏∞ÌÉÄ
                    expectedReturn = 0.03;
                }
                
                gameState.roleData.investments.push({
                    type: 'commodity',
                    name: commodity,
                    amount: investAmount,
                    price: price,
                    returnRate: (Math.random() * 0.12) - 0.06 + expectedReturn, // ¬±6% + ÏòàÏÉÅÏàòÏùµ
                    dividends: 0, // ÏõêÏûêÏû¨Îäî Î∞∞Îãπ ÏóÜÏùå
                    volatility: volatility
                });

                updateInvestmentDisplay();
                updateDisplay();
                closeModal();
                showNotification(`${commodity} ${investAmount.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß Ìà¨Ïûê ÏôÑÎ£å!`, 'success');
            }
        }

        // Ìè¨Ìä∏Ìè¥Î¶¨Ïò§ Î∂ÑÏÑù
        function showPortfolioAnalysis() {
            if (gameState.roleData.investments.length === 0) {
                showNotification('Ìà¨Ïûê ÏÉÅÌíàÏù¥ ÏóÜÏñ¥ Î∂ÑÏÑùÌï† Ïàò ÏóÜÏäµÎãàÎã§', 'info');
                return;
            }

            const totalInvestment = gameState.roleData.investments.reduce((sum, i) => sum + i.amount, 0);
            const totalValue = gameState.roleData.investments.reduce((sum, i) => sum + Math.floor(i.amount * (1 + i.returnRate)), 0);
            const totalReturn = ((totalValue - totalInvestment) / totalInvestment * 100).toFixed(2);
            
            // Ìà¨Ïûê Ïú†ÌòïÎ≥Ñ Î∂ÑÏÑù
            const typeAnalysis = {};
            gameState.roleData.investments.forEach(inv => {
                if (!typeAnalysis[inv.type]) {
                    typeAnalysis[inv.type] = { count: 0, amount: 0, value: 0 };
                }
                typeAnalysis[inv.type].count++;
                typeAnalysis[inv.type].amount += inv.amount;
                typeAnalysis[inv.type].value += Math.floor(inv.amount * (1 + inv.returnRate));
            });

            const typeNames = {
                'stock': 'Ï£ºÏãù',
                'crypto': 'ÏïîÌò∏ÌôîÌèê',
                'forex': 'Ïô∏Ìôò',
                'commodity': 'ÏõêÏûêÏû¨',
                'futures': 'ÏÑ†Î¨ºÌà¨Ïûê',
                'realestate': 'Î∂ÄÎèôÏÇ∞'
            };

            const modalContent = `
                <h2 style="text-align: center; margin-bottom: 30px; color: var(--primary);">üìà Ìè¨Ìä∏Ìè¥Î¶¨Ïò§ Î∂ÑÏÑù</h2>
                
                <div style="background: rgba(34, 197, 94, 0.1); border: 1px solid rgba(34, 197, 94, 0.3); border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                    <h3 style="color: var(--success); margin: 0 0 15px 0;">üí∞ Ï†ÑÏ≤¥ ÏàòÏùµ ÌòÑÌô©</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px;">
                        <div style="text-align: center;">
                            <div style="color: #94a3b8; font-size: 0.9rem;">Ï¥ù Ìà¨ÏûêÍ∏à</div>
                            <div style="color: #e2e8f0; font-size: 1.2rem; font-weight: bold;">${totalInvestment.toLocaleString()}Ïõê</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="color: #94a3b8; font-size: 0.9rem;">ÌòÑÏû¨ Í∞ÄÏπò</div>
                            <div style="color: #e2e8f0; font-size: 1.2rem; font-weight: bold;">${totalValue.toLocaleString()}Ïõê</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="color: #94a3b8; font-size: 0.9rem;">Ï¥ù ÏàòÏùµÎ•†</div>
                            <div style="color: ${totalReturn >= 0 ? 'var(--success)' : 'var(--danger)'}; font-size: 1.2rem; font-weight: bold;">${totalReturn >= 0 ? '+' : ''}${totalReturn}%</div>
                        </div>
                    </div>
                </div>

                <div style="background: rgba(99, 102, 241, 0.1); border: 1px solid rgba(99, 102, 241, 0.3); border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                    <h3 style="color: var(--primary); margin: 0 0 15px 0;">üìä Ìà¨Ïûê Ïú†ÌòïÎ≥Ñ Î∂ÑÏÑù</h3>
                    ${Object.entries(typeAnalysis).map(([type, data]) => {
                        const returnRate = ((data.value - data.amount) / data.amount * 100).toFixed(1);
                        const percentage = (data.amount / totalInvestment * 100).toFixed(1);
                        return `
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px solid rgba(255,255,255,0.1);">
                                <div>
                                    <div style="color: #e2e8f0; font-weight: bold;">${typeNames[type] || type}</div>
                                    <div style="color: #94a3b8; font-size: 0.9rem;">${data.count}Í∞ú Ï¢ÖÎ™© ‚Ä¢ ÎπÑÏ§ë ${percentage}%</div>
                                </div>
                                <div style="text-align: right;">
                                    <div style="color: ${returnRate >= 0 ? 'var(--success)' : 'var(--danger)'}; font-weight: bold;">${returnRate >= 0 ? '+' : ''}${returnRate}%</div>
                                    <div style="color: #94a3b8; font-size: 0.9rem;">${data.value.toLocaleString()}Ïõê</div>
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>

                <div style="text-align: center;">
                    <button onclick="closeModal()" style="
                        padding: 12px 30px; background: rgba(71, 85, 105, 0.2);
                        color: #e2e8f0; border: 1px solid rgba(71, 85, 105, 0.3);
                        border-radius: 8px; cursor: pointer; font-size: 0.9rem;
                    ">Îã´Í∏∞</button>
                </div>
            `;

            showModal(modalContent);
        }

        // ÏÑ†Î¨ºÌà¨Ïûê ÏãúÏû• (Î†àÎ≤ÑÎ¶¨ÏßÄ ÏµúÎåÄ 200Î∞∞) - 100Ï¢Ö Í≥ÑÏïΩ
        function openFuturesMarket() {
            const futuresContracts = [
                // === Ï£ºÏöî ÏßÄÏàò ÏÑ†Î¨º (20Ï¢Ö) ===
                { name: 'KOSPI 200 ÏÑ†Î¨º', price: 325.40, change: '+1.85%', trend: 'up', category: 'index', baseVolatility: 0.02 },
                { name: 'KOSDAQ ÏÑ†Î¨º', price: 128.90, change: '+2.35%', trend: 'up', category: 'index', baseVolatility: 0.035 },
                { name: 'S&P 500 ÏÑ†Î¨º', price: 4680.20, change: '+0.95%', trend: 'up', category: 'index', baseVolatility: 0.02 },
                { name: 'NASDAQ ÏÑ†Î¨º', price: 15420.80, change: '-0.75%', trend: 'down', category: 'index', baseVolatility: 0.025 },
                { name: 'Dow Jones ÏÑ†Î¨º', price: 34520.60, change: '+0.45%', trend: 'up', category: 'index', baseVolatility: 0.018 },
                { name: 'Russell 2000 ÏÑ†Î¨º', price: 2045.80, change: '+1.65%', trend: 'up', category: 'index', baseVolatility: 0.028 },
                { name: 'DAX ÏÑ†Î¨º', price: 16240.50, change: '-0.85%', trend: 'down', category: 'index', baseVolatility: 0.022 },
                { name: 'FTSE 100 ÏÑ†Î¨º', price: 7520.30, change: '+0.55%', trend: 'up', category: 'index', baseVolatility: 0.019 },
                { name: 'CAC 40 ÏÑ†Î¨º', price: 7380.90, change: '-0.35%', trend: 'down', category: 'index', baseVolatility: 0.021 },
                { name: 'Nikkei 225 ÏÑ†Î¨º', price: 32840.70, change: '+1.15%', trend: 'up', category: 'index', baseVolatility: 0.023 },
                { name: 'Hang Seng ÏÑ†Î¨º', price: 17920.40, change: '-1.25%', trend: 'down', category: 'index', baseVolatility: 0.032 },
                { name: 'Shanghai Composite ÏÑ†Î¨º', price: 3125.80, change: '+0.85%', trend: 'up', category: 'index', baseVolatility: 0.028 },
                { name: 'ASX 200 ÏÑ†Î¨º', price: 7240.60, change: '+0.75%', trend: 'up', category: 'index', baseVolatility: 0.025 },
                { name: 'BSE Sensex ÏÑ†Î¨º', price: 68520.30, change: '+1.45%', trend: 'up', category: 'index', baseVolatility: 0.026 },
                { name: 'IBEX 35 ÏÑ†Î¨º', price: 9640.20, change: '-0.65%', trend: 'down', category: 'index', baseVolatility: 0.024 },
                { name: 'AEX ÏÑ†Î¨º', price: 740.80, change: '+0.25%', trend: 'up', category: 'index', baseVolatility: 0.020 },
                { name: 'TSX ÏÑ†Î¨º', price: 20140.50, change: '+1.05%', trend: 'up', category: 'index', baseVolatility: 0.021 },
                { name: 'BOVESPA ÏÑ†Î¨º', price: 126840.30, change: '+2.15%', trend: 'up', category: 'index', baseVolatility: 0.034 },
                { name: 'MOEX ÏÑ†Î¨º', price: 3250.90, change: '-1.85%', trend: 'down', category: 'index', baseVolatility: 0.045 },
                { name: 'VIX ÏÑ†Î¨º', price: 18.45, change: '+12.5%', trend: 'up', category: 'index', baseVolatility: 0.15 },

                // === ÏóêÎÑàÏßÄ ÏÑ†Î¨º (15Ï¢Ö) ===
                { name: 'ÏõêÏú†(WTI) ÏÑ†Î¨º', price: 78.95, change: '+3.45%', trend: 'up', category: 'energy', baseVolatility: 0.05 },
                { name: 'Î∏åÎ†åÌä∏Ïú† ÏÑ†Î¨º', price: 82.30, change: '+2.85%', trend: 'up', category: 'energy', baseVolatility: 0.048 },
                { name: 'Ï≤úÏó∞Í∞ÄÏä§ ÏÑ†Î¨º', price: 3.82, change: '-2.85%', trend: 'down', category: 'energy', baseVolatility: 0.08 },
                { name: 'ÌúòÎ∞úÏú† ÏÑ†Î¨º', price: 2.45, change: '+1.95%', trend: 'up', category: 'energy', baseVolatility: 0.055 },
                { name: 'Í≤ΩÏú† ÏÑ†Î¨º', price: 2.68, change: '+2.15%', trend: 'up', category: 'energy', baseVolatility: 0.052 },
                { name: 'Îì±Ïú† ÏÑ†Î¨º', price: 2.54, change: '+1.85%', trend: 'up', category: 'energy', baseVolatility: 0.053 },
                { name: 'Ïö∞ÎùºÎäÑ ÏÑ†Î¨º', price: 64.50, change: '+4.25%', trend: 'up', category: 'energy', baseVolatility: 0.085 },
                { name: 'ÏÑùÌÉÑ ÏÑ†Î¨º', price: 118.40, change: '-1.65%', trend: 'down', category: 'energy', baseVolatility: 0.065 },
                { name: 'Ï†ÑÎ†• ÏÑ†Î¨º', price: 85.30, change: '+3.15%', trend: 'up', category: 'energy', baseVolatility: 0.075 },
                { name: 'Î¶¨Ìä¨ ÏÑ†Î¨º', price: 28450.00, change: '+5.85%', trend: 'up', category: 'energy', baseVolatility: 0.12 },
                { name: 'ÏΩîÎ∞úÌä∏ ÏÑ†Î¨º', price: 35250.00, change: '+3.45%', trend: 'up', category: 'energy', baseVolatility: 0.095 },
                { name: 'ÎãàÏºà ÏÑ†Î¨º', price: 18420.00, change: '+2.65%', trend: 'up', category: 'energy', baseVolatility: 0.088 },
                { name: 'Ìù¨ÌÜ†Î•ò ÏÑ†Î¨º', price: 145.80, change: '+6.25%', trend: 'up', category: 'energy', baseVolatility: 0.11 },
                { name: 'ÏàòÏÜå ÏÑ†Î¨º', price: 4.25, change: '+7.85%', trend: 'up', category: 'energy', baseVolatility: 0.13 },
                { name: 'Î∞îÏù¥Ïò§Ïó∞Î£å ÏÑ†Î¨º', price: 1.85, change: '+2.45%', trend: 'up', category: 'energy', baseVolatility: 0.078 },

                // === Í∑ÄÍ∏àÏÜç ÏÑ†Î¨º (10Ï¢Ö) ===
                { name: 'Í∏à ÏÑ†Î¨º', price: 2045.30, change: '+2.15%', trend: 'up', category: 'metals', baseVolatility: 0.03 },
                { name: 'ÏùÄ ÏÑ†Î¨º', price: 24.85, change: '+3.25%', trend: 'up', category: 'metals', baseVolatility: 0.048 },
                { name: 'Î∞±Í∏à ÏÑ†Î¨º', price: 1025.40, change: '+1.85%', trend: 'up', category: 'metals', baseVolatility: 0.055 },
                { name: 'ÌåîÎùºÎìê ÏÑ†Î¨º', price: 1580.60, change: '+4.15%', trend: 'up', category: 'metals', baseVolatility: 0.078 },
                { name: 'Î°úÎìê ÏÑ†Î¨º', price: 4250.00, change: '+6.85%', trend: 'up', category: 'metals', baseVolatility: 0.12 },
                { name: 'Íµ¨Î¶¨ ÏÑ†Î¨º', price: 8.25, change: '+1.65%', trend: 'up', category: 'metals', baseVolatility: 0.045 },
                { name: 'ÏïåÎ£®ÎØ∏ÎäÑ ÏÑ†Î¨º', price: 2.18, change: '+0.85%', trend: 'up', category: 'metals', baseVolatility: 0.038 },
                { name: 'ÏïÑÏó∞ ÏÑ†Î¨º', price: 2.65, change: '+1.45%', trend: 'up', category: 'metals', baseVolatility: 0.042 },
                { name: 'Ï£ºÏÑù ÏÑ†Î¨º', price: 28.50, change: '+2.25%', trend: 'up', category: 'metals', baseVolatility: 0.058 },
                { name: 'ÎÇ© ÏÑ†Î¨º', price: 2.18, change: '+0.95%', trend: 'up', category: 'metals', baseVolatility: 0.048 },

                // === ÎÜçÏÇ∞Î¨º ÏÑ†Î¨º (20Ï¢Ö) ===
                { name: 'Î∞Ä ÏÑ†Î¨º', price: 620.50, change: '+1.25%', trend: 'up', category: 'agriculture', baseVolatility: 0.04 },
                { name: 'Ïò•ÏàòÏàò ÏÑ†Î¨º', price: 485.75, change: '+2.15%', trend: 'up', category: 'agriculture', baseVolatility: 0.045 },
                { name: 'ÎåÄÎëê ÏÑ†Î¨º', price: 1385.25, change: '+1.85%', trend: 'up', category: 'agriculture', baseVolatility: 0.048 },
                { name: 'ÏåÄ ÏÑ†Î¨º', price: 16.80, change: '+0.95%', trend: 'up', category: 'agriculture', baseVolatility: 0.035 },
                { name: 'Î≥¥Î¶¨ ÏÑ†Î¨º', price: 245.60, change: '+1.45%', trend: 'up', category: 'agriculture', baseVolatility: 0.042 },
                { name: 'Í∑ÄÎ¶¨ ÏÑ†Î¨º', price: 385.40, change: '+2.25%', trend: 'up', category: 'agriculture', baseVolatility: 0.055 },
                { name: 'ÏÑ§ÌÉï ÏÑ†Î¨º', price: 22.45, change: '+3.15%', trend: 'up', category: 'agriculture', baseVolatility: 0.065 },
                { name: 'Ïª§Ìîº ÏÑ†Î¨º', price: 175.80, change: '+4.25%', trend: 'up', category: 'agriculture', baseVolatility: 0.078 },
                { name: 'ÏΩîÏΩîÏïÑ ÏÑ†Î¨º', price: 3485.00, change: '+2.85%', trend: 'up', category: 'agriculture', baseVolatility: 0.068 },
                { name: 'Î©¥Ìôî ÏÑ†Î¨º', price: 78.45, change: '+1.65%', trend: 'up', category: 'agriculture', baseVolatility: 0.052 },
                { name: 'Ïò§Î†åÏßÄÏ£ºÏä§ ÏÑ†Î¨º', price: 145.30, change: '+5.25%', trend: 'up', category: 'agriculture', baseVolatility: 0.095 },
                { name: 'ÎèºÏßÄÍ≥†Í∏∞ ÏÑ†Î¨º', price: 82.60, change: '+2.45%', trend: 'up', category: 'agriculture', baseVolatility: 0.058 },
                { name: 'Ïá†Í≥†Í∏∞ ÏÑ†Î¨º', price: 156.80, change: '+1.95%', trend: 'up', category: 'agriculture', baseVolatility: 0.048 },
                { name: 'Ïö∞Ïú† ÏÑ†Î¨º', price: 18.25, change: '+0.85%', trend: 'up', category: 'agriculture', baseVolatility: 0.038 },
                { name: 'ÏπòÏ¶à ÏÑ†Î¨º', price: 2.15, change: '+1.15%', trend: 'up', category: 'agriculture', baseVolatility: 0.042 },
                { name: 'Í≥ÑÎûÄ ÏÑ†Î¨º', price: 1.85, change: '+3.45%', trend: 'up', category: 'agriculture', baseVolatility: 0.085 },
                { name: 'Îã≠Í≥†Í∏∞ ÏÑ†Î¨º', price: 1.28, change: '+2.25%', trend: 'up', category: 'agriculture', baseVolatility: 0.065 },
                { name: 'Ïó∞Ïñ¥ ÏÑ†Î¨º', price: 8.45, change: '+4.15%', trend: 'up', category: 'agriculture', baseVolatility: 0.088 },
                { name: 'ÏÉàÏö∞ ÏÑ†Î¨º', price: 12.60, change: '+5.85%', trend: 'up', category: 'agriculture', baseVolatility: 0.12 },
                { name: 'Î∞îÎãêÎùº ÏÑ†Î¨º', price: 485.00, change: '+8.25%', trend: 'up', category: 'agriculture', baseVolatility: 0.15 },

                // === ÌÜµÌôî ÏÑ†Î¨º (15Ï¢Ö) ===
                { name: 'USD/KRW ÏÑ†Î¨º', price: 1322.50, change: '+0.65%', trend: 'up', category: 'currency', baseVolatility: 0.015 },
                { name: 'EUR/USD ÏÑ†Î¨º', price: 1.0845, change: '-0.35%', trend: 'down', category: 'currency', baseVolatility: 0.02 },
                { name: 'GBP/USD ÏÑ†Î¨º', price: 1.2650, change: '+0.45%', trend: 'up', category: 'currency', baseVolatility: 0.025 },
                { name: 'USD/JPY ÏÑ†Î¨º', price: 148.50, change: '+0.85%', trend: 'up', category: 'currency', baseVolatility: 0.018 },
                { name: 'AUD/USD ÏÑ†Î¨º', price: 0.6750, change: '+0.55%', trend: 'up', category: 'currency', baseVolatility: 0.028 },
                { name: 'USD/CAD ÏÑ†Î¨º', price: 1.3450, change: '-0.25%', trend: 'down', category: 'currency', baseVolatility: 0.022 },
                { name: 'USD/CHF ÏÑ†Î¨º', price: 0.8925, change: '+0.15%', trend: 'up', category: 'currency', baseVolatility: 0.018 },
                { name: 'USD/CNY ÏÑ†Î¨º', price: 7.1850, change: '+0.35%', trend: 'up', category: 'currency', baseVolatility: 0.015 },
                { name: 'EUR/GBP ÏÑ†Î¨º', price: 0.8580, change: '-0.45%', trend: 'down', category: 'currency', baseVolatility: 0.021 },
                { name: 'EUR/JPY ÏÑ†Î¨º', price: 161.20, change: '+0.95%', trend: 'up', category: 'currency', baseVolatility: 0.024 },
                { name: 'GBP/JPY ÏÑ†Î¨º', price: 187.80, change: '+1.15%', trend: 'up', category: 'currency', baseVolatility: 0.032 },
                { name: 'NZD/USD ÏÑ†Î¨º', price: 0.6180, change: '+0.75%', trend: 'up', category: 'currency', baseVolatility: 0.035 },
                { name: 'USD/MXN ÏÑ†Î¨º', price: 17.25, change: '-0.85%', trend: 'down', category: 'currency', baseVolatility: 0.045 },
                { name: 'USD/BRL ÏÑ†Î¨º', price: 5.18, change: '+1.25%', trend: 'up', category: 'currency', baseVolatility: 0.055 },
                { name: 'USD/RUB ÏÑ†Î¨º', price: 95.40, change: '+2.85%', trend: 'up', category: 'currency', baseVolatility: 0.085 },

                // === ÏïîÌò∏ÌôîÌèê ÏÑ†Î¨º (20Ï¢Ö) ===
                { name: 'Bitcoin ÏÑ†Î¨º', price: 43250.00, change: '+8.25%', trend: 'up', category: 'crypto', baseVolatility: 0.12 },
                { name: 'Ethereum ÏÑ†Î¨º', price: 2640.80, change: '+6.15%', trend: 'up', category: 'crypto', baseVolatility: 0.15 },
                { name: 'BNB ÏÑ†Î¨º', price: 285.40, change: '+4.85%', trend: 'up', category: 'crypto', baseVolatility: 0.18 },
                { name: 'XRP ÏÑ†Î¨º', price: 0.625, change: '+12.5%', trend: 'up', category: 'crypto', baseVolatility: 0.22 },
                { name: 'Solana ÏÑ†Î¨º', price: 68.50, change: '+9.45%', trend: 'up', category: 'crypto', baseVolatility: 0.25 },
                { name: 'Cardano ÏÑ†Î¨º', price: 0.485, change: '+7.85%', trend: 'up', category: 'crypto', baseVolatility: 0.28 },
                { name: 'Dogecoin ÏÑ†Î¨º', price: 0.085, change: '+15.2%', trend: 'up', category: 'crypto', baseVolatility: 0.35 },
                { name: 'Polygon ÏÑ†Î¨º', price: 0.725, change: '+8.65%', trend: 'up', category: 'crypto', baseVolatility: 0.32 },
                { name: 'Chainlink ÏÑ†Î¨º', price: 14.80, change: '+6.45%', trend: 'up', category: 'crypto', baseVolatility: 0.26 },
                { name: 'Litecoin ÏÑ†Î¨º', price: 72.30, change: '+5.25%', trend: 'up', category: 'crypto', baseVolatility: 0.24 },
                { name: 'Avalanche ÏÑ†Î¨º', price: 18.50, change: '+11.5%', trend: 'up', category: 'crypto', baseVolatility: 0.38 },
                { name: 'Polkadot ÏÑ†Î¨º', price: 5.45, change: '+7.25%', trend: 'up', category: 'crypto', baseVolatility: 0.30 },
                { name: 'Uniswap ÏÑ†Î¨º', price: 6.85, change: '+9.15%', trend: 'up', category: 'crypto', baseVolatility: 0.33 },
                { name: 'NEAR ÏÑ†Î¨º', price: 1.95, change: '+13.8%', trend: 'up', category: 'crypto', baseVolatility: 0.42 },
                { name: 'ApeCoin ÏÑ†Î¨º', price: 1.25, change: '+18.5%', trend: 'up', category: 'crypto', baseVolatility: 0.55 },
                { name: 'Shiba Inu ÏÑ†Î¨º', price: 0.0000095, change: '+25.8%', trend: 'up', category: 'crypto', baseVolatility: 0.65 },
                { name: 'Pepe ÏÑ†Î¨º', price: 0.00000125, change: '+45.2%', trend: 'up', category: 'crypto', baseVolatility: 0.85 },
                { name: 'Floki ÏÑ†Î¨º', price: 0.000035, change: '+35.6%', trend: 'up', category: 'crypto', baseVolatility: 0.75 },
                { name: 'SafeMoon ÏÑ†Î¨º', price: 0.00018, change: '+28.9%', trend: 'up', category: 'crypto', baseVolatility: 0.95 },
                { name: 'DogeCoin2.0 ÏÑ†Î¨º', price: 0.0045, change: '+58.7%', trend: 'up', category: 'crypto', baseVolatility: 1.2 }
            ];

            const modalContent = `
                <h2 style="text-align: center; margin-bottom: 15px; color: var(--primary);">üìä ÏÑ†Î¨ºÌà¨Ïûê ÏãúÏû• (100Ï¢Ö)</h2>
                <div style="text-align: center; margin-bottom: 20px;">
                    <span style="background: linear-gradient(45deg, #ef4444, #f97316); color: white; padding: 6px 12px; border-radius: 15px; font-size: 0.8rem; font-weight: bold;">
                        ‚ö° Î†àÎ≤ÑÎ¶¨ÏßÄ ÏµúÎåÄ 200Î∞∞ ‚ö°
                    </span>
                </div>
                
                <div style="background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.3); border-radius: 8px; padding: 12px; margin-bottom: 15px;">
                    <div style="color: var(--danger); font-size: 0.8rem; line-height: 1.4;">
                        <strong>‚ö†Ô∏è Í≥†ÏúÑÌóò:</strong> Î†àÎ≤ÑÎ¶¨ÏßÄ Ìà¨ÏûêÎäî ÏàòÏùµ/ÏÜêÏã§Ïù¥ Í∑πÎåÄÌôîÎê©ÎãàÎã§. 200Î∞∞ Ïãú 1% ÌïòÎùΩÏúºÎ°úÎèÑ ÏõêÍ∏à ÏÜåÏã§ ÏúÑÌóò!
                    </div>
                </div>

                <!-- Ïπ¥ÌÖåÍ≥†Î¶¨ ÌÉ≠ -->
                <div style="display: flex; flex-wrap: wrap; gap: 5px; margin-bottom: 15px; justify-content: center;">
                    <button onclick="showFuturesCategory('all')" id="futuresTab-all" style="
                        padding: 8px 12px; background: var(--primary); color: white;
                        border: none; border-radius: 20px; cursor: pointer; font-size: 0.8rem; font-weight: 600;
                    ">Ï†ÑÏ≤¥ (100)</button>
                    <button onclick="showFuturesCategory('index')" id="futuresTab-index" style="
                        padding: 8px 12px; background: rgba(71, 85, 105, 0.2); color: #94a3b8;
                        border: 1px solid rgba(71, 85, 105, 0.3); border-radius: 20px; cursor: pointer; font-size: 0.8rem;
                    ">ÏßÄÏàò (20)</button>
                    <button onclick="showFuturesCategory('energy')" id="futuresTab-energy" style="
                        padding: 8px 12px; background: rgba(71, 85, 105, 0.2); color: #94a3b8;
                        border: 1px solid rgba(71, 85, 105, 0.3); border-radius: 20px; cursor: pointer; font-size: 0.8rem;
                    ">ÏóêÎÑàÏßÄ (15)</button>
                    <button onclick="showFuturesCategory('metals')" id="futuresTab-metals" style="
                        padding: 8px 12px; background: rgba(71, 85, 105, 0.2); color: #94a3b8;
                        border: 1px solid rgba(71, 85, 105, 0.3); border-radius: 20px; cursor: pointer; font-size: 0.8rem;
                    ">Í∏àÏÜç (10)</button>
                    <button onclick="showFuturesCategory('agriculture')" id="futuresTab-agriculture" style="
                        padding: 8px 12px; background: rgba(71, 85, 105, 0.2); color: #94a3b8;
                        border: 1px solid rgba(71, 85, 105, 0.3); border-radius: 20px; cursor: pointer; font-size: 0.8rem;
                    ">ÎÜçÏÇ∞Î¨º (20)</button>
                    <button onclick="showFuturesCategory('currency')" id="futuresTab-currency" style="
                        padding: 8px 12px; background: rgba(71, 85, 105, 0.2); color: #94a3b8;
                        border: 1px solid rgba(71, 85, 105, 0.3); border-radius: 20px; cursor: pointer; font-size: 0.8rem;
                    ">ÌÜµÌôî (15)</button>
                    <button onclick="showFuturesCategory('crypto')" id="futuresTab-crypto" style="
                        padding: 8px 12px; background: rgba(71, 85, 105, 0.2); color: #94a3b8;
                        border: 1px solid rgba(71, 85, 105, 0.3); border-radius: 20px; cursor: pointer; font-size: 0.8rem;
                    ">ÎπÑÌä∏ÌÅ¨Î†àÎîß (20)</button>
                </div>

                <div id="futuresContractsList" style="display: grid; gap: 8px; margin-bottom: 15px; max-height: 350px; overflow-y: auto;">
                    ${futuresContracts.map(contract => `
                        <div class="futures-contract" data-category="${contract.category}" style="
                            background: rgba(71, 85, 105, 0.1); border: 1px solid rgba(71, 85, 105, 0.3);
                            border-radius: 8px; padding: 10px; cursor: pointer; transition: all 0.2s;
                        " onclick="selectFuturesContract('${contract.name}', ${contract.price}, ${contract.baseVolatility})" 
                           onmouseover="this.style.background='rgba(99, 102, 241, 0.2)'" 
                           onmouseout="this.style.background='rgba(71, 85, 105, 0.1)'">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <div style="color: #e2e8f0; font-weight: bold; font-size: 0.9rem; margin-bottom: 2px;">${contract.name}</div>
                                    <div style="color: #94a3b8; font-size: 0.8rem;">‚Ç©${contract.price.toLocaleString()}</div>
                                </div>
                                <div style="text-align: right;">
                                    <div style="color: ${contract.trend === 'up' ? 'var(--success)' : 'var(--danger)'}; font-weight: bold; font-size: 0.85rem;">
                                        ${contract.trend === 'up' ? 'üöÄ' : 'üìâ'} ${contract.change}
                                    </div>
                                    <div style="color: #94a3b8; font-size: 0.7rem;">${getCategoryName(contract.category)}</div>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>

                <div style="text-align: center;">
                    <button onclick="closeModal()" style="
                        padding: 10px 25px; background: rgba(71, 85, 105, 0.2);
                        color: #e2e8f0; border: 1px solid rgba(71, 85, 105, 0.3);
                        border-radius: 8px; cursor: pointer; font-size: 0.9rem;
                    ">Îã´Í∏∞</button>
                </div>
                
            `;

            showModal(modalContent);
        }

        // ÏÑ†Î¨º Ïπ¥ÌÖåÍ≥†Î¶¨ ÌïÑÌÑ∞ÎßÅ
        function showFuturesCategory(category) {
            // ÌÉ≠ Ïä§ÌÉÄÏùº ÏóÖÎç∞Ïù¥Ìä∏
            document.querySelectorAll('[id^="futuresTab-"]').forEach(tab => {
                tab.style.background = 'rgba(71, 85, 105, 0.2)';
                tab.style.color = '#94a3b8';
                tab.style.border = '1px solid rgba(71, 85, 105, 0.3)';
            });
            
            const activeTab = document.getElementById(`futuresTab-${category}`);
            if (activeTab) {
                activeTab.style.background = 'var(--primary)';
                activeTab.style.color = 'white';
                activeTab.style.border = 'none';
            }

            // Í≥ÑÏïΩ ÌïÑÌÑ∞ÎßÅ
            document.querySelectorAll('.futures-contract').forEach(contract => {
                if (category === 'all' || contract.dataset.category === category) {
                    contract.style.display = 'block';
                } else {
                    contract.style.display = 'none';
                }
            });
        }

        function getCategoryName(category) {
            const names = {
                'index': 'ÏßÄÏàò',
                'energy': 'ÏóêÎÑàÏßÄ',
                'metals': 'Í∏àÏÜç',
                'agriculture': 'ÎÜçÏÇ∞Î¨º',
                'currency': 'ÌÜµÌôî',
                'crypto': 'ÏïîÌò∏ÌôîÌèê'
            };
            return names[category] || category;
        }

        function selectFuturesContract(contractName, price, baseVolatility) {
            const modalContent = `
                <h2 style="text-align: center; margin-bottom: 30px; color: var(--primary);">üìä ${contractName}</h2>
                
                <div style="background: rgba(59, 130, 246, 0.1); border: 1px solid rgba(59, 130, 246, 0.3); border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                    <h3 style="color: var(--primary); margin: 0 0 15px 0;">üí∞ Ìà¨Ïûê ÏÑ§Ï†ï</h3>
                    
                    <div style="margin-bottom: 20px;">
                        <label style="color: #e2e8f0; display: block; margin-bottom: 8px;">Ìà¨Ïûê Í∏àÏï°:</label>
                        <input type="range" id="futuresAmount" min="100000" max="50000000" value="1000000" 
                               style="width: 100%; margin-bottom: 10px;" oninput="updateFuturesAmount()">
                        <div style="display: flex; justify-content: space-between; color: #94a3b8; font-size: 0.9rem;">
                            <span>10Îßå</span>
                            <span id="selectedFuturesAmount" style="color: var(--primary); font-weight: bold;">100Îßå ÎπÑÌä∏ÌÅ¨Î†àÎîß</span>
                            <span>5Ï≤úÎßå</span>
                        </div>
                    </div>

                    <div style="margin-bottom: 20px;">
                        <label style="color: #e2e8f0; display: block; margin-bottom: 8px;">Î†àÎ≤ÑÎ¶¨ÏßÄ Î∞∞Ïàò:</label>
                        <select id="leverageSelect" style="
                            width: 100%; padding: 10px; background: rgba(71, 85, 105, 0.2);
                            border: 1px solid rgba(71, 85, 105, 0.3); border-radius: 8px;
                            color: #e2e8f0; font-size: 1rem;
                        " onchange="updateLeverageInfo()">
                            <option value="1">1Î∞∞ (Î†àÎ≤ÑÎ¶¨ÏßÄ ÏóÜÏùå)</option>
                            <option value="2">2Î∞∞</option>
                            <option value="5">5Î∞∞</option>
                            <option value="10">10Î∞∞</option>
                            <option value="20">20Î∞∞</option>
                            <option value="50">50Î∞∞ ‚ö°</option>
                            <option value="100">100Î∞∞ ‚ö°‚ö°</option>
                            <option value="200" selected>200Î∞∞ ‚ö°‚ö°‚ö° (ÏµúÎåÄ)</option>
                        </select>
                    </div>

                    <div style="margin-bottom: 20px;">
                        <label style="color: #e2e8f0; display: block; margin-bottom: 8px;">Ìè¨ÏßÄÏÖò:</label>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                            <button id="longBtn" onclick="selectPosition('long')" style="
                                padding: 12px; background: rgba(34, 197, 94, 0.2); border: 2px solid var(--success);
                                color: var(--success); border-radius: 8px; cursor: pointer; font-weight: bold;
                            ">üöÄ Î°± (ÏÉÅÏäπ)</button>
                            <button id="shortBtn" onclick="selectPosition('short')" style="
                                padding: 12px; background: rgba(71, 85, 105, 0.1); border: 2px solid rgba(71, 85, 105, 0.3);
                                color: #94a3b8; border-radius: 8px; cursor: pointer; font-weight: bold;
                            ">üìâ Ïàè (ÌïòÎùΩ)</button>
                        </div>
                    </div>

                    <div id="leverageInfo" style="background: rgba(34, 197, 94, 0.1); border: 1px solid rgba(34, 197, 94, 0.3); border-radius: 8px; padding: 15px;">
                        <div style="color: var(--success); font-size: 0.9rem; line-height: 1.5;" id="leverageDetails">
                            ‚Ä¢ Ïã§Ï†ú Ìà¨ÏûêÍ∏à: 100Îßå ÎπÑÌä∏ÌÅ¨Î†àÎîß<br>
                            ‚Ä¢ Î†àÎ≤ÑÎ¶¨ÏßÄ: 200Î∞∞<br>
                            ‚Ä¢ Ï¥ù Ìè¨ÏßÄÏÖò: 2Ïñµ ÎπÑÌä∏ÌÅ¨Î†àÎîß<br>
                            ‚Ä¢ 1% Î≥ÄÎèô Ïãú ÏàòÏùµ/ÏÜêÏã§: ¬±200Îßå ÎπÑÌä∏ÌÅ¨Î†àÎîß
                        </div>
                    </div>
                </div>

                <div style="display: flex; gap: 15px; justify-content: center;">
                    <button onclick="executeFuturesTrade('${contractName}', ${price}, ${baseVolatility})" style="
                        padding: 15px 30px; background: linear-gradient(135deg, #10b981, #059669);
                        color: white; border: none; border-radius: 10px; cursor: pointer;
                        font-size: 1rem; font-weight: bold; box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
                    ">üí∏ Ìà¨Ïûê Ïã§Ìñâ</button>
                    <button onclick="openFuturesMarket()" style="
                        padding: 15px 30px; background: rgba(71, 85, 105, 0.2);
                        color: #e2e8f0; border: 1px solid rgba(71, 85, 105, 0.3);
                        border-radius: 10px; cursor: pointer; font-size: 1rem;
                    ">‚Üê Îí§Î°ú</button>
                </div>
            `;

            showModal(modalContent);
            window.selectedPosition = 'long'; // Í∏∞Î≥∏Í∞í
        }

        let selectedPosition = 'long';

        function selectPosition(position) {
            selectedPosition = position;
            document.getElementById('longBtn').style.background = position === 'long' ? 'rgba(34, 197, 94, 0.2)' : 'rgba(71, 85, 105, 0.1)';
            document.getElementById('longBtn').style.border = position === 'long' ? '2px solid var(--success)' : '2px solid rgba(71, 85, 105, 0.3)';
            document.getElementById('longBtn').style.color = position === 'long' ? 'var(--success)' : '#94a3b8';
            
            document.getElementById('shortBtn').style.background = position === 'short' ? 'rgba(239, 68, 68, 0.2)' : 'rgba(71, 85, 105, 0.1)';
            document.getElementById('shortBtn').style.border = position === 'short' ? '2px solid var(--danger)' : '2px solid rgba(71, 85, 105, 0.3)';
            document.getElementById('shortBtn').style.color = position === 'short' ? 'var(--danger)' : '#94a3b8';
        }

        function updateFuturesAmount() {
            const amount = parseInt(document.getElementById('futuresAmount').value);
            document.getElementById('selectedFuturesAmount').textContent = `${Math.floor(amount / 10000)}Îßå ÎπÑÌä∏ÌÅ¨Î†àÎîß`;
            updateLeverageInfo();
        }

        function updateLeverageInfo() {
            const amount = parseInt(document.getElementById('futuresAmount')?.value || 1000000);
            const leverage = parseInt(document.getElementById('leverageSelect')?.value || 200);
            const totalPosition = amount * leverage;
            const onePercentChange = totalPosition * 0.01;

            if (document.getElementById('leverageDetails')) {
                document.getElementById('leverageDetails').innerHTML = `
                    ‚Ä¢ Ïã§Ï†ú Ìà¨ÏûêÍ∏à: ${amount.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß<br>
                    ‚Ä¢ Î†àÎ≤ÑÎ¶¨ÏßÄ: ${leverage}Î∞∞<br>
                    ‚Ä¢ Ï¥ù Ìè¨ÏßÄÏÖò: ${totalPosition.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß<br>
                    ‚Ä¢ 1% Î≥ÄÎèô Ïãú ÏàòÏùµ/ÏÜêÏã§: ¬±${onePercentChange.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß<br>
                    ‚Ä¢ ÎßàÏßÑÏΩú Í∏∞Ï§Ä: ${leverage > 50 ? '-0.5%' : leverage > 10 ? '-2%' : '-5%'} (${leverage > 50 ? 'Í∑πÎèÑÎ°ú ÏúÑÌóò' : leverage > 10 ? 'Îß§Ïö∞ ÏúÑÌóò' : 'ÏúÑÌóò'})
                `;

                const infoDiv = document.getElementById('leverageInfo');
                if (leverage >= 100) {
                    infoDiv.style.background = 'rgba(239, 68, 68, 0.1)';
                    infoDiv.style.border = '1px solid rgba(239, 68, 68, 0.3)';
                    infoDiv.querySelector('#leverageDetails').style.color = 'var(--danger)';
                } else if (leverage >= 20) {
                    infoDiv.style.background = 'rgba(245, 158, 11, 0.1)';
                    infoDiv.style.border = '1px solid rgba(245, 158, 11, 0.3)';
                    infoDiv.querySelector('#leverageDetails').style.color = 'var(--warning)';
                } else {
                    infoDiv.style.background = 'rgba(34, 197, 94, 0.1)';
                    infoDiv.style.border = '1px solid rgba(34, 197, 94, 0.3)';
                    infoDiv.querySelector('#leverageDetails').style.color = 'var(--success)';
                }
            }
        }

        function executeFuturesTrade(contractName, entryPrice, baseVolatility) {
            const amount = parseInt(document.getElementById('futuresAmount').value);
            const leverage = parseInt(document.getElementById('leverageSelect').value);
            const position = selectedPosition;

            if (gameState.currentUser.game_balance < amount) {
                showNotification(`ÏÑ†Î¨ºÌà¨ÏûêÏóêÎäî ${amount.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîßÏù¥ ÌïÑÏöîÌï©ÎãàÎã§`, 'error');
                return;
            }

            const confirmation = confirm(`
${contractName} 
Ìà¨ÏûêÍ∏à: ${amount.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß
Î†àÎ≤ÑÎ¶¨ÏßÄ: ${leverage}Î∞∞ 
Ìè¨ÏßÄÏÖò: ${position === 'long' ? 'Î°±(ÏÉÅÏäπ)' : 'Ïàè(ÌïòÎùΩ)'}
Ï¥ù Ìè¨ÏßÄÏÖò: ${(amount * leverage).toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß

Ï†ïÎßê Ìà¨ÏûêÌïòÏãúÍ≤†ÏäµÎãàÍπå? (Í≥†ÏúÑÌóò Ìà¨ÏûêÏûÖÎãàÎã§!)
            `);

            if (!confirmation) return;

            gameState.currentUser.game_balance -= amount;

            // ÎßàÏßÑÏΩú Í∏∞Ï§Ä ÏÑ§Ï†ï
            let marginCallThreshold;
            if (leverage >= 100) marginCallThreshold = -0.005; // -0.5%
            else if (leverage >= 50) marginCallThreshold = -0.01; // -1%
            else if (leverage >= 20) marginCallThreshold = -0.02; // -2%
            else if (leverage >= 10) marginCallThreshold = -0.05; // -5%
            else marginCallThreshold = -0.1; // -10%

            gameState.roleData.investments.push({
                type: 'futures',
                name: contractName,
                amount: amount,
                leverage: leverage,
                position: position, // 'long' or 'short'
                entryPrice: entryPrice,
                currentPrice: entryPrice,
                returnRate: 0,
                dividends: 0,
                volatility: baseVolatility * (1 + leverage * 0.01), // Î†àÎ≤ÑÎ¶¨ÏßÄÏóê Îî∞Î•∏ Î≥ÄÎèôÏÑ± Ï¶ùÍ∞Ä
                marginCallThreshold: marginCallThreshold,
                totalPosition: amount * leverage,
                isActive: true,
                openTime: Date.now()
            });

            updateInvestmentDisplay();
            updateDisplay();
            closeModal();
            
            const leverageEmoji = leverage >= 100 ? '‚ö°‚ö°‚ö°' : leverage >= 50 ? '‚ö°‚ö°' : leverage >= 10 ? '‚ö°' : '';
            showNotification(`${contractName} ${leverage}Î∞∞ ${leverageEmoji} ${position === 'long' ? 'Î°±' : 'Ïàè'} Ìè¨ÏßÄÏÖò ÏßÑÏûÖ!`, 'success');
        }
        
        // ÏßÅÏû•Ïù∏ Í∏∞Îä•Îì§
        function workOvertime() {
            const overtimePay = Math.floor(gameState.roleData.workStats.salary * 0.3);
            gameState.currentUser.game_balance += overtimePay;
            gameState.roleData.workStats.experience += 1;
            
            updateWorkDisplay();
            updateDisplay();
            showNotification(`ÏïºÍ∑ºÏúºÎ°ú ${overtimePay.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîßÏùÑ Î∞õÏïòÏäµÎãàÎã§!`, 'success');
        }
        
        function attendTraining() {
            const trainingCost = 2000;
            if (gameState.currentUser.game_balance < trainingCost) {
                showNotification(`ÍµêÏú°ÎπÑÎ°ú ${trainingCost.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîßÏù¥ ÌïÑÏöîÌï©ÎãàÎã§`, 'error');
                return;
            }
            
            gameState.currentUser.game_balance -= trainingCost;
            gameState.roleData.workStats.experience += 5;
            gameState.roleData.workStats.salary += 200;
            
            updateWorkDisplay();
            updateDisplay();
            showNotification('ÍµêÏú°ÏùÑ ÏôÑÎ£åÌñàÏäµÎãàÎã§! Í∏âÏó¨Í∞Ä ÏÉÅÏäπÌñàÏäµÎãàÎã§.', 'success');
        }
        
        function requestPromotion() {
            if (gameState.roleData.workStats.experience < 10) {
                showNotification('ÏäπÏßÑÌïòÎ†§Î©¥ Í≤ΩÎ†• 10ÎÖÑ Ïù¥ÏÉÅÏù¥ ÌïÑÏöîÌï©ÎãàÎã§', 'error');
                return;
            }
            
            const positions = ['ÏÇ¨Ïõê', 'Ï£ºÏûÑ', 'ÎåÄÎ¶¨', 'Í≥ºÏû•', 'Ï∞®Ïû•', 'Î∂ÄÏû•'];
            const currentIndex = positions.indexOf(gameState.roleData.workStats.position);
            
            if (currentIndex < positions.length - 1) {
                gameState.roleData.workStats.position = positions[currentIndex + 1];
                gameState.roleData.workStats.salary = Math.floor(gameState.roleData.workStats.salary * 1.5);
                gameState.roleData.workStats.bonuses += 5000;
                
                updateWorkDisplay();
                updateDisplay();
                showNotification(`${gameState.roleData.workStats.position}ÏúºÎ°ú ÏäπÏßÑÌñàÏäµÎãàÎã§!`, 'success');
            } else {
                showNotification('Îçî Ïù¥ÏÉÅ ÏäπÏßÑÌï† Ïàò ÏóÜÏäµÎãàÎã§', 'info');
            }
        }
        
        function changeJob() {
            const newSalary = Math.floor(gameState.roleData.workStats.salary * (0.8 + Math.random() * 0.6));
            gameState.roleData.workStats.salary = newSalary;
            gameState.roleData.workStats.experience += 2;
            
            const companies = ['ÏÉàÎ°úÏö¥ ÌöåÏÇ¨ A', 'Í∏ÄÎ°úÎ≤å Í∏∞ÏóÖ B', 'Ïä§ÌÉÄÌä∏ÏóÖ C', 'ÎåÄÍ∏∞ÏóÖ D'];
            const newCompany = companies[Math.floor(Math.random() * companies.length)];
            
            gameState.roleData.workHistory.push({
                company: newCompany,
                position: gameState.roleData.workStats.position,
                startDate: new Date().toLocaleDateString(),
                salary: newSalary,
                performance: Math.floor(Math.random() * 30) + 70
            });
            
            updateWorkDisplay();
            updateDisplay();
            showNotification(`${newCompany}Î°ú Ïù¥ÏßÅÌñàÏäµÎãàÎã§!`, 'success');
        }
        
        // ÏóÖÎç∞Ïù¥Ìä∏ Ìï®ÏàòÎì§
        function updateBusinessDisplay() {
            const businessCount = gameState.roleData.businesses.length;
            const totalProfit = gameState.roleData.businesses.reduce((sum, b) => sum + b.profit, 0);
            const totalValue = gameState.roleData.businesses.reduce((sum, b) => sum + b.value, 0);
            const totalEmployees = gameState.roleData.businesses.reduce((sum, b) => sum + b.employees, 0);
            
            document.getElementById('businessCount').textContent = businessCount;
            document.getElementById('monthlyProfit').textContent = totalProfit.toLocaleString();
            document.getElementById('businessValue').textContent = totalValue.toLocaleString();
            document.getElementById('employeeCount').textContent = totalEmployees;
            
            const businessList = document.getElementById('myBusinesses');
            businessList.innerHTML = '';
            
            gameState.roleData.businesses.forEach(business => {
                const businessCard = document.createElement('div');
                businessCard.className = 'business-card';
                const publicBadge = business.isPublic ? ' <span style="color: var(--primary); font-size: 0.9rem;">üìà ÏÉÅÏû•</span>' : '';
                businessCard.innerHTML = `
                    <div class="business-header">
                        <div class="business-name">${business.name} (Î†àÎ≤® ${business.level})${publicBadge}</div>
                        <div class="business-profit">+${business.profit.toLocaleString()}/Ïõî</div>
                    </div>
                    <p>ÏßÅÏõê: ${business.employees}Î™Ö | Í∞ÄÏπò: ${business.value.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß</p>
                `;
                businessList.appendChild(businessCard);
            });
            
            // ÏÉÅÏû• Í∏∞ÏóÖ Ï†ïÎ≥¥ ÏóÖÎç∞Ïù¥Ìä∏
            updatePublicCompanyDisplay();
            
            // Í∏∞ÏóÖ ÌèâÍ∞Ä Ï†ïÎ≥¥ ÏóÖÎç∞Ïù¥Ìä∏
            updateCompanyRatingDisplay();
            
            // Í≤ΩÏüÅÏÇ¨ Ï†ïÎ≥¥ ÏóÖÎç∞Ïù¥Ìä∏
            updateCompetitorDisplay();
        }
        
        function updateInvestmentDisplay() {
            const totalInvestment = gameState.roleData.investments.reduce((sum, i) => sum + i.amount, 0);
            const avgReturn = gameState.roleData.investments.length > 0 ? 
                (gameState.roleData.investments.reduce((sum, i) => sum + i.returnRate, 0) / gameState.roleData.investments.length * 100) : 0;
            const totalDividends = gameState.roleData.investments.reduce((sum, i) => sum + i.dividends, 0);
            
            document.getElementById('totalInvestment').textContent = totalInvestment.toLocaleString();
            document.getElementById('investmentReturn').textContent = avgReturn.toFixed(1) + '%';
            document.getElementById('stockCount').textContent = gameState.roleData.investments.length;
            document.getElementById('dividends').textContent = totalDividends.toLocaleString();
            
            const portfolioDiv = document.getElementById('investmentPortfolio');
            portfolioDiv.innerHTML = '';
            
            gameState.roleData.investments.forEach(investment => {
                const card = document.createElement('div');
                card.className = 'business-card';
                const returnColor = investment.returnRate >= 0 ? 'var(--success)' : 'var(--danger)';
                // ÏÑ†Î¨ºÌà¨Ïûê ÌäπÎ≥Ñ ÌëúÏãú
                if (investment.type === 'futures') {
                    const leverageEmoji = investment.leverage >= 100 ? '‚ö°‚ö°‚ö°' : investment.leverage >= 50 ? '‚ö°‚ö°' : investment.leverage >= 10 ? '‚ö°' : '';
                    const positionEmoji = investment.position === 'long' ? 'üöÄ' : 'üìâ';
                    const statusText = investment.isActive ? 'ÏßÑÌñâÏ§ë' : 'Ï≤≠ÏÇ∞Îê®';
                    const statusColor = investment.isActive ? (investment.returnRate >= 0 ? 'var(--success)' : 'var(--warning)') : 'var(--danger)';
                    
                    card.innerHTML = `
                        <div class="business-header">
                            <div class="business-name">${investment.name} ${leverageEmoji}</div>
                            <div style="color: ${returnColor}">${(investment.returnRate * 100).toFixed(1)}%</div>
                        </div>
                        <p>
                            ${positionEmoji} ${investment.position === 'long' ? 'Î°±' : 'Ïàè'} ${investment.leverage}Î∞∞ | 
                            Ìà¨ÏûêÍ∏à: ${investment.amount.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß | 
                            <span style="color: ${statusColor};">${statusText}</span>
                        </p>
                        ${investment.isActive ? `<p style="font-size: 0.8rem; color: #94a3b8;">Ï¥ù Ìè¨ÏßÄÏÖò: ${investment.totalPosition.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß</p>` : ''}
                    `;
                } else {
                    card.innerHTML = `
                        <div class="business-header">
                            <div class="business-name">${investment.name} (${investment.type})</div>
                            <div style="color: ${returnColor}">${(investment.returnRate * 100).toFixed(1)}%</div>
                        </div>
                        <p>Ìà¨ÏûêÍ∏à: ${investment.amount.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß | Î∞∞Îãπ: ${investment.dividends.toLocaleString()}/Ïõî</p>
                    `;
                }
                portfolioDiv.appendChild(card);
            });
        }
        
        function updateWorkDisplay() {
            document.getElementById('monthlySalary').textContent = gameState.roleData.workStats.salary.toLocaleString();
            document.getElementById('workExperience').textContent = gameState.roleData.workStats.experience + 'ÎÖÑ';
            document.getElementById('jobTitle').textContent = gameState.roleData.workStats.position;
            document.getElementById('bonusAvailable').textContent = gameState.roleData.workStats.bonuses.toLocaleString();
            
            const historyDiv = document.getElementById('workHistory');
            historyDiv.innerHTML = '';
            
            gameState.roleData.workHistory.forEach(job => {
                const card = document.createElement('div');
                card.className = 'business-card';
                card.innerHTML = `
                    <div class="business-header">
                        <div class="business-name">${job.company}</div>
                        <div class="business-profit">${job.salary.toLocaleString()}/Ïõî</div>
                    </div>
                    <p>${job.position} | ÏûÖÏÇ¨Ïùº: ${job.startDate} | ÏÑ±Í≥º: ${job.performance}Ï†ê</p>
                `;
                historyDiv.appendChild(card);
            });
        }

        // M&A ÏãúÏä§ÌÖú Ìï®ÏàòÎì§
        function openMAModal() {
            generateAcquisitionTargets();
            document.getElementById('maModal').style.display = 'flex';
        }

        function closeMAModal() {
            document.getElementById('maModal').style.display = 'none';
        }

        function generateAcquisitionTargets() {
            const targetCompanies = [
                { name: 'ÌÖåÌÅ¨ÎÖ∏Î≤†Ïù¥ÏÖò', sector: 'tech', value: 50000, employees: 25, profit: 3000, growth: 15 },
                { name: 'Í∏ÄÎ°úÎ≤åÎ°úÏßÄÏä§', sector: 'logistics', value: 80000, employees: 45, profit: 4500, growth: 12 },
                { name: 'Í∑∏Î¶∞ÏóêÎÑàÏßÄ', sector: 'energy', value: 120000, employees: 65, profit: 7000, growth: 20 },
                { name: 'Ìó¨Ïä§ÏºÄÏñ¥ÌîåÎü¨Ïä§', sector: 'healthcare', value: 90000, employees: 38, profit: 5500, growth: 18 },
                { name: 'ÏóêÎìÄÌÖåÌÅ¨', sector: 'education', value: 35000, employees: 22, profit: 2200, growth: 25 },
                { name: 'Ìë∏ÎìúÌÖåÌÅ¨', sector: 'food', value: 60000, employees: 30, profit: 3800, growth: 14 }
            ];

            // ÎûúÎç§ÏúºÎ°ú 3-5Í∞ú ÌöåÏÇ¨ ÏÑ†ÌÉù
            const shuffled = [...targetCompanies].sort(() => 0.5 - Math.random());
            const availableTargets = shuffled.slice(0, 3 + Math.floor(Math.random() * 3));

            const targetsDiv = document.getElementById('acquisitionTargets');
            targetsDiv.innerHTML = '';

            availableTargets.forEach(target => {
                const targetCard = document.createElement('div');
                targetCard.className = 'business-card';
                targetCard.style.marginBottom = '15px';
                
                const acquisitionCost = Math.floor(target.value * (1.2 + Math.random() * 0.4)); // 120-160% ÌîÑÎ¶¨ÎØ∏ÏóÑ
                const canAfford = gameState.currentUser.game_balance >= acquisitionCost;
                
                targetCard.innerHTML = `
                    <div class="business-header">
                        <div class="business-name">${target.name} (${target.sector})</div>
                        <div class="business-profit">+${target.profit.toLocaleString()}/Ïõî</div>
                    </div>
                    <div style="margin: 10px 0; font-size: 0.9rem; color: #94a3b8;">
                        <div>Í∏∞ÏóÖÍ∞ÄÏπò: ${target.value.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß | ÏßÅÏõê: ${target.employees}Î™Ö</div>
                        <div>ÏÑ±Ïû•Î•†: +${target.growth}% | Ïù∏ÏàòÎπÑÏö©: ${acquisitionCost.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß</div>
                    </div>
                    <button class="btn ${canAfford ? '' : 'btn-secondary'}" 
                            onclick="attemptAcquisition('${target.name}', ${acquisitionCost}, ${target.value}, ${target.employees}, ${target.profit}, ${target.growth})"
                            ${canAfford ? '' : 'disabled'}>
                        ${canAfford ? 'Ïù∏ÏàòÌïòÍ∏∞' : 'ÏûêÍ∏à Î∂ÄÏ°±'}
                    </button>
                `;
                targetsDiv.appendChild(targetCard);
            });
        }

        function attemptAcquisition(name, cost, value, employees, profit, growth) {
            if (gameState.currentUser.game_balance < cost) {
                showNotification('Ïù∏Ïàò ÏûêÍ∏àÏù¥ Î∂ÄÏ°±Ìï©ÎãàÎã§', 'error');
                return;
            }

            // M&A ÏÑ±Í≥µÎ•† Í≥ÑÏÇ∞ (ÏûêÍ∏à Ïó¨Ïú†ÎèÑ, Í∏∞ÏóÖ Í∑úÎ™® Îì± Í≥†Î†§)
            const fundRatio = gameState.currentUser.game_balance / cost;
            const baseSuccessRate = 0.7; // 70% Í∏∞Î≥∏ ÏÑ±Í≥µÎ•†
            const fundingBonus = Math.min(0.2, (fundRatio - 1) * 0.1); // ÏûêÍ∏à Ïó¨Ïú†ÎèÑ Î≥¥ÎÑàÏä§
            const successRate = Math.min(0.9, baseSuccessRate + fundingBonus); // ÏµúÎåÄ 90%

            const isSuccess = Math.random() < successRate;

            if (isSuccess) {
                // Ïù∏Ïàò ÏÑ±Í≥µ
                gameState.currentUser.game_balance -= cost;
                
                const newBusiness = {
                    name: name,
                    level: 1,
                    employees: employees,
                    profit: Math.floor(profit * (1 + growth / 100)), // ÏÑ±Ïû•Î•† Ï†ÅÏö©
                    value: value,
                    investment: cost,
                    isPublic: false,
                    sector: 'acquired',
                    growthRate: growth,
                    acquired: true
                };

                gameState.roleData.businesses.push(newBusiness);
                
                // Í∏∞ÏóÖ ÌèâÌåê ÏÉÅÏäπ
                gameState.roleData.companyRating.reputation += 5;
                gameState.roleData.companyRating.marketShare += 2;

                updateBusinessDisplay();
                updateDisplay();
                closeMAModal();
                showNotification(`${name} Ïù∏ÏàòÍ∞Ä ÏÑ±Í≥µÌñàÏäµÎãàÎã§! ÏãúÏû• Ï†êÏú†Ïú®Ïù¥ Ï¶ùÍ∞ÄÌñàÏäµÎãàÎã§.`, 'success');
            } else {
                // Ïù∏Ïàò Ïã§Ìå® - ÏùºÎ∂Ä ÎπÑÏö© ÏÜêÏã§
                const loss = Math.floor(cost * 0.15); // 15% ÏÜêÏã§ (ÌòëÏÉÅ ÎπÑÏö©, Ïã§ÏÇ¨ ÎπÑÏö© Îì±)
                gameState.currentUser.game_balance -= loss;
                
                updateDisplay();
                showNotification(`${name} Ïù∏ÏàòÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§. ÌòëÏÉÅ ÎπÑÏö©ÏúºÎ°ú ${loss.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîßÏùÑ ÏûÉÏóàÏäµÎãàÎã§.`, 'error');
            }
        }

        // R&D ÏãúÏä§ÌÖú Ìï®ÏàòÎì§
        function openRDModal() {
            generateRDProjects();
            updateActiveRDProjects();
            document.getElementById('rdModal').style.display = 'flex';
        }

        function closeRDModal() {
            document.getElementById('rdModal').style.display = 'none';
        }

        function generateRDProjects() {
            const availableProjects = [
                { 
                    name: 'ÏûêÎèôÌôî ÏãúÏä§ÌÖú', 
                    cost: 30000, 
                    duration: 6, 
                    description: 'ÏÉùÏÇ∞ Ìö®Ïú®ÏÑ± 20% Ìñ•ÏÉÅ',
                    benefit: { type: 'efficiency', value: 0.2 }
                },
                { 
                    name: 'AI ÌíàÏßàÍ¥ÄÎ¶¨', 
                    cost: 45000, 
                    duration: 8, 
                    description: 'Î∂àÎüâÎ•† 50% Í∞êÏÜå, ÌèâÌåê +10',
                    benefit: { type: 'quality', value: 0.5, reputation: 10 }
                },
                { 
                    name: 'ÏπúÌôòÍ≤Ω Í∏∞Ïà†', 
                    cost: 25000, 
                    duration: 5, 
                    description: 'ESG Ï†êÏàò +20, Ï†ïÎ∂Ä ÏßÄÏõêÍ∏à 15000 ÎπÑÌä∏ÌÅ¨Î†àÎîß',
                    benefit: { type: 'esg', value: 20, subsidy: 15000 }
                },
                { 
                    name: 'Ïã†Ï†úÌíà Í∞úÎ∞ú', 
                    cost: 60000, 
                    duration: 10, 
                    description: 'Ïã†Í∑ú ÏÇ¨ÏóÖ Í∏∞Ìöå, ÏàòÏùµ +30%',
                    benefit: { type: 'revenue', value: 0.3 }
                },
                { 
                    name: 'ÎîîÏßÄÌÑ∏ Ìä∏ÎûúÏä§Ìè¨Î©îÏù¥ÏÖò', 
                    cost: 50000, 
                    duration: 12, 
                    description: 'Ïö¥ÏòÅÎπÑ -25%, Í≥†Í∞ù ÎßåÏ°±ÎèÑ +15',
                    benefit: { type: 'cost_reduction', value: 0.25, reputation: 15 }
                }
            ];

            // ÌòÑÏû¨ ÏßÑÌñâÏ§ëÏù¥ÏßÄ ÏïäÏùÄ ÌîÑÎ°úÏ†ùÌä∏Îßå ÌëúÏãú
            const activeProjectNames = gameState.roleData.rdProjects.map(p => p.name);
            const available = availableProjects.filter(p => !activeProjectNames.includes(p.name));

            const projectsDiv = document.getElementById('availableRDProjects');
            projectsDiv.innerHTML = '';

            available.slice(0, 3).forEach(project => {
                const projectCard = document.createElement('div');
                projectCard.className = 'business-card';
                projectCard.style.marginBottom = '15px';
                
                const canAfford = gameState.currentUser.game_balance >= project.cost;
                
                projectCard.innerHTML = `
                    <div class="business-header">
                        <div class="business-name">${project.name}</div>
                        <div style="color: var(--warning);">${project.cost.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß</div>
                    </div>
                    <div style="margin: 10px 0; font-size: 0.9rem; color: #94a3b8;">
                        <div>Í∞úÎ∞ú Í∏∞Í∞Ñ: ${project.duration}Í∞úÏõî</div>
                        <div style="color: var(--success);">${project.description}</div>
                    </div>
                    <button class="btn ${canAfford ? '' : 'btn-secondary'}" 
                            onclick="startRDProject('${project.name}', ${project.cost}, ${project.duration}, '${project.description}', '${JSON.stringify(project.benefit).replace(/"/g, "&quot;")}')"
                            ${canAfford ? '' : 'disabled'}>
                        ${canAfford ? 'ÌîÑÎ°úÏ†ùÌä∏ ÏãúÏûë' : 'ÏûêÍ∏à Î∂ÄÏ°±'}
                    </button>
                `;
                projectsDiv.appendChild(projectCard);
            });
        }

        function startRDProject(name, cost, duration, description, benefitStr) {
            if (gameState.currentUser.game_balance < cost) {
                showNotification('R&D ÏûêÍ∏àÏù¥ Î∂ÄÏ°±Ìï©ÎãàÎã§', 'error');
                return;
            }

            gameState.currentUser.game_balance -= cost;
            
            const benefit = JSON.parse(benefitStr.replace(/&quot;/g, '"'));
            const startDate = new Date();
            const endDate = new Date();
            endDate.setMonth(endDate.getMonth() + duration);

            const rdProject = {
                name: name,
                cost: cost,
                duration: duration,
                description: description,
                benefit: benefit,
                startDate: startDate.toLocaleDateString(),
                endDate: endDate.toLocaleDateString(),
                progress: 0,
                completed: false
            };

            gameState.roleData.rdProjects.push(rdProject);
            
            updateDisplay();
            generateRDProjects();
            updateActiveRDProjects();
            showNotification(`${name} R&D ÌîÑÎ°úÏ†ùÌä∏Î•º ÏãúÏûëÌñàÏäµÎãàÎã§!`, 'success');
        }

        function updateActiveRDProjects() {
            const activeDiv = document.getElementById('activeRDProjects');
            activeDiv.innerHTML = '';

            const activeProjects = gameState.roleData.rdProjects.filter(p => !p.completed);

            if (activeProjects.length === 0) {
                activeDiv.innerHTML = '<p style="color: #64748b; text-align: center;">ÏßÑÌñâÏ§ëÏù∏ R&D ÌîÑÎ°úÏ†ùÌä∏Í∞Ä ÏóÜÏäµÎãàÎã§</p>';
                return;
            }

            activeProjects.forEach(project => {
                const projectCard = document.createElement('div');
                projectCard.className = 'business-card';
                projectCard.style.marginBottom = '15px';
                
                // ÏßÑÌñâÎ•† Í≥ÑÏÇ∞ (ÏãúÍ∞Ñ Í∏∞Î∞ò ÏãúÎÆ¨Î†àÏù¥ÏÖò)
                const startDate = new Date(project.startDate);
                const endDate = new Date(project.endDate);
                const now = new Date();
                const totalTime = endDate - startDate;
                const elapsedTime = now - startDate;
                const progress = Math.min(100, Math.max(0, (elapsedTime / totalTime) * 100));
                
                projectCard.innerHTML = `
                    <div class="business-header">
                        <div class="business-name">${project.name}</div>
                        <div style="color: var(--primary);">${progress.toFixed(1)}%</div>
                    </div>
                    <div style="margin: 10px 0; font-size: 0.9rem; color: #94a3b8;">
                        <div>${project.description}</div>
                        <div>ÏôÑÎ£å ÏòàÏ†ï: ${project.endDate}</div>
                        <div style="background: rgba(59, 130, 246, 0.1); border-radius: 10px; height: 8px; margin-top: 8px;">
                            <div style="background: var(--primary); height: 100%; border-radius: 10px; width: ${progress}%; transition: width 0.3s;"></div>
                        </div>
                    </div>
                    ${progress >= 100 ? 
                        `<button class="btn" onclick="completeRDProject('${project.name}')">ÌîÑÎ°úÏ†ùÌä∏ ÏôÑÎ£å</button>` :
                        '<div style="color: #64748b; text-align: center;">Í∞úÎ∞ú ÏßÑÌñâÏ§ë...</div>'
                    }
                `;
                activeDiv.appendChild(projectCard);
            });
        }

        function completeRDProject(projectName) {
            const projectIndex = gameState.roleData.rdProjects.findIndex(p => p.name === projectName);
            if (projectIndex === -1) return;

            const project = gameState.roleData.rdProjects[projectIndex];
            project.completed = true;

            // ÌòúÌÉù Ï†ÅÏö©
            const benefit = project.benefit;
            let message = `${projectName} R&D ÌîÑÎ°úÏ†ùÌä∏Í∞Ä ÏôÑÎ£åÎêòÏóàÏäµÎãàÎã§! `;

            if (benefit.type === 'efficiency') {
                // Î™®Îì† ÏÇ¨ÏóÖÏ≤¥ ÏàòÏùµ Ï¶ùÍ∞Ä
                gameState.roleData.businesses.forEach(business => {
                    business.profit = Math.floor(business.profit * (1 + benefit.value));
                });
                message += `Î™®Îì† ÏÇ¨ÏóÖÏ≤¥Ïùò Ìö®Ïú®ÏÑ±Ïù¥ ${(benefit.value * 100)}% Ìñ•ÏÉÅÎêòÏóàÏäµÎãàÎã§.`;
            }

            if (benefit.type === 'quality' || benefit.reputation) {
                gameState.roleData.companyRating.reputation += (benefit.reputation || 0);
                message += ` ÌèâÌåêÏù¥ ${benefit.reputation || 0}Ï†ê ÏÉÅÏäπÌñàÏäµÎãàÎã§.`;
            }

            if (benefit.type === 'esg') {
                gameState.roleData.companyRating.esgScore += benefit.value;
                if (benefit.subsidy) {
                    gameState.currentUser.game_balance += benefit.subsidy;
                    message += ` ESG Ï†êÏàòÍ∞Ä ${benefit.value}Ï†ê ÏÉÅÏäπÌïòÍ≥† Ï†ïÎ∂Ä ÏßÄÏõêÍ∏à ${benefit.subsidy.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîßÏùÑ Î∞õÏïòÏäµÎãàÎã§.`;
                }
            }

            if (benefit.type === 'revenue') {
                gameState.roleData.businesses.forEach(business => {
                    business.profit = Math.floor(business.profit * (1 + benefit.value));
                });
                message += ` Î™®Îì† ÏÇ¨ÏóÖÏ≤¥ ÏàòÏùµÏù¥ ${(benefit.value * 100)}% Ï¶ùÍ∞ÄÌñàÏäµÎãàÎã§.`;
            }

            if (benefit.type === 'cost_reduction') {
                // Ïö¥ÏòÅÎπÑ Ï†àÍ∞ê Ìö®Í≥ºÎäî ÏàòÏùµ Ï¶ùÍ∞ÄÎ°ú ÌëúÌòÑ
                gameState.roleData.businesses.forEach(business => {
                    business.profit = Math.floor(business.profit * (1 + benefit.value * 0.5)); // ÎπÑÏö© Ï†àÍ∞êÏùò Ï†àÎ∞òÏùÑ ÏàòÏùµ Ï¶ùÍ∞ÄÎ°ú
                });
                if (benefit.reputation) {
                    gameState.roleData.companyRating.reputation += benefit.reputation;
                    message += ` Ïö¥ÏòÅÎπÑÍ∞Ä Ï†àÍ∞êÎêòÍ≥† ÌèâÌåêÏù¥ ${benefit.reputation}Ï†ê ÏÉÅÏäπÌñàÏäµÎãàÎã§.`;
                }
            }

            updateBusinessDisplay();
            updateDisplay();
            updateActiveRDProjects();
            showNotification(message, 'success');
        }

        // Í∏∞ÏóÖ Îì±Í∏â & ÌèâÌåê ÏãúÏä§ÌÖú Ìï®ÏàòÎì§
        function updateCompanyRatingDisplay() {
            // Ïã†Ïö©Îì±Í∏â Í≥ÑÏÇ∞ (Í∏∞ÏóÖÍ∞ÄÏπò, ÌèâÌåê, ESG Ï†êÏàò Í∏∞Î∞ò)
            const totalBusinessValue = gameState.roleData.businesses.reduce((sum, b) => sum + b.value, 0);
            const reputation = gameState.roleData.companyRating.reputation;
            const esgScore = gameState.roleData.companyRating.esgScore;
            
            let creditRating = 'D';
            if (totalBusinessValue >= 500000 && reputation >= 90 && esgScore >= 80) {
                creditRating = 'AAA';
            } else if (totalBusinessValue >= 300000 && reputation >= 80 && esgScore >= 70) {
                creditRating = 'AA';
            } else if (totalBusinessValue >= 200000 && reputation >= 70 && esgScore >= 60) {
                creditRating = 'A';
            } else if (totalBusinessValue >= 100000 && reputation >= 60 && esgScore >= 50) {
                creditRating = 'BBB';
            } else if (totalBusinessValue >= 50000 && reputation >= 50 && esgScore >= 40) {
                creditRating = 'BB';
            } else if (totalBusinessValue >= 20000 && reputation >= 40 && esgScore >= 30) {
                creditRating = 'B';
            } else if (totalBusinessValue >= 10000 || reputation >= 30) {
                creditRating = 'C';
            }
            
            gameState.roleData.companyRating.creditRating = creditRating;
            
            // UI ÏóÖÎç∞Ïù¥Ìä∏
            document.getElementById('creditRating').textContent = creditRating;
            document.getElementById('companyReputation').textContent = reputation + 'Ï†ê';
            document.getElementById('esgScore').textContent = esgScore + 'Ï†ê';
            document.getElementById('marketSharePercent').textContent = gameState.roleData.companyRating.marketShare.toFixed(1) + '%';
            
            // Ïã†Ïö©Îì±Í∏âÏóê Îî∞Î•∏ ÏÉâÏÉÅ Î≥ÄÍ≤Ω
            const ratingElement = document.getElementById('creditRating');
            ratingElement.style.color = getCreditRatingColor(creditRating);
        }

        function getCreditRatingColor(rating) {
            const colors = {
                'AAA': '#10b981', // ÎÖπÏÉâ 
                'AA': '#16a34a',
                'A': '#65a30d', 
                'BBB': '#ca8a04', // Ìô©ÏÉâ
                'BB': '#ea580c',
                'B': '#dc2626',   // Ï†ÅÏÉâ
                'C': '#991b1b',
                'D': '#7f1d1d'
            };
            return colors[rating] || '#64748b';
        }

        // Í≤ΩÏüÅÏÇ¨ ÏãúÏä§ÌÖú Ìï®ÏàòÎì§
        function generateCompetitors() {
            if (gameState.roleData.competitors.length === 0) {
                const competitorNames = ['ÌÖåÌÅ¨Ïù¥ÎÖ∏Î≤†Ïù¥ÌÑ∞', 'Í∏ÄÎ°úÎ≤åÎπÑÏ¶à', 'Ìì®Ï≤òÏª¥ÌçºÎãà', 'Ïä§ÎßàÌä∏ÏÜîÎ£®ÏÖò', 'ÎÑ•Ïä§Ìä∏Ï†úÎÑàÎ†àÏù¥ÏÖò'];
                
                for (let i = 0; i < 3; i++) {
                    const competitor = {
                        name: competitorNames[i],
                        marketShare: 10 + Math.random() * 20, // 10-30%
                        reputation: 50 + Math.random() * 40,  // 50-90
                        growth: -5 + Math.random() * 20,      // -5% ~ 15%
                        strength: ['ÌòÅÏã†', 'ÎßàÏºÄÌåÖ', 'ÎπÑÏö©Ìö®Ïú®', 'ÌíàÏßà', 'Í≥†Í∞ùÏÑúÎπÑÏä§'][Math.floor(Math.random() * 5)]
                    };
                    gameState.roleData.competitors.push(competitor);
                }
            }
        }

        function updateCompetitorDisplay() {
            generateCompetitors();
            const competitorsDiv = document.getElementById('competitorsList');
            competitorsDiv.innerHTML = '';

            gameState.roleData.competitors.forEach((competitor, index) => {
                const competitorCard = document.createElement('div');
                competitorCard.className = 'business-card';
                competitorCard.style.marginBottom = '10px';
                
                const growthColor = competitor.growth >= 0 ? 'var(--success)' : 'var(--danger)';
                const vsPlayerShare = gameState.roleData.companyRating.marketShare;
                const isWinning = competitor.marketShare < vsPlayerShare;
                
                competitorCard.innerHTML = `
                    <div class="business-header">
                        <div class="business-name">${competitor.name} ${isWinning ? 'üìâ' : 'üìà'}</div>
                        <div style="color: ${growthColor};">${competitor.growth.toFixed(1)}%</div>
                    </div>
                    <div style="font-size: 0.9rem; color: #94a3b8; margin-top: 5px;">
                        ÏãúÏû•Ï†êÏú†Ïú®: ${competitor.marketShare.toFixed(1)}% | ÌèâÌåê: ${competitor.reputation.toFixed(0)}Ï†ê | Í∞ïÏ†ê: ${competitor.strength}
                    </div>
                `;
                competitorsDiv.appendChild(competitorCard);
            });
        }

        function simulateMarketCompetition() {
            // Îß§Îã¨ ÏãúÏû• Ï†êÏú†Ïú® Î≥ÄÌôî ÏãúÎÆ¨Î†àÏù¥ÏÖò
            const playerGrowth = gameState.roleData.businesses.length * 0.2 + (gameState.roleData.companyRating.reputation - 50) * 0.05;
            
            gameState.roleData.competitors.forEach(competitor => {
                const competitorGrowth = (competitor.growth / 100) * competitor.marketShare * 0.1;
                const randomFactor = (Math.random() - 0.5) * 2; // -1 ~ 1
                
                competitor.marketShare += competitorGrowth + randomFactor;
                competitor.marketShare = Math.max(1, Math.min(50, competitor.marketShare)); // 1-50% Ï†úÌïú
            });
            
            // ÌîåÎ†àÏù¥Ïñ¥ Ï†êÏú†Ïú® ÏóÖÎç∞Ïù¥Ìä∏
            const totalMarket = 100;
            const competitorTotalShare = gameState.roleData.competitors.reduce((sum, c) => sum + c.marketShare, 0);
            const remainingShare = Math.max(5, totalMarket - competitorTotalShare - 30); // 30%Îäî Í∏∞ÌÉÄ ÏóÖÏ≤¥Îì§
            
            gameState.roleData.companyRating.marketShare += playerGrowth;
            gameState.roleData.companyRating.marketShare = Math.max(1, Math.min(remainingShare, gameState.roleData.companyRating.marketShare));
        }

        // ÌÜ†ÏßÄ ÏãúÏä§ÌÖú Î≥ÄÏàò
        let selectedRegion = null;
        let currentLandSize = 1000;

        // ÌÜ†ÏßÄ Ìà¨Ïûê Ìï®ÏàòÎì§
        function openLandModal() {
            updateLandMarketDisplay();
            document.getElementById('landModal').style.display = 'flex';
        }

        function closeLandModal() {
            document.getElementById('landModal').style.display = 'none';
        }

        function closeLandDetailModal() {
            document.getElementById('landDetailModal').style.display = 'none';
        }

        function updateLandMarketDisplay() {
            // Ï†ÑÏ≤¥ ÌÜ†ÏßÄ ÌòÑÌô© ÏóÖÎç∞Ïù¥Ìä∏
            const totalAvailable = gameState.landMarket.regions.reduce((sum, r) => sum + r.available, 0);
            document.getElementById('landMarketStatus').textContent = 
                `Ï†ÑÍµ≠ ÌÜ†ÏßÄ ÌòÑÌô©: Ï¥ù ${gameState.landMarket.totalLand.toLocaleString()}Ìèâ Ï§ë ${totalAvailable.toLocaleString()}Ìèâ ÎÇ®Ïùå`;
            
            // Î∂ÄÎèôÏÇ∞ Î™®Îã¨Ïùò ÌÜ†ÏßÄ ÏÉÅÌÉúÎèÑ ÏóÖÎç∞Ïù¥Ìä∏
            const totalLandStatus = document.getElementById('totalLandStatus');
            if (totalLandStatus) {
                totalLandStatus.textContent = `Ï¥ù ${(gameState.landMarket.totalLand / 10000).toFixed(1)}ÎßåÌèâ Ï§ë ${(totalAvailable / 10000).toFixed(1)}ÎßåÌèâ ÎÇ®Ïùå`;
            }

            // ÏßÄÏó≠Î≥Ñ ÌÜ†ÏßÄ Î™©Î°ù ÏÉùÏÑ±
            const regionsDiv = document.getElementById('landRegionsList');
            regionsDiv.innerHTML = '';

            gameState.landMarket.regions.forEach(region => {
                const occupancyRate = ((region.total - region.available) / region.total * 100).toFixed(1);
                // Î¨¥Ï†úÌïú Ìù¨ÏÜåÏÑ± ÌîÑÎ¶¨ÎØ∏ÏóÑ: Ï†êÏú†Ïú®Ïù¥ ÎÜíÏùÑÏàòÎ°ù Í∏∞ÌïòÍ∏âÏàòÏ†Å ÏÉÅÏäπ
                const scarcityMultiplier = 1 + Math.pow(occupancyRate / 100, 2) * 10; // 100% Ï†êÏú†Ïãú 1100% (11Î∞∞)
                const basePrice = gameState.landMarket.landPricePerUnit * region.priceMultiplier * scarcityMultiplier;
                
                const regionCard = document.createElement('div');
                regionCard.className = 'business-card';
                regionCard.style.cursor = region.available > 0 ? 'pointer' : 'not-allowed';
                regionCard.style.opacity = region.available > 0 ? '1' : '0.5';
                
                const statusColor = occupancyRate < 30 ? 'var(--success)' : 
                                  occupancyRate < 70 ? 'var(--warning)' : 'var(--danger)';
                
                regionCard.innerHTML = `
                    <div class="business-header">
                        <div class="business-name">${region.name}</div>
                        <div style="color: ${statusColor};">${occupancyRate}% Ï†êÏú†</div>
                    </div>
                    <div style="font-size: 0.9rem; color: #94a3b8; margin: 10px 0;">
                        <div>‚Ä¢ ÎÇ®ÏùÄ ÌÜ†ÏßÄ: ${region.available.toLocaleString()}Ìèâ</div>
                        <div>‚Ä¢ ÌèâÎãπ Í∞ÄÍ≤©: ${Math.floor(basePrice).toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß</div>
                        <div>‚Ä¢ ÏßÄÏó≠ ÌäπÏÑ±: ${getRegionFeature(region.name)}</div>
                        <div>‚Ä¢ ÏÉÅÌÉú: ${region.available > 0 ? 'Íµ¨Îß§ Í∞ÄÎä•' : 'Îß§ÏßÑ'}</div>
                    </div>
                `;
                
                if (region.available > 0) {
                    regionCard.onclick = () => openLandDetailModal(region);
                }
                
                regionsDiv.appendChild(regionCard);
            });
        }

        function getRegionFeature(regionName) {
            const features = {
                'Í∞ïÎÇ®Íµ¨': 'ÏµúÍ≥†Í∏â ÏÉÅÏóÖÏßÄÍµ¨',
                'ÏÑúÏ¥àÍµ¨': 'ÍµêÏú°/ÏóÖÎ¨¥ Ï§ëÏã¨ÏßÄ',
                'ÏÜ°ÌååÍµ¨': 'Ïã†ÎèÑÏãú Í∞úÎ∞úÏßÄÏó≠',  
                'ÎßàÌè¨Íµ¨': 'IT/Î¨∏Ìôî Î≥µÌï©ÏßÄÏó≠',
                'ÏÑ±ÎèôÍµ¨': 'Ï§ÄÍ∞ïÎÇ® Ïã†Ìù•ÏßÄÏó≠',
                'Í≤ΩÍ∏∞ÎèÑ': 'ÏàòÎèÑÍ∂å Í∑ºÍµê',
                'Ïù∏Ï≤ú': 'Íµ≠Ï†úÍ≥µÌï≠ Ïù∏Í∑º',
                'ÏßÄÎ∞©': 'Í∞úÎ∞ú Ïû†Ïû¨Î†• ÏßÄÏó≠'
            };
            return features[regionName] || 'ÏùºÎ∞ò ÏßÄÏó≠';
        }

        function openLandDetailModal(region) {
            selectedRegion = region;
            currentLandSize = 1000;
            
            document.getElementById('landDetailTitle').textContent = `${region.name} ÌÜ†ÏßÄ Íµ¨Îß§`;
            document.getElementById('landSizeSlider').value = currentLandSize;
            document.getElementById('landSizeSlider').max = Math.min(50000, region.available);
            document.getElementById('landSizeSlider').min = Math.min(1000, region.available);
            
            updateLandCalculation();
            document.getElementById('landModal').style.display = 'none';
            document.getElementById('landDetailModal').style.display = 'flex';
        }

        function updateLandCalculation() {
            if (!selectedRegion) return;
            
            currentLandSize = parseInt(document.getElementById('landSizeSlider').value);
            document.getElementById('selectedLandSize').textContent = `${currentLandSize}Ìèâ`;
            
            // Ìù¨ÏÜåÏÑ± ÌîÑÎ¶¨ÎØ∏ÏóÑ Í≥ÑÏÇ∞ (Î¨¥Ï†úÌïú)
            const occupancyRate = (selectedRegion.total - selectedRegion.available) / selectedRegion.total;
            const scarcityMultiplier = 1 + Math.pow(occupancyRate, 2) * 10; // Î¨¥Ï†úÌïú Í∏∞ÌïòÍ∏âÏàòÏ†Å ÏÉÅÏäπ
            
            // Í∞ÄÍ≤© Í≥ÑÏÇ∞
            const basePrice = gameState.landMarket.landPricePerUnit * currentLandSize;
            const regionPrice = basePrice * (selectedRegion.priceMultiplier - 1);
            const scarcityPrice = basePrice * (scarcityMultiplier - 1);
            const totalPrice = basePrice + regionPrice + scarcityPrice;
            
            // UI ÏóÖÎç∞Ïù¥Ìä∏
            document.getElementById('landBasePrice').textContent = `${basePrice.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß`;
            document.getElementById('landRegionPrice').textContent = `+${regionPrice.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß`;
            document.getElementById('landScarcityPrice').textContent = `+${scarcityPrice.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß`;
            document.getElementById('landTotalPrice').textContent = `${Math.floor(totalPrice).toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß`;
            
            // Íµ¨Îß§ Í∞ÄÎä• Ïó¨Î∂Ä ÌôïÏù∏
            const canAfford = gameState.currentUser.game_balance >= totalPrice;
            const purchaseBtn = document.getElementById('landPurchaseBtn');
            purchaseBtn.disabled = !canAfford || currentLandSize > selectedRegion.available;
            purchaseBtn.textContent = !canAfford ? 'ÏûêÍ∏à Î∂ÄÏ°±' : 
                                    currentLandSize > selectedRegion.available ? 'ÌÜ†ÏßÄ Î∂ÄÏ°±' : 'Íµ¨Îß§ÌïòÍ∏∞';
            purchaseBtn.className = canAfford && currentLandSize <= selectedRegion.available ? 'btn' : 'btn btn-secondary';
            
            // ÌÜ†ÏßÄ Ï†ïÎ≥¥ ÏóÖÎç∞Ïù¥Ìä∏
            document.getElementById('landDetailInfo').innerHTML = `
                <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                    <span>ÏßÄÏó≠:</span>
                    <span style="font-weight: bold;">${selectedRegion.name}</span>
                </div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                    <span>Íµ¨Îß§ ÌèâÏàò:</span>
                    <span style="font-weight: bold;">${currentLandSize.toLocaleString()}Ìèâ</span>
                </div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                    <span>ÎÇ®ÏùÄ ÌÜ†ÏßÄ:</span>
                    <span>${selectedRegion.available.toLocaleString()}Ìèâ</span>
                </div>
                <div style="display: flex; justify-content: space-between;">
                    <span>Ï†êÏú†Ïú®:</span>
                    <span>${((selectedRegion.total - selectedRegion.available) / selectedRegion.total * 100).toFixed(1)}%</span>
                </div>
            `;
        }

        function confirmLandPurchase() {
            if (!selectedRegion || currentLandSize > selectedRegion.available) return;
            
            // Í∞ÄÍ≤© Ïû¨Í≥ÑÏÇ∞ (Î¨¥Ï†úÌïú Ìù¨ÏÜåÏÑ±)
            const occupancyRate = (selectedRegion.total - selectedRegion.available) / selectedRegion.total;
            const scarcityMultiplier = 1 + Math.pow(occupancyRate, 2) * 10;
            const basePrice = gameState.landMarket.landPricePerUnit * currentLandSize;
            const totalPrice = basePrice * selectedRegion.priceMultiplier * scarcityMultiplier;
            
            if (gameState.currentUser.game_balance < totalPrice) {
                showNotification('ÌÜ†ÏßÄ Íµ¨Îß§ ÏûêÍ∏àÏù¥ Î∂ÄÏ°±Ìï©ÎãàÎã§', 'error');
                return;
            }
            
            // ÌÜ†ÏßÄ Íµ¨Îß§ Ï≤òÎ¶¨
            gameState.currentUser.game_balance -= Math.floor(totalPrice);
            selectedRegion.available -= currentLandSize;
            
            // ÌÜ†ÏßÄ ÏàòÏùµÎ•† Í≥ÑÏÇ∞ (ÏßÄÏó≠Í≥º Ìù¨ÏÜåÏÑ±Ïóê Îî∞Îùº)
            const baseReturn = (Math.random() * 0.60) - 0.10; // -10~50%
            const regionBonus = (selectedRegion.priceMultiplier - 1) * 0.1; // ÏßÄÏó≠ Î≥¥ÎÑàÏä§
            const scarcityBonus = occupancyRate * 0.2; // Ìù¨ÏÜåÏÑ± Î≥¥ÎÑàÏä§
            const totalReturn = baseReturn + regionBonus + scarcityBonus;
            
            const landInvestment = {
                type: 'realestate',
                subType: 'land',
                name: `üèûÔ∏è ${selectedRegion.name} ÌÜ†ÏßÄ`,
                region: selectedRegion.name,
                size: currentLandSize,
                amount: Math.floor(totalPrice),
                returnRate: totalReturn,
                dividends: totalReturn > 0.1 ? Math.floor(totalPrice * 0.01) : 0,
                riskFactor: 2.0,
                originalReturnRate: totalReturn,
                landData: {
                    region: selectedRegion.name,
                    size: currentLandSize,
                    purchasePrice: Math.floor(totalPrice)
                }
            };
            
            // Ìà¨Ïûê ID Ï∂îÍ∞Ä
            landInvestment.investmentId = Date.now() + Math.random();
            
            gameState.roleData.investments.push(landInvestment);
            
            updateInvestmentDisplay();
            updateDisplay();
            closeLandDetailModal();
            
            const resultMessage = totalReturn < 0 ? 
                `${selectedRegion.name} ÌÜ†ÏßÄ Ìà¨ÏûêÍ∞Ä ÏÜêÏã§ÏùÑ Î≥¥Í≥† ÏûàÏäµÎãàÎã§. (${(totalReturn * 100).toFixed(1)}%)` :
                `${selectedRegion.name} ÌÜ†ÏßÄ ${currentLandSize}ÌèâÏùÑ ÏÑ±Í≥µÏ†ÅÏúºÎ°ú Íµ¨Îß§ÌñàÏäµÎãàÎã§! (ÏàòÏùµÎ•†: ${(totalReturn * 100).toFixed(1)}%)`;
            
            showNotification(resultMessage, totalReturn < 0 ? 'warning' : 'success');
            
            // ÌÜ†ÏßÄ ÏãúÏû• ÌòÑÌô© ÏóÖÎç∞Ïù¥Ìä∏
            updateLandMarketDisplay();
        }

        // AI ÌÜ†ÏßÄ Íµ¨Îß§ ÏãúÎÆ¨Î†àÏù¥ÏÖò (Îã§Î•∏ Ìà¨ÏûêÏûêÎì§Ïùò ÌÜ†ÏßÄ Íµ¨Îß§)
        function simulateLandMarket() {
            // Ïã†Í∑ú ÌÜ†ÏßÄ Íµ¨Îß§
            gameState.landMarket.regions.forEach(region => {
                if (region.available > 0 && Math.random() < 0.02) { // 2% ÌôïÎ•†Î°ú AIÍ∞Ä Íµ¨Îß§
                    const aiPurchaseSize = Math.min(
                        Math.floor(Math.random() * 2000) + 1000, // 1000~3000Ìèâ
                        region.available
                    );
                    region.available -= aiPurchaseSize;
                    
                    if (Math.random() < 0.1) { // 10% ÌôïÎ•†Î°ú ÏïåÎ¶º
                        showNotification(`Îã§Î•∏ Ìà¨ÏûêÏûêÍ∞Ä ${region.name}ÏóêÏÑú ${aiPurchaseSize}ÌèâÏùÑ Íµ¨Îß§ÌñàÏäµÎãàÎã§`, 'info');
                    }
                }
            });
            
            // AIÍ∞Ä Îß§Îß§ ÏãúÏû•Ïóê ÌÜ†ÏßÄ Ïò¨Î¶¨Í∏∞
            if (Math.random() < 0.05) { // 5% ÌôïÎ•†
                generateAILandSale();
            }
            
            // AIÍ∞Ä Îß§Îß§ ÏãúÏû•ÏóêÏÑú ÌÜ†ÏßÄ Íµ¨Îß§ÌïòÍ∏∞
            if (gameState.landMarket.marketplace.length > 0 && Math.random() < 0.03) { // 3% ÌôïÎ•†
                const randomLand = gameState.landMarket.marketplace[Math.floor(Math.random() * gameState.landMarket.marketplace.length)];
                if (randomLand && !randomLand.isPlayerOwned) {
                    purchaseLandFromMarketplace(randomLand, true);
                }
            }
        }

        // ÌÜ†ÏßÄ Îß§Îß§ ÏãúÏû• Ìï®ÏàòÎì§
        let selectedLandForSale = null;

        function openLandMarketplace() {
            updateMarketplace();
            document.getElementById('landMarketplaceModal').style.display = 'flex';
            showMarketplaceBuy();
        }

        function closeLandMarketplace() {
            document.getElementById('landMarketplaceModal').style.display = 'none';
        }

        function showMarketplaceBuy() {
            document.getElementById('marketplaceBuyBtn').className = 'btn';
            document.getElementById('marketplaceSellBtn').className = 'btn btn-secondary';
            document.getElementById('marketplaceBuySection').style.display = 'block';
            document.getElementById('marketplaceSellSection').style.display = 'none';
            updateMarketplaceBuyList();
        }

        function showMarketplaceSell() {
            document.getElementById('marketplaceBuyBtn').className = 'btn btn-secondary';
            document.getElementById('marketplaceSellBtn').className = 'btn';
            document.getElementById('marketplaceBuySection').style.display = 'none';
            document.getElementById('marketplaceSellSection').style.display = 'block';
            updateMarketplaceSellList();
        }

        function updateMarketplace() {
            updateMarketplaceBuyList();
            updateMarketplaceSellList();
        }

        function updateMarketplaceBuyList() {
            const buyListDiv = document.getElementById('landForSaleList');
            buyListDiv.innerHTML = '';

            if (gameState.landMarket.marketplace.length === 0) {
                buyListDiv.innerHTML = '<p style="text-align: center; color: #64748b; padding: 20px;">Îß§Îß§ ÏãúÏû•Ïóê Ïò¨ÎùºÏò® ÌÜ†ÏßÄÍ∞Ä ÏóÜÏäµÎãàÎã§</p>';
                return;
            }

            gameState.landMarket.marketplace.forEach((land, index) => {
                const landCard = document.createElement('div');
                landCard.className = 'business-card';
                landCard.style.marginBottom = '15px';
                
                const profitMargin = ((land.salePrice - land.originalPrice) / land.originalPrice * 100).toFixed(1);
                const profitColor = profitMargin >= 0 ? 'var(--success)' : 'var(--danger)';
                const sellerType = land.isPlayerOwned ? '(ÎÇò)' : '(Îã§Î•∏ Ìà¨ÏûêÏûê)';
                const canBuy = !land.isPlayerOwned && gameState.currentUser.game_balance >= land.salePrice;
                
                landCard.innerHTML = `
                    <div class="business-header">
                        <div class="business-name">${land.name} ${land.size.toLocaleString()}Ìèâ</div>
                        <div style="color: var(--warning);">${land.salePrice.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß</div>
                    </div>
                    <div style="font-size: 0.9rem; color: #94a3b8; margin: 10px 0;">
                        <div>‚Ä¢ ÏßÄÏó≠: ${land.region} | ÌèâÎãπ: ${Math.floor(land.salePrice / land.size).toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß</div>
                        <div>‚Ä¢ ÌåêÎß§Ïûê: ${land.sellerName} ${sellerType}</div>
                        <div>‚Ä¢ Íµ¨Îß§Í∞Ä ÎåÄÎπÑ: <span style="color: ${profitColor};">${profitMargin >= 0 ? '+' : ''}${profitMargin}%</span></div>
                        <div>‚Ä¢ ÏàòÏùµÎ•†: ${(land.currentReturn * 100).toFixed(1)}%</div>
                    </div>
                    ${land.isPlayerOwned ? 
                        '<div style="text-align: center; color: #64748b;">ÎÇ¥Í∞Ä ÌåêÎß§Ï§ëÏù∏ ÌÜ†ÏßÄ</div>' :
                        `<button class="btn ${canBuy ? '' : 'btn-secondary'}" 
                                onclick="purchaseLandFromMarketplace(gameState.landMarket.marketplace[${index}])"
                                ${canBuy ? '' : 'disabled'}>
                            ${canBuy ? 'Íµ¨Îß§ÌïòÍ∏∞' : 'ÏûêÍ∏à Î∂ÄÏ°±'}
                        </button>`
                    }
                `;
                
                buyListDiv.appendChild(landCard);
            });
        }

        function updateMarketplaceSellList() {
            const sellListDiv = document.getElementById('myLandList');
            sellListDiv.innerHTML = '';

            const myLands = gameState.roleData.investments.filter(inv => 
                inv.type === 'realestate' && inv.subType === 'land'
            );

            if (myLands.length === 0) {
                sellListDiv.innerHTML = '<p style="text-align: center; color: #64748b; padding: 20px;">Î≥¥Ïú†Ìïú ÌÜ†ÏßÄÍ∞Ä ÏóÜÏäµÎãàÎã§</p>';
                return;
            }

            myLands.forEach((land, index) => {
                const isOnSale = gameState.landMarket.marketplace.some(m => m.originalInvestmentId === land.investmentId);
                const currentMarketPrice = calculateCurrentLandValue(land);
                const profitLoss = ((currentMarketPrice - land.amount) / land.amount * 100).toFixed(1);
                const profitColor = profitLoss >= 0 ? 'var(--success)' : 'var(--danger)';
                
                const landCard = document.createElement('div');
                landCard.className = 'business-card';
                landCard.style.marginBottom = '15px';
                
                landCard.innerHTML = `
                    <div class="business-header">
                        <div class="business-name">${land.name} ${land.landData.size.toLocaleString()}Ìèâ</div>
                        <div style="color: ${profitColor};">${profitLoss >= 0 ? '+' : ''}${profitLoss}%</div>
                    </div>
                    <div style="font-size: 0.9rem; color: #94a3b8; margin: 10px 0;">
                        <div>‚Ä¢ Íµ¨Îß§Í∞Ä: ${land.amount.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß</div>
                        <div>‚Ä¢ ÌòÑÏû¨Í∞Ä: ${currentMarketPrice.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß</div>
                        <div>‚Ä¢ ÏàòÏùµÎ•†: ${(land.returnRate * 100).toFixed(1)}%</div>
                        <div>‚Ä¢ ÏõîÏàòÏùµ: ${land.dividends.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß</div>
                    </div>
                    <button class="btn ${isOnSale ? 'btn-secondary' : ''}" 
                            onclick="${isOnSale ? 'removeLandFromMarketplace' : 'openLandSaleModal'}(${index})"
                            ${isOnSale ? '' : ''}>
                        ${isOnSale ? 'ÌåêÎß§ Ï∑®ÏÜå' : 'Îß§ÎèÑÌïòÍ∏∞'}
                    </button>
                `;
                
                sellListDiv.appendChild(landCard);
            });
        }

        function calculateCurrentLandValue(land) {
            const region = gameState.landMarket.regions.find(r => r.name === land.landData.region);
            if (!region) return land.amount;
            
            const occupancyRate = (region.total - region.available) / region.total;
            const scarcityMultiplier = 1 + Math.pow(occupancyRate, 2) * 10; // Î¨¥Ï†úÌïú Ìù¨ÏÜåÏÑ±
            const basePrice = gameState.landMarket.landPricePerUnit * land.landData.size;
            
            return Math.floor(basePrice * region.priceMultiplier * scarcityMultiplier);
        }

        function openLandSaleModal(landIndex) {
            const land = gameState.roleData.investments.filter(inv => 
                inv.type === 'realestate' && inv.subType === 'land'
            )[landIndex];
            
            selectedLandForSale = { ...land, investmentIndex: landIndex };
            
            const currentMarketPrice = calculateCurrentLandValue(land);
            
            document.getElementById('salePriceSlider').value = 100;
            updateSalePrice();
            
            document.getElementById('saleItemInfo').innerHTML = `
                <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                    <span>ÌÜ†ÏßÄ:</span>
                    <span style="font-weight: bold;">${land.name}</span>
                </div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                    <span>ÌèâÏàò:</span>
                    <span>${land.landData.size.toLocaleString()}Ìèâ</span>
                </div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                    <span>ÏßÄÏó≠:</span>
                    <span>${land.landData.region}</span>
                </div>
                <div style="display: flex; justify-content: space-between;">
                    <span>Î≥¥Ïú†Í∏∞Í∞Ñ:</span>
                    <span>Íµ¨Îß§ ÌõÑ Í≥ÑÏÜç</span>
                </div>
            `;
            
            document.getElementById('originalPurchasePrice').textContent = `${land.amount.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß`;
            document.getElementById('currentMarketPrice').textContent = `${currentMarketPrice.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß`;
            
            document.getElementById('landSaleModal').style.display = 'flex';
        }

        function closeLandSaleModal() {
            document.getElementById('landSaleModal').style.display = 'none';
            selectedLandForSale = null;
        }

        function updateSalePrice() {
            if (!selectedLandForSale) return;
            
            const pricePercent = parseInt(document.getElementById('salePriceSlider').value);
            const currentMarketPrice = calculateCurrentLandValue(selectedLandForSale);
            const salePrice = Math.floor(currentMarketPrice * (pricePercent / 100));
            const profit = salePrice - selectedLandForSale.amount;
            
            document.getElementById('salePricePercent').textContent = `${pricePercent}% ${
                pricePercent < 50 ? '(Ìè≠ÌÉÑÏÑ∏Ïùº)' : 
                pricePercent < 80 ? '(Í∏âÎß§)' : 
                pricePercent <= 120 ? '(Ï†ÅÏ†ïÍ∞Ä)' :
                pricePercent <= 300 ? '(ÌîÑÎ¶¨ÎØ∏ÏóÑ)' :
                pricePercent <= 500 ? '(Í≥†Í∞Ä)' : '(Ìà¨Í∏∞Í∞ÄÍ≤©)'
            }`;
            document.getElementById('finalSalePrice').textContent = `${salePrice.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß`;
            document.getElementById('expectedProfit').textContent = `${profit >= 0 ? '+' : ''}${profit.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß`;
            document.getElementById('expectedProfit').style.color = profit >= 0 ? 'var(--success)' : 'var(--danger)';
        }

        function confirmLandSale() {
            if (!selectedLandForSale) return;
            
            const pricePercent = parseInt(document.getElementById('salePriceSlider').value);
            const currentMarketPrice = calculateCurrentLandValue(selectedLandForSale);
            const salePrice = Math.floor(currentMarketPrice * (pricePercent / 100));
            
            // ÏãúÏû•Ïóê ÌÜ†ÏßÄ Îì±Î°ù
            const marketListing = {
                id: Date.now(),
                name: selectedLandForSale.name,
                region: selectedLandForSale.landData.region,
                size: selectedLandForSale.landData.size,
                originalPrice: selectedLandForSale.amount,
                salePrice: salePrice,
                currentReturn: selectedLandForSale.returnRate,
                sellerName: gameState.currentUser.username || 'ÏùµÎ™Ö',
                isPlayerOwned: true,
                originalInvestmentId: selectedLandForSale.investmentId || Date.now(),
                landData: selectedLandForSale.landData
            };
            
            gameState.landMarket.marketplace.push(marketListing);
            
            closeLandSaleModal();
            updateMarketplace();
            showNotification(`${selectedLandForSale.name} ${selectedLandForSale.landData.size}ÌèâÏùÑ ${salePrice.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîßÏóê Îß§ÎèÑ Îì±Î°ùÌñàÏäµÎãàÎã§`, 'success');
        }

        function purchaseLandFromMarketplace(land, isAI = false) {
            if (!isAI && gameState.currentUser.game_balance < land.salePrice) {
                showNotification('ÌÜ†ÏßÄ Íµ¨Îß§ ÏûêÍ∏àÏù¥ Î∂ÄÏ°±Ìï©ÎãàÎã§', 'error');
                return;
            }
            
            if (!isAI && land.isPlayerOwned) {
                showNotification('Î≥∏Ïù∏Ïù¥ ÌåêÎß§Ï§ëÏù∏ ÌÜ†ÏßÄÎäî Íµ¨Îß§Ìï† Ïàò ÏóÜÏäµÎãàÎã§', 'error');
                return;
            }
            
            if (!isAI) {
                // ÌîåÎ†àÏù¥Ïñ¥Í∞Ä Íµ¨Îß§ÌïòÎäî Í≤ΩÏö∞
                gameState.currentUser.game_balance -= land.salePrice;
                
                // Ìà¨Ïûê Ìè¨Ìä∏Ìè¥Î¶¨Ïò§Ïóê Ï∂îÍ∞Ä
                const newLandInvestment = {
                    type: 'realestate',
                    subType: 'land',
                    name: land.name,
                    region: land.region,
                    size: land.size,
                    amount: land.salePrice,
                    returnRate: land.currentReturn,
                    dividends: land.currentReturn > 0.1 ? Math.floor(land.salePrice * 0.01) : 0,
                    riskFactor: 2.0,
                    originalReturnRate: land.currentReturn,
                    landData: land.landData,
                    investmentId: Date.now()
                };
                
                gameState.roleData.investments.push(newLandInvestment);
                updateInvestmentDisplay();
                updateDisplay();
                
                showNotification(`${land.name} ${land.size}ÌèâÏùÑ ${land.salePrice.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîßÏóê Íµ¨Îß§ÌñàÏäµÎãàÎã§!`, 'success');
            }
            
            // ÏãúÏû•ÏóêÏÑú Ï†úÍ±∞
            const marketIndex = gameState.landMarket.marketplace.findIndex(m => m.id === land.id);
            if (marketIndex !== -1) {
                gameState.landMarket.marketplace.splice(marketIndex, 1);
            }
            
            // ÌåêÎß§ÏûêÍ∞Ä ÌîåÎ†àÏù¥Ïñ¥Ïù∏ Í≤ΩÏö∞ ÏàòÏùµÍ∏à ÏßÄÍ∏â
            if (land.isPlayerOwned && !isAI) {
                gameState.currentUser.game_balance += land.salePrice;
                
                // Ìà¨Ïûê Ìè¨Ìä∏Ìè¥Î¶¨Ïò§ÏóêÏÑú Ìï¥Îãπ ÌÜ†ÏßÄ Ï†úÍ±∞
                const investmentIndex = gameState.roleData.investments.findIndex(inv => 
                    inv.investmentId === land.originalInvestmentId
                );
                if (investmentIndex !== -1) {
                    gameState.roleData.investments.splice(investmentIndex, 1);
                }
                
                const profit = land.salePrice - land.originalPrice;
                showNotification(`ÌÜ†ÏßÄ Îß§ÎèÑ ÏôÑÎ£å! ${profit >= 0 ? '+' : ''}${profit.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß ${profit >= 0 ? 'ÏàòÏùµ' : 'ÏÜêÏã§'}`, profit >= 0 ? 'success' : 'warning');
                updateInvestmentDisplay();
                updateDisplay();
            }
            
            updateMarketplace();
        }

        function generateAILandSale() {
            const regions = gameState.landMarket.regions;
            const randomRegion = regions[Math.floor(Math.random() * regions.length)];
            const size = Math.floor(Math.random() * 15000) + 1000; // 1000~16000Ìèâ (ÎåÄÌòï ÌÜ†ÏßÄ Ìè¨Ìï®)
            const occupancyRate = (randomRegion.total - randomRegion.available) / randomRegion.total;
            const scarcityMultiplier = 1 + Math.pow(occupancyRate, 2) * 10; // Î¨¥Ï†úÌïú Ìù¨ÏÜåÏÑ±
            const basePrice = gameState.landMarket.landPricePerUnit * size;
            const originalPrice = Math.floor(basePrice * randomRegion.priceMultiplier * (0.8 + Math.random() * 0.4));
            const currentPrice = Math.floor(basePrice * randomRegion.priceMultiplier * scarcityMultiplier);
            const salePrice = Math.floor(currentPrice * (0.3 + Math.random() * 4)); // 30~430% Í∞ÄÍ≤© (Ìà¨Í∏∞Ï†Å Î≥ÄÎèô)
            
            const aiLand = {
                id: Date.now() + Math.random(),
                name: `üèûÔ∏è ${randomRegion.name} ÌÜ†ÏßÄ`,
                region: randomRegion.name,
                size: size,
                originalPrice: originalPrice,
                salePrice: salePrice,
                currentReturn: (Math.random() * 0.6) - 0.1,
                sellerName: ['ÌÜ†ÏßÄÏôï', 'Î∂ÄÎèôÏÇ∞Ìà¨ÏûêÏûê', 'Í∞úÎ∞úÏóÖÏ≤¥', 'AIÌà¨ÏûêÏûê'][Math.floor(Math.random() * 4)],
                isPlayerOwned: false,
                landData: { region: randomRegion.name, size: size }
            };
            
            gameState.landMarket.marketplace.push(aiLand);
        }

        function removeLandFromMarketplace(landIndex) {
            const myLands = gameState.roleData.investments.filter(inv => 
                inv.type === 'realestate' && inv.subType === 'land'
            );
            const land = myLands[landIndex];
            
            if (!land) return;
            
            // ÏãúÏû•ÏóêÏÑú Ìï¥Îãπ ÌÜ†ÏßÄ Ï†úÍ±∞
            const marketIndex = gameState.landMarket.marketplace.findIndex(m => 
                m.originalInvestmentId === land.investmentId && m.isPlayerOwned
            );
            
            if (marketIndex !== -1) {
                gameState.landMarket.marketplace.splice(marketIndex, 1);
                updateMarketplace();
                showNotification(`${land.name} Îß§ÎèÑÎ•º Ï∑®ÏÜåÌñàÏäµÎãàÎã§`, 'info');
            }
        }

        // Ìà¨Ïûê ÏãúÏû• Î≥ÄÏàò
        let selectedInvestment = null;

        // Ï£ºÏãù ÏãúÏû• Ìï®ÏàòÎì§
        function openStockMarket() {
            const stockCategories = {
                'tech': [
                    // ÌïúÍµ≠ IT/ÌÖåÌÅ¨ (25Í∞ú)
                    { name: 'ÏÇºÏÑ±Ï†ÑÏûê', price: 68500, change: '+1.25%', trend: 'up', dividend: 2.8, sector: 'tech' },
                    { name: 'SKÌïòÏù¥ÎãâÏä§', price: 125000, change: '+2.15%', trend: 'up', dividend: 1.5, sector: 'tech' },
                    { name: 'NAVER', price: 185000, change: '-0.85%', trend: 'down', dividend: 0.8, sector: 'tech' },
                    { name: 'Ïπ¥Ïπ¥Ïò§', price: 58500, change: '+3.45%', trend: 'up', dividend: 1.2, sector: 'tech' },
                    { name: 'LGÏ†ÑÏûê', price: 95000, change: '+1.85%', trend: 'up', dividend: 3.2, sector: 'tech' },
                    { name: 'LGÎîîÏä§ÌîåÎ†àÏù¥', price: 15200, change: '+4.25%', trend: 'up', dividend: 2.1, sector: 'tech' },
                    { name: 'ÏÇºÏÑ±SDI', price: 485000, change: '+2.85%', trend: 'up', dividend: 1.8, sector: 'tech' },
                    { name: 'SKÌÖîÎ†àÏΩ§', price: 52500, change: '+0.95%', trend: 'up', dividend: 4.5, sector: 'tech' },
                    { name: 'KT', price: 28500, change: '+1.15%', trend: 'up', dividend: 5.2, sector: 'tech' },
                    { name: 'LGÏú†ÌîåÎü¨Ïä§', price: 12800, change: '+0.75%', trend: 'up', dividend: 6.8, sector: 'tech' },
                    { name: 'ÎÑ§Ïò§ÏúÑÏ¶à', price: 18500, change: '+8.25%', trend: 'up', dividend: 1.5, sector: 'tech' },
                    { name: 'NHN', price: 35500, change: '+5.15%', trend: 'up', dividend: 2.8, sector: 'tech' },
                    { name: 'ÎÑ•Ïä®', price: 68500, change: '+3.85%', trend: 'up', dividend: 2.2, sector: 'tech' },
                    { name: 'NCÏÜåÌîÑÌä∏', price: 485000, change: '+4.25%', trend: 'up', dividend: 1.8, sector: 'tech' },
                    { name: 'ÌéÑÏñ¥ÎπÑÏä§', price: 42500, change: '+6.85%', trend: 'up', dividend: 1.2, sector: 'tech' },
                    { name: 'ÌÅ¨ÎûòÌîÑÌÜ§', price: 185000, change: '+2.45%', trend: 'up', dividend: 1.5, sector: 'tech' },
                    { name: 'Ïª¥Ìà¨Ïä§', price: 68500, change: '+7.25%', trend: 'up', dividend: 2.1, sector: 'tech' },
                    { name: 'ÏúÑÎ©îÏù¥Îìú', price: 42500, change: '+9.85%', trend: 'up', dividend: 1.8, sector: 'tech' },
                    { name: 'ÏóîÏî®ÏÜåÌîÑÌä∏', price: 285000, change: '+3.15%', trend: 'up', dividend: 2.5, sector: 'tech' },
                    { name: 'SKÏä§ÌÄòÏñ¥', price: 48500, change: '+2.85%', trend: 'up', dividend: 2.8, sector: 'tech' },
                    { name: 'Ïø†Ìå°', price: 16500, change: '+4.25%', trend: 'up', dividend: 0.0, sector: 'tech' },
                    { name: 'Î∞∞Îã¨ÏùòÎØºÏ°±', price: 125000, change: '+3.45%', trend: 'up', dividend: 1.2, sector: 'tech' },
                    { name: 'ÌÜ†Ïä§', price: 68500, change: '+5.85%', trend: 'up', dividend: 0.8, sector: 'tech' },
                    { name: 'ÎãπÍ∑ºÎßàÏºì', price: 45000, change: '+6.25%', trend: 'up', dividend: 0.0, sector: 'tech' },
                    { name: 'ÏïºÎÜÄÏûê', price: 28500, change: '+4.15%', trend: 'up', dividend: 1.5, sector: 'tech' },
                    
                    // Í∏ÄÎ°úÎ≤å IT/ÌÖåÌÅ¨ (25Í∞ú)
                    { name: 'Apple', price: 175.25, change: '+1.85%', trend: 'up', dividend: 0.5, sector: 'tech' },
                    { name: 'Microsoft', price: 425.80, change: '+2.15%', trend: 'up', dividend: 0.7, sector: 'tech' },
                    { name: 'Google', price: 142.50, change: '+1.65%', trend: 'up', dividend: 0.0, sector: 'tech' },
                    { name: 'Amazon', price: 155.40, change: '+2.85%', trend: 'up', dividend: 0.0, sector: 'tech' },
                    { name: 'Tesla', price: 248.50, change: '+4.25%', trend: 'up', dividend: 0.0, sector: 'tech' },
                    { name: 'NVIDIA', price: 485.75, change: '+6.85%', trend: 'up', dividend: 0.4, sector: 'tech' },
                    { name: 'Meta', price: 325.60, change: '+3.45%', trend: 'up', dividend: 0.0, sector: 'tech' },
                    { name: 'Netflix', price: 485.20, change: '+2.25%', trend: 'up', dividend: 0.0, sector: 'tech' },
                    { name: 'Adobe', price: 625.80, change: '+1.95%', trend: 'up', dividend: 0.0, sector: 'tech' },
                    { name: 'Salesforce', price: 285.40, change: '+2.65%', trend: 'up', dividend: 0.0, sector: 'tech' },
                    { name: 'Oracle', price: 125.60, change: '+1.45%', trend: 'up', dividend: 1.8, sector: 'tech' },
                    { name: 'Intel', price: 48.25, change: '+2.85%', trend: 'up', dividend: 2.5, sector: 'tech' },
                    { name: 'AMD', price: 125.80, change: '+4.15%', trend: 'up', dividend: 0.0, sector: 'tech' },
                    { name: 'Qualcomm', price: 148.50, change: '+3.25%', trend: 'up', dividend: 2.1, sector: 'tech' },
                    { name: 'Broadcom', price: 985.40, change: '+2.45%', trend: 'up', dividend: 1.9, sector: 'tech' },
                    { name: 'IBM', price: 185.20, change: '+1.85%', trend: 'up', dividend: 3.8, sector: 'tech' },
                    { name: 'Cisco', price: 52.80, change: '+1.65%', trend: 'up', dividend: 2.9, sector: 'tech' },
                    { name: 'ServiceNow', price: 745.60, change: '+3.85%', trend: 'up', dividend: 0.0, sector: 'tech' },
                    { name: 'Snowflake', price: 185.40, change: '+5.25%', trend: 'up', dividend: 0.0, sector: 'tech' },
                    { name: 'Palantir', price: 18.25, change: '+8.45%', trend: 'up', dividend: 0.0, sector: 'tech' },
                    { name: 'CrowdStrike', price: 285.60, change: '+6.85%', trend: 'up', dividend: 0.0, sector: 'tech' },
                    { name: 'Zoom', price: 68.25, change: '+4.15%', trend: 'up', dividend: 0.0, sector: 'tech' },
                    { name: 'Slack', price: 28.50, change: '+3.85%', trend: 'up', dividend: 0.0, sector: 'tech' },
                    { name: 'Shopify', price: 85.40, change: '+5.65%', trend: 'up', dividend: 0.0, sector: 'tech' },
                    { name: 'Unity', price: 42.80, change: '+7.25%', trend: 'up', dividend: 0.0, sector: 'tech' }
                ],
                
                'finance': [
                    // ÌïúÍµ≠ Í∏àÏúµ (25Í∞ú)
                    { name: 'KBÍ∏àÏúµ', price: 58500, change: '+1.85%', trend: 'up', dividend: 4.5, sector: 'finance' },
                    { name: 'Ïã†ÌïúÍ∏àÏúµÏßÄÏ£º', price: 42500, change: '+2.15%', trend: 'up', dividend: 4.8, sector: 'finance' },
                    { name: 'ÌïòÎÇòÍ∏àÏúµÏßÄÏ£º', price: 48500, change: '+1.65%', trend: 'up', dividend: 4.2, sector: 'finance' },
                    { name: 'Ïö∞Î¶¨Í∏àÏúµÏßÄÏ£º', price: 15200, change: '+2.85%', trend: 'up', dividend: 5.2, sector: 'finance' },
                    { name: 'NHÌà¨ÏûêÏ¶ùÍ∂å', price: 12800, change: '+3.45%', trend: 'up', dividend: 3.8, sector: 'finance' },
                    { name: 'ÎØ∏ÎûòÏóêÏÖãÏ¶ùÍ∂å', price: 8500, change: '+4.25%', trend: 'up', dividend: 4.1, sector: 'finance' },
                    { name: 'ÏÇºÏÑ±Ï¶ùÍ∂å', price: 42500, change: '+2.45%', trend: 'up', dividend: 3.5, sector: 'finance' },
                    { name: 'ÌïúÍµ≠Ìà¨ÏûêÏ¶ùÍ∂å', price: 3850, change: '+3.85%', trend: 'up', dividend: 4.8, sector: 'finance' },
                    { name: 'DBÍ∏àÏúµÌà¨Ïûê', price: 3250, change: '+2.65%', trend: 'up', dividend: 4.5, sector: 'finance' },
                    { name: 'ÌÇ§ÏõÄÏ¶ùÍ∂å', price: 125000, change: '+1.95%', trend: 'up', dividend: 2.8, sector: 'finance' },
                    { name: 'ÍµêÎ≥¥Ï¶ùÍ∂å', price: 8500, change: '+2.25%', trend: 'up', dividend: 4.2, sector: 'finance' },
                    { name: 'Ïã†ÏòÅÏ¶ùÍ∂å', price: 5850, change: '+3.15%', trend: 'up', dividend: 5.1, sector: 'finance' },
                    { name: 'Ïú†ÏïàÌÉÄÏ¶ùÍ∂å', price: 3250, change: '+2.85%', trend: 'up', dividend: 4.8, sector: 'finance' },
                    { name: 'IBKÌà¨ÏûêÏ¶ùÍ∂å', price: 2850, change: '+4.15%', trend: 'up', dividend: 5.5, sector: 'finance' },
                    { name: 'ÌïòÏù¥Ìà¨ÏûêÏ¶ùÍ∂å', price: 2450, change: '+3.65%', trend: 'up', dividend: 5.8, sector: 'finance' },
                    { name: 'ÏÇºÏÑ±ÏÉùÎ™Ö', price: 85000, change: '+1.45%', trend: 'up', dividend: 3.2, sector: 'finance' },
                    { name: 'ÌïúÌôîÏÉùÎ™Ö', price: 2850, change: '+2.85%', trend: 'up', dividend: 6.5, sector: 'finance' },
                    { name: 'ÍµêÎ≥¥ÏÉùÎ™Ö', price: 8500, change: '+1.95%', trend: 'up', dividend: 4.8, sector: 'finance' },
                    { name: 'DBÏÉùÎ™Ö', price: 85000, change: '+2.15%', trend: 'up', dividend: 3.8, sector: 'finance' },
                    { name: 'ÎèôÏñëÏÉùÎ™Ö', price: 8500, change: '+3.45%', trend: 'up', dividend: 5.2, sector: 'finance' },
                    { name: 'ÏÇºÏÑ±ÌôîÏû¨', price: 285000, change: '+1.85%', trend: 'up', dividend: 2.5, sector: 'finance' },
                    { name: 'DBÏÜêÌï¥Î≥¥Ìóò', price: 48500, change: '+2.65%', trend: 'up', dividend: 4.2, sector: 'finance' },
                    { name: 'ÌïúÌôîÏÜêÌï¥Î≥¥Ìóò', price: 2850, change: '+3.85%', trend: 'up', dividend: 6.8, sector: 'finance' },
                    { name: 'KBÏÜêÌï¥Î≥¥Ìóò', price: 58500, change: '+2.25%', trend: 'up', dividend: 3.5, sector: 'finance' },
                    { name: 'ÌòÑÎåÄÌï¥ÏÉÅ', price: 28500, change: '+2.45%', trend: 'up', dividend: 4.5, sector: 'finance' },
                    
                    // Í∏ÄÎ°úÎ≤å Í∏àÏúµ (25Í∞ú)
                    { name: 'JPMorgan Chase', price: 185.40, change: '+1.85%', trend: 'up', dividend: 2.8, sector: 'finance' },
                    { name: 'Bank of America', price: 35.80, change: '+2.15%', trend: 'up', dividend: 3.2, sector: 'finance' },
                    { name: 'Wells Fargo', price: 48.25, change: '+2.65%', trend: 'up', dividend: 2.9, sector: 'finance' },
                    { name: 'Citigroup', price: 52.60, change: '+3.15%', trend: 'up', dividend: 3.8, sector: 'finance' },
                    { name: 'Goldman Sachs', price: 425.80, change: '+1.95%', trend: 'up', dividend: 2.1, sector: 'finance' },
                    { name: 'Morgan Stanley', price: 95.40, change: '+2.45%', trend: 'up', dividend: 2.5, sector: 'finance' },
                    { name: 'American Express', price: 185.60, change: '+1.75%', trend: 'up', dividend: 1.5, sector: 'finance' },
                    { name: 'Visa', price: 285.20, change: '+1.85%', trend: 'up', dividend: 0.8, sector: 'finance' },
                    { name: 'Mastercard', price: 425.80, change: '+2.25%', trend: 'up', dividend: 0.6, sector: 'finance' },
                    { name: 'PayPal', price: 68.50, change: '+3.45%', trend: 'up', dividend: 0.0, sector: 'finance' },
                    { name: 'Square', price: 85.40, change: '+4.85%', trend: 'up', dividend: 0.0, sector: 'finance' },
                    { name: 'Berkshire Hathaway', price: 485000, change: '+1.25%', trend: 'up', dividend: 0.0, sector: 'finance' },
                    { name: 'BlackRock', price: 825.60, change: '+1.65%', trend: 'up', dividend: 2.4, sector: 'finance' },
                    { name: 'Charles Schwab', price: 68.25, change: '+2.85%', trend: 'up', dividend: 1.8, sector: 'finance' },
                    { name: 'Credit Suisse', price: 2.85, change: '-4.25%', trend: 'down', dividend: 0.0, sector: 'finance' },
                    { name: 'Deutsche Bank', price: 12.50, change: '+2.15%', trend: 'up', dividend: 0.0, sector: 'finance' },
                    { name: 'Barclays', price: 1.85, change: '+1.95%', trend: 'up', dividend: 5.2, sector: 'finance' },
                    { name: 'HSBC', price: 6.45, change: '+2.65%', trend: 'up', dividend: 6.8, sector: 'finance' },
                    { name: 'UBS', price: 18.50, change: '+1.85%', trend: 'up', dividend: 3.5, sector: 'finance' },
                    { name: 'ING Group', price: 14.25, change: '+2.45%', trend: 'up', dividend: 4.2, sector: 'finance' },
                    { name: 'Santander', price: 3.85, change: '+3.15%', trend: 'up', dividend: 7.5, sector: 'finance' },
                    { name: 'BNP Paribas', price: 58.50, change: '+1.75%', trend: 'up', dividend: 3.8, sector: 'finance' },
                    { name: 'Societe Generale', price: 28.40, change: '+2.85%', trend: 'up', dividend: 4.5, sector: 'finance' },
                    { name: 'Lloyds Banking', price: 0.52, change: '+3.45%', trend: 'up', dividend: 4.8, sector: 'finance' },
                    { name: 'Royal Bank of Canada', price: 125.80, change: '+1.65%', trend: 'up', dividend: 3.5, sector: 'finance' }
                ],

                'energy': [
                    // ÌïúÍµ≠ ÏóêÎÑàÏßÄ (25Í∞ú)
                    { name: 'SKÏù¥ÎÖ∏Î≤†Ïù¥ÏÖò', price: 125000, change: '+2.85%', trend: 'up', dividend: 2.5, sector: 'energy' },
                    { name: 'LGÌôîÌïô', price: 485000, change: '+3.45%', trend: 'up', dividend: 1.8, sector: 'energy' },
                    { name: 'ÌïúÌôîÏÜîÎ£®ÏÖò', price: 28500, change: '+4.15%', trend: 'up', dividend: 2.1, sector: 'energy' },
                    { name: 'S-Oil', price: 85000, change: '+3.85%', trend: 'up', dividend: 4.5, sector: 'energy' },
                    { name: 'GS', price: 42500, change: '+2.65%', trend: 'up', dividend: 3.8, sector: 'energy' },
                    { name: 'SKÍ∞ÄÏä§', price: 125000, change: '+1.95%', trend: 'up', dividend: 5.2, sector: 'energy' },
                    { name: 'ÌïúÍµ≠Í∞ÄÏä§Í≥µÏÇ¨', price: 28500, change: '+2.45%', trend: 'up', dividend: 4.8, sector: 'energy' },
                    { name: 'ÌïúÏ†ÑKPS', price: 28500, change: '+3.15%', trend: 'up', dividend: 3.5, sector: 'energy' },
                    { name: 'ÌïúÍµ≠Ï†ÑÎ†•', price: 20500, change: '+1.85%', trend: 'up', dividend: 0.0, sector: 'energy' },
                    { name: 'ÎÇ®ÎèôÎ∞úÏ†Ñ', price: 28500, change: '+2.85%', trend: 'up', dividend: 4.2, sector: 'energy' },
                    { name: 'ÎèôÏÑúÎ∞úÏ†Ñ', price: 20500, change: '+3.45%', trend: 'up', dividend: 4.8, sector: 'energy' },
                    { name: 'ÏÑúÎ∂ÄÎ∞úÏ†Ñ', price: 28500, change: '+2.25%', trend: 'up', dividend: 4.5, sector: 'energy' },
                    { name: 'Ï§ëÎ∂ÄÎ∞úÏ†Ñ', price: 20500, change: '+1.95%', trend: 'up', dividend: 5.1, sector: 'energy' },
                    { name: 'ÌïúÏàòÏõê', price: 28500, change: '+2.65%', trend: 'up', dividend: 3.8, sector: 'energy' },
                    { name: 'ÌïúÍµ≠ÏÑùÏú†Í≥µÏÇ¨', price: 8500, change: '+4.15%', trend: 'up', dividend: 2.5, sector: 'energy' },
                    { name: 'SKÏóêÎÑàÏßÄ', price: 185000, change: '+3.85%', trend: 'up', dividend: 3.2, sector: 'energy' },
                    { name: 'GSÏπºÌÖçÏä§', price: 485000, change: '+2.45%', trend: 'up', dividend: 2.8, sector: 'energy' },
                    { name: 'ÌòÑÎåÄÏò§ÏùºÎ±ÖÌÅ¨', price: 8500, change: '+3.15%', trend: 'up', dividend: 4.5, sector: 'energy' },
                    { name: 'ÎåÄÌïúÏú†Ìôî', price: 185000, change: '+2.85%', trend: 'up', dividend: 3.8, sector: 'energy' },
                    { name: 'Î°ØÎç∞ÏºÄÎØ∏Ïπº', price: 185000, change: '+1.95%', trend: 'up', dividend: 2.5, sector: 'energy' },
                    { name: 'Í∏àÌò∏ÏÑùÏú†ÌôîÌïô', price: 125000, change: '+3.45%', trend: 'up', dividend: 3.2, sector: 'energy' },
                    { name: 'ÌïúÌôîÏºÄÎØ∏Ïπº', price: 28500, change: '+2.65%', trend: 'up', dividend: 4.1, sector: 'energy' },
                    { name: 'Ìö®ÏÑ±', price: 85000, change: '+1.85%', trend: 'up', dividend: 2.8, sector: 'energy' },
                    { name: 'ÌÉúÍ¥ëÏÇ∞ÏóÖ', price: 485000, change: '+2.25%', trend: 'up', dividend: 1.5, sector: 'energy' },
                    { name: 'OCI', price: 85000, change: '+4.85%', trend: 'up', dividend: 2.2, sector: 'energy' },
                    
                    // Í∏ÄÎ°úÎ≤å ÏóêÎÑàÏßÄ (25Í∞ú)
                    { name: 'Exxon Mobil', price: 125.40, change: '+2.85%', trend: 'up', dividend: 5.8, sector: 'energy' },
                    { name: 'Chevron', price: 185.60, change: '+3.15%', trend: 'up', dividend: 3.2, sector: 'energy' },
                    { name: 'Shell', price: 68.25, change: '+2.45%', trend: 'up', dividend: 6.5, sector: 'energy' },
                    { name: 'BP', price: 38.50, change: '+1.95%', trend: 'up', dividend: 4.8, sector: 'energy' },
                    { name: 'TotalEnergies', price: 68.40, change: '+2.65%', trend: 'up', dividend: 5.2, sector: 'energy' },
                    { name: 'ConocoPhillips', price: 125.80, change: '+3.45%', trend: 'up', dividend: 2.1, sector: 'energy' },
                    { name: 'Schlumberger', price: 58.25, change: '+4.15%', trend: 'up', dividend: 2.8, sector: 'energy' },
                    { name: 'Marathon Petroleum', price: 185.40, change: '+2.85%', trend: 'up', dividend: 2.5, sector: 'energy' },
                    { name: 'Valero Energy', price: 148.60, change: '+3.25%', trend: 'up', dividend: 3.8, sector: 'energy' },
                    { name: 'Phillips 66', price: 125.80, change: '+2.45%', trend: 'up', dividend: 4.2, sector: 'energy' },
                    { name: 'Kinder Morgan', price: 18.50, change: '+1.85%', trend: 'up', dividend: 6.8, sector: 'energy' },
                    { name: 'Enterprise Products', price: 28.40, change: '+2.15%', trend: 'up', dividend: 7.5, sector: 'energy' },
                    { name: 'Enbridge', price: 42.80, change: '+1.65%', trend: 'up', dividend: 6.2, sector: 'energy' },
                    { name: 'TC Energy', price: 48.25, change: '+2.85%', trend: 'up', dividend: 5.8, sector: 'energy' },
                    { name: 'NextEra Energy', price: 68.50, change: '+1.95%', trend: 'up', dividend: 2.8, sector: 'energy' },
                    { name: 'Duke Energy', price: 105.40, change: '+1.45%', trend: 'up', dividend: 3.5, sector: 'energy' },
                    { name: 'Southern Company', price: 68.25, change: '+1.85%', trend: 'up', dividend: 4.2, sector: 'energy' },
                    { name: 'Dominion Energy', price: 52.80, change: '+2.25%', trend: 'up', dividend: 4.8, sector: 'energy' },
                    { name: 'Exelon', price: 42.50, change: '+1.95%', trend: 'up', dividend: 3.2, sector: 'energy' },
                    { name: 'American Electric Power', price: 85.60, change: '+1.65%', trend: 'up', dividend: 3.8, sector: 'energy' },
                    { name: 'Sempra Energy', price: 148.25, change: '+2.45%', trend: 'up', dividend: 3.2, sector: 'energy' },
                    { name: 'Consolidated Edison', price: 95.40, change: '+1.25%', trend: 'up', dividend: 3.5, sector: 'energy' },
                    { name: 'Public Service Enterprise', price: 68.80, change: '+1.85%', trend: 'up', dividend: 2.8, sector: 'energy' },
                    { name: 'Xcel Energy', price: 62.50, change: '+1.45%', trend: 'up', dividend: 3.0, sector: 'energy' },
                    { name: 'Eversource Energy', price: 78.25, change: '+1.95%', trend: 'up', dividend: 4.2, sector: 'energy' }
                ]
            };

            const modalContent = `
                <h2 style="text-align: center; margin-bottom: 15px; color: var(--primary);">üìä Ï£ºÏãù ÌòÑÎ¨º ÏãúÏû• (150Ï¢Ö)</h2>
                
                <div style="background: rgba(59, 130, 246, 0.1); border: 1px solid rgba(59, 130, 246, 0.3); border-radius: 8px; padding: 12px; margin-bottom: 15px;">
                    <div style="color: var(--primary); font-size: 0.9rem; line-height: 1.4; text-align: center;">
                        <strong>üìà KOSPI:</strong> ${gameState.stockMarket?.kospi?.toLocaleString() || '2,450'} 
                        <span style="color: var(--success); margin-left: 10px;">+1.25%</span>
                    </div>
                </div>

                <!-- Ïπ¥ÌÖåÍ≥†Î¶¨ ÌÉ≠ -->
                <div style="display: flex; flex-wrap: wrap; gap: 5px; margin-bottom: 15px; justify-content: center;">
                    <button onclick="showStockCategory('all')" id="stockTab-all" style="
                        padding: 8px 12px; background: var(--primary); color: white;
                        border: none; border-radius: 20px; cursor: pointer; font-size: 0.8rem; font-weight: 600;
                    ">Ï†ÑÏ≤¥ (150)</button>
                    <button onclick="showStockCategory('tech')" id="stockTab-tech" style="
                        padding: 8px 12px; background: rgba(71, 85, 105, 0.2); color: #94a3b8;
                        border: 1px solid rgba(71, 85, 105, 0.3); border-radius: 20px; cursor: pointer; font-size: 0.8rem;
                    ">IT/ÌÖåÌÅ¨ (50)</button>
                    <button onclick="showStockCategory('finance')" id="stockTab-finance" style="
                        padding: 8px 12px; background: rgba(71, 85, 105, 0.2); color: #94a3b8;
                        border: 1px solid rgba(71, 85, 105, 0.3); border-radius: 20px; cursor: pointer; font-size: 0.8rem;
                    ">Í∏àÏúµ (50)</button>
                    <button onclick="showStockCategory('energy')" id="stockTab-energy" style="
                        padding: 8px 12px; background: rgba(71, 85, 105, 0.2); color: #94a3b8;
                        border: 1px solid rgba(71, 85, 105, 0.3); border-radius: 20px; cursor: pointer; font-size: 0.8rem;
                    ">ÏóêÎÑàÏßÄ (50)</button>
                </div>

                <div id="stocksList" style="display: grid; gap: 8px; margin-bottom: 15px; max-height: 400px; overflow-y: auto;">
                    ${Object.entries(stockCategories).flatMap(([category, stocks]) => 
                        stocks.map(stock => `
                            <div class="stock-item" data-category="${category}" style="
                                background: rgba(71, 85, 105, 0.1); border: 1px solid rgba(71, 85, 105, 0.3);
                                border-radius: 8px; padding: 10px; cursor: pointer; transition: all 0.2s;
                            " onclick="openInvestmentDetail(${JSON.stringify(stock).replace(/"/g, '&quot;')}, 'stock')" 
                               onmouseover="this.style.background='rgba(99, 102, 241, 0.2)'" 
                               onmouseout="this.style.background='rgba(71, 85, 105, 0.1)'">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <div>
                                        <div style="color: #e2e8f0; font-weight: bold; font-size: 0.9rem; margin-bottom: 2px;">${stock.name}</div>
                                        <div style="color: #94a3b8; font-size: 0.8rem;">‚Ç©${stock.price.toLocaleString()} ‚Ä¢ Î∞∞Îãπ ${stock.dividend}%</div>
                                    </div>
                                    <div style="text-align: right;">
                                        <div style="color: ${stock.trend === 'up' ? 'var(--success)' : 'var(--danger)'}; font-weight: bold; font-size: 0.85rem;">
                                            ${stock.trend === 'up' ? 'üìà' : 'üìâ'} ${stock.change}
                                        </div>
                                        <div style="color: #94a3b8; font-size: 0.7rem;">${stock.sector === 'tech' ? 'IT/ÌÖåÌÅ¨' : stock.sector === 'finance' ? 'Í∏àÏúµ' : 'ÏóêÎÑàÏßÄ'}</div>
                                    </div>
                                </div>
                            </div>
                        `)
                    ).join('')}
                </div>

                <div style="text-align: center;">
                    <button onclick="closeModal()" style="
                        padding: 10px 25px; background: rgba(71, 85, 105, 0.2);
                        color: #e2e8f0; border: 1px solid rgba(71, 85, 105, 0.3);
                        border-radius: 8px; cursor: pointer; font-size: 0.9rem;
                    ">Îã´Í∏∞</button>
                </div>
                
            `;

            showModal(modalContent);
        }

        // Ï£ºÏãù Ïπ¥ÌÖåÍ≥†Î¶¨ ÌïÑÌÑ∞ÎßÅ
        function showStockCategory(category) {
            // ÌÉ≠ Ïä§ÌÉÄÏùº ÏóÖÎç∞Ïù¥Ìä∏
            document.querySelectorAll('[id^="stockTab-"]').forEach(tab => {
                tab.style.background = 'rgba(71, 85, 105, 0.2)';
                tab.style.color = '#94a3b8';
                tab.style.border = '1px solid rgba(71, 85, 105, 0.3)';
            });
            
            const activeTab = document.getElementById(`stockTab-${category}`);
            if (activeTab) {
                activeTab.style.background = 'var(--primary)';
                activeTab.style.color = 'white';
                activeTab.style.border = 'none';
            }

            // Ï£ºÏãù ÌïÑÌÑ∞ÎßÅ
            document.querySelectorAll('.stock-item').forEach(stock => {
                if (category === 'all' || stock.dataset.category === category) {
                    stock.style.display = 'block';
                } else {
                    stock.style.display = 'none';
                }
            });
        }

        function closeStockMarket() {
            document.getElementById('stockMarketModal').style.display = 'none';
        }

        function updateStockMarketModal() {
            // KOSPI Ï†ïÎ≥¥ ÏóÖÎç∞Ïù¥Ìä∏
            document.getElementById('stockModalKospi').textContent = gameState.stockMarket.kospi.toLocaleString();
            const kospiChange = gameState.stockMarket.kospiChange || 0;
            document.getElementById('stockModalKospiChange').textContent = 
                `${kospiChange >= 0 ? '+' : ''}${kospiChange.toFixed(2)}%`;
            document.getElementById('stockModalKospiChange').style.color = 
                kospiChange >= 0 ? 'var(--success)' : 'var(--danger)';

            // Ï£ºÏãù Î™©Î°ù ÏÉùÏÑ±
            const stocksDiv = document.getElementById('stocksList');
            stocksDiv.innerHTML = '';

            gameState.stockMarket.stocks.forEach(stock => {
                const stockCard = document.createElement('div');
                stockCard.className = 'business-card';
                stockCard.style.cursor = 'pointer';
                stockCard.style.marginBottom = '10px';
                
                const changeColor = stock.change >= 0 ? 'var(--success)' : 'var(--danger)';
                const changeSign = stock.change >= 0 ? '+' : '';
                
                stockCard.innerHTML = `
                    <div class="business-header">
                        <div class="business-name">${stock.name}</div>
                        <div style="color: ${changeColor};">${changeSign}${stock.change.toFixed(2)}%</div>
                    </div>
                    <div style="font-size: 0.9rem; color: #94a3b8; margin: 8px 0;">
                        <div>‚Ä¢ Ï£ºÍ∞Ä: ${stock.price.toLocaleString()}Ïõê</div>
                        <div>‚Ä¢ Î∞∞ÎãπÎ•†: ${stock.dividend}%</div>
                        <div>‚Ä¢ ÏÑπÌÑ∞: ${getSectorName(stock.sector)}</div>
                        <div style="font-size: 0.8rem; color: #64748b;">‚Ä¢ ${stock.description}</div>
                    </div>
                `;
                
                stockCard.onclick = () => openInvestmentDetail(stock, 'stock');
                stocksDiv.appendChild(stockCard);
            });
        }

        // ÏïîÌò∏ÌôîÌèê ÏãúÏû• Ìï®ÏàòÎì§
        function openCryptoMarket() {
            updateCryptoMarketModal();
            document.getElementById('cryptoMarketModal').style.display = 'flex';
        }

        function closeCryptoMarket() {
            document.getElementById('cryptoMarketModal').style.display = 'none';
        }

        function updateCryptoMarketModal() {
            // Ï¥ù ÏãúÏû•Í∞ÄÏπò Í≥ÑÏÇ∞
            const totalMarketCap = gameState.stockMarket.cryptos.reduce((sum, crypto) => sum + crypto.marketCap, 0);
            document.getElementById('cryptoMarketCap').textContent = `‚Ç©${Math.floor(totalMarketCap / 1000000000000)}Ï°∞`;

            // ÏïîÌò∏ÌôîÌèê Î™©Î°ù ÏÉùÏÑ±
            const cryptosDiv = document.getElementById('cryptosList');
            cryptosDiv.innerHTML = '';

            gameState.stockMarket.cryptos.forEach(crypto => {
                const cryptoCard = document.createElement('div');
                cryptoCard.className = 'business-card';
                cryptoCard.style.cursor = 'pointer';
                cryptoCard.style.marginBottom = '10px';
                
                const changeColor = crypto.change >= 0 ? 'var(--success)' : 'var(--danger)';
                const changeSign = crypto.change >= 0 ? '+' : '';
                
                cryptoCard.innerHTML = `
                    <div class="business-header">
                        <div class="business-name">${crypto.name} (${crypto.symbol})</div>
                        <div style="color: ${changeColor};">${changeSign}${crypto.change.toFixed(2)}%</div>
                    </div>
                    <div style="font-size: 0.9rem; color: #94a3b8; margin: 8px 0;">
                        <div>‚Ä¢ Í∞ÄÍ≤©: ‚Ç©${crypto.price.toLocaleString()}</div>
                        <div>‚Ä¢ ÏãúÍ∞ÄÏ¥ùÏï°: ‚Ç©${Math.floor(crypto.marketCap / 1000000000)}Ïñµ</div>
                        <div style="font-size: 0.8rem; color: #64748b;">‚Ä¢ ${crypto.description}</div>
                    </div>
                `;
                
                cryptoCard.onclick = () => openInvestmentDetail(crypto, 'crypto');
                cryptosDiv.appendChild(cryptoCard);
            });
        }

        // Ìà¨Ïûê ÏÉÅÏÑ∏ Ï†ïÎ≥¥ Î™®Îã¨
        function openInvestmentDetail(investment, type) {
            selectedInvestment = { ...investment, type: type };
            
            document.getElementById('investmentDetailTitle').textContent = 
                `${investment.name} Ìà¨Ïûê`;
            
            let detailInfo = '';
            if (type === 'stock') {
                detailInfo = `
                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                        <span>Ï¢ÖÎ™©Î™Ö:</span>
                        <span style="font-weight: bold;">${investment.name}</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                        <span>ÌòÑÏû¨ Ï£ºÍ∞Ä:</span>
                        <span>${investment.price.toLocaleString()}Ïõê</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                        <span>Î∞∞ÎãπÎ•†:</span>
                        <span>${investment.dividend}%</span>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <span>ÏÑπÌÑ∞:</span>
                        <span>${getSectorName(investment.sector)}</span>
                    </div>
                `;
            } else {
                detailInfo = `
                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                        <span>ÏïîÌò∏ÌôîÌèê:</span>
                        <span style="font-weight: bold;">${investment.name} (${investment.symbol})</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                        <span>ÌòÑÏû¨ Í∞ÄÍ≤©:</span>
                        <span>‚Ç©${investment.price.toLocaleString()}</span>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <span>ÏãúÍ∞ÄÏ¥ùÏï°:</span>
                        <span>‚Ç©${Math.floor(investment.marketCap / 1000000000)}Ïñµ</span>
                    </div>
                `;
            }
            
            document.getElementById('investmentDetailInfo').innerHTML = detailInfo;
            document.getElementById('investmentAmountSlider').value = 1000000;
            updateInvestmentAmount();
            
            document.getElementById('investmentDetailModal').style.display = 'flex';
        }

        function closeInvestmentDetail() {
            document.getElementById('investmentDetailModal').style.display = 'none';
            selectedInvestment = null;
        }

        function updateInvestmentAmount() {
            if (!selectedInvestment) return;
            
            const amount = parseInt(document.getElementById('investmentAmountSlider').value);
            document.getElementById('selectedInvestmentAmount').textContent = `${Math.floor(amount / 10000)}Îßå ÎπÑÌä∏ÌÅ¨Î†àÎîß`;
            document.getElementById('finalInvestmentAmount').textContent = `${amount.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß`;
            
            let monthlyReturn, annualReturn;
            
            if (selectedInvestment.type === 'stock') {
                monthlyReturn = Math.floor(amount * selectedInvestment.dividend / 100 / 12);
                annualReturn = selectedInvestment.dividend + (Math.random() * 15 - 5); // ¬±5% Î≥ÄÎèôÏÑ±
            } else {
                monthlyReturn = 0; // ÏïîÌò∏ÌôîÌèêÎäî Î∞∞Îãπ ÏóÜÏùå
                annualReturn = Math.random() * 80 - 30; // -30~50% Í≥†Î≥ÄÎèôÏÑ±
            }
            
            document.getElementById('expectedMonthlyReturn').textContent = `${monthlyReturn.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß`;
            document.getElementById('expectedAnnualReturn').textContent = `${annualReturn >= 0 ? '+' : ''}${annualReturn.toFixed(1)}%`;
            document.getElementById('expectedAnnualReturn').style.color = annualReturn >= 0 ? 'var(--success)' : 'var(--danger)';
            
            // Íµ¨Îß§ Í∞ÄÎä• Ïó¨Î∂Ä ÌôïÏù∏
            const canAfford = gameState.currentUser.game_balance >= amount;
            const confirmBtn = document.getElementById('confirmInvestmentBtn');
            confirmBtn.disabled = !canAfford;
            confirmBtn.textContent = canAfford ? 'Ìà¨ÏûêÌïòÍ∏∞' : 'ÏûêÍ∏à Î∂ÄÏ°±';
            confirmBtn.className = canAfford ? 'btn' : 'btn btn-secondary';
        }

        function confirmInvestment() {
            if (!selectedInvestment) return;
            
            const amount = parseInt(document.getElementById('investmentAmountSlider').value);
            
            if (gameState.currentUser.game_balance < amount) {
                showNotification('Ìà¨Ïûê ÏûêÍ∏àÏù¥ Î∂ÄÏ°±Ìï©ÎãàÎã§', 'error');
                return;
            }
            
            gameState.currentUser.game_balance -= amount;
            
            let investment;
            if (selectedInvestment.type === 'stock') {
                investment = {
                    type: 'stock',
                    name: selectedInvestment.name,
                    amount: amount,
                    shares: Math.floor(amount / selectedInvestment.price),
                    purchasePrice: selectedInvestment.price,
                    returnRate: (Math.random() * 0.15) + 0.03,
                    dividends: Math.floor(amount * selectedInvestment.dividend / 100 / 12),
                    volatility: 0.02,
                    sector: selectedInvestment.sector
                };
            } else {
                investment = {
                    type: 'crypto',
                    name: selectedInvestment.name,
                    symbol: selectedInvestment.symbol,
                    amount: amount,
                    coins: amount / selectedInvestment.price,
                    purchasePrice: selectedInvestment.price,
                    returnRate: (Math.random() * 0.6) - 0.2,
                    dividends: 0,
                    volatility: 0.08
                };
            }
            
            gameState.roleData.investments.push(investment);
            
            updateInvestmentDisplay();
            updateDisplay();
            closeInvestmentDetail();
            closeStockMarket();
            closeCryptoMarket();
            
            const investmentType = selectedInvestment.type === 'stock' ? 'Ï£ºÏãù' : 'ÏïîÌò∏ÌôîÌèê';
            showNotification(`${selectedInvestment.name} ${investmentType} ${amount.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß Ìà¨Ïûê ÏôÑÎ£å!`, 'success');
        }

        function getSectorName(sector) {
            const sectorNames = {
                'tech': 'Í∏∞Ïà†',
                'finance': 'Í∏àÏúµ',
                'auto': 'ÏûêÎèôÏ∞®',
                'chemical': 'ÌôîÌïô',
                'electronics': 'Ï†ÑÏûê',
                'steel': 'Ï≤†Í∞ï',
                'media': 'ÎØ∏ÎîîÏñ¥'
            };
            return sectorNames[sector] || sector;
        }

        // M&A Î∞è R&D Ìå®ÎÑê ÌëúÏãú Ìï®ÏàòÎì§
        function showMAPanel() {
            openMAModal();
        }

        function showRDPanel() {
            openRDModal();
        }

        // ============================================
        // Ï∫êÌîºÌÉàÎ¶¨Ï¶ò Ïä§ÌÉÄÏùº Í≤ΩÏ†ú ÏãúÏä§ÌÖú (Capitalism 2 Style)
        // ============================================

        // ÏãúÏû• Í∞ÄÍ≤© Ï¥àÍ∏∞Ìôî
        function initializeMarketPrices() {
            const marketPrices = gameState.roleData.supplyChain.marketPrices;
            
            // ÏõêÏûêÏû¨ Í∞ÄÍ≤© ÏÑ§Ï†ï
            marketPrices.set('wheat', { price: 50, demand: 1000, supply: 1000 });
            marketPrices.set('corn', { price: 45, demand: 800, supply: 800 });
            marketPrices.set('cotton', { price: 120, demand: 600, supply: 600 });
            marketPrices.set('lumber', { price: 80, demand: 900, supply: 900 });
            marketPrices.set('iron_ore', { price: 30, demand: 1200, supply: 1200 });
            marketPrices.set('coal', { price: 25, demand: 1100, supply: 1100 });
            marketPrices.set('oil', { price: 200, demand: 1500, supply: 1500 });
            marketPrices.set('milk', { price: 35, demand: 700, supply: 700 });
            marketPrices.set('beef', { price: 300, demand: 500, supply: 500 });
            
            // Í∞ÄÍ≥µÌíà Í∞ÄÍ≤© ÏÑ§Ï†ï
            marketPrices.set('bread', { price: 150, demand: 800, supply: 700 });
            marketPrices.set('textiles', { price: 250, demand: 600, supply: 550 });
            marketPrices.set('furniture', { price: 800, demand: 400, supply: 350 });
            marketPrices.set('steel', { price: 100, demand: 1000, supply: 950 });
            marketPrices.set('gasoline', { price: 400, demand: 1200, supply: 1100 });
            marketPrices.set('electronics', { price: 1500, demand: 300, supply: 250 });
            marketPrices.set('automobiles', { price: 25000, demand: 100, supply: 80 });
        }

        // Ï∫êÌîºÌÉàÎ¶¨Ï¶ò Ïä§ÌÉÄÏùº ÏÇ¨ÏóÖ ÏÉùÏÑ±
        function openCapitalismBusinessModal() {
            const modalContent = `
                <h2 style="text-align: center; margin-bottom: 30px; color: var(--primary);">üè≠ ÏÇ∞ÏóÖ Ï†úÍµ≠ Í±¥ÏÑ§</h2>
                
                <div style="margin-bottom: 20px;">
                    <p style="text-align: center; color: #cbd5e1; margin-bottom: 20px;">
                        ÏõêÏûêÏû¨ ÏÉùÏÇ∞Î∂ÄÌÑ∞ ÏÜåÎß§ ÌåêÎß§ÍπåÏßÄ ÏôÑÏ†ÑÌïú Í≥µÍ∏âÎßùÏùÑ Íµ¨Ï∂ïÌïòÏÑ∏Ïöî.
                    </p>
                </div>

                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                    <div class="business-category" onclick="showRawMaterialBusinesses()" style="
                        padding: 20px;
                        background: linear-gradient(135deg, #10b981, #047857);
                        border-radius: 12px;
                        cursor: pointer;
                        transition: all 0.3s ease;
                        text-align: center;
                    ">
                        <div style="font-size: 2.5rem; margin-bottom: 10px;">üåæ</div>
                        <h3 style="color: white; margin-bottom: 8px;">ÏõêÏûêÏû¨ ÏÉùÏÇ∞</h3>
                        <p style="color: rgba(255,255,255,0.8); font-size: 0.9rem;">ÎÜçÏû•, Í¥ëÏÇ∞, Î™©Ïû•</p>
                    </div>

                    <div class="business-category" onclick="showManufacturingBusinesses()" style="
                        padding: 20px;
                        background: linear-gradient(135deg, #f59e0b, #d97706);
                        border-radius: 12px;
                        cursor: pointer;
                        transition: all 0.3s ease;
                        text-align: center;
                    ">
                        <div style="font-size: 2.5rem; margin-bottom: 10px;">üè≠</div>
                        <h3 style="color: white; margin-bottom: 8px;">Ï†úÏ°∞ÏóÖ</h3>
                        <p style="color: rgba(255,255,255,0.8); font-size: 0.9rem;">Í≥µÏû•, Í∞ÄÍ≥µÏóÖÏ≤¥</p>
                    </div>

                    <div class="business-category" onclick="showDistributionBusinesses()" style="
                        padding: 20px;
                        background: linear-gradient(135deg, #3b82f6, #1d4ed8);
                        border-radius: 12px;
                        cursor: pointer;
                        transition: all 0.3s ease;
                        text-align: center;
                    ">
                        <div style="font-size: 2.5rem; margin-bottom: 10px;">üöõ</div>
                        <h3 style="color: white; margin-bottom: 8px;">Ïú†ÌÜµÏóÖ</h3>
                        <p style="color: rgba(255,255,255,0.8); font-size: 0.9rem;">ÎèÑÎß§Ï†ê, Î¨ºÎ•òÏÑºÌÑ∞</p>
                    </div>

                    <div class="business-category" onclick="showRetailBusinesses()" style="
                        padding: 20px;
                        background: linear-gradient(135deg, #8b5cf6, #7c3aed);
                        border-radius: 12px;
                        cursor: pointer;
                        transition: all 0.3s ease;
                        text-align: center;
                    ">
                        <div style="font-size: 2.5rem; margin-bottom: 10px;">üè™</div>
                        <h3 style="color: white; margin-bottom: 8px;">ÏÜåÎß§ÏóÖ</h3>
                        <p style="color: rgba(255,255,255,0.8); font-size: 0.9rem;">ÏÜåÎß§Ï†ê, ÎåÄÎ¶¨Ï†ê</p>
                    </div>
                </div>

                <div style="margin-top: 30px; text-align: center;">
                    <button onclick="showSupplyChainOverview()" style="
                        padding: 12px 24px;
                        background: var(--primary);
                        color: white;
                        border: none;
                        border-radius: 8px;
                        cursor: pointer;
                        font-weight: 600;
                        margin-right: 10px;
                    ">Í≥µÍ∏âÎßù ÌòÑÌô©</button>
                    
                    <button onclick="showMarketPrices()" style="
                        padding: 12px 24px;
                        background: var(--success);
                        color: white;
                        border: none;
                        border-radius: 8px;
                        cursor: pointer;
                        font-weight: 600;
                    ">ÏãúÏû• Í∞ÄÍ≤©</button>
                </div>
            `;
            
            showModal(modalContent);
        }

        // ÏõêÏûêÏû¨ ÏÉùÏÇ∞ÏóÖ ÌëúÏãú
        function showRawMaterialBusinesses() {
            const businesses = [
                {
                    id: 'wheat_farm',
                    name: 'Î∞Ä ÎÜçÏû•',
                    icon: 'üåæ',
                    product: 'wheat',
                    cost: 25000,
                    monthlyProduction: 200,
                    description: 'Î∞ÄÏùÑ ÏÉùÏÇ∞ÌïòÏó¨ Ï†úÎπµÏóÖÏ≤¥Ïóê Í≥µÍ∏â',
                    requirements: 'ÎÜçÏßÄ 500Ìèâ ÌïÑÏöî'
                },
                {
                    id: 'corn_farm',
                    name: 'Ïò•ÏàòÏàò ÎÜçÏû•',
                    icon: 'üåΩ',
                    product: 'corn',
                    cost: 22000,
                    monthlyProduction: 180,
                    description: 'ÏÇ¨Î£åÏö© Î∞è Í∞ÄÍ≥µÏö© Ïò•ÏàòÏàò ÏÉùÏÇ∞',
                    requirements: 'ÎÜçÏßÄ 400Ìèâ ÌïÑÏöî'
                },
                {
                    id: 'cotton_farm',
                    name: 'Î™©Ìôî ÎÜçÏû•',
                    icon: 'üåø',
                    product: 'cotton',
                    cost: 30000,
                    monthlyProduction: 150,
                    description: 'ÏÑ¨Ïú† ÏõêÎ£åÏù∏ Î™©Ìôî ÏÉùÏÇ∞',
                    requirements: 'ÎÜçÏßÄ 600Ìèâ ÌïÑÏöî'
                },
                {
                    id: 'lumber_mill',
                    name: 'Ï†úÏû¨ÏÜå',
                    icon: 'ü™µ',
                    product: 'lumber',
                    cost: 35000,
                    monthlyProduction: 300,
                    description: 'Î™©Ïû¨ Í∞ÄÍ≥µ Î∞è Í≥µÍ∏â',
                    requirements: 'ÏÇ∞Î¶ºÏßÄÏó≠ ÌïÑÏöî'
                },
                {
                    id: 'iron_mine',
                    name: 'Ï≤†Í¥ëÏÇ∞',
                    icon: '‚õèÔ∏è',
                    product: 'iron_ore',
                    cost: 50000,
                    monthlyProduction: 400,
                    description: 'Ï≤†Í¥ëÏÑù Ï±ÑÍµ¥ Î∞è Í∞ÄÍ≥µ',
                    requirements: 'Í¥ëÏóÖÍ∂å ÌïÑÏöî'
                },
                {
                    id: 'coal_mine',
                    name: 'ÌÉÑÍ¥ë',
                    icon: '‚ö´',
                    product: 'coal',
                    cost: 45000,
                    monthlyProduction: 350,
                    description: 'ÏÑùÌÉÑ Ï±ÑÍµ¥ Î∞è Í≥µÍ∏â',
                    requirements: 'Í¥ëÏóÖÍ∂å ÌïÑÏöî'
                },
                {
                    id: 'oil_well',
                    name: 'Ïú†Ï†ï',
                    icon: 'üõ¢Ô∏è',
                    product: 'oil',
                    cost: 80000,
                    monthlyProduction: 100,
                    description: 'ÏõêÏú† Ï±ÑÍµ¥ Î∞è Ï†ïÏ†ú',
                    requirements: 'Ï±ÑÍµ¥Í∂å ÌïÑÏöî'
                },
                {
                    id: 'dairy_farm',
                    name: 'ÎÇôÎÜçÏû•',
                    icon: 'üêÑ',
                    product: 'milk',
                    cost: 28000,
                    monthlyProduction: 250,
                    description: 'Ïö∞Ïú† ÏÉùÏÇ∞ Î∞è Í≥µÍ∏â',
                    requirements: 'Î™©Ï¥àÏßÄ 300Ìèâ ÌïÑÏöî'
                },
                {
                    id: 'cattle_ranch',
                    name: 'Î™©Ïû•',
                    icon: 'ü•©',
                    product: 'beef',
                    cost: 60000,
                    monthlyProduction: 80,
                    description: 'Ïú°Ïö∞ ÏÇ¨Ïú° Î∞è ÎèÑÏ∂ï',
                    requirements: 'Î™©Ï¥àÏßÄ 1000Ìèâ ÌïÑÏöî'
                }
            ];

            showBusinessTypeSelection(businesses, 'rawMaterials', 'ÏõêÏûêÏû¨ ÏÉùÏÇ∞ÏóÖ');
        }

        // Ï†úÏ°∞ÏóÖ ÌëúÏãú
        function showManufacturingBusinesses() {
            const businesses = [
                {
                    id: 'bakery',
                    name: 'Ï†úÎπµÍ≥µÏû•',
                    icon: 'üçû',
                    product: 'bread',
                    cost: 40000,
                    inputs: [{ product: 'wheat', quantity: 3 }],
                    monthlyProduction: 100,
                    description: 'Î∞ÄÍ∞ÄÎ£®Î°ú Îπµ Ï†úÏ°∞',
                    requirements: 'Î∞Ä Í≥µÍ∏âÍ≥ÑÏïΩ ÌïÑÏöî'
                },
                {
                    id: 'textile_mill',
                    name: 'Î∞©ÏßÅÍ≥µÏû•',
                    icon: 'üßµ',
                    product: 'textiles',
                    cost: 55000,
                    inputs: [{ product: 'cotton', quantity: 2 }],
                    monthlyProduction: 80,
                    description: 'Î™©ÌôîÎ•º ÏßÅÎ¨ºÎ°ú Í∞ÄÍ≥µ',
                    requirements: 'Î™©Ìôî Í≥µÍ∏âÍ≥ÑÏïΩ ÌïÑÏöî'
                },
                {
                    id: 'furniture_factory',
                    name: 'Í∞ÄÍµ¨Í≥µÏû•',
                    icon: 'ü™ë',
                    product: 'furniture',
                    cost: 70000,
                    inputs: [{ product: 'lumber', quantity: 4 }],
                    monthlyProduction: 30,
                    description: 'Î™©Ïû¨Î°ú Í∞ÄÍµ¨ Ï†úÏ°∞',
                    requirements: 'Î™©Ïû¨ Í≥µÍ∏âÍ≥ÑÏïΩ ÌïÑÏöî'
                },
                {
                    id: 'steel_mill',
                    name: 'Ï†úÏ≤†ÏÜå',
                    icon: 'üè≠',
                    product: 'steel',
                    cost: 120000,
                    inputs: [
                        { product: 'iron_ore', quantity: 3 },
                        { product: 'coal', quantity: 2 }
                    ],
                    monthlyProduction: 200,
                    description: 'Ï≤†Í¥ëÏÑùÍ≥º ÏÑùÌÉÑÏúºÎ°ú Ï≤†Í∞ï Ï†úÏ°∞',
                    requirements: 'Ï≤†Í¥ëÏÑù, ÏÑùÌÉÑ Í≥µÍ∏âÍ≥ÑÏïΩ ÌïÑÏöî'
                }
            ];

            showBusinessTypeSelection(businesses, 'manufacturers', 'Ï†úÏ°∞ÏóÖ');
        }

        // Í≥µÌÜµ ÏÇ¨ÏóÖ ÏÑ†ÌÉù ÌëúÏãú Ìï®Ïàò
        function showBusinessTypeSelection(businesses, category, categoryName) {
            const modalContent = `
                <h2 style="text-align: center; margin-bottom: 30px; color: var(--primary);">üè≠ ${categoryName}</h2>
                
                <div style="display: grid; gap: 15px; max-height: 60vh; overflow-y: auto;">
                    ${businesses.map(business => {
                        const canAfford = gameState.currentUser.game_balance >= business.cost;
                        // Ïú†ÌÜµÏóÖÍ≥º ÏÜåÎß§ÏóÖÏùÄ ÏßÅÏ†ëÏ†ÅÏù∏ ÏàòÏùµÏù¥ ÏûàÍ≥†, Ï†úÏ°∞ÏóÖÏùÄ ÏÉùÏÇ∞Îüâ * Í∞ÄÍ≤©ÏúºÎ°ú Í≥ÑÏÇ∞
                        let monthlyRevenue = 0;
                        if (category === 'distributors' || category === 'retailers') {
                            monthlyRevenue = business.monthlyRevenue || 0;
                        } else {
                            const marketPrice = gameState.roleData.supplyChain.marketPrices.get(business.product);
                            monthlyRevenue = marketPrice ? Math.floor(business.monthlyProduction * marketPrice.price) : 0;
                        }
                        
                        return `
                            <div class="capitalism-business-card ${canAfford ? '' : 'disabled'}" 
                                 onclick="${canAfford ? `createCapitalismBusiness('${business.id}', '${category}')` : ''}"
                                 style="
                                    padding: 20px;
                                    background: ${canAfford ? 'rgba(255,255,255,0.05)' : 'rgba(255,255,255,0.02)'};
                                    border: 1px solid ${canAfford ? 'rgba(255,255,255,0.1)' : 'rgba(255,255,255,0.05)'};
                                    border-radius: 12px;
                                    cursor: ${canAfford ? 'pointer' : 'not-allowed'};
                                    opacity: ${canAfford ? '1' : '0.5'};
                                 ">
                                
                                <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                                    <div style="font-size: 2rem;">${business.icon}</div>
                                    <div style="flex: 1;">
                                        <h3 style="color: var(--primary); margin: 0;">${business.name}</h3>
                                        <p style="color: #94a3b8; margin: 5px 0; font-size: 0.9rem;">${business.description}</p>
                                    </div>
                                    <div style="text-align: right;">
                                        <div style="color: var(--danger); font-weight: 600;">${business.cost.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß</div>
                                        <div style="color: var(--success); font-weight: 600;">${monthlyRevenue.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß/Ïõî</div>
                                    </div>
                                </div>

                                <div style="background: rgba(99, 102, 241, 0.1); border-radius: 8px; padding: 10px; font-size: 0.85rem;">
                                    <div>ÏÉùÏÇ∞Îüâ: ${business.monthlyProduction}/Ïõî | ${business.requirements}</div>
                                    ${business.inputs ? `<div style="margin-top: 5px;">ÌïÑÏöî ÏõêÎ£å: ${business.inputs.map(i => `${i.product} ${i.quantity}Í∞ú`).join(', ')}</div>` : ''}
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>

                <div style="margin-top: 20px; text-align: center;">
                    <button onclick="openCapitalismBusinessModal()" style="
                        padding: 10px 20px; border: 1px solid rgba(255,255,255,0.2);
                        background: rgba(255,255,255,0.05); color: #e2e8f0;
                        border-radius: 8px; cursor: pointer;">Îí§Î°ú Í∞ÄÍ∏∞</button>
                </div>
            `;
            
            showModal(modalContent);
        }

        // Ï∫êÌîºÌÉàÎ¶¨Ï¶ò ÏÇ¨ÏóÖ ÏÉùÏÑ±
        function createCapitalismBusiness(businessId, category) {
            const allBusinesses = {
                // ÏõêÏûêÏû¨ ÏÉùÏÇ∞ÏóÖ
                'wheat_farm': { name: 'Î∞Ä ÎÜçÏû•', cost: 25000, product: 'wheat', monthlyProduction: 200, employees: 4, sector: 'ÎÜçÏóÖ' },
                'corn_farm': { name: 'Ïò•ÏàòÏàò ÎÜçÏû•', cost: 22000, product: 'corn', monthlyProduction: 180, employees: 3, sector: 'ÎÜçÏóÖ' },
                'cotton_farm': { name: 'Î™©Ìôî ÎÜçÏû•', cost: 30000, product: 'cotton', monthlyProduction: 150, employees: 5, sector: 'ÎÜçÏóÖ' },
                'lumber_mill': { name: 'Ï†úÏû¨ÏÜå', cost: 35000, product: 'lumber', monthlyProduction: 300, employees: 8, sector: 'ÏûÑÏóÖ' },
                'iron_mine': { name: 'Ï≤†Í¥ëÏÇ∞', cost: 50000, product: 'iron_ore', monthlyProduction: 400, employees: 12, sector: 'Í¥ëÏóÖ' },
                'coal_mine': { name: 'ÌÉÑÍ¥ë', cost: 45000, product: 'coal', monthlyProduction: 350, employees: 10, sector: 'Í¥ëÏóÖ' },
                'oil_well': { name: 'Ïú†Ï†ï', cost: 80000, product: 'oil', monthlyProduction: 100, employees: 6, sector: 'ÏÑùÏú†' },
                'dairy_farm': { name: 'ÎÇôÎÜçÏû•', cost: 28000, product: 'milk', monthlyProduction: 250, employees: 6, sector: 'ÎÜçÏóÖ' },
                'cattle_ranch': { name: 'Î™©Ïû•', cost: 60000, product: 'beef', monthlyProduction: 80, employees: 8, sector: 'Ï∂ïÏÇ∞ÏóÖ' },

                // Ï†úÏ°∞ÏóÖ
                'bakery': { name: 'Ï†úÎπµÍ≥µÏû•', cost: 40000, product: 'bread', monthlyProduction: 100, employees: 6, sector: 'ÏãùÌíàÏ†úÏ°∞', inputs: [{ product: 'wheat', quantity: 3 }] },
                'textile_mill': { name: 'Î∞©ÏßÅÍ≥µÏû•', cost: 55000, product: 'textiles', monthlyProduction: 80, employees: 10, sector: 'ÏÑ¨Ïú†Ï†úÏ°∞', inputs: [{ product: 'cotton', quantity: 2 }] },
                'furniture_factory': { name: 'Í∞ÄÍµ¨Í≥µÏû•', cost: 70000, product: 'furniture', monthlyProduction: 30, employees: 15, sector: 'Í∞ÄÍµ¨Ï†úÏ°∞', inputs: [{ product: 'lumber', quantity: 4 }] },
                'steel_mill': { name: 'Ï†úÏ≤†ÏÜå', cost: 120000, product: 'steel', monthlyProduction: 200, employees: 25, sector: 'Ï≤†Í∞ïÏ†úÏ°∞', inputs: [{ product: 'iron_ore', quantity: 3 }, { product: 'coal', quantity: 2 }] },

                // Ïú†ÌÜµÏóÖ
                'wholesale_center': { name: 'ÎèÑÎß§ Ïú†ÌÜµÏÑºÌÑ∞', cost: 75000, monthlyRevenue: 12000, employees: 15, sector: 'Ïú†ÌÜµÏóÖ', products: ['bread', 'clothing', 'furniture'] },
                'logistics_hub': { name: 'Î¨ºÎ•ò ÌóàÎ∏å', cost: 120000, monthlyRevenue: 18000, employees: 25, sector: 'Î¨ºÎ•òÏóÖ', products: ['all_products'] },
                'cold_chain': { name: 'ÎÉâÏû• Ïú†ÌÜµÏÑºÌÑ∞', cost: 95000, monthlyRevenue: 15000, employees: 18, sector: 'ÎÉâÏû•Ïú†ÌÜµ', products: ['milk', 'beef'] },
                'import_distributor': { name: 'ÏàòÏûÖ Ï¥ùÌåê', cost: 150000, monthlyRevenue: 22000, employees: 20, sector: 'ÏàòÏûÖÏú†ÌÜµ', products: ['luxury_goods', 'electronics'] },

                // ÏÜåÎß§ÏóÖ
                'department_store': { name: 'Î∞±ÌôîÏ†ê', cost: 200000, monthlyRevenue: 35000, employees: 50, sector: 'Î∞±ÌôîÏ†êÏóÖ', products: ['clothing', 'furniture', 'luxury_goods'] },
                'supermarket': { name: 'ÎåÄÌòïÎßàÌä∏', cost: 180000, monthlyRevenue: 28000, employees: 40, sector: 'ÎåÄÌòïÎßàÌä∏ÏóÖ', products: ['bread', 'milk', 'beef', 'processed_foods'] },
                'convenience_store': { name: 'Ìé∏ÏùòÏ†ê Ï≤¥Ïù∏', cost: 80000, monthlyRevenue: 15000, employees: 12, sector: 'Ìé∏ÏùòÏ†êÏóÖ', products: ['processed_foods', 'beverages'] },
                'specialty_store': { name: 'Ï†ÑÎ¨∏ ÌåêÎß§Ï†ê', cost: 120000, monthlyRevenue: 20000, employees: 15, sector: 'Ï†ÑÎ¨∏ÏÜåÎß§ÏóÖ', products: ['electronics', 'luxury_goods'] },
                'online_mall': { name: 'Ïò®ÎùºÏù∏ ÏáºÌïëÎ™∞', cost: 60000, monthlyRevenue: 18000, employees: 8, sector: 'Ï†ÑÏûêÏÉÅÍ±∞Îûò', products: ['all_products'] },
                'franchise_dealer': { name: 'Í∞ÄÎßπÏ†ê Î≥∏Î∂Ä', cost: 250000, monthlyRevenue: 45000, employees: 30, sector: 'ÌîÑÎûúÏ∞®Ïù¥Ï¶à', products: ['franchise_rights'] }
            };

            const selectedBusiness = allBusinesses[businessId];
            if (!selectedBusiness) return;

            // Ï†ÑÏó≠ Î≥ÄÏàòÏóê Ï†ÄÏû•
            window.currentSelectedBusiness = selectedBusiness;
            showCapitalismBusinessOptions(selectedBusiness, businessId, category);
        }

        // Ï∫êÌîºÌÉàÎ¶¨Ï¶ò ÏÇ¨ÏóÖ ÏòµÏÖò ÏÑ†ÌÉù
        function showCapitalismBusinessOptions(business, businessId, category) {
            const modalContent = `
                <h2 style="text-align: center; margin-bottom: 30px; color: var(--primary);">üè≠ ${business.name} ÏÑ§Î¶Ω ÏòµÏÖò</h2>
                
                <div style="background: rgba(99, 102, 241, 0.1); border: 1px solid rgba(99, 102, 241, 0.3); border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px; font-size: 0.9rem;">
                        <div><span style="color: #64748b;">ÏÇ¨ÏóÖÎ™Ö:</span> <span style="color: #e2e8f0; font-weight: 600;">${business.name}</span></div>
                        <div><span style="color: #64748b;">ÏóÖÏ¢Ö:</span> <span style="color: #e2e8f0; font-weight: 600;">${business.sector}</span></div>
                        <div><span style="color: #64748b;">Í∏∞Î≥∏ ÎπÑÏö©:</span> <span style="color: var(--danger); font-weight: 600;">${business.cost.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß</span></div>
                        <div><span style="color: #64748b;">Í∏∞Î≥∏ ÏßÅÏõê:</span> <span style="color: #e2e8f0; font-weight: 600;">${business.employees}Î™Ö</span></div>
                    </div>
                </div>

                <div style="background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                    <h3 style="color: var(--primary); margin-bottom: 15px;">üèóÔ∏è ÏãúÏÑ§ Í∑úÎ™® ÏÑ†ÌÉù</h3>
                    <div id="facilityOptions" style="display: grid; gap: 15px;"></div>
                </div>

                <div style="background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                    <h3 style="color: var(--primary); margin-bottom: 15px;">üë• Ï¥àÍ∏∞ ÏßÅÏõê Í∑úÎ™® ÏÑ†ÌÉù</h3>
                    <div id="staffingOptions" style="display: grid; gap: 15px;"></div>
                </div>

                <div style="background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                    <h3 style="color: var(--primary); margin-bottom: 15px;">üéØ Ïö¥ÏòÅ Ï†ÑÎûµ ÏÑ†ÌÉù</h3>
                    <div id="strategyOptions" style="display: grid; gap: 15px;"></div>
                </div>

                <div id="finalEstimate" style="background: rgba(16, 185, 129, 0.1); border: 1px solid rgba(16, 185, 129, 0.3); border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 30px;">
                    <button onclick="openCapitalismBusinessModal()" style="
                        padding: 12px 20px; border: 1px solid rgba(255,255,255,0.2);
                        background: rgba(255,255,255,0.05); color: #e2e8f0;
                        border-radius: 8px; cursor: pointer;">Ï∑®ÏÜå</button>
                    
                    <button onclick="confirmCapitalismBusiness('${businessId}', '${category}')" style="
                        padding: 12px 20px; border: none; background: var(--primary);
                        color: white; border-radius: 8px; cursor: pointer; font-weight: 600;">ÏÑ§Î¶ΩÌïòÍ∏∞</button>
                </div>
            `;

            showModal(modalContent);
            loadCapitalismBusinessOptions(business, businessId);
        }

        // Ï∫êÌîºÌÉàÎ¶¨Ï¶ò ÏÇ¨ÏóÖ ÏòµÏÖò Î°úÎìú
        function loadCapitalismBusinessOptions(business, businessId) {
            // ÏãúÏÑ§ Í∑úÎ™® ÏòµÏÖò
            const facilityOptions = [
                { id: 'small', name: 'ÏÜåÍ∑úÎ™®', multiplier: 1.0, description: 'Í∏∞Î≥∏ Í∑úÎ™®', bonus: '' },
                { id: 'medium', name: 'Ï§ëÍ∑úÎ™®', multiplier: 1.8, description: '80% ÌÅ∞ Í∑úÎ™®', bonus: 'Ìö®Ïú®ÏÑ± +10%' },
                { id: 'large', name: 'ÎåÄÍ∑úÎ™®', multiplier: 3.0, description: '3Î∞∞ ÌÅ∞ Í∑úÎ™®', bonus: 'Ìö®Ïú®ÏÑ± +25%' },
                { id: 'mega', name: 'Ï¥àÎåÄÍ∑úÎ™®', multiplier: 5.0, description: '5Î∞∞ ÌÅ∞ Í∑úÎ™®', bonus: 'Ìö®Ïú®ÏÑ± +50%' }
            ];

            // ÏßÅÏõê Í∑úÎ™® ÏòµÏÖò
            const staffingOptions = [
                { id: 'minimal', name: 'ÏµúÏÜå Ïù∏Î†•', multiplier: 0.8, description: 'Í∏∞Î≥∏ Ïù∏Î†•Ïùò 80%', penalty: 'ÏÉùÏÇ∞ÏÑ± -10%' },
                { id: 'standard', name: 'ÌëúÏ§Ä Ïù∏Î†•', multiplier: 1.0, description: 'Í∏∞Î≥∏ Ïù∏Î†•', bonus: '' },
                { id: 'expanded', name: 'ÌôïÏû• Ïù∏Î†•', multiplier: 1.5, description: 'Í∏∞Î≥∏ Ïù∏Î†•Ïùò 150%', bonus: 'ÏÉùÏÇ∞ÏÑ± +20%' },
                { id: 'premium', name: 'ÌîÑÎ¶¨ÎØ∏ÏóÑ Ïù∏Î†•', multiplier: 2.0, description: 'Í∏∞Î≥∏ Ïù∏Î†•Ïùò 200%', bonus: 'ÏÉùÏÇ∞ÏÑ± +40%' }
            ];

            // Ïö¥ÏòÅ Ï†ÑÎûµ ÏòµÏÖò
            const strategyOptions = [
                { id: 'cost_focus', name: 'ÎπÑÏö© ÏµúÏ†ÅÌôî', description: 'Ïö¥ÏòÅÎπÑ -20%, ÌíàÏßà -10%' },
                { id: 'balanced', name: 'Í∑†Ìòï Ïö¥ÏòÅ', description: 'ÌëúÏ§Ä Ïö¥ÏòÅ Î∞©Ïãù' },
                { id: 'quality_focus', name: 'ÌíàÏßà ÏßëÏ§ë', description: 'Ïö¥ÏòÅÎπÑ +30%, ÌíàÏßà +25%' },
                { id: 'innovation', name: 'ÌòÅÏã† Ï§ëÏã¨', description: 'Ïö¥ÏòÅÎπÑ +50%, ÏÉùÏÇ∞ÏÑ± +35%' }
            ];

            // HTML ÏÉùÏÑ±
            document.getElementById('facilityOptions').innerHTML = facilityOptions.map(option => {
                const cost = Math.floor(business.cost * option.multiplier);
                const canAfford = gameState.currentUser.game_balance >= cost;
                
                return `
                    <div class="option-card ${canAfford ? '' : 'disabled'}" data-type="facility" data-id="${option.id}"
                         onclick="${canAfford ? `selectCapitalismOption('facility', '${option.id}')` : ''}"
                         style="padding: 15px; border: 2px solid rgba(255,255,255,0.1); border-radius: 8px; 
                                cursor: ${canAfford ? 'pointer' : 'not-allowed'}; opacity: ${canAfford ? '1' : '0.5'};">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                            <h4 style="color: var(--primary); margin: 0;">${option.name}</h4>
                            <span style="color: var(--danger); font-weight: 600;">${cost.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß</span>
                        </div>
                        <p style="color: #94a3b8; margin: 5px 0; font-size: 0.9rem;">${option.description}</p>
                        ${option.bonus ? `<div style="color: var(--success); font-size: 0.8rem;">üí° ${option.bonus}</div>` : ''}
                    </div>
                `;
            }).join('');

            document.getElementById('staffingOptions').innerHTML = staffingOptions.map(option => `
                <div class="option-card" data-type="staffing" data-id="${option.id}"
                     onclick="selectCapitalismOption('staffing', '${option.id}')"
                     style="padding: 15px; border: 2px solid rgba(255,255,255,0.1); border-radius: 8px; cursor: pointer;">
                    <h4 style="color: var(--primary); margin: 0 0 8px 0;">${option.name}</h4>
                    <p style="color: #94a3b8; margin: 5px 0; font-size: 0.9rem;">${option.description}</p>
                    ${option.bonus ? `<div style="color: var(--success); font-size: 0.8rem;">üí° ${option.bonus}</div>` : ''}
                    ${option.penalty ? `<div style="color: var(--warning); font-size: 0.8rem;">‚ö†Ô∏è ${option.penalty}</div>` : ''}
                </div>
            `).join('');

            document.getElementById('strategyOptions').innerHTML = strategyOptions.map(option => `
                <div class="option-card" data-type="strategy" data-id="${option.id}"
                     onclick="selectCapitalismOption('strategy', '${option.id}')"
                     style="padding: 15px; border: 2px solid rgba(255,255,255,0.1); border-radius: 8px; cursor: pointer;">
                    <h4 style="color: var(--primary); margin: 0 0 8px 0;">${option.name}</h4>
                    <p style="color: #94a3b8; margin: 5px 0; font-size: 0.9rem;">${option.description}</p>
                </div>
            `).join('');

            // Í∏∞Î≥∏Í∞í ÏÑ†ÌÉù
            window.selectedCapitalismOptions = { facility: 'small', staffing: 'standard', strategy: 'balanced' };
            selectCapitalismOption('facility', 'small');
            selectCapitalismOption('staffing', 'standard');
            selectCapitalismOption('strategy', 'balanced');
        }

        // Ï∫êÌîºÌÉàÎ¶¨Ï¶ò ÏòµÏÖò ÏÑ†ÌÉù
        function selectCapitalismOption(type, id) {
            // Ïù¥Ï†Ñ ÏÑ†ÌÉù Ìï¥Ï†ú
            document.querySelectorAll(`[data-type="${type}"]`).forEach(el => {
                el.style.border = '2px solid rgba(255,255,255,0.1)';
            });

            // ÌòÑÏû¨ ÏÑ†ÌÉù ÌëúÏãú
            const selectedElement = document.querySelector(`[data-type="${type}"][data-id="${id}"]`);
            if (selectedElement) {
                selectedElement.style.border = '2px solid var(--primary)';
            }

            // ÏÑ†ÌÉù Ï†ÄÏû•
            window.selectedCapitalismOptions[type] = id;
            updateCapitalismEstimate();
        }

        // ÏòàÏÉÅ ÏàòÏπò ÏóÖÎç∞Ïù¥Ìä∏
        function updateCapitalismEstimate() {
            const business = window.currentSelectedBusiness;
            if (!business) return;

            const options = window.selectedCapitalismOptions;
            
            // Î∞∞Ïú® Í≥ÑÏÇ∞
            const facilityMultipliers = { small: 1.0, medium: 1.8, large: 3.0, mega: 5.0 };
            const staffingMultipliers = { minimal: 0.8, standard: 1.0, expanded: 1.5, premium: 2.0 };
            
            const facilityMultiplier = facilityMultipliers[options.facility];
            const staffingMultiplier = staffingMultipliers[options.staffing];

            // ÏµúÏ¢Ö Í≥ÑÏÇ∞
            const totalCost = Math.floor(business.cost * facilityMultiplier);
            const totalEmployees = Math.floor(business.employees * facilityMultiplier * staffingMultiplier);
            
            let monthlyRevenue = 0;
            let finalProduction = 0;
            
            // Ïú†ÌÜµÏóÖ/ÏÜåÎß§ÏóÖÏù∏ÏßÄ ÌôïÏù∏ (monthlyRevenue ÏÜçÏÑ± ÏûàÎäîÏßÄÎ°ú ÌåêÎã®)
            if (business.monthlyRevenue) {
                // Ïú†ÌÜµÏóÖÍ≥º ÏÜåÎß§ÏóÖ: ÏßÅÏ†ë ÏàòÏùµ Í≥ÑÏÇ∞
                const baseRevenue = Math.floor(business.monthlyRevenue * facilityMultiplier);
                
                // ÏàòÏùµÏÑ± Î≥¥ÎÑàÏä§ Í≥ÑÏÇ∞
                let revenueBonus = 0;
                if (options.staffing === 'expanded') revenueBonus += 0.2;
                if (options.staffing === 'premium') revenueBonus += 0.4;
                if (options.strategy === 'quality_focus') revenueBonus += 0.3;
                if (options.strategy === 'innovation') revenueBonus += 0.35;
                
                monthlyRevenue = Math.floor(baseRevenue * (1 + revenueBonus));
            } else {
                // Ï†úÏ°∞ÏóÖÍ≥º ÏõêÏûêÏû¨ÏóÖ: Í∏∞Ï°¥ ÏÉùÏÇ∞Îüâ * Í∞ÄÍ≤© Î∞©Ïãù
                const baseProduction = Math.floor(business.monthlyProduction * facilityMultiplier);
                
                // ÏÉùÏÇ∞ÏÑ± Î≥¥ÎÑàÏä§ Í≥ÑÏÇ∞
                let productivityBonus = 0;
                if (options.staffing === 'expanded') productivityBonus += 0.2;
                if (options.staffing === 'premium') productivityBonus += 0.4;
                if (options.strategy === 'innovation') productivityBonus += 0.35;

                finalProduction = Math.floor(baseProduction * (1 + productivityBonus));
                
                // ÏãúÏû• Í∞ÄÍ≤©ÏúºÎ°ú ÏàòÏùµ Í≥ÑÏÇ∞
                const marketPrice = gameState.roleData.supplyChain.marketPrices.get(business.product);
                monthlyRevenue = marketPrice ? finalProduction * marketPrice.price : 0;
            }

            // Ïö¥ÏòÅÎπÑ Í≥ÑÏÇ∞
            let operatingCostMultiplier = 0.05;
            if (options.strategy === 'cost_focus') operatingCostMultiplier *= 0.8;
            if (options.strategy === 'quality_focus') operatingCostMultiplier *= 1.3;
            if (options.strategy === 'innovation') operatingCostMultiplier *= 1.5;

            const monthlyOperatingCost = Math.floor(totalCost * operatingCostMultiplier);
            const monthlyProfit = monthlyRevenue - monthlyOperatingCost;

            // ÏßÅÏõê Ïàò Î≥¥ÎÑàÏä§ Í≥ÑÏÇ∞
            const employeeBonus = calculateEmployeeBonus(totalEmployees);

            document.getElementById('finalEstimate').innerHTML = `
                <h3 style="color: var(--success); margin-bottom: 15px;">üí∞ ÏµúÏ¢Ö ÏòàÏÉÅ ÏàòÏπò</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; font-size: 0.9rem;">
                    <div>
                        <span style="color: #64748b;">Ï¥ù Ìà¨ÏûêÎπÑÏö©:</span>
                        <div style="color: var(--danger); font-weight: 600; font-size: 1.1rem;">${totalCost.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß</div>
                    </div>
                    <div>
                        <span style="color: #64748b;">Ï¥ù ÏßÅÏõê Ïàò:</span>
                        <div style="color: #e2e8f0; font-weight: 600; font-size: 1.1rem;">${totalEmployees}Î™Ö</div>
                    </div>
                    <div>
                        <span style="color: #64748b;">Ïõî ÏÉùÏÇ∞Îüâ:</span>
                        <div style="color: var(--primary); font-weight: 600; font-size: 1.1rem;">${finalProduction.toLocaleString()}Í∞ú</div>
                    </div>
                    <div>
                        <span style="color: #64748b;">Ïõî Îß§Ï∂ú:</span>
                        <div style="color: var(--success); font-weight: 600; font-size: 1.1rem;">${monthlyRevenue.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß</div>
                    </div>
                    <div>
                        <span style="color: #64748b;">Ïõî ÏàúÏù¥Ïùµ:</span>
                        <div style="color: ${monthlyProfit >= 0 ? 'var(--success)' : 'var(--danger)'}; font-weight: 600; font-size: 1.1rem;">${monthlyProfit.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß</div>
                    </div>
                    <div>
                        <span style="color: #64748b;">ÏßÅÏõê Î≥¥ÎÑàÏä§:</span>
                        <div style="color: var(--warning); font-weight: 600; font-size: 1.1rem;">+${(employeeBonus * 100).toFixed(1)}%</div>
                    </div>
                </div>

                ${employeeBonus > 0 ? `
                    <div style="margin-top: 15px; padding: 10px; background: rgba(245, 158, 11, 0.1); border: 1px solid rgba(245, 158, 11, 0.3); border-radius: 8px;">
                        <div style="color: var(--warning); font-weight: 600; margin-bottom: 5px;">üöÄ ÎåÄÍ∑úÎ™® Ï°∞ÏßÅ Î≥¥ÎÑàÏä§!</div>
                        <div style="color: #cbd5e1; font-size: 0.9rem;">ÏßÅÏõê ${totalEmployees}Î™ÖÏúºÎ°ú Ïù∏Ìïú ÌôïÏû•/Ìö®Ïú®ÏÑ± Î≥¥ÎÑàÏä§ Ï†ÅÏö©</div>
                    </div>
                ` : ''}
            `;

            // ÏµúÏ¢Ö ÏàòÏπò Ï†ÄÏû•
            window.finalCapitalismEstimate = {
                cost: totalCost, employees: totalEmployees, production: finalProduction,
                revenue: monthlyRevenue, profit: monthlyProfit, employeeBonus: employeeBonus, business: business
            };
        }

        // ÏßÅÏõê Ïàò Î≥¥ÎÑàÏä§ Í≥ÑÏÇ∞
        function calculateEmployeeBonus(employeeCount) {
            if (employeeCount >= 100) return 0.5; // 100Î™Ö Ïù¥ÏÉÅ: 50% Î≥¥ÎÑàÏä§
            if (employeeCount >= 50) return 0.3;  // 50Î™Ö Ïù¥ÏÉÅ: 30% Î≥¥ÎÑàÏä§
            if (employeeCount >= 25) return 0.2;  // 25Î™Ö Ïù¥ÏÉÅ: 20% Î≥¥ÎÑàÏä§
            if (employeeCount >= 15) return 0.1;  // 15Î™Ö Ïù¥ÏÉÅ: 10% Î≥¥ÎÑàÏä§
            return 0; // 15Î™Ö ÎØ∏Îßå: Î≥¥ÎÑàÏä§ ÏóÜÏùå
        }

        // Ï∫êÌîºÌÉàÎ¶¨Ï¶ò ÏÇ¨ÏóÖ ÌôïÏ†ï
        function confirmCapitalismBusiness(businessId, category) {
            const estimate = window.finalCapitalismEstimate;
            if (!estimate) return;

            if (gameState.currentUser.game_balance < estimate.cost) {
                showNotification(`ÏÇ¨ÏóÖ ÏÑ§Î¶ΩÏóê ${estimate.cost.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîßÏù¥ ÌïÑÏöîÌï©ÎãàÎã§`, 'error');
                return;
            }

            // ÏÑ±Í≥µÎ•† = 60% + ÏßÅÏõê Î≥¥ÎÑàÏä§
            const baseSuccessRate = 0.6;
            const employeeBonusRate = estimate.employeeBonus * 0.5;
            const finalSuccessRate = Math.min(baseSuccessRate + employeeBonusRate, 0.95);

            const isSuccess = Math.random() < finalSuccessRate;
            gameState.currentUser.game_balance -= estimate.cost;
            closeModal();

            if (isSuccess) {
                const newBusiness = {
                    id: Date.now(), name: estimate.business.name, type: 'capitalism_business',
                    category: category, sector: estimate.business.sector, level: 1,
                    profit: estimate.profit, employees: estimate.employees, value: estimate.cost,
                    monthlyExpenses: Math.floor(estimate.profit * 0.3), founded: new Date().getFullYear(),
                    shares: 1000000, publicShares: 0, isPublic: false,
                    production: estimate.production, product: estimate.business.product, employeeBonus: estimate.employeeBonus
                };

                gameState.roleData.businesses.push(newBusiness);
                
                // Í≥µÍ∏âÎßùÏóê ÏÇ¨ÏóÖÏ≤¥ Ï∂îÍ∞Ä
                if (category === 'rawMaterials') {
                    gameState.roleData.supplyChain.rawMaterials.push(newBusiness);
                } else if (category === 'manufacturers') {
                    gameState.roleData.supplyChain.manufacturers.push(newBusiness);
                } else if (category === 'distributors') {
                    gameState.roleData.supplyChain.distributors.push(newBusiness);
                } else if (category === 'retailers') {
                    gameState.roleData.supplyChain.retailers.push(newBusiness);
                }
                
                updateBusinessDisplay();
                updateDisplay();
                showNotification(`üéâ ${estimate.business.name} ÏÑ§Î¶Ω ÏÑ±Í≥µ! ÏßÅÏõê ${estimate.employees}Î™ÖÏúºÎ°ú ÏãúÏûëÌï©ÎãàÎã§!`, 'success');
            } else {
                const recoveredAmount = Math.floor(estimate.cost * 0.4);
                gameState.currentUser.game_balance += recoveredAmount;
                updateDisplay();
                showNotification(`‚ùå ${estimate.business.name} ÏÑ§Î¶Ω Ïã§Ìå®... ${recoveredAmount.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîßÎßå ÌöåÏàòÌñàÏäµÎãàÎã§.`, 'error');
            }
        }

        // ÏãúÏû• Í∞ÄÍ≤© ÌëúÏãú
        function showMarketPrices() {
            const marketPrices = gameState.roleData.supplyChain.marketPrices;
            let priceList = '';
            
            marketPrices.forEach((data, product) => {
                const trend = data.demand > data.supply ? 'üìà' : data.demand < data.supply ? 'üìâ' : '‚û°Ô∏è';
                const trendColor = data.demand > data.supply ? 'var(--success)' : data.demand < data.supply ? 'var(--danger)' : 'var(--warning)';
                
                priceList += `
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; border-bottom: 1px solid rgba(255,255,255,0.1);">
                        <div><span style="color: #e2e8f0; font-weight: 600;">${product}</span></div>
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <span style="color: var(--success); font-weight: 600;">${data.price.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß</span>
                            <span style="color: ${trendColor};">${trend}</span>
                        </div>
                    </div>
                `;
            });

            const modalContent = `
                <h2 style="text-align: center; margin-bottom: 30px; color: var(--primary);">üíπ ÏãúÏû• Í∞ÄÍ≤© ÌòÑÌô©</h2>
                
                <div style="background: rgba(255,255,255,0.05); border-radius: 12px; padding: 20px; max-height: 60vh; overflow-y: auto;">
                    ${priceList}
                </div>

                <div style="margin-top: 20px; text-align: center;">
                    <button onclick="openCapitalismBusinessModal()" style="
                        padding: 10px 20px; border: 1px solid rgba(255,255,255,0.2);
                        background: rgba(255,255,255,0.05); color: #e2e8f0;
                        border-radius: 8px; cursor: pointer;">Îí§Î°ú Í∞ÄÍ∏∞</button>
                </div>
            `;
            
            showModal(modalContent);
        }

        // Í∏∞Ï°¥ ÏÇ¨ÏóÖ ÏÉùÏÑ± Î≤ÑÌäºÏùÑ ÌôïÏû•
        const originalCreateNewBusiness = createNewBusiness;
        function createNewBusiness() {
            const modalContent = `
                <h2 style="text-align: center; margin-bottom: 30px; color: var(--primary);">üè™ ÏÇ¨ÏóÖ Ïú†Ìòï ÏÑ†ÌÉù</h2>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px;">
                    <div onclick="openBusinessSelectionModal()" style="
                        padding: 30px; background: linear-gradient(135deg, var(--primary), var(--secondary));
                        border-radius: 12px; cursor: pointer; text-align: center;">
                        <div style="font-size: 2.5rem; margin-bottom: 15px;">üè™</div>
                        <h3 style="color: white; margin-bottom: 10px;">ÏùºÎ∞ò ÏÇ¨ÏóÖ</h3>
                        <p style="color: rgba(255,255,255,0.8); font-size: 0.9rem;">Ïπ¥Ìéò, ITÏä§ÌÉÄÌä∏ÏóÖ, ÏùåÏãùÏ†ê Îì±<br>Ï†ÑÌÜµÏ†ÅÏù∏ ÎπÑÏ¶àÎãàÏä§ Î™®Îç∏</p>
                    </div>

                    <div onclick="openCapitalismBusinessModal()" style="
                        padding: 30px; background: linear-gradient(135deg, var(--success), #047857);
                        border-radius: 12px; cursor: pointer; text-align: center;">
                        <div style="font-size: 2.5rem; margin-bottom: 15px;">üè≠</div>
                        <h3 style="color: white; margin-bottom: 10px;">ÏÇ∞ÏóÖ Ï†úÍµ≠</h3>
                        <p style="color: rgba(255,255,255,0.8); font-size: 0.9rem;">ÏõêÏûêÏû¨Î∂ÄÌÑ∞ ÏÜåÎß§ÍπåÏßÄ<br>ÏôÑÏ†ÑÌïú Í≥µÍ∏âÎßù Íµ¨Ï∂ï</p>
                    </div>
                </div>

                <div style="background: rgba(99, 102, 241, 0.1); border-radius: 12px; padding: 20px;">
                    <h4 style="color: var(--primary); margin-bottom: 10px;">üí° ÏÇ∞ÏóÖ Ï†úÍµ≠ Î™®ÎìúÎûÄ?</h4>
                    <ul style="color: #cbd5e1; font-size: 0.9rem; margin: 0; padding-left: 20px;">
                        <li>Ï∫êÌîºÌÉàÎ¶¨Ï¶ò2 Ïä§ÌÉÄÏùºÏùò Î≥µÌï© Í≤ΩÏ†ú ÏãúÎÆ¨Î†àÏù¥ÏÖò</li>
                        <li>ÎÜçÏû•‚ÜíÍ≥µÏû•‚ÜíÎèÑÎß§‚ÜíÏÜåÎß§Ïùò ÏôÑÏ†ÑÌïú Í∞ÄÏπòÏÇ¨Ïä¨ Íµ¨Ï∂ï</li>
                        <li>Í≥µÍ∏âÍ≥ÑÏïΩ, Ïû¨Í≥†Í¥ÄÎ¶¨, ÏãúÏû• ÏàòÍ∏â Î∂ÑÏÑù</li>
                        <li>Í∑πÌïúÏùò ÏûêÏú†ÎèÑÎ°ú Í±∞ÎåÄÌïú ÏÇ∞ÏóÖ Ï†úÍµ≠ÏùÑ Í±¥ÏÑ§</li>
                    </ul>
                </div>
            `;
            
            showModal(modalContent);
        }

        // Ïú†ÌÜµÏóÖ ÌëúÏãú
        function showDistributionBusinesses() {
            const businesses = [
                {
                    id: 'wholesale_center',
                    name: 'ÎèÑÎß§ Ïú†ÌÜµÏÑºÌÑ∞',
                    icon: 'üè¨',
                    products: ['bread', 'clothing', 'furniture'],
                    cost: 75000,
                    monthlyRevenue: 12000,
                    employees: 15,
                    description: 'Ï†úÏ°∞ÏóÖÏ≤¥ÏôÄ ÏÜåÎß§Ï†êÏùÑ Ïó∞Í≤∞ÌïòÎäî ÎåÄÍ∑úÎ™® Ïú†ÌÜµÏÑºÌÑ∞',
                    requirements: 'Ï†úÏ°∞ÏóÖÏ≤¥ Í≥ÑÏïΩ ÌïÑÏöî, Ï∞ΩÍ≥† 1000Ìèâ'
                },
                {
                    id: 'logistics_hub',
                    name: 'Î¨ºÎ•ò ÌóàÎ∏å',
                    icon: 'üöõ',
                    products: ['all_products'],
                    cost: 120000,
                    monthlyRevenue: 18000,
                    employees: 25,
                    description: 'Ï†ÑÍµ≠ Î∞∞ÏÜ°ÎßùÏùÑ Í∞ñÏ∂ò Ï¢ÖÌï© Î¨ºÎ•òÏÑºÌÑ∞',
                    requirements: 'ÍµêÌÜµ ÏöîÏ∂©ÏßÄ ÌïÑÏöî, Ï∞®Îüâ 100ÎåÄ'
                },
                {
                    id: 'cold_chain',
                    name: 'ÎÉâÏû• Ïú†ÌÜµÏÑºÌÑ∞',
                    icon: 'üßä',
                    products: ['milk', 'beef'],
                    cost: 95000,
                    monthlyRevenue: 15000,
                    employees: 18,
                    description: 'Ïã†ÏÑ†ÏãùÌíà Ï†ÑÏö© ÎÉâÏû• Ïú†ÌÜµ ÏãúÏÑ§',
                    requirements: 'ÎÉâÏû•ÏÑ§ÎπÑ ÌïÑÏöî, ÎÜçÏû• Í≥ÑÏïΩ'
                },
                {
                    id: 'import_distributor',
                    name: 'ÏàòÏûÖ Ï¥ùÌåê',
                    icon: 'üåè',
                    products: ['luxury_goods', 'electronics'],
                    cost: 150000,
                    monthlyRevenue: 22000,
                    employees: 20,
                    description: 'Ìï¥Ïô∏ Î∏åÎûúÎìú ÎèÖÏ†ê ÏàòÏûÖ Ïú†ÌÜµÏóÖ',
                    requirements: 'ÏàòÏûÖ ÎùºÏù¥ÏÑ†Ïä§ ÌïÑÏöî'
                }
            ];

            showBusinessTypeSelection(businesses, 'distributors', 'Ïú†ÌÜµÏóÖ');
        }

        // ÏÜåÎß§ÏóÖ ÌëúÏãú
        function showRetailBusinesses() {
            const businesses = [
                {
                    id: 'department_store',
                    name: 'Î∞±ÌôîÏ†ê',
                    icon: 'üè¨',
                    products: ['clothing', 'furniture', 'luxury_goods'],
                    cost: 200000,
                    monthlyRevenue: 35000,
                    employees: 50,
                    description: 'Í≥†Í∏â Î∏åÎûúÎìú ÏúÑÏ£ºÏùò ÎåÄÌòï Î∞±ÌôîÏ†ê',
                    requirements: 'ÏÉÅÍ∂å ÏûÖÏßÄ ÌïÑÏöî, Î∏åÎûúÎìú Í≥ÑÏïΩ'
                },
                {
                    id: 'supermarket',
                    name: 'ÎåÄÌòïÎßàÌä∏',
                    icon: 'üõí',
                    products: ['bread', 'milk', 'beef', 'processed_foods'],
                    cost: 180000,
                    monthlyRevenue: 28000,
                    employees: 40,
                    description: 'ÏùºÏÉÅ ÏÉùÌïÑÌíà ÏúÑÏ£ºÏùò ÎåÄÌòï Ìï†Ïù∏ÎßàÌä∏',
                    requirements: 'ÎåÄÍ∑úÎ™® Îß§Ïû• Î∂ÄÏßÄ ÌïÑÏöî'
                },
                {
                    id: 'convenience_store',
                    name: 'Ìé∏ÏùòÏ†ê Ï≤¥Ïù∏',
                    icon: 'üè™',
                    products: ['processed_foods', 'beverages'],
                    cost: 80000,
                    monthlyRevenue: 15000,
                    employees: 12,
                    description: '24ÏãúÍ∞Ñ Ïö¥ÏòÅÌïòÎäî Ìé∏ÏùòÏ†ê ÌîÑÎûúÏ∞®Ïù¥Ï¶à',
                    requirements: 'Ïú†ÎèôÏù∏Íµ¨ ÎßéÏùÄ ÏßÄÏó≠ ÌïÑÏöî'
                },
                {
                    id: 'specialty_store',
                    name: 'Ï†ÑÎ¨∏ ÌåêÎß§Ï†ê',
                    icon: 'üéØ',
                    products: ['electronics', 'luxury_goods'],
                    cost: 120000,
                    monthlyRevenue: 20000,
                    employees: 15,
                    description: 'ÌäπÏ†ï Î∏åÎûúÎìúÎÇò Ïπ¥ÌÖåÍ≥†Î¶¨ Ï†ÑÎ¨∏ Îß§Ïû•',
                    requirements: 'Î∏åÎûúÎìú ÎåÄÎ¶¨Ï†ê Í≥ÑÏïΩ ÌïÑÏöî'
                },
                {
                    id: 'online_mall',
                    name: 'Ïò®ÎùºÏù∏ ÏáºÌïëÎ™∞',
                    icon: 'üíª',
                    products: ['all_products'],
                    cost: 60000,
                    monthlyRevenue: 18000,
                    employees: 8,
                    description: 'Ïù∏ÌÑ∞ÎÑ∑ Í∏∞Î∞ò Ï¢ÖÌï© ÏáºÌïëÎ™∞',
                    requirements: 'IT Ïù∏ÌîÑÎùº, Î¨ºÎ•òÏÑºÌÑ∞ Ïó∞Í≥Ñ'
                },
                {
                    id: 'franchise_dealer',
                    name: 'Í∞ÄÎßπÏ†ê Î≥∏Î∂Ä',
                    icon: 'üè¢',
                    products: ['franchise_rights'],
                    cost: 250000,
                    monthlyRevenue: 45000,
                    employees: 30,
                    description: 'ÌîÑÎûúÏ∞®Ïù¥Ï¶à Í∞ÄÎßπÏ†êÏùÑ Ïö¥ÏòÅÌïòÎäî Î≥∏Î∂Ä',
                    requirements: 'Î∏åÎûúÎìú Í∞úÎ∞ú, Í∞ÄÎßπÏ†ê Í¥ÄÎ¶¨ ÏãúÏä§ÌÖú'
                }
            ];

            showBusinessTypeSelection(businesses, 'retailers', 'ÏÜåÎß§ÏóÖ');
        }

        // Í≥µÍ∏âÎßù ÌòÑÌô© ÌëúÏãú
        function showSupplyChainOverview() {
            const supplyChain = gameState.roleData.supplyChain;
            
            const modalContent = `
                <h2 style="text-align: center; margin-bottom: 30px; color: var(--primary);">üîó Í≥µÍ∏âÎßù ÌòÑÌô©</h2>
                
                <!-- Í≥µÍ∏âÎßù Îã®Í≥ÑÎ≥Ñ ÌòÑÌô© -->
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 15px; margin-bottom: 30px;">
                    <div style="background: rgba(34, 197, 94, 0.1); border: 1px solid rgba(34, 197, 94, 0.3); border-radius: 12px; padding: 15px; text-align: center;">
                        <h3 style="color: var(--success); margin: 0 0 10px 0; font-size: 0.9rem;">üåæ ÏõêÏûêÏû¨</h3>
                        <div style="font-size: 1.5rem; font-weight: bold; color: #e2e8f0;">${supplyChain.rawMaterials.length}</div>
                        <div style="font-size: 0.8rem; color: #94a3b8;">Í∞ú ÏÇ¨ÏóÖÏ≤¥</div>
                    </div>
                    
                    <div style="background: rgba(59, 130, 246, 0.1); border: 1px solid rgba(59, 130, 246, 0.3); border-radius: 12px; padding: 15px; text-align: center;">
                        <h3 style="color: var(--primary); margin: 0 0 10px 0; font-size: 0.9rem;">üè≠ Ï†úÏ°∞ÏóÖ</h3>
                        <div style="font-size: 1.5rem; font-weight: bold; color: #e2e8f0;">${supplyChain.manufacturers.length}</div>
                        <div style="font-size: 0.8rem; color: #94a3b8;">Í∞ú ÏÇ¨ÏóÖÏ≤¥</div>
                    </div>
                    
                    <div style="background: rgba(16, 185, 129, 0.1); border: 1px solid rgba(16, 185, 129, 0.3); border-radius: 12px; padding: 15px; text-align: center;">
                        <h3 style="color: #10b981; margin: 0 0 10px 0; font-size: 0.9rem;">üöõ Ïú†ÌÜµÏóÖ</h3>
                        <div style="font-size: 1.5rem; font-weight: bold; color: #e2e8f0;">${supplyChain.distributors.length}</div>
                        <div style="font-size: 0.8rem; color: #94a3b8;">Í∞ú ÏÇ¨ÏóÖÏ≤¥</div>
                    </div>
                    
                    <div style="background: rgba(139, 92, 246, 0.1); border: 1px solid rgba(139, 92, 246, 0.3); border-radius: 12px; padding: 15px; text-align: center;">
                        <h3 style="color: #8b5cf6; margin: 0 0 10px 0; font-size: 0.9rem;">üè™ ÏÜåÎß§ÏóÖ</h3>
                        <div style="font-size: 1.5rem; font-weight: bold; color: #e2e8f0;">${supplyChain.retailers.length}</div>
                        <div style="font-size: 0.8rem; color: #94a3b8;">Í∞ú ÏÇ¨ÏóÖÏ≤¥</div>
                    </div>
                </div>

                <!-- ÏãúÏû• Í∞ÄÍ≤© ÌòÑÌô© -->
                <div style="margin-bottom: 30px;">
                    <h3 style="color: var(--warning); margin-bottom: 15px;">üìä ÏãúÏû• Í∞ÄÍ≤© ÌòÑÌô©</h3>
                    <div style="max-height: 200px; overflow-y: auto; background: rgba(255,255,255,0.02); border-radius: 10px; padding: 10px;">
                        ${Array.from(supplyChain.marketPrices.entries()).map(([product, data]) => {
                            const trend = data.demand > data.supply ? 'üìà' : data.demand < data.supply ? 'üìâ' : '‚û°Ô∏è';
                            const trendColor = data.demand > data.supply ? 'var(--success)' : data.demand < data.supply ? 'var(--danger)' : 'var(--warning)';
                            return `
                                <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px 0; border-bottom: 1px solid rgba(255,255,255,0.05);">
                                    <span style="color: #e2e8f0;">${getProductKoreanName(product)}</span>
                                    <div style="display: flex; align-items: center; gap: 10px;">
                                        <span style="color: var(--warning); font-weight: bold;">${data.price.toLocaleString()}ÎπÑÌä∏ÌÅ¨Î†àÎîß</span>
                                        <span style="color: ${trendColor}; font-size: 1.2rem;">${trend}</span>
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                </div>

                <!-- Í≥µÍ∏âÎßù Í¥ÄÎ¶¨ Î©îÎâ¥ -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                    <button onclick="showSupplyChainContracts()" style="
                        padding: 15px;
                        background: var(--primary);
                        color: white;
                        border: none;
                        border-radius: 10px;
                        cursor: pointer;
                        font-size: 0.9rem;
                        font-weight: 600;
                    ">üìù Í≥µÍ∏â Í≥ÑÏïΩ Í¥ÄÎ¶¨</button>
                    
                    <button onclick="showInventoryManagement()" style="
                        padding: 15px;
                        background: var(--success);
                        color: white;
                        border: none;
                        border-radius: 10px;
                        cursor: pointer;
                        font-size: 0.9rem;
                        font-weight: 600;
                    ">üì¶ Ïû¨Í≥† Í¥ÄÎ¶¨</button>
                </div>

                <div style="text-align: center;">
                    <button onclick="closeModal()" style="
                        padding: 10px 20px;
                        border: 1px solid rgba(255,255,255,0.2);
                        background: rgba(255,255,255,0.05);
                        color: #e2e8f0;
                        border-radius: 8px;
                        cursor: pointer;
                    ">Îã´Í∏∞</button>
                </div>
            `;
            
            showModal(modalContent);
        }

        // Ï†úÌíàÎ™Ö ÌïúÍ∏Ä Î≥ÄÌôò
        function getProductKoreanName(product) {
            const names = {
                'wheat': 'Î∞Ä',
                'corn': 'Ïò•ÏàòÏàò', 
                'cotton': 'Î™©Ìôî',
                'lumber': 'Î™©Ïû¨',
                'iron_ore': 'Ï≤†Í¥ëÏÑù',
                'coal': 'ÏÑùÌÉÑ',
                'oil': 'ÏõêÏú†',
                'milk': 'Ïö∞Ïú†',
                'beef': 'Ïá†Í≥†Í∏∞',
                'bread': 'Îπµ',
                'textiles': 'ÏÑ¨Ïú†',
                'furniture': 'Í∞ÄÍµ¨',
                'steel': 'Í∞ïÏ≤†'
            };
            return names[product] || product;
        }

        // Í≥µÍ∏â Í≥ÑÏïΩ Í¥ÄÎ¶¨
        function showSupplyChainContracts() {
            const supplyChain = gameState.roleData.supplyChain;
            
            const modalContent = `
                <h2 style="text-align: center; margin-bottom: 30px; color: var(--primary);">üìù Í≥µÍ∏â Í≥ÑÏïΩ Í¥ÄÎ¶¨</h2>
                
                <!-- ÌòÑÏû¨ Í≥ÑÏïΩ ÌòÑÌô© -->
                <div style="margin-bottom: 30px;">
                    <h3 style="color: var(--success); margin-bottom: 15px;">üìã ÌòÑÏû¨ ÌôúÏÑ± Í≥ÑÏïΩ (${supplyChain.contracts.length}Í±¥)</h3>
                    <div style="max-height: 250px; overflow-y: auto; background: rgba(255,255,255,0.02); border-radius: 10px; padding: 15px;">
                        ${supplyChain.contracts.length > 0 ? supplyChain.contracts.map(contract => `
                            <div style="background: rgba(255,255,255,0.05); border-radius: 8px; padding: 15px; margin-bottom: 10px;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                                    <span style="color: var(--primary); font-weight: bold;">${getProductKoreanName(contract.product)} Í≥µÍ∏âÍ≥ÑÏïΩ</span>
                                    <span style="color: var(--warning); font-size: 0.9rem;">${contract.quantity.toLocaleString()}Í∞ú/Ïõî</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; font-size: 0.9rem; color: #94a3b8;">
                                    <span>Í≥µÍ∏âÏóÖÏ≤¥: ${contract.supplier}</span>
                                    <span>Îã®Í∞Ä: ${contract.price.toLocaleString()}ÎπÑÌä∏ÌÅ¨Î†àÎîß</span>
                                </div>
                                <div style="margin-top: 8px;">
                                    <button onclick="cancelContract('${contract.id}')" style="
                                        padding: 5px 10px; background: var(--danger); color: white;
                                        border: none; border-radius: 5px; cursor: pointer; font-size: 0.8rem;
                                    ">Í≥ÑÏïΩ Ìï¥ÏßÄ</button>
                                </div>
                            </div>
                        `).join('') : '<div style="text-align: center; color: #94a3b8; padding: 20px;">ÌôúÏÑ± Í≥ÑÏïΩÏù¥ ÏóÜÏäµÎãàÎã§</div>'}
                    </div>
                </div>

                <!-- ÏÉà Í≥ÑÏïΩ Ï≤¥Í≤∞ -->
                <div style="margin-bottom: 20px;">
                    <h3 style="color: var(--primary); margin-bottom: 15px;">ü§ù ÏÉà Í≥ÑÏïΩ Ï≤¥Í≤∞</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <button onclick="showAvailableSuppliers()" style="
                            padding: 12px; background: var(--success); color: white;
                            border: none; border-radius: 8px; cursor: pointer; font-weight: 600;
                        ">ÏõêÏûêÏû¨ Í≥µÍ∏âÏóÖÏ≤¥ Ï∞æÍ∏∞</button>
                        
                        <button onclick="showAvailableBuyers()" style="
                            padding: 12px; background: var(--primary); color: white;
                            border: none; border-radius: 8px; cursor: pointer; font-weight: 600;
                        ">Ï†úÌíà ÌåêÎß§Ï≤ò Ï∞æÍ∏∞</button>
                    </div>
                </div>

                <div style="text-align: center;">
                    <button onclick="showSupplyChainOverview()" style="
                        padding: 10px 20px; border: 1px solid rgba(255,255,255,0.2);
                        background: rgba(255,255,255,0.05); color: #e2e8f0;
                        border-radius: 8px; cursor: pointer;
                    ">Í≥µÍ∏âÎßù ÌòÑÌô©ÏúºÎ°ú ÎèåÏïÑÍ∞ÄÍ∏∞</button>
                </div>
            `;
            
            showModal(modalContent);
        }

        // Ïû¨Í≥† Í¥ÄÎ¶¨
        function showInventoryManagement() {
            const supplyChain = gameState.roleData.supplyChain;
            
            const modalContent = `
                <h2 style="text-align: center; margin-bottom: 30px; color: var(--primary);">üì¶ Ïû¨Í≥† Í¥ÄÎ¶¨</h2>
                
                <!-- ÌòÑÏû¨ Ïû¨Í≥† ÌòÑÌô© -->
                <div style="margin-bottom: 30px;">
                    <h3 style="color: var(--success); margin-bottom: 15px;">üìä ÌòÑÏû¨ Î≥¥Ïú† Ïû¨Í≥†</h3>
                    <div style="max-height: 300px; overflow-y: auto; background: rgba(255,255,255,0.02); border-radius: 10px; padding: 15px;">
                        ${supplyChain.inventory.size > 0 ? Array.from(supplyChain.inventory.entries()).map(([product, quantity]) => {
                            const marketPrice = supplyChain.marketPrices.get(product);
                            const totalValue = marketPrice ? quantity * marketPrice.price : 0;
                            return `
                                <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: rgba(255,255,255,0.05); border-radius: 8px; margin-bottom: 10px;">
                                    <div>
                                        <div style="color: var(--primary); font-weight: bold;">${getProductKoreanName(product)}</div>
                                        <div style="color: #94a3b8; font-size: 0.9rem;">Îã®Í∞Ä: ${marketPrice ? marketPrice.price.toLocaleString() : 'Ï†ïÎ≥¥ÏóÜÏùå'}ÎπÑÌä∏ÌÅ¨Î†àÎîß</div>
                                    </div>
                                    <div style="text-align: right;">
                                        <div style="color: #e2e8f0; font-weight: bold;">${quantity.toLocaleString()}Í∞ú</div>
                                        <div style="color: var(--warning); font-size: 0.9rem;">Ï¥ù ${totalValue.toLocaleString()}ÎπÑÌä∏ÌÅ¨Î†àÎîß</div>
                                    </div>
                                </div>
                            `;
                        }).join('') : '<div style="text-align: center; color: #94a3b8; padding: 20px;">Î≥¥Ïú† Ïû¨Í≥†Í∞Ä ÏóÜÏäµÎãàÎã§</div>'}
                    </div>
                </div>

                <!-- Ïû¨Í≥† Í¥ÄÎ¶¨ ÏòµÏÖò -->
                <div style="margin-bottom: 20px;">
                    <h3 style="color: var(--warning); margin-bottom: 15px;">‚öôÔ∏è Ïû¨Í≥† Í¥ÄÎ¶¨ ÏòµÏÖò</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <button onclick="showInventoryPurchase()" style="
                            padding: 12px; background: var(--success); color: white;
                            border: none; border-radius: 8px; cursor: pointer; font-weight: 600;
                        ">üì• Ïû¨Í≥† Íµ¨Îß§</button>
                        
                        <button onclick="showInventorySale()" style="
                            padding: 12px; background: var(--primary); color: white;
                            border: none; border-radius: 8px; cursor: pointer; font-weight: 600;
                        ">üì§ Ïû¨Í≥† ÌåêÎß§</button>
                    </div>
                </div>

                <div style="text-align: center;">
                    <button onclick="showSupplyChainOverview()" style="
                        padding: 10px 20px; border: 1px solid rgba(255,255,255,0.2);
                        background: rgba(255,255,255,0.05); color: #e2e8f0;
                        border-radius: 8px; cursor: pointer;
                    ">Í≥µÍ∏âÎßù ÌòÑÌô©ÏúºÎ°ú ÎèåÏïÑÍ∞ÄÍ∏∞</button>
                </div>
            `;
            
            showModal(modalContent);
        }

        // ÏûÑÏãú Ìï®ÏàòÎì§ (Íµ¨ÌòÑ ÏòàÏ†ï)
        function cancelContract(contractId) {
            showNotification('Í≥ÑÏïΩ Ìï¥ÏßÄ Í∏∞Îä•ÏùÄ Íµ¨ÌòÑ Ï§ëÏûÖÎãàÎã§!', 'warning');
        }

        function showAvailableSuppliers() {
            showNotification('Í≥µÍ∏âÏóÖÏ≤¥ Ï∞æÍ∏∞ Í∏∞Îä•ÏùÄ Íµ¨ÌòÑ Ï§ëÏûÖÎãàÎã§!', 'warning');
        }

        function showAvailableBuyers() {
            showNotification('ÌåêÎß§Ï≤ò Ï∞æÍ∏∞ Í∏∞Îä•ÏùÄ Íµ¨ÌòÑ Ï§ëÏûÖÎãàÎã§!', 'warning');
        }

        function showInventoryPurchase() {
            showNotification('Ïû¨Í≥† Íµ¨Îß§ Í∏∞Îä•ÏùÄ Íµ¨ÌòÑ Ï§ëÏûÖÎãàÎã§!', 'warning');
        }

        function showInventorySale() {
            showNotification('Ïû¨Í≥† ÌåêÎß§ Í∏∞Îä•ÏùÄ Íµ¨ÌòÑ Ï§ëÏûÖÎãàÎã§!', 'warning');
        }

        // ===== ÎÖ∏ÎèôÏûê Í¥ÄÎ¶¨ ÏãúÏä§ÌÖú =====

        // ÎÖ∏ÎèôÏûê ÏÉùÏÑ±
        function createWorker(businessId, type = 'regular') {
            const names = ['ÍπÄÎØºÏàò', 'Ïù¥ÏòÅÌù¨', 'Î∞ïÏ≤†Ïàò', 'ÏµúÏàòÏßÑ', 'Ï†ïÌòÑÏö∞', 'Í∞ïÏßÄÏùÄ', 'Ï°∞ÏÑ±ÎØº', 'Ïú§ÏÜåÏòÅ', 'ÏûÑÎåÄÌòÑ', 'ÌïúÎØ∏Îûò'];
            const skills = ['production', 'quality', 'leadership', 'creativity'];
            
            const worker = {
                id: Date.now() + Math.random(),
                name: names[Math.floor(Math.random() * names.length)],
                age: 22 + Math.floor(Math.random() * 38), // 22-60ÏÑ∏
                businessId: businessId,
                position: type === 'regular' ? 'ÏÇ¨Ïõê' : type === 'manager' ? 'ÌåÄÏû•' : 'Î∂ÄÏû•',
                experience: Math.floor(Math.random() * 10), // 0-10ÎÖÑ Í≤ΩÎ†•
                skills: {
                    production: 30 + Math.floor(Math.random() * 70), // 30-100
                    quality: 30 + Math.floor(Math.random() * 70),
                    leadership: 20 + Math.floor(Math.random() * 60),
                    creativity: 20 + Math.floor(Math.random() * 60)
                },
                salary: calculateBaseSalary(type),
                satisfaction: 70 + Math.floor(Math.random() * 30), // 70-100%
                performance: 50 + Math.floor(Math.random() * 50), // 50-100%
                hireDate: new Date(),
                contracts: {
                    salaryBonus: 0,
                    benefits: ['Í∏∞Î≥∏ÏùòÎ£åÎ≥¥Ìóò'],
                    vacationDays: 15
                },
                training: {
                    inProgress: null,
                    completed: [],
                    nextAvailable: new Date()
                },
                status: 'active' // active, training, sick, strike
            };
            
            return worker;
        }

        // Í∏∞Î≥∏ Í∏âÏó¨ Í≥ÑÏÇ∞
        function calculateBaseSalary(position) {
            const baseSalaries = {
                'ÏÇ¨Ïõê': 3000 + Math.floor(Math.random() * 1000),
                'ÌåÄÏû•': 5000 + Math.floor(Math.random() * 2000), 
                'Î∂ÄÏû•': 8000 + Math.floor(Math.random() * 3000),
                'ÏûÑÏõê': 12000 + Math.floor(Math.random() * 5000)
            };
            return baseSalaries[position] || 3000;
        }

        // ÎÖ∏ÎèôÏûê Í¥ÄÎ¶¨ Î©îÏù∏ ÌôîÎ©¥
        function showWorkforceManagement() {
            const workforce = gameState.roleData.workforce;
            
            const modalContent = `
                <h2 style="text-align: center; margin-bottom: 30px; color: var(--primary);">üë• ÎÖ∏ÎèôÏûê Í¥ÄÎ¶¨</h2>
                
                <!-- ÎÖ∏ÎèôÏûê ÌòÑÌô© ÏöîÏïΩ -->
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 15px; margin-bottom: 30px;">
                    <div style="background: rgba(34, 197, 94, 0.1); border: 1px solid rgba(34, 197, 94, 0.3); border-radius: 12px; padding: 15px; text-align: center;">
                        <h3 style="color: var(--success); margin: 0 0 10px 0; font-size: 0.9rem;">üë§ Ï†ÑÏ≤¥ ÏßÅÏõê</h3>
                        <div style="font-size: 1.5rem; font-weight: bold; color: #e2e8f0;">${workforce.workers.length}</div>
                        <div style="font-size: 0.8rem; color: #94a3b8;">Î™Ö</div>
                    </div>
                    
                    <div style="background: rgba(59, 130, 246, 0.1); border: 1px solid rgba(59, 130, 246, 0.3); border-radius: 12px; padding: 15px; text-align: center;">
                        <h3 style="color: var(--primary); margin: 0 0 10px 0; font-size: 0.9rem;">üíº Í¥ÄÎ¶¨ÏßÅ</h3>
                        <div style="font-size: 1.5rem; font-weight: bold; color: #e2e8f0;">${workforce.workers.filter(w => ['ÌåÄÏû•', 'Î∂ÄÏû•', 'ÏûÑÏõê'].includes(w.position)).length}</div>
                        <div style="font-size: 0.8rem; color: #94a3b8;">Î™Ö</div>
                    </div>
                    
                    <div style="background: rgba(245, 158, 11, 0.1); border: 1px solid rgba(245, 158, 11, 0.3); border-radius: 12px; padding: 15px; text-align: center;">
                        <h3 style="color: var(--warning); margin: 0 0 10px 0; font-size: 0.9rem;">üòä ÌèâÍ∑† ÎßåÏ°±ÎèÑ</h3>
                        <div style="font-size: 1.5rem; font-weight: bold; color: #e2e8f0;">${workforce.workers.length > 0 ? Math.round(workforce.workers.reduce((a, w) => a + w.satisfaction, 0) / workforce.workers.length) : 0}</div>
                        <div style="font-size: 0.8rem; color: #94a3b8;">%</div>
                    </div>
                    
                    <div style="background: rgba(168, 85, 247, 0.1); border: 1px solid rgba(168, 85, 247, 0.3); border-radius: 12px; padding: 15px; text-align: center;">
                        <h3 style="color: #a855f7; margin: 0 0 10px 0; font-size: 0.9rem;">üìö ÍµêÏú°Ï§ë</h3>
                        <div style="font-size: 1.5rem; font-weight: bold; color: #e2e8f0;">${workforce.workers.filter(w => w.status === 'training').length}</div>
                        <div style="font-size: 0.8rem; color: #94a3b8;">Î™Ö</div>
                    </div>
                </div>

                <!-- ÎÖ∏ÎèôÏûê Í¥ÄÎ¶¨ Î©îÎâ¥ -->
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-bottom: 30px;">
                    <button onclick="showWorkerList()" style="
                        padding: 15px; background: var(--primary); color: white;
                        border: none; border-radius: 10px; cursor: pointer;
                        font-size: 0.9rem; font-weight: 600;
                    ">üë• ÏßÅÏõê Î™ÖÎã®</button>
                    
                    <button onclick="showRecruitment()" style="
                        padding: 15px; background: var(--success); color: white;
                        border: none; border-radius: 10px; cursor: pointer;
                        font-size: 0.9rem; font-weight: 600;
                    ">üîç Ï±ÑÏö©ÌïòÍ∏∞</button>
                    
                    <button onclick="showTrainingPrograms()" style="
                        padding: 15px; background: var(--warning); color: white;
                        border: none; border-radius: 10px; cursor: pointer;
                        font-size: 0.9rem; font-weight: 600;
                    ">üìö ÍµêÏú°ÏÑºÌÑ∞</button>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                    <button onclick="showWorkerSatisfaction()" style="
                        padding: 15px; background: #8b5cf6; color: white;
                        border: none; border-radius: 10px; cursor: pointer;
                        font-size: 0.9rem; font-weight: 600;
                    ">üòä ÎßåÏ°±ÎèÑ Í¥ÄÎ¶¨</button>
                    
                    <button onclick="showUnionManagement()" style="
                        padding: 15px; background: var(--danger); color: white;
                        border: none; border-radius: 10px; cursor: pointer;
                        font-size: 0.9rem; font-weight: 600;
                    ">‚úä ÎÖ∏Ï°∞ Í¥ÄÎ¶¨</button>
                </div>

                <div style="text-align: center;">
                    <button onclick="closeModal()" style="
                        padding: 10px 20px; border: 1px solid rgba(255,255,255,0.2);
                        background: rgba(255,255,255,0.05); color: #e2e8f0;
                        border-radius: 8px; cursor: pointer;
                    ">Îã´Í∏∞</button>
                </div>
            `;
            
            showModal(modalContent);
        }

        // ÏßÅÏõê Î™ÖÎã® Î≥¥Í∏∞
        function showWorkerList() {
            const workforce = gameState.roleData.workforce;
            const businesses = gameState.roleData.businesses;
            
            const modalContent = `
                <h2 style="text-align: center; margin-bottom: 30px; color: var(--primary);">üë• ÏßÅÏõê Î™ÖÎã®</h2>
                
                <div style="max-height: 400px; overflow-y: auto;">
                    ${workforce.workers.length > 0 ? workforce.workers.map(worker => {
                        const business = businesses.find(b => b.id === worker.businessId);
                        const skillAvg = Math.round((worker.skills.production + worker.skills.quality + worker.skills.leadership + worker.skills.creativity) / 4);
                        return `
                            <div style="background: rgba(255,255,255,0.05); border-radius: 10px; padding: 15px; margin-bottom: 15px;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                    <div>
                                        <h3 style="color: var(--primary); margin: 0;">${worker.name} (${worker.age}ÏÑ∏)</h3>
                                        <div style="color: #94a3b8; font-size: 0.9rem;">${worker.position} ‚Ä¢ ${business ? business.name : 'ÎØ∏Î∞∞Ï†ï'}</div>
                                    </div>
                                    <div style="text-align: right;">
                                        <div style="color: var(--success); font-weight: bold;">${worker.salary.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß/Ïõî</div>
                                        <div style="color: #94a3b8; font-size: 0.9rem;">Í≤ΩÎ†• ${worker.experience}ÎÖÑ</div>
                                    </div>
                                </div>
                                
                                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-bottom: 10px; font-size: 0.8rem;">
                                    <div style="background: rgba(34, 197, 94, 0.2); padding: 5px; border-radius: 5px; text-align: center;">
                                        <div>ÌèâÍ∑† Ïä§ÌÇ¨</div>
                                        <div style="font-weight: bold; color: var(--success);">${skillAvg}Ï†ê</div>
                                    </div>
                                    <div style="background: rgba(245, 158, 11, 0.2); padding: 5px; border-radius: 5px; text-align: center;">
                                        <div>ÎßåÏ°±ÎèÑ</div>
                                        <div style="font-weight: bold; color: var(--warning);">${worker.satisfaction}%</div>
                                    </div>
                                    <div style="background: rgba(59, 130, 246, 0.2); padding: 5px; border-radius: 5px; text-align: center;">
                                        <div>ÏÑ±Í≥º</div>
                                        <div style="font-weight: bold; color: var(--primary);">${worker.performance}%</div>
                                    </div>
                                </div>
                                
                                <div style="display: flex; gap: 10px;">
                                    <button onclick="showWorkerDetails('${worker.id}')" style="
                                        padding: 5px 10px; background: var(--primary); color: white;
                                        border: none; border-radius: 5px; cursor: pointer; font-size: 0.8rem;
                                    ">ÏÉÅÏÑ∏Ï†ïÎ≥¥</button>
                                    
                                    <button onclick="promoteWorker('${worker.id}')" style="
                                        padding: 5px 10px; background: var(--success); color: white;
                                        border: none; border-radius: 5px; cursor: pointer; font-size: 0.8rem;
                                    ">ÏäπÏßÑ</button>
                                    
                                    <button onclick="fireWorker('${worker.id}')" style="
                                        padding: 5px 10px; background: var(--danger); color: white;
                                        border: none; border-radius: 5px; cursor: pointer; font-size: 0.8rem;
                                    ">Ìï¥Í≥†</button>
                                </div>
                            </div>
                        `;
                    }).join('') : '<div style="text-align: center; color: #94a3b8; padding: 40px;">ÏßÅÏõêÏù¥ ÏóÜÏäµÎãàÎã§</div>'}
                </div>

                <div style="text-align: center; margin-top: 20px;">
                    <button onclick="showWorkforceManagement()" style="
                        padding: 10px 20px; border: 1px solid rgba(255,255,255,0.2);
                        background: rgba(255,255,255,0.05); color: #e2e8f0;
                        border-radius: 8px; cursor: pointer;
                    ">ÎèåÏïÑÍ∞ÄÍ∏∞</button>
                </div>
            `;
            
            showModal(modalContent);
        }

        // Ï±ÑÏö© ÏãúÏû•
        function showRecruitment() {
            // Íµ¨Ïù∏ ÏãúÏû•Ïóê ÌõÑÎ≥¥Ïûê ÏÉùÏÑ± (ÏóÜÏúºÎ©¥)
            if (gameState.roleData.workforce.jobMarket.length === 0) {
                for (let i = 0; i < 8; i++) {
                    gameState.roleData.workforce.jobMarket.push(createJobSeeker());
                }
            }
            
            const jobMarket = gameState.roleData.workforce.jobMarket;
            
            const modalContent = `
                <h2 style="text-align: center; margin-bottom: 30px; color: var(--primary);">üîç Ïù∏Ïû¨ Ï±ÑÏö©</h2>
                
                <div style="margin-bottom: 20px; text-align: center;">
                    <button onclick="refreshJobMarket()" style="
                        padding: 10px 20px; background: var(--success); color: white;
                        border: none; border-radius: 8px; cursor: pointer; font-weight: 600;
                    ">üîÑ ÏÉàÎ°úÏö¥ Ïù∏Ïû¨ Ï∞æÍ∏∞ (1000 ÎπÑÌä∏ÌÅ¨Î†àÎîß)</button>
                </div>
                
                <div style="max-height: 400px; overflow-y: auto;">
                    ${jobMarket.map(candidate => {
                        const skillAvg = Math.round((candidate.skills.production + candidate.skills.quality + candidate.skills.leadership + candidate.skills.creativity) / 4);
                        const hireCost = candidate.expectedSalary + (candidate.experience * 500);
                        return `
                            <div style="background: rgba(255,255,255,0.05); border-radius: 10px; padding: 15px; margin-bottom: 15px;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                    <div>
                                        <h3 style="color: var(--primary); margin: 0;">${candidate.name} (${candidate.age}ÏÑ∏)</h3>
                                        <div style="color: #94a3b8; font-size: 0.9rem;">${candidate.previousJob} ‚Ä¢ Í≤ΩÎ†• ${candidate.experience}ÎÖÑ</div>
                                    </div>
                                    <div style="text-align: right;">
                                        <div style="color: var(--warning); font-weight: bold;">Ìù¨Îßù Í∏âÏó¨: ${candidate.expectedSalary.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß</div>
                                        <div style="color: #94a3b8; font-size: 0.9rem;">Ï±ÑÏö©ÎπÑ: ${hireCost.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß</div>
                                    </div>
                                </div>
                                
                                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 8px; margin-bottom: 10px; font-size: 0.8rem;">
                                    <div style="background: rgba(34, 197, 94, 0.2); padding: 5px; border-radius: 5px; text-align: center;">
                                        <div>ÏÉùÏÇ∞</div>
                                        <div style="font-weight: bold;">${candidate.skills.production}</div>
                                    </div>
                                    <div style="background: rgba(245, 158, 11, 0.2); padding: 5px; border-radius: 5px; text-align: center;">
                                        <div>ÌíàÏßà</div>
                                        <div style="font-weight: bold;">${candidate.skills.quality}</div>
                                    </div>
                                    <div style="background: rgba(168, 85, 247, 0.2); padding: 5px; border-radius: 5px; text-align: center;">
                                        <div>Î¶¨ÎçîÏã≠</div>
                                        <div style="font-weight: bold;">${candidate.skills.leadership}</div>
                                    </div>
                                    <div style="background: rgba(59, 130, 246, 0.2); padding: 5px; border-radius: 5px; text-align: center;">
                                        <div>Ï∞ΩÏùòÏÑ±</div>
                                        <div style="font-weight: bold;">${candidate.skills.creativity}</div>
                                    </div>
                                </div>
                                
                                <div style="text-align: center;">
                                    <button onclick="hireCandidate('${candidate.id}')" style="
                                        padding: 8px 16px; background: var(--success); color: white;
                                        border: none; border-radius: 5px; cursor: pointer; font-weight: 600;
                                    ">Ï±ÑÏö©ÌïòÍ∏∞</button>
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>

                <div style="text-align: center; margin-top: 20px;">
                    <button onclick="showWorkforceManagement()" style="
                        padding: 10px 20px; border: 1px solid rgba(255,255,255,0.2);
                        background: rgba(255,255,255,0.05); color: #e2e8f0;
                        border-radius: 8px; cursor: pointer;
                    ">ÎèåÏïÑÍ∞ÄÍ∏∞</button>
                </div>
            `;
            
            showModal(modalContent);
        }

        // Íµ¨ÏßÅÏûê ÏÉùÏÑ±
        function createJobSeeker() {
            const names = ['ÍπÄÏòÅÏàò', 'Ïù¥ÎØ∏ÏòÅ', 'Î∞ïÌòÑÏ§Ä', 'ÏµúÏßÄÌòú', 'Ï†ïÌÉúÏú§', 'Í∞ïÏàòÎØº', 'Ï°∞Ìï¥Î¶º', 'Ïú§ÏßÄÏõê', 'ÏûÑÏÑ±Ìò∏', 'ÌïúÏòàÏßÑ'];
            const jobs = ['ÏÉùÏÇ∞ÏßÅ', 'ÌíàÏßàÍ¥ÄÎ¶¨', 'ÏòÅÏóÖÏßÅ', 'Í∏∞Ïà†ÏßÅ', 'Í¥ÄÎ¶¨ÏßÅ', 'Ïó∞Íµ¨Í∞úÎ∞ú', 'ÎßàÏºÄÌåÖ', 'Ïû¨Î¨¥ÌöåÍ≥Ñ'];
            
            return {
                id: Date.now() + Math.random(),
                name: names[Math.floor(Math.random() * names.length)],
                age: 22 + Math.floor(Math.random() * 35),
                experience: Math.floor(Math.random() * 15),
                previousJob: jobs[Math.floor(Math.random() * jobs.length)],
                skills: {
                    production: 40 + Math.floor(Math.random() * 60),
                    quality: 40 + Math.floor(Math.random() * 60),
                    leadership: 30 + Math.floor(Math.random() * 50),
                    creativity: 30 + Math.floor(Math.random() * 50)
                },
                expectedSalary: 3000 + Math.floor(Math.random() * 5000),
                availability: new Date()
            };
        }

        // ÍµêÏú° ÌîÑÎ°úÍ∑∏Îû®
        function showTrainingPrograms() {
            const modalContent = `
                <h2 style="text-align: center; margin-bottom: 30px; color: var(--primary);">üìö ÍµêÏú°ÏÑºÌÑ∞</h2>
                
                <div style="display: grid; gap: 15px; max-height: 400px; overflow-y: auto;">
                    <div style="background: rgba(34, 197, 94, 0.1); border: 1px solid rgba(34, 197, 94, 0.3); border-radius: 10px; padding: 15px;">
                        <h3 style="color: var(--success); margin: 0 0 10px 0;">üè≠ ÏÉùÏÇ∞ÏÑ± Ìñ•ÏÉÅ ÍµêÏú°</h3>
                        <p style="color: #94a3b8; margin: 0 0 10px 0; font-size: 0.9rem;">ÏÉùÏÇ∞ Ïä§ÌÇ¨ÏùÑ 10-20Ï†ê Ìñ•ÏÉÅÏãúÌÇµÎãàÎã§</p>
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <span style="color: var(--danger);">ÎπÑÏö©: 5000 ÎπÑÌä∏ÌÅ¨Î†àÎîß</span> ‚Ä¢ 
                                <span style="color: #94a3b8;">Í∏∞Í∞Ñ: 2Ï£º</span>
                            </div>
                            <button onclick="startTraining('production')" style="
                                padding: 8px 16px; background: var(--success); color: white;
                                border: none; border-radius: 5px; cursor: pointer;
                            ">ÍµêÏú° ÏãúÏûë</button>
                        </div>
                    </div>

                    <div style="background: rgba(245, 158, 11, 0.1); border: 1px solid rgba(245, 158, 11, 0.3); border-radius: 10px; padding: 15px;">
                        <h3 style="color: var(--warning); margin: 0 0 10px 0;">‚≠ê ÌíàÏßàÍ¥ÄÎ¶¨ ÍµêÏú°</h3>
                        <p style="color: #94a3b8; margin: 0 0 10px 0; font-size: 0.9rem;">ÌíàÏßà Ïä§ÌÇ¨ÏùÑ 10-20Ï†ê Ìñ•ÏÉÅÏãúÌÇµÎãàÎã§</p>
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <span style="color: var(--danger);">ÎπÑÏö©: 6000 ÎπÑÌä∏ÌÅ¨Î†àÎîß</span> ‚Ä¢ 
                                <span style="color: #94a3b8;">Í∏∞Í∞Ñ: 3Ï£º</span>
                            </div>
                            <button onclick="startTraining('quality')" style="
                                padding: 8px 16px; background: var(--warning); color: white;
                                border: none; border-radius: 5px; cursor: pointer;
                            ">ÍµêÏú° ÏãúÏûë</button>
                        </div>
                    </div>

                    <div style="background: rgba(168, 85, 247, 0.1); border: 1px solid rgba(168, 85, 247, 0.3); border-radius: 10px; padding: 15px;">
                        <h3 style="color: #a855f7; margin: 0 0 10px 0;">üëë Î¶¨ÎçîÏã≠ ÍµêÏú°</h3>
                        <p style="color: #94a3b8; margin: 0 0 10px 0; font-size: 0.9rem;">Î¶¨ÎçîÏã≠ Ïä§ÌÇ¨ÏùÑ 15-25Ï†ê Ìñ•ÏÉÅÏãúÌÇµÎãàÎã§</p>
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <span style="color: var(--danger);">ÎπÑÏö©: 8000 ÎπÑÌä∏ÌÅ¨Î†àÎîß</span> ‚Ä¢ 
                                <span style="color: #94a3b8;">Í∏∞Í∞Ñ: 4Ï£º</span>
                            </div>
                            <button onclick="startTraining('leadership')" style="
                                padding: 8px 16px; background: #a855f7; color: white;
                                border: none; border-radius: 5px; cursor: pointer;
                            ">ÍµêÏú° ÏãúÏûë</button>
                        </div>
                    </div>

                    <div style="background: rgba(59, 130, 246, 0.1); border: 1px solid rgba(59, 130, 246, 0.3); border-radius: 10px; padding: 15px;">
                        <h3 style="color: var(--primary); margin: 0 0 10px 0;">üí° Ï∞ΩÏùòÏÑ± ÍµêÏú°</h3>
                        <p style="color: #94a3b8; margin: 0 0 10px 0; font-size: 0.9rem;">Ï∞ΩÏùòÏÑ± Ïä§ÌÇ¨ÏùÑ 10-20Ï†ê Ìñ•ÏÉÅÏãúÌÇµÎãàÎã§</p>
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <span style="color: var(--danger);">ÎπÑÏö©: 7000 ÎπÑÌä∏ÌÅ¨Î†àÎîß</span> ‚Ä¢ 
                                <span style="color: #94a3b8;">Í∏∞Í∞Ñ: 3Ï£º</span>
                            </div>
                            <button onclick="startTraining('creativity')" style="
                                padding: 8px 16px; background: var(--primary); color: white;
                                border: none; border-radius: 5px; cursor: pointer;
                            ">ÍµêÏú° ÏãúÏûë</button>
                        </div>
                    </div>
                </div>

                <div style="text-align: center; margin-top: 20px;">
                    <button onclick="showWorkforceManagement()" style="
                        padding: 10px 20px; border: 1px solid rgba(255,255,255,0.2);
                        background: rgba(255,255,255,0.05); color: #e2e8f0;
                        border-radius: 8px; cursor: pointer;
                    ">ÎèåÏïÑÍ∞ÄÍ∏∞</button>
                </div>
            `;
            
            showModal(modalContent);
        }

        // ÎßåÏ°±ÎèÑ Í¥ÄÎ¶¨
        function showWorkerSatisfaction() {
            const workforce = gameState.roleData.workforce;
            const factors = workforce.satisfactionFactors;
            
            const modalContent = `
                <h2 style="text-align: center; margin-bottom: 30px; color: var(--primary);">üòä ÏßÅÏõê ÎßåÏ°±ÎèÑ Í¥ÄÎ¶¨</h2>
                
                <!-- ÎßåÏ°±ÎèÑ ÏöîÏÜåÎì§ -->
                <div style="display: grid; gap: 15px; margin-bottom: 30px;">
                    <div style="background: rgba(34, 197, 94, 0.1); border: 1px solid rgba(34, 197, 94, 0.3); border-radius: 10px; padding: 15px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <h3 style="color: var(--success); margin: 0;">üí∞ Í∏âÏó¨ ÏàòÏ§Ä</h3>
                            <span style="color: #e2e8f0; font-weight: bold;">${factors.baseSalary}%</span>
                        </div>
                        <p style="color: #94a3b8; margin: 0 0 10px 0; font-size: 0.9rem;">Ï†ÑÏ≤¥ ÏßÅÏõêÏùò Í∏âÏó¨Î•º 10% Ïù∏ÏÉÅÌï©ÎãàÎã§</p>
                        <button onclick="improveSalaries()" style="
                            padding: 8px 16px; background: var(--success); color: white;
                            border: none; border-radius: 5px; cursor: pointer; width: 100%;
                        ">Í∏âÏó¨ Ïù∏ÏÉÅ (${Math.floor(workforce.workers.reduce((sum, w) => sum + w.salary, 0) * 0.1).toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß/Ïõî Ï∂îÍ∞Ä)</button>
                    </div>

                    <div style="background: rgba(245, 158, 11, 0.1); border: 1px solid rgba(245, 158, 11, 0.3); border-radius: 10px; padding: 15px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <h3 style="color: var(--warning); margin: 0;">üè• Î≥µÎ¶¨ÌõÑÏÉù</h3>
                            <span style="color: #e2e8f0; font-weight: bold;">${factors.benefits}%</span>
                        </div>
                        <p style="color: #94a3b8; margin: 0 0 10px 0; font-size: 0.9rem;">ÏùòÎ£åÎ≥¥Ìóò, ÏãùÎãπ, Ìó¨Ïä§Ïû• Îì±ÏùÑ Í∞úÏÑ†Ìï©ÎãàÎã§</p>
                        <button onclick="improveBenefits()" style="
                            padding: 8px 16px; background: var(--warning); color: white;
                            border: none; border-radius: 5px; cursor: pointer; width: 100%;
                        ">Î≥µÎ¶¨ÌõÑÏÉù Í∞úÏÑ† (50000 ÎπÑÌä∏ÌÅ¨Î†àÎîß)</button>
                    </div>

                    <div style="background: rgba(59, 130, 246, 0.1); border: 1px solid rgba(59, 130, 246, 0.3); border-radius: 10px; padding: 15px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <h3 style="color: var(--primary); margin: 0;">üè¢ Í∑ºÎ¨¥ÌôòÍ≤Ω</h3>
                            <span style="color: #e2e8f0; font-weight: bold;">${factors.workEnvironment}%</span>
                        </div>
                        <p style="color: #94a3b8; margin: 0 0 10px 0; font-size: 0.9rem;">ÏÇ¨Î¨¥Ïã§, ÏûëÏóÖÏû•, Ìú¥Í≤åÏãúÏÑ§ÏùÑ Í∞úÏÑ†Ìï©ÎãàÎã§</p>
                        <button onclick="improveWorkEnvironment()" style="
                            padding: 8px 16px; background: var(--primary); color: white;
                            border: none; border-radius: 5px; cursor: pointer; width: 100%;
                        ">Í∑ºÎ¨¥ÌôòÍ≤Ω Í∞úÏÑ† (80000 ÎπÑÌä∏ÌÅ¨Î†àÎîß)</button>
                    </div>

                    <div style="background: rgba(168, 85, 247, 0.1); border: 1px solid rgba(168, 85, 247, 0.3); border-radius: 10px; padding: 15px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <h3 style="color: #a855f7; margin: 0;">üìà ÏÑ±Ïû•Í∏∞Ìöå</h3>
                            <span style="color: #e2e8f0; font-weight: bold;">${factors.growthOpportunity}%</span>
                        </div>
                        <p style="color: #94a3b8; margin: 0 0 10px 0; font-size: 0.9rem;">ÏäπÏßÑ Í∏∞ÌöåÏôÄ Í≤ΩÎ†• Í∞úÎ∞ú ÌîÑÎ°úÍ∑∏Îû®ÏùÑ ÌôïÎåÄÌï©ÎãàÎã§</p>
                        <button onclick="improveGrowthOpportunity()" style="
                            padding: 8px 16px; background: #a855f7; color: white;
                            border: none; border-radius: 5px; cursor: pointer; width: 100%;
                        ">ÏÑ±Ïû•Í∏∞Ìöå ÌôïÎåÄ (60000 ÎπÑÌä∏ÌÅ¨Î†àÎîß)</button>
                    </div>
                </div>

                <!-- Ï†ÑÏ≤¥ ÎßåÏ°±ÎèÑ ÌòÑÌô© -->
                <div style="background: rgba(255,255,255,0.05); border-radius: 10px; padding: 15px; margin-bottom: 20px;">
                    <h3 style="color: var(--primary); margin: 0 0 15px 0;">üìä ÏßÅÏõêÎ≥Ñ ÎßåÏ°±ÎèÑ ÌòÑÌô©</h3>
                    <div style="max-height: 200px; overflow-y: auto;">
                        ${workforce.workers.length > 0 ? workforce.workers.map(worker => `
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px 0; border-bottom: 1px solid rgba(255,255,255,0.05);">
                                <span style="color: #e2e8f0;">${worker.name}</span>
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    <div style="width: 100px; height: 8px; background: rgba(255,255,255,0.1); border-radius: 4px; overflow: hidden;">
                                        <div style="width: ${worker.satisfaction}%; height: 100%; background: ${worker.satisfaction >= 80 ? 'var(--success)' : worker.satisfaction >= 60 ? 'var(--warning)' : 'var(--danger)'};"></div>
                                    </div>
                                    <span style="color: ${worker.satisfaction >= 80 ? 'var(--success)' : worker.satisfaction >= 60 ? 'var(--warning)' : 'var(--danger)'}; font-weight: bold; min-width: 40px;">${worker.satisfaction}%</span>
                                </div>
                            </div>
                        `).join('') : '<div style="text-align: center; color: #94a3b8;">ÏßÅÏõêÏù¥ ÏóÜÏäµÎãàÎã§</div>'}
                    </div>
                </div>

                <div style="text-align: center;">
                    <button onclick="showWorkforceManagement()" style="
                        padding: 10px 20px; border: 1px solid rgba(255,255,255,0.2);
                        background: rgba(255,255,255,0.05); color: #e2e8f0;
                        border-radius: 8px; cursor: pointer;
                    ">ÎèåÏïÑÍ∞ÄÍ∏∞</button>
                </div>
            `;
            
            showModal(modalContent);
        }

        // ÎÖ∏Ï°∞ Í¥ÄÎ¶¨
        function showUnionManagement() {
            const workforce = gameState.roleData.workforce;
            
            const modalContent = `
                <h2 style="text-align: center; margin-bottom: 30px; color: var(--primary);">‚úä ÎÖ∏ÎèôÏ°∞Ìï© Í¥ÄÎ¶¨</h2>
                
                <!-- ÎÖ∏Ï°∞ ÌòÑÌô© -->
                <div style="background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.3); border-radius: 10px; padding: 20px; margin-bottom: 30px;">
                    <h3 style="color: var(--danger); margin: 0 0 15px 0;">‚ö†Ô∏è ÎÖ∏Ï°∞ Í≤∞ÏÑ± ÏúÑÌóòÎèÑ</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div>
                            <div style="color: #94a3b8; margin-bottom: 5px;">ÌèâÍ∑† ÎßåÏ°±ÎèÑ:</div>
                            <div style="color: #e2e8f0; font-weight: bold; font-size: 1.2rem;">
                                ${workforce.workers.length > 0 ? Math.round(workforce.workers.reduce((a, w) => a + w.satisfaction, 0) / workforce.workers.length) : 0}%
                            </div>
                        </div>
                        <div>
                            <div style="color: #94a3b8; margin-bottom: 5px;">ÌååÏóÖ ÏúÑÌóòÎèÑ:</div>
                            <div style="color: var(--danger); font-weight: bold; font-size: 1.2rem;">
                                ${calculateStrikeRisk()}%
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ÎÖ∏Ï°∞ ÌôúÎèô -->
                <div style="display: grid; gap: 15px; margin-bottom: 30px;">
                    <div style="background: rgba(255,255,255,0.05); border-radius: 10px; padding: 15px;">
                        <h3 style="color: var(--warning); margin: 0 0 10px 0;">üí¨ ÎÖ∏ÏÇ¨ÌòëÏÉÅ</h3>
                        <p style="color: #94a3b8; margin: 0 0 15px 0;">ÏßÅÏõêÎì§Í≥º ÏûÑÍ∏à Î∞è Í∑ºÎ°úÏ°∞Í±¥Ïóê ÎåÄÌï¥ ÌòëÏÉÅÌï©ÎãàÎã§</p>
                        <button onclick="startNegotiation()" style="
                            padding: 10px 20px; background: var(--warning); color: white;
                            border: none; border-radius: 5px; cursor: pointer; width: 100%;
                        ">ÌòëÏÉÅ ÏãúÏûë</button>
                    </div>

                    <div style="background: rgba(255,255,255,0.05); border-radius: 10px; padding: 15px;">
                        <h3 style="color: var(--danger); margin: 0 0 10px 0;">üö® ÌååÏóÖ ÎåÄÏùë</h3>
                        <p style="color: #94a3b8; margin: 0 0 15px 0;">ÌååÏóÖÏù¥ Î∞úÏÉùÌñàÏùÑ Îïå ÎåÄÏùë Î∞©ÏïàÏùÑ ÏÑ†ÌÉùÌï©ÎãàÎã§</p>
                        <div style="display: flex; gap: 10px;">
                            <button onclick="handleStrike('negotiate')" style="
                                padding: 8px 12px; background: var(--success); color: white;
                                border: none; border-radius: 5px; cursor: pointer; flex: 1;
                            ">ÌòëÏÉÅ</button>
                            <button onclick="handleStrike('replace')" style="
                                padding: 8px 12px; background: var(--danger); color: white;
                                border: none; border-radius: 5px; cursor: pointer; flex: 1;
                            ">ÎåÄÏ≤¥Ïù∏Î†•</button>
                        </div>
                    </div>
                </div>

                <!-- ÌòÑÏû¨ ÏßÑÌñâÏ§ëÏù∏ ÎÖ∏ÏÇ¨ Ïù¥Ïäà -->
                <div style="background: rgba(255,255,255,0.02); border-radius: 10px; padding: 15px; margin-bottom: 20px;">
                    <h3 style="color: var(--primary); margin: 0 0 15px 0;">üìã ÌòÑÏû¨ ÎÖ∏ÏÇ¨ Ïù¥Ïäà</h3>
                    <div style="max-height: 150px; overflow-y: auto;">
                        ${generateLaborIssues().length > 0 ? generateLaborIssues().map(issue => `
                            <div style="padding: 10px; background: rgba(255,255,255,0.05); border-radius: 5px; margin-bottom: 10px;">
                                <div style="color: var(--warning); font-weight: bold;">${issue.title}</div>
                                <div style="color: #94a3b8; font-size: 0.9rem;">${issue.description}</div>
                                <div style="color: var(--danger); font-size: 0.8rem;">ÏòÅÌñ•: ÎßåÏ°±ÎèÑ ${issue.impact}% Í∞êÏÜå</div>
                            </div>
                        `).join('') : '<div style="text-align: center; color: #94a3b8;">ÌòÑÏû¨ ÌäπÎ≥ÑÌïú Ïù¥ÏäàÍ∞Ä ÏóÜÏäµÎãàÎã§</div>'}
                    </div>
                </div>

                <div style="text-align: center;">
                    <button onclick="showWorkforceManagement()" style="
                        padding: 10px 20px; border: 1px solid rgba(255,255,255,0.2);
                        background: rgba(255,255,255,0.05); color: #e2e8f0;
                        border-radius: 8px; cursor: pointer;
                    ">ÎèåÏïÑÍ∞ÄÍ∏∞</button>
                </div>
            `;
            
            showModal(modalContent);
        }

        // ÌååÏóÖ ÏúÑÌóòÎèÑ Í≥ÑÏÇ∞
        function calculateStrikeRisk() {
            const workforce = gameState.roleData.workforce;
            if (workforce.workers.length === 0) return 0;
            
            const avgSatisfaction = workforce.workers.reduce((a, w) => a + w.satisfaction, 0) / workforce.workers.length;
            return Math.max(0, Math.min(100, Math.round(100 - avgSatisfaction)));
        }

        // ÎÖ∏ÏÇ¨ Ïù¥Ïäà ÏÉùÏÑ±
        function generateLaborIssues() {
            const issues = [
                { title: "ÏûÑÍ∏à Ïù∏ÏÉÅ ÏöîÍµ¨", description: "ÏßÅÏõêÎì§Ïù¥ 5% ÏûÑÍ∏à Ïù∏ÏÉÅÏùÑ ÏöîÍµ¨ÌïòÍ≥† ÏûàÏäµÎãàÎã§", impact: 15 },
                { title: "Í∑ºÎ¨¥ÏãúÍ∞Ñ Îã®Ï∂ï", description: "Ï£º 40ÏãúÍ∞Ñ Í∑ºÎ¨¥Ï†ú ÎèÑÏûÖÏùÑ ÏöîÍµ¨Ìï©ÎãàÎã§", impact: 10 },
                { title: "Î≥µÎ¶¨ÌõÑÏÉù Í∞úÏÑ†", description: "ÏùòÎ£åÎ≥¥ÌóòÍ≥º ÏãùÎåÄ ÏßÄÏõê ÌôïÎåÄÎ•º ÏöîÍµ¨Ìï©ÎãàÎã§", impact: 12 },
                { title: "ÏûëÏóÖÌôòÍ≤Ω Í∞úÏÑ†", description: "ÏïàÏ†ÑÏû•ÎπÑÏôÄ ÏûëÏóÖÍ≥µÍ∞Ñ Í∞úÏÑ†ÏùÑ ÏöîÍµ¨Ìï©ÎãàÎã§", impact: 18 }
            ];
            
            // ÎßåÏ°±ÎèÑÏóê Îî∞Îùº Ïù¥Ïäà Î∞úÏÉù
            const avgSatisfaction = gameState.roleData.workforce.workers.length > 0 
                ? gameState.roleData.workforce.workers.reduce((a, w) => a + w.satisfaction, 0) / gameState.roleData.workforce.workers.length 
                : 100;
            
            if (avgSatisfaction < 70) {
                return issues.slice(0, Math.floor(Math.random() * 3) + 1);
            }
            
            return [];
        }

        // ===== ÎÖ∏ÎèôÏûê Í¥ÄÎ¶¨ Ïï°ÏÖò Ìï®ÏàòÎì§ =====

        // Ï±ÑÏö©ÌïòÍ∏∞
        function hireCandidate(candidateId) {
            const jobMarket = gameState.roleData.workforce.jobMarket;
            const candidate = jobMarket.find(c => c.id == candidateId);
            if (!candidate) return;

            const hireCost = candidate.expectedSalary + (candidate.experience * 500);
            
            if (gameState.currentUser.game_balance < hireCost) {
                showNotification(`Ï±ÑÏö©Ïóê ${hireCost.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîßÏù¥ ÌïÑÏöîÌï©ÎãàÎã§`, 'error');
                return;
            }

            // Î∞∞Ï†ïÌï† ÏÇ¨ÏóÖÏ≤¥ ÏÑ†ÌÉù (Ï≤´ Î≤àÏß∏ ÏÇ¨ÏóÖÏ≤¥Ïóê Î∞∞Ï†ï)
            const businesses = gameState.roleData.businesses;
            const businessId = businesses.length > 0 ? businesses[0].id : null;

            const newWorker = {
                id: Date.now() + Math.random(),
                name: candidate.name,
                age: candidate.age,
                businessId: businessId,
                position: candidate.experience >= 8 ? 'ÌåÄÏû•' : candidate.experience >= 15 ? 'Î∂ÄÏû•' : 'ÏÇ¨Ïõê',
                experience: candidate.experience,
                skills: candidate.skills,
                salary: candidate.expectedSalary,
                satisfaction: 80 + Math.floor(Math.random() * 20), // 80-100%
                performance: 60 + Math.floor(Math.random() * 40), // 60-100%
                hireDate: new Date(),
                contracts: {
                    salaryBonus: 0,
                    benefits: ['Í∏∞Î≥∏ÏùòÎ£åÎ≥¥Ìóò'],
                    vacationDays: 15
                },
                training: {
                    inProgress: null,
                    completed: [],
                    nextAvailable: new Date()
                },
                status: 'active'
            };

            gameState.currentUser.game_balance -= hireCost;
            gameState.roleData.workforce.workers.push(newWorker);
            
            // Íµ¨Ïù∏ ÏãúÏû•ÏóêÏÑú Ï†úÍ±∞
            const index = jobMarket.findIndex(c => c.id == candidateId);
            jobMarket.splice(index, 1);

            updateDisplay();
            showNotification(`‚úÖ ${candidate.name}ÎãòÏùÑ ÏÑ±Í≥µÏ†ÅÏúºÎ°ú Ï±ÑÏö©ÌñàÏäµÎãàÎã§!`, 'success');
            showRecruitment(); // ÌôîÎ©¥ ÏÉàÎ°úÍ≥†Ïπ®
        }

        // Íµ¨Ïù∏ ÏãúÏû• ÏÉàÎ°úÍ≥†Ïπ®
        function refreshJobMarket() {
            if (gameState.currentUser.game_balance < 1000) {
                showNotification('Íµ¨Ïù∏ ÏãúÏû• ÏÉàÎ°úÍ≥†Ïπ®Ïóê 1000 ÎπÑÌä∏ÌÅ¨Î†àÎîßÏù¥ ÌïÑÏöîÌï©ÎãàÎã§', 'error');
                return;
            }

            gameState.currentUser.game_balance -= 1000;
            gameState.roleData.workforce.jobMarket = [];
            
            for (let i = 0; i < 8; i++) {
                gameState.roleData.workforce.jobMarket.push(createJobSeeker());
            }

            updateDisplay();
            showNotification('ÏÉàÎ°úÏö¥ Ïù∏Ïû¨Îì§Ïù¥ ÎÇòÌÉÄÎÇ¨ÏäµÎãàÎã§!', 'success');
            showRecruitment();
        }

        // ÏßÅÏõê Ìï¥Í≥†
        function fireWorker(workerId) {
            const workers = gameState.roleData.workforce.workers;
            const worker = workers.find(w => w.id == workerId);
            if (!worker) return;

            const severancePay = Math.floor(worker.salary * 2); // Ìá¥ÏßÅÍ∏à 2Í∞úÏõîÏπò
            
            if (confirm(`${worker.name}ÎãòÏùÑ Ìï¥Í≥†ÌïòÏãúÍ≤†ÏäµÎãàÍπå? Ìá¥ÏßÅÍ∏à ${severancePay.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîßÏù¥ ÏßÄÍ∏âÎê©ÎãàÎã§.`)) {
                gameState.currentUser.game_balance -= severancePay;
                
                const index = workers.findIndex(w => w.id == workerId);
                workers.splice(index, 1);

                // Îã§Î•∏ ÏßÅÏõêÎì§Ïùò ÎßåÏ°±ÎèÑ Í∞êÏÜå
                workers.forEach(w => {
                    w.satisfaction = Math.max(20, w.satisfaction - 10);
                });

                updateDisplay();
                showNotification(`${worker.name}ÎãòÏùÑ Ìï¥Í≥†ÌñàÏäµÎãàÎã§. Ìá¥ÏßÅÍ∏à ${severancePay.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß ÏßÄÍ∏â`, 'warning');
                showWorkerList();
            }
        }

        // ÏßÅÏõê ÏäπÏßÑ
        function promoteWorker(workerId) {
            const worker = gameState.roleData.workforce.workers.find(w => w.id == workerId);
            if (!worker) return;

            const promotions = {
                'ÏÇ¨Ïõê': { next: 'ÌåÄÏû•', salaryIncrease: 2000 },
                'ÌåÄÏû•': { next: 'Î∂ÄÏû•', salaryIncrease: 3000 },
                'Î∂ÄÏû•': { next: 'ÏûÑÏõê', salaryIncrease: 4000 },
                'ÏûÑÏõê': null
            };

            const promotion = promotions[worker.position];
            if (!promotion) {
                showNotification(`${worker.name}ÎãòÏùÄ Ïù¥ÎØ∏ ÏµúÍ≥† ÏßÅÍ∏âÏûÖÎãàÎã§`, 'warning');
                return;
            }

            if (confirm(`${worker.name}ÎãòÏùÑ ${promotion.next}Î°ú ÏäπÏßÑÏãúÌÇ§ÏãúÍ≤†ÏäµÎãàÍπå? ÏõîÍ∏âÏù¥ ${promotion.salaryIncrease.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß Ïù∏ÏÉÅÎê©ÎãàÎã§.`)) {
                worker.position = promotion.next;
                worker.salary += promotion.salaryIncrease;
                worker.satisfaction = Math.min(100, worker.satisfaction + 20);
                worker.performance = Math.min(100, worker.performance + 10);

                showNotification(`üéâ ${worker.name}ÎãòÏù¥ ${promotion.next}Î°ú ÏäπÏßÑÌñàÏäµÎãàÎã§!`, 'success');
                showWorkerList();
            }
        }

        // ÍµêÏú° ÏãúÏûë
        function startTraining(skillType) {
            const workers = gameState.roleData.workforce.workers;
            const trainingCosts = {
                'production': 5000,
                'quality': 6000, 
                'leadership': 8000,
                'creativity': 7000
            };

            const cost = trainingCosts[skillType];
            
            if (gameState.currentUser.game_balance < cost) {
                showNotification(`ÍµêÏú°Ïóê ${cost.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîßÏù¥ ÌïÑÏöîÌï©ÎãàÎã§`, 'error');
                return;
            }

            // ÍµêÏú°Î∞õÏùÑ ÏßÅÏõê ÏÑ†ÌÉù (ÎûúÎç§)
            const availableWorkers = workers.filter(w => w.status === 'active');
            if (availableWorkers.length === 0) {
                showNotification('ÍµêÏú°Î∞õÏùÑ ÏßÅÏõêÏù¥ ÏóÜÏäµÎãàÎã§', 'warning');
                return;
            }

            const worker = availableWorkers[Math.floor(Math.random() * availableWorkers.length)];
            
            gameState.currentUser.game_balance -= cost;
            worker.status = 'training';
            worker.training.inProgress = skillType;
            
            // ÍµêÏú° ÏôÑÎ£å ÏãúÎÆ¨Î†àÏù¥ÏÖò (Ï¶âÏãú ÏôÑÎ£å)
            setTimeout(() => {
                const improvement = 10 + Math.floor(Math.random() * 11); // 10-20Ï†ê Ìñ•ÏÉÅ
                worker.skills[skillType] = Math.min(100, worker.skills[skillType] + improvement);
                worker.status = 'active';
                worker.training.inProgress = null;
                worker.training.completed.push(skillType);
                worker.satisfaction = Math.min(100, worker.satisfaction + 5);
                
                showNotification(`‚úÖ ${worker.name}ÎãòÏùò ${getSkillName(skillType)} ÍµêÏú°Ïù¥ ÏôÑÎ£åÎêòÏóàÏäµÎãàÎã§! (+${improvement}Ï†ê)`, 'success');
            }, 2000);

            updateDisplay();
            showNotification(`${worker.name}ÎãòÏù¥ ${getSkillName(skillType)} ÍµêÏú°ÏùÑ ÏãúÏûëÌñàÏäµÎãàÎã§`, 'info');
            showTrainingPrograms();
        }

        function getSkillName(skillType) {
            const names = {
                'production': 'ÏÉùÏÇ∞ÏÑ±',
                'quality': 'ÌíàÏßàÍ¥ÄÎ¶¨',
                'leadership': 'Î¶¨ÎçîÏã≠',
                'creativity': 'Ï∞ΩÏùòÏÑ±'
            };
            return names[skillType];
        }

        // ÎßåÏ°±ÎèÑ Í∞úÏÑ† Ìï®ÏàòÎì§
        function improveSalaries() {
            const workers = gameState.roleData.workforce.workers;
            const totalIncrease = Math.floor(workers.reduce((sum, w) => sum + w.salary, 0) * 0.1);
            
            if (gameState.currentUser.game_balance < totalIncrease) {
                showNotification(`Í∏âÏó¨ Ïù∏ÏÉÅÏóê ${totalIncrease.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîßÏù¥ ÌïÑÏöîÌï©ÎãàÎã§`, 'error');
                return;
            }

            gameState.currentUser.game_balance -= totalIncrease;
            gameState.roleData.workforce.satisfactionFactors.baseSalary = Math.min(200, gameState.roleData.workforce.satisfactionFactors.baseSalary + 10);
            
            workers.forEach(w => {
                w.salary = Math.floor(w.salary * 1.1);
                w.satisfaction = Math.min(100, w.satisfaction + 15);
            });

            updateDisplay();
            showNotification('üí∞ Ï†ÑÏ≤¥ ÏßÅÏõê Í∏âÏó¨Î•º 10% Ïù∏ÏÉÅÌñàÏäµÎãàÎã§!', 'success');
            showWorkerSatisfaction();
        }

        function improveBenefits() {
            if (gameState.currentUser.game_balance < 50000) {
                showNotification('Î≥µÎ¶¨ÌõÑÏÉù Í∞úÏÑ†Ïóê 50000 ÎπÑÌä∏ÌÅ¨Î†àÎîßÏù¥ ÌïÑÏöîÌï©ÎãàÎã§', 'error');
                return;
            }

            gameState.currentUser.game_balance -= 50000;
            gameState.roleData.workforce.satisfactionFactors.benefits = Math.min(100, gameState.roleData.workforce.satisfactionFactors.benefits + 20);
            
            gameState.roleData.workforce.workers.forEach(w => {
                w.satisfaction = Math.min(100, w.satisfaction + 10);
            });

            updateDisplay();
            showNotification('üè• Î≥µÎ¶¨ÌõÑÏÉùÏù¥ Í∞úÏÑ†ÎêòÏóàÏäµÎãàÎã§!', 'success');
            showWorkerSatisfaction();
        }

        function improveWorkEnvironment() {
            if (gameState.currentUser.game_balance < 80000) {
                showNotification('Í∑ºÎ¨¥ÌôòÍ≤Ω Í∞úÏÑ†Ïóê 80000 ÎπÑÌä∏ÌÅ¨Î†àÎîßÏù¥ ÌïÑÏöîÌï©ÎãàÎã§', 'error');
                return;
            }

            gameState.currentUser.game_balance -= 80000;
            gameState.roleData.workforce.satisfactionFactors.workEnvironment = Math.min(100, gameState.roleData.workforce.satisfactionFactors.workEnvironment + 25);
            
            gameState.roleData.workforce.workers.forEach(w => {
                w.satisfaction = Math.min(100, w.satisfaction + 12);
                w.performance = Math.min(100, w.performance + 8);
            });

            updateDisplay();
            showNotification('üè¢ Í∑ºÎ¨¥ÌôòÍ≤ΩÏù¥ Í∞úÏÑ†ÎêòÏóàÏäµÎãàÎã§!', 'success');
            showWorkerSatisfaction();
        }

        function improveGrowthOpportunity() {
            if (gameState.currentUser.game_balance < 60000) {
                showNotification('ÏÑ±Ïû•Í∏∞Ìöå ÌôïÎåÄÏóê 60000 ÎπÑÌä∏ÌÅ¨Î†àÎîßÏù¥ ÌïÑÏöîÌï©ÎãàÎã§', 'error');
                return;
            }

            gameState.currentUser.game_balance -= 60000;
            gameState.roleData.workforce.satisfactionFactors.growthOpportunity = Math.min(100, gameState.roleData.workforce.satisfactionFactors.growthOpportunity + 30);
            
            gameState.roleData.workforce.workers.forEach(w => {
                w.satisfaction = Math.min(100, w.satisfaction + 15);
                w.performance = Math.min(100, w.performance + 5);
            });

            updateDisplay();
            showNotification('üìà ÏÑ±Ïû•Í∏∞ÌöåÍ∞Ä ÌôïÎåÄÎêòÏóàÏäµÎãàÎã§!', 'success');
            showWorkerSatisfaction();
        }

        // ÎÖ∏ÏÇ¨ÌòëÏÉÅ ÏãúÏûë
        function startNegotiation() {
            const avgSatisfaction = gameState.roleData.workforce.workers.length > 0 
                ? gameState.roleData.workforce.workers.reduce((a, w) => a + w.satisfaction, 0) / gameState.roleData.workforce.workers.length 
                : 100;

            if (avgSatisfaction >= 80) {
                showNotification('üòä ÏßÅÏõêÎì§Ïù¥ ÌòÑÏû¨ ÏÉÅÌÉúÏóê ÎßåÏ°±ÌïòÍ≥† ÏûàÏñ¥ ÌäπÎ≥ÑÌïú ÌòëÏÉÅÏù¥ ÌïÑÏöîÌïòÏßÄ ÏïäÏäµÎãàÎã§', 'success');
                return;
            }

            const demandIncrease = Math.floor((100 - avgSatisfaction) * 100); // ÎßåÏ°±ÎèÑÏóê Î∞òÎπÑÎ°Ä
            
            if (confirm(`ÏßÅÏõêÎì§Ïù¥ ${demandIncrease.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîßÏùò Î≥µÏßÄÎπÑ ÏßÄÏõêÏùÑ ÏöîÍµ¨Ìï©ÎãàÎã§. ÏàòÎùΩÌïòÏãúÍ≤†ÏäµÎãàÍπå?`)) {
                if (gameState.currentUser.game_balance < demandIncrease) {
                    showNotification('ÏûêÍ∏àÏù¥ Î∂ÄÏ°±ÌïòÏó¨ ÌòëÏÉÅÏù¥ Í≤∞Î†¨ÎêòÏóàÏäµÎãàÎã§', 'error');
                    gameState.roleData.workforce.workers.forEach(w => {
                        w.satisfaction = Math.max(10, w.satisfaction - 20);
                    });
                } else {
                    gameState.currentUser.game_balance -= demandIncrease;
                    gameState.roleData.workforce.workers.forEach(w => {
                        w.satisfaction = Math.min(100, w.satisfaction + 25);
                    });
                    showNotification('ü§ù ÎÖ∏ÏÇ¨ÌòëÏÉÅÏù¥ ÏÑ±Í≥µÏ†ÅÏúºÎ°ú ÎßàÎ¨¥Î¶¨ÎêòÏóàÏäµÎãàÎã§!', 'success');
                }
            } else {
                gameState.roleData.workforce.workers.forEach(w => {
                    w.satisfaction = Math.max(10, w.satisfaction - 15);
                });
                showNotification('ÌòëÏÉÅÏù¥ Í≤∞Î†¨ÎêòÏñ¥ ÏßÅÏõêÎì§Ïùò ÎßåÏ°±ÎèÑÍ∞Ä ÌïòÎùΩÌñàÏäµÎãàÎã§', 'warning');
            }
            
            updateDisplay();
            showUnionManagement();
        }

        // ÌååÏóÖ ÎåÄÏùë
        function handleStrike(response) {
            if (response === 'negotiate') {
                const cost = Math.floor(gameState.roleData.workforce.workers.length * 2000); // ÏßÅÏõê 1Î™ÖÎãπ 2000 ÎπÑÌä∏ÌÅ¨Î†àÎîß
                
                if (gameState.currentUser.game_balance < cost) {
                    showNotification('ÌòëÏÉÅ ÏûêÍ∏àÏù¥ Î∂ÄÏ°±Ìï©ÎãàÎã§', 'error');
                    return;
                }

                gameState.currentUser.game_balance -= cost;
                gameState.roleData.workforce.workers.forEach(w => {
                    w.satisfaction = Math.min(100, w.satisfaction + 30);
                    w.status = 'active';
                });
                
                showNotification('ü§ù ÌååÏóÖÏù¥ Ìï¥Í≤∞ÎêòÏóàÏäµÎãàÎã§', 'success');
            } else if (response === 'replace') {
                // ÎåÄÏ≤¥Ïù∏Î†• Í≥†Ïö© (ÎπÑÏö© ÎßéÏù¥ Îì§Í≥† ÎßåÏ°±ÎèÑ Îçî ÌïòÎùΩ)
                const cost = Math.floor(gameState.roleData.workforce.workers.length * 5000);
                
                if (gameState.currentUser.game_balance < cost) {
                    showNotification('ÎåÄÏ≤¥Ïù∏Î†• Í≥†Ïö© ÎπÑÏö©Ïù¥ Î∂ÄÏ°±Ìï©ÎãàÎã§', 'error');
                    return;
                }

                gameState.currentUser.game_balance -= cost;
                gameState.roleData.workforce.workers.forEach(w => {
                    w.satisfaction = Math.max(5, w.satisfaction - 40);
                    w.status = 'active';
                });
                
                showNotification('üí∞ ÎåÄÏ≤¥Ïù∏Î†•ÏúºÎ°ú ÌååÏóÖÏùÑ ÏñµÏ†úÌñàÏßÄÎßå ÏßÅÏõêÎì§Ïùò Î∂àÎßåÏù¥ Ïª§Ï°åÏäµÎãàÎã§', 'warning');
            }
            
            updateDisplay();
            showUnionManagement();
        }

        // Î°úÍ∑∏ÏïÑÏõÉ Í∏∞Îä•
        function showCoinPurchase() {
            const coinPackages = [
                // ÏÜåÏï° Ìå®ÌÇ§ÏßÄ (0~20% Î≥¥ÎÑàÏä§)
                { amount: 500, price: 0.99, bonus: 0, popular: false, category: 'ÏûÖÎ¨∏Ïûê' },
                { amount: 1200, price: 1.99, bonus: 200, popular: false, category: 'ÏûÖÎ¨∏Ïûê' },
                { amount: 2500, price: 2.99, bonus: 500, popular: false, category: 'ÏûÖÎ¨∏Ïûê' },
                { amount: 5000, price: 4.99, bonus: 1000, popular: false, category: 'ÏûÖÎ¨∏Ïûê' },
                
                // Ïù∏Í∏∞ Ìå®ÌÇ§ÏßÄ (25~50% Î≥¥ÎÑàÏä§)
                { amount: 8000, price: 7.99, bonus: 2500, popular: false, category: 'Ïù∏Í∏∞' },
                { amount: 12000, price: 9.99, bonus: 4000, popular: true, category: 'Ïù∏Í∏∞' },
                { amount: 18000, price: 14.99, bonus: 7000, popular: false, category: 'Ïù∏Í∏∞' },
                { amount: 25000, price: 19.99, bonus: 12500, popular: false, category: 'Ïù∏Í∏∞' },
                
                // ÎåÄÏö©Îüâ Ìå®ÌÇ§ÏßÄ (60~100% Î≥¥ÎÑàÏä§)
                { amount: 35000, price: 24.99, bonus: 25000, popular: false, category: 'ÎåÄÏö©Îüâ' },
                { amount: 50000, price: 34.99, bonus: 40000, popular: false, category: 'ÎåÄÏö©Îüâ' },
                { amount: 75000, price: 49.99, bonus: 75000, popular: false, category: 'ÎåÄÏö©Îüâ' },
                { amount: 100000, price: 69.99, bonus: 120000, popular: false, category: 'ÎåÄÏö©Îüâ' },
                
                // ÌîÑÎ¶¨ÎØ∏ÏóÑ Ìå®ÌÇ§ÏßÄ (167~3000% Î≥¥ÎÑàÏä§)
                { amount: 150000, price: 99.99, bonus: 250000, popular: false, category: 'ÌîÑÎ¶¨ÎØ∏ÏóÑ' },
                { amount: 200000, price: 149.99, bonus: 800000, popular: false, category: 'ÌîÑÎ¶¨ÎØ∏ÏóÑ' },
                { amount: 300000, price: 199.99, bonus: 2700000, popular: false, category: 'ÌîÑÎ¶¨ÎØ∏ÏóÑ' },
                { amount: 500000, price: 299.99, bonus: 15000000, popular: false, category: 'ÌîÑÎ¶¨ÎØ∏ÏóÑ' }
            ];

            const modalContent = `
                <h2 style="text-align: center; margin-bottom: 30px; color: var(--primary);">üí∞ ÎπÑÌä∏ÌÅ¨Î†àÎîß Íµ¨Îß§</h2>
                
                <!-- ÌòÑÏû¨ Î≥¥Ïú† ÎπÑÌä∏ÌÅ¨Î†àÎîß -->
                <div style="background: rgba(34, 197, 94, 0.1); border: 1px solid rgba(34, 197, 94, 0.3); border-radius: 12px; padding: 20px; margin-bottom: 30px; text-align: center;">
                    <div style="color: #94a3b8; font-size: 0.9rem; margin-bottom: 5px;">ÌòÑÏû¨ Î≥¥Ïú† ÎπÑÌä∏ÌÅ¨Î†àÎîß</div>
                    <div style="color: var(--success); font-size: 2rem; font-weight: bold;">${gameState.roleData.balance.toLocaleString()}</div>
                </div>

                <!-- ÎπÑÌä∏ÌÅ¨Î†àÎîß Ìå®ÌÇ§ÏßÄ -->
                ${['ÏûÖÎ¨∏Ïûê', 'Ïù∏Í∏∞', 'ÎåÄÏö©Îüâ', 'ÌîÑÎ¶¨ÎØ∏ÏóÑ'].map(category => {
                    const categoryPackages = coinPackages.filter(pkg => pkg.category === category);
                    const categoryColors = {
                        'ÏûÖÎ¨∏Ïûê': { bg: 'rgba(34, 197, 94, 0.1)', border: 'rgba(34, 197, 94, 0.3)', accent: '#22c55e' },
                        'Ïù∏Í∏∞': { bg: 'rgba(99, 102, 241, 0.1)', border: 'rgba(99, 102, 241, 0.3)', accent: '#6366f1' },
                        'ÎåÄÏö©Îüâ': { bg: 'rgba(168, 85, 247, 0.1)', border: 'rgba(168, 85, 247, 0.3)', accent: '#a855f7' },
                        'ÌîÑÎ¶¨ÎØ∏ÏóÑ': { bg: 'rgba(251, 191, 36, 0.1)', border: 'rgba(251, 191, 36, 0.3)', accent: '#fbbf24' }
                    };
                    const colors = categoryColors[category];
                    
                    return `
                        <div style="margin-bottom: 25px;">
                            <div style="
                                text-align: center; margin-bottom: 15px; padding: 8px 16px;
                                background: ${colors.bg}; border: 1px solid ${colors.border};
                                border-radius: 20px; display: inline-block;
                                color: ${colors.accent}; font-weight: bold; font-size: 0.9rem;
                            ">${category === 'ÏûÖÎ¨∏Ïûê' ? 'üå±' : category === 'Ïù∏Í∏∞' ? 'üî•' : category === 'ÎåÄÏö©Îüâ' ? 'üíé' : 'üëë'} ${category} Ìå®ÌÇ§ÏßÄ</div>
                            
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 12px;">
                                ${categoryPackages.map(pkg => {
                                    const bonusPercentage = pkg.bonus > 0 ? Math.round((pkg.bonus / pkg.amount) * 100) : 0;
                                    const totalCoins = pkg.amount + pkg.bonus;
                                    const pricePerCoin = (pkg.price / totalCoins * 1000).toFixed(1);
                                    
                                    return `
                                        <div style="
                                            position: relative;
                                            background: ${pkg.popular ? 'linear-gradient(135deg, rgba(99, 102, 241, 0.15), rgba(139, 92, 246, 0.15))' : colors.bg};
                                            border: ${pkg.popular ? '2px solid var(--primary)' : `1px solid ${colors.border}`};
                                            border-radius: 12px; padding: 16px; cursor: pointer;
                                            transition: all 0.3s ease; hover: transform: translateY(-2px);
                                            ${pkg.popular ? 'transform: scale(1.02); box-shadow: 0 8px 25px rgba(99, 102, 241, 0.2);' : ''}
                                        " onclick="purchaseCoin(${totalCoins}, ${pkg.price})">
                                            ${pkg.popular ? '<div style="position: absolute; top: -8px; left: 50%; transform: translateX(-50%); background: linear-gradient(45deg, #6366f1, #8b5cf6); color: white; padding: 4px 12px; border-radius: 15px; font-size: 0.7rem; font-weight: 600; box-shadow: 0 2px 8px rgba(99, 102, 241, 0.3);">üî• Ïù∏Í∏∞ ÏÉÅÌíà</div>' : ''}
                                            ${bonusPercentage >= 50 ? '<div style="position: absolute; top: -8px; right: 10px; background: linear-gradient(45deg, #f59e0b, #ef4444); color: white; padding: 4px 8px; border-radius: 12px; font-size: 0.7rem; font-weight: 600;">HOT</div>' : ''}
                                            
                                            <div style="text-align: center; margin-bottom: 12px;">
                                                <div style="color: var(--primary); font-size: 1.8rem; font-weight: bold; margin-bottom: 4px;">$${pkg.price}</div>
                                                <div style="color: #94a3b8; font-size: 0.75rem;">ÎπÑÌä∏ÌÅ¨Î†àÎîßÎãπ $${pricePerCoin}/1000Í∞ú</div>
                                            </div>
                                            
                                            <div style="text-align: center; margin-bottom: 8px;">
                                                <div style="color: #e2e8f0; font-size: 1.1rem; font-weight: bold;">
                                                    ${pkg.amount.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß
                                                </div>
                                                ${pkg.bonus > 0 ? `
                                                    <div style="color: ${colors.accent}; font-size: 0.9rem; margin-top: 4px;">
                                                        +${pkg.bonus.toLocaleString()} Î≥¥ÎÑàÏä§ (${bonusPercentage}%)
                                                    </div>
                                                    <div style="color: ${colors.accent}; font-size: 0.8rem; font-weight: 600; margin-top: 2px;">
                                                        = ${totalCoins.toLocaleString()} Ï¥ù ÎπÑÌä∏ÌÅ¨Î†àÎîß
                                                    </div>
                                                ` : ''}
                                            </div>
                                            
                                            ${pkg.bonus > 0 ? `<div style="text-align: center; margin-top: 8px; padding: 6px; background: rgba(34, 197, 94, 0.1); border-radius: 6px; border: 1px solid rgba(34, 197, 94, 0.2);"><div style="color: var(--success); font-size: 0.7rem; font-weight: 600;">${pkg.bonus.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß Î¨¥Î£å!</div></div>` : ''}
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        </div>
                    `;
                }).join('')}

                <!-- Ï£ºÏùòÏÇ¨Ìï≠ -->
                <div style="background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.3); border-radius: 8px; padding: 15px; margin-bottom: 20px;">
                    <div style="color: var(--danger); font-size: 0.9rem; line-height: 1.5;">
                        <strong>‚ö†Ô∏è Ï£ºÏùòÏÇ¨Ìï≠:</strong><br>
                        ‚Ä¢ Íµ¨Îß§Ìïú ÎπÑÌä∏ÌÅ¨Î†àÎîßÏùÄ ÌôòÎ∂àÎêòÏßÄ ÏïäÏäµÎãàÎã§<br>
                        ‚Ä¢ Í≤∞Ï†úÎäî ÏïàÏ†ÑÌïú PayPalÏùÑ ÌÜµÌï¥ Ï≤òÎ¶¨Îê©ÎãàÎã§<br>
                        ‚Ä¢ Íµ¨Îß§ ÌõÑ Ï¶âÏãú ÎπÑÌä∏ÌÅ¨Î†àÎîßÏù¥ ÏßÄÍ∏âÎê©ÎãàÎã§
                    </div>
                </div>

                <div style="text-align: center;">
                    <button onclick="closeModal()" style="
                        padding: 12px 30px; background: rgba(71, 85, 105, 0.2);
                        color: #e2e8f0; border: 1px solid rgba(71, 85, 105, 0.3);
                        border-radius: 8px; cursor: pointer; font-size: 0.9rem;
                    ">Îã´Í∏∞</button>
                </div>
            `;

            showModal(modalContent);
        }

        function purchaseCoin(amount, price) {
            if (confirm(`$${price}Ïóê ${amount.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîßÏùÑ Íµ¨Îß§ÌïòÏãúÍ≤†ÏäµÎãàÍπå?`)) {
                // Ïã§Ï†ú Í≤∞Ï†ú Ï≤òÎ¶¨Îäî Ïó¨Í∏∞ÏÑú Íµ¨ÌòÑ (PayPal, Stripe Îì±)
                // ÏûÑÏãúÎ°ú Î∞îÎ°ú ÎπÑÌä∏ÌÅ¨Î†àÎîß ÏßÄÍ∏â
                showPaymentInterface(amount, price);
            }
        }

        function showPaymentInterface(amount, price) {
            const modalContent = `
                <h2 style="text-align: center; margin-bottom: 30px; color: var(--primary);">üí≥ Í≤∞Ï†ú ÏßÑÌñâ</h2>
                
                <div style="background: rgba(59, 130, 246, 0.1); border: 1px solid rgba(59, 130, 246, 0.3); border-radius: 12px; padding: 20px; margin-bottom: 30px;">
                    <div style="text-align: center; margin-bottom: 20px;">
                        <div style="color: #94a3b8; font-size: 0.9rem;">Íµ¨Îß§ ÏÉÅÌíà</div>
                        <div style="color: #e2e8f0; font-size: 1.5rem; font-weight: bold; margin: 10px 0;">${amount.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß</div>
                        <div style="color: var(--primary); font-size: 1.3rem; font-weight: bold;">$${price}</div>
                    </div>
                    
                    <div style="border-top: 1px solid rgba(71, 85, 105, 0.3); padding-top: 15px; text-align: center;">
                        <div style="color: #94a3b8; font-size: 0.8rem; margin-bottom: 15px;">Í≤∞Ï†ú Î∞©Î≤ï ÏÑ†ÌÉù</div>
                        
                        <div style="display: grid; gap: 10px;">
                            <button onclick="processPayment('paypal', ${amount}, ${price})" style="
                                padding: 15px; background: #0070ba; color: white;
                                border: none; border-radius: 8px; cursor: pointer;
                                font-size: 1rem; font-weight: 600;
                                display: flex; align-items: center; justify-content: center; gap: 10px;
                            ">
                                <span>PayPal</span>
                            </button>
                            
                            <button onclick="processPayment('card', ${amount}, ${price})" style="
                                padding: 15px; background: #1a1a1a; color: white;
                                border: 1px solid #333; border-radius: 8px; cursor: pointer;
                                font-size: 1rem; font-weight: 600;
                                display: flex; align-items: center; justify-content: center; gap: 10px;
                            ">
                                üí≥ Ïã†Ïö©Ïπ¥Îìú
                            </button>
                            
                            <button onclick="processPayment('demo', ${amount}, ${price})" style="
                                padding: 15px; background: var(--success); color: white;
                                border: none; border-radius: 8px; cursor: pointer;
                                font-size: 1rem; font-weight: 600;
                            ">
                                üéÆ Îç∞Î™® Íµ¨Îß§ (ÌÖåÏä§Ìä∏Ïö©)
                            </button>
                        </div>
                    </div>
                </div>

                <div style="text-align: center;">
                    <button onclick="showCoinPurchase()" style="
                        padding: 12px 30px; background: rgba(71, 85, 105, 0.2);
                        color: #e2e8f0; border: 1px solid rgba(71, 85, 105, 0.3);
                        border-radius: 8px; cursor: pointer; font-size: 0.9rem;
                    ">‚Üê Îí§Î°ú</button>
                </div>
            `;

            showModal(modalContent);
        }

        function processPayment(method, amount, price) {
            if (method === 'demo') {
                // Îç∞Î™® Íµ¨Îß§ - Ï¶âÏãú ÎπÑÌä∏ÌÅ¨Î†àÎîß ÏßÄÍ∏â
                gameState.roleData.balance += amount;
                updateDisplay();
                
                alert(`üéâ Íµ¨Îß§ ÏôÑÎ£å!\n${amount.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîßÏù¥ Í≥ÑÏ†ïÏóê Ï∂îÍ∞ÄÎêòÏóàÏäµÎãàÎã§.`);
                closeModal();
            } else {
                // Ïã§Ï†ú Í≤∞Ï†ú Ï≤òÎ¶¨
                alert(`${method === 'paypal' ? 'PayPal' : 'Ïã†Ïö©Ïπ¥Îìú'} Í≤∞Ï†ú ÌéòÏù¥ÏßÄÎ°ú Ïù¥ÎèôÌï©ÎãàÎã§.\n\nÏã§Ï†ú ÏÑúÎπÑÏä§ÏóêÏÑúÎäî Ïó¨Í∏∞ÏÑú Í≤∞Ï†ú Ï≤òÎ¶¨Í∞Ä ÏßÑÌñâÎê©ÎãàÎã§.`);
                
                // Ïã§Ï†ú Íµ¨ÌòÑÏóêÏÑúÎäî Ïó¨Í∏∞ÏÑú Í≤∞Ï†ú API Ìò∏Ï∂ú
                // ÏûÑÏãúÎ°ú ÏÑ±Í≥µÌñàÎã§Í≥† Í∞ÄÏ†ï
                setTimeout(() => {
                    gameState.roleData.balance += amount;
                    updateDisplay();
                    alert(`üéâ Íµ¨Îß§ ÏôÑÎ£å!\n${amount.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîßÏù¥ Í≥ÑÏ†ïÏóê Ï∂îÍ∞ÄÎêòÏóàÏäµÎãàÎã§.`);
                    closeModal();
                }, 2000);
            }
        }

        function logout() {
            if (confirm('Ï†ïÎßê Î°úÍ∑∏ÏïÑÏõÉÌïòÏãúÍ≤†ÏäµÎãàÍπå? Ï†ÄÏû•ÎêòÏßÄ ÏïäÏùÄ Îç∞Ïù¥ÌÑ∞Îäî ÏÜêÏã§Îê† Ïàò ÏûàÏäµÎãàÎã§.')) {
                // Í≤åÏûÑ ÏÉÅÌÉú Ï¥àÍ∏∞Ìôî
                gameState = {
                    currentUser: null,
                    isLoggedIn: false,
                    selectedRole: null,
                    gameData: {
                        banks: [],
                        businesses: [],
                        stockMarket: {
                            kospi: 2400,
                            companies: new Map()
                        },
                        users: []
                    }
                };

                // Î°úÏª¨ Ïä§ÌÜ†Î¶¨ÏßÄÏóêÏÑú ÌòÑÏû¨ ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥ Ï†úÍ±∞
                localStorage.removeItem('currentUser');

                // ÌôîÎ©¥ Ï¥àÍ∏∞Ìôî
                document.getElementById('loginSection').style.display = 'flex';
                document.getElementById('roleSelection').style.display = 'none';
                document.getElementById('gameInterface').style.display = 'none';

                // ÏûÖÎ†• ÌïÑÎìú Ï¥àÍ∏∞Ìôî
                document.getElementById('loginForm').reset();

                showNotification('Î°úÍ∑∏ÏïÑÏõÉÎêòÏóàÏäµÎãàÎã§', 'info');
            }
        }

        // ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥ ÏóÖÎç∞Ïù¥Ìä∏
        function updateUserDisplay() {
            if (gameState.currentUser) {
                document.getElementById('currentUserName').textContent = gameState.currentUser.username;
            }
        }

        // Í≥ÑÏ†ï Î©îÎâ¥ ÌëúÏãú
        function showAccountMenu() {
            const modalContent = `
                <h2 style="text-align: center; margin-bottom: 30px; color: var(--primary);">üë§ Í≥ÑÏ†ï Í¥ÄÎ¶¨</h2>
                
                <!-- ÌòÑÏû¨ Í≥ÑÏ†ï Ï†ïÎ≥¥ -->
                <div style="background: rgba(59, 130, 246, 0.1); border: 1px solid rgba(59, 130, 246, 0.3); border-radius: 12px; padding: 20px; margin-bottom: 30px;">
                    <h3 style="color: var(--primary); margin: 0 0 15px 0;">üìã ÌòÑÏû¨ Í≥ÑÏ†ï Ï†ïÎ≥¥</h3>
                    <div style="display: grid; gap: 10px;">
                        <div style="display: flex; justify-content: space-between;">
                            <span style="color: #94a3b8;">ÏÇ¨Ïö©ÏûêÎ™Ö:</span>
                            <span style="color: #e2e8f0; font-weight: bold;">${gameState.currentUser ? gameState.currentUser.username : '-'}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span style="color: #94a3b8;">Ïù¥Î©îÏùº:</span>
                            <span style="color: #e2e8f0;">${gameState.currentUser ? gameState.currentUser.email : '-'}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span style="color: #94a3b8;">Í≥ÑÏ†ï ID:</span>
                            <span style="color: #94a3b8; font-family: monospace; font-size: 0.8rem;">${gameState.currentUser ? gameState.currentUser.id : '-'}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span style="color: #94a3b8;">Ïó≠Ìï†:</span>
                            <span style="color: var(--success); font-weight: bold;">${gameState.currentUser ? (gameState.currentUser.role === 'entrepreneur' ? 'ÏÇ¨ÏóÖÍ∞Ä' : gameState.currentUser.role === 'banker' ? 'ÏùÄÌñâÍ∞Ä' : gameState.currentUser.role === 'investor' ? 'Ìà¨ÏûêÏûê' : gameState.currentUser.role === 'worker' ? 'ÏßÅÏû•Ïù∏' : 'ÎØ∏ÏÑ†ÌÉù') : '-'}</span>
                        </div>
                    </div>
                </div>

                <!-- Í≥ÑÏ†ï Í¥ÄÎ¶¨ ÏòµÏÖò -->
                <div style="display: grid; gap: 15px; margin-bottom: 30px;">
                    <button onclick="changeUsername()" style="
                        padding: 15px; background: var(--primary); color: white;
                        border: none; border-radius: 10px; cursor: pointer;
                        font-size: 0.9rem; font-weight: 600;
                    ">‚úèÔ∏è ÏÇ¨Ïö©ÏûêÎ™Ö Î≥ÄÍ≤Ω</button>
                    
                    <button onclick="changeRole()" style="
                        padding: 15px; background: #8b5cf6; color: white;
                        border: none; border-radius: 10px; cursor: pointer;
                        font-size: 0.9rem; font-weight: 600;
                    ">üé≠ Ïó≠Ìï† Î≥ÄÍ≤Ω</button>
                    
                    <button onclick="switchAccount()" style="
                        padding: 15px; background: var(--warning); color: white;
                        border: none; border-radius: 10px; cursor: pointer;
                        font-size: 0.9rem; font-weight: 600;
                    ">üîÑ Îã§Î•∏ Í≥ÑÏ†ïÏúºÎ°ú Ï†ÑÌôò</button>
                    
                    <button onclick="showGameStats()" style="
                        padding: 15px; background: var(--success); color: white;
                        border: none; border-radius: 10px; cursor: pointer;
                        font-size: 0.9rem; font-weight: 600;
                    ">üìä Í≤åÏûÑ ÌÜµÍ≥Ñ</button>
                    
                    <button onclick="showCoinPurchase()" style="
                        padding: 15px; background: linear-gradient(135deg, #fbbf24, #f59e0b); color: white;
                        border: none; border-radius: 10px; cursor: pointer;
                        font-size: 0.9rem; font-weight: 600;
                        box-shadow: 0 4px 12px rgba(251, 191, 36, 0.3);
                    ">üí∞ ÎπÑÌä∏ÌÅ¨Î†àÎîß Íµ¨Îß§</button>
                </div>

                <!-- Îç∞Ïù¥ÌÑ∞ Í¥ÄÎ¶¨ ÏÑπÏÖò -->
                <div style="border-top: 1px solid rgba(255,255,255,0.1); padding-top: 20px; margin-bottom: 30px;">
                    <h4 style="color: #94a3b8; margin: 0 0 15px 0; font-size: 0.9rem; text-align: center;">üíæ Îç∞Ïù¥ÌÑ∞ Í¥ÄÎ¶¨</h4>
                    
                    <div style="display: grid; gap: 10px;">
                        <!-- Î°úÏª¨ Ï†ÄÏû• -->
                        <button onclick="saveGameState(); showNotification('Î°úÏª¨Ïóê Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§', 'success');" style="
                            padding: 12px; background: rgba(16, 185, 129, 0.8);
                            color: white; border: none; border-radius: 8px;
                            cursor: pointer; font-weight: 600; font-size: 0.85rem;
                        ">üíæ Î°úÏª¨ Ï†ÄÏû•</button>
                        
                        ${supabaseClient && !gameState.isDemo ? `
                        <!-- ÌÅ¥ÎùºÏö∞Îìú Ï†ÄÏû•/Î°úÎìú (Supabase Ïó∞Í≤∞ ÏãúÎßå) -->
                        <button onclick="saveGameStateToSupabase()" style="
                            padding: 12px; background: rgba(59, 130, 246, 0.9);
                            color: white; border: none; border-radius: 8px;
                            cursor: pointer; font-weight: 600; font-size: 0.85rem;
                        ">‚òÅÔ∏è ÌÅ¥ÎùºÏö∞Îìú Ï†ÄÏû•</button>
                        
                        <button onclick="loadGameStateFromSupabase()" style="
                            padding: 12px; background: rgba(139, 69, 19, 0.9);
                            color: white; border: none; border-radius: 8px;
                            cursor: pointer; font-weight: 600; font-size: 0.85rem;
                        ">‚òÅÔ∏è ÌÅ¥ÎùºÏö∞ÎìúÏóêÏÑú Î°úÎìú</button>
                        ` : ''}
                        
                        <button onclick="exportGameData()" style="
                            padding: 12px; background: rgba(156, 163, 175, 0.8);
                            color: white; border: none; border-radius: 8px;
                            cursor: pointer; font-weight: 600; font-size: 0.85rem;
                        ">üì§ Îç∞Ïù¥ÌÑ∞ ÎÇ¥Î≥¥ÎÇ¥Í∏∞</button>
                        
                        <button onclick="importGameData()" style="
                            padding: 12px; background: rgba(107, 114, 128, 0.8);
                            color: white; border: none; border-radius: 8px;
                            cursor: pointer; font-weight: 600; font-size: 0.85rem;
                        ">üì• Îç∞Ïù¥ÌÑ∞ Í∞ÄÏ†∏Ïò§Í∏∞</button>
                        
                        <button onclick="resetGameData()" style="
                            padding: 12px; background: rgba(239, 68, 68, 0.8);
                            color: white; border: none; border-radius: 8px;
                            cursor: pointer; font-weight: 600; font-size: 0.85rem;
                        ">üóëÔ∏è Îç∞Ïù¥ÌÑ∞ Ï¥àÍ∏∞Ìôî</button>
                    </div>
                </div>

                <div style="text-align: center;">
                    <button onclick="closeModal()" style="
                        padding: 10px 20px; border: 1px solid rgba(255,255,255,0.2);
                        background: rgba(255,255,255,0.05); color: #e2e8f0;
                        border-radius: 8px; cursor: pointer;
                    ">Îã´Í∏∞</button>
                </div>
            `;
            
            showModal(modalContent);
        }

        // P2P Í±∞Îûò Î™®Îã¨Îì§
        function showP2PBuyModal(listing) {
            const fee = listing.price * gameState.p2pMarket.fees[listing.type + 'Sale'];
            const totalCost = listing.price + fee;
            
            const modalContent = `
                <h2 style="text-align: center; margin-bottom: 30px; color: var(--primary);">üõí P2P Íµ¨Îß§</h2>
                
                <div style="background: rgba(59, 130, 246, 0.1); border: 1px solid rgba(59, 130, 246, 0.3); border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                    <div style="margin-bottom: 15px;">
                        <div style="font-size: 1.2rem; font-weight: bold; color: var(--primary);">${listing.name}</div>
                        <div style="color: #94a3b8; font-size: 0.9rem;">ÌåêÎß§Ïûê: ${listing.sellerName}</div>
                    </div>
                    <div style="color: #e2e8f0;">
                        ${listing.description || 'ÏÉÅÏÑ∏ Ï†ïÎ≥¥Í∞Ä ÏóÜÏäµÎãàÎã§.'}
                    </div>
                </div>

                <div style="background: rgba(34, 34, 34, 0.6); border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <span>Í∏∞Î≥∏ Í∞ÄÍ≤©:</span>
                        <span>${listing.price.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <span>Í±∞Îûò ÏàòÏàòÎ£å (${(gameState.p2pMarket.fees[listing.type + 'Sale'] * 100).toFixed(1)}%):</span>
                        <span>${fee.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß</span>
                    </div>
                    <div style="border-top: 1px solid rgba(255,255,255,0.1); padding-top: 10px; margin-top: 10px;">
                        <div style="display: flex; justify-content: space-between; font-weight: bold; font-size: 1.1rem;">
                            <span>Ï¥ù Í≤∞Ï†úÏï°:</span>
                            <span style="color: var(--primary);">${totalCost.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß</span>
                        </div>
                    </div>
                </div>

                <div style="background: ${gameState.currentUser.game_balance >= totalCost ? 'rgba(34, 197, 94, 0.1)' : 'rgba(239, 68, 68, 0.1)'}; 
                     border: 1px solid ${gameState.currentUser.game_balance >= totalCost ? 'rgba(34, 197, 94, 0.3)' : 'rgba(239, 68, 68, 0.3)'}; 
                     border-radius: 12px; padding: 15px; margin-bottom: 20px; text-align: center;">
                    <div style="color: #94a3b8; font-size: 0.9rem; margin-bottom: 5px;">ÎÇ¥ Î≥¥Ïú† ÎπÑÌä∏ÌÅ¨Î†àÎîß</div>
                    <div style="color: ${gameState.currentUser.game_balance >= totalCost ? 'var(--success)' : 'var(--danger)'}; font-size: 1.5rem; font-weight: bold;">
                        ${gameState.currentUser.game_balance.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß
                    </div>
                </div>

                <div style="display: flex; gap: 15px; margin-top: 20px;">
                    <button onclick="closeModal()" class="btn btn-secondary" style="flex: 1;">Ï∑®ÏÜå</button>
                    <button onclick="confirmP2PBuy('${listing.id}')" 
                            ${gameState.currentUser.game_balance >= totalCost ? 'class="btn"' : 'class="btn btn-secondary" disabled'} 
                            style="flex: 1;">
                        ${gameState.currentUser.game_balance >= totalCost ? 'Íµ¨Îß§ÌïòÍ∏∞' : 'ÏûîÏï° Î∂ÄÏ°±'}
                    </button>
                </div>
            `;
            
            showModal(modalContent);
        }

        function showP2PSellModal(asset, type) {
            let suggestedPrice = 0;
            let description = '';
            
            if (type === 'business') {
                suggestedPrice = Math.floor(asset.value * 1.2); // Í∏∞ÏóÖ Í∞ÄÏπòÏùò 120%
                description = `${asset.type} ÏÇ¨ÏóÖÏ≤¥, Ïõî ÏàòÏùµ: ${asset.profit.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß, ÏßÅÏõê: ${asset.employees}Î™Ö`;
            } else if (type === 'investment') {
                suggestedPrice = Math.floor(asset.amount * (1 + asset.returnRate)); // ÌòÑÏû¨ Í∞ÄÏπò
                description = `${asset.type} Ìà¨Ïûê, ÏàòÏùµÎ•†: ${(asset.returnRate * 100).toFixed(1)}%`;
            }
            
            const modalContent = `
                <h2 style="text-align: center; margin-bottom: 30px; color: var(--primary);">üí∞ P2P ÌåêÎß§ Îì±Î°ù</h2>
                
                <div style="background: rgba(34, 197, 94, 0.1); border: 1px solid rgba(34, 197, 94, 0.3); border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                    <div style="margin-bottom: 15px;">
                        <div style="font-size: 1.2rem; font-weight: bold; color: var(--success);">${asset.name}</div>
                        <div style="color: #94a3b8; font-size: 0.9rem;">${description}</div>
                    </div>
                </div>

                <div style="margin-bottom: 20px;">
                    <label style="display: block; color: #cbd5e1; margin-bottom: 8px; font-weight: 500;">ÌåêÎß§ Í∞ÄÍ≤© (ÎπÑÌä∏ÌÅ¨Î†àÎîß)</label>
                    <input type="number" id="p2pSellPrice" min="1000" 
                           style="width: 100%; padding: 12px; border: 1px solid rgba(255,255,255,0.2); 
                                  border-radius: 8px; background: rgba(255,255,255,0.05); color: #e2e8f0;
                                  font-size: 1rem;" 
                           oninput="updateP2PSellPreview()">
                    <div style="color: #94a3b8; font-size: 0.8rem; margin-top: 5px;">
                        Í∂åÏû• Í∞ÄÍ≤©: ${suggestedPrice.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß
                    </div>
                </div>

                <div style="margin-bottom: 20px;">
                    <label style="display: block; color: #cbd5e1; margin-bottom: 8px; font-weight: 500;">ÌåêÎß§ ÏÑ§Î™Ö (ÏÑ†ÌÉù)</label>
                    <textarea id="p2pSellDescription" placeholder="Íµ¨Îß§ÏûêÏóêÍ≤å Ï†ÑÎã¨Ìï† Î©îÏãúÏßÄÎ•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî..." 
                              style="width: 100%; padding: 12px; border: 1px solid rgba(255,255,255,0.2); 
                                     border-radius: 8px; background: rgba(255,255,255,0.05); color: #e2e8f0;
                                     resize: vertical; height: 80px; font-family: inherit;"></textarea>
                </div>

                <div style="background: rgba(34, 34, 34, 0.6); border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <span>ÌåêÎß§ Í∞ÄÍ≤©:</span>
                        <span id="sellPriceDisplay">${suggestedPrice.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <span>Í±∞Îûò ÏàòÏàòÎ£å (${(gameState.p2pMarket.fees[type + 'Sale'] * 100).toFixed(1)}%):</span>
                        <span id="sellFeeDisplay">-${Math.floor(suggestedPrice * gameState.p2pMarket.fees[type + 'Sale']).toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß</span>
                    </div>
                    <div style="border-top: 1px solid rgba(255,255,255,0.1); padding-top: 10px; margin-top: 10px;">
                        <div style="display: flex; justify-content: space-between; font-weight: bold; font-size: 1.1rem;">
                            <span>Ïã§ ÏàòÎ†πÏï°:</span>
                            <span style="color: var(--success);" id="netReceiveDisplay">${Math.floor(suggestedPrice * (1 - gameState.p2pMarket.fees[type + 'Sale'])).toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß</span>
                        </div>
                    </div>
                </div>

                <div style="display: flex; gap: 15px; margin-top: 20px;">
                    <button onclick="closeModal()" class="btn btn-secondary" style="flex: 1;">Ï∑®ÏÜå</button>
                    <button onclick="confirmP2PSell('${asset.id || asset.name}', '${type}')" class="btn" style="flex: 1;">
                        ÌåêÎß§ Îì±Î°ùÌïòÍ∏∞
                    </button>
                </div>
            `;
            
            showModal(modalContent);
            
            // Î™®Îã¨Ïù¥ ÌëúÏãúÎêú ÌõÑ input Í∞í ÏÑ§Ï†ï
            setTimeout(() => {
                const priceInput = document.getElementById('p2pSellPrice');
                if (priceInput) {
                    priceInput.value = suggestedPrice;
                }
                updateP2PSellPreview();
            }, 50);
        }

        // ÏÇ¨Ïö©ÏûêÎ™Ö Î≥ÄÍ≤Ω
        function changeUsername() {
            const newUsername = prompt('ÏÉàÎ°úÏö¥ ÏÇ¨Ïö©ÏûêÎ™ÖÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî:', gameState.currentUser.username);
            
            if (newUsername && newUsername.trim() !== '' && newUsername.length >= 3) {
                gameState.currentUser.username = newUsername.trim();
                updateUserDisplay();
                showNotification('ÏÇ¨Ïö©ÏûêÎ™ÖÏù¥ Î≥ÄÍ≤ΩÎêòÏóàÏäµÎãàÎã§', 'success');
                showAccountMenu(); // Î©îÎâ¥ ÏÉàÎ°úÍ≥†Ïπ®
            } else if (newUsername !== null) {
                showNotification('ÏÇ¨Ïö©ÏûêÎ™ÖÏùÄ 3Ïûê Ïù¥ÏÉÅÏù¥Ïñ¥Ïïº Ìï©ÎãàÎã§', 'error');
            }
        }

        // Ïó≠Ìï† Î≥ÄÍ≤Ω
        function changeRole() {
            const modalContent = `
                <h2 style="text-align: center; margin-bottom: 30px; color: var(--primary);">üé≠ Ïó≠Ìï† Î≥ÄÍ≤Ω</h2>
                
                <div style="background: rgba(245, 158, 11, 0.1); border: 1px solid rgba(245, 158, 11, 0.3); border-radius: 12px; padding: 20px; margin-bottom: 30px;">
                    <h3 style="color: var(--warning); margin: 0 0 10px 0;">‚ö†Ô∏è Ï£ºÏùòÏÇ¨Ìï≠</h3>
                    <p style="color: #94a3b8; margin: 0; font-size: 0.9rem;">
                        Ïó≠Ìï†ÏùÑ Î≥ÄÍ≤ΩÌïòÎ©¥ ÌòÑÏû¨ Í≤åÏûÑ Îç∞Ïù¥ÌÑ∞Í∞Ä Ï¥àÍ∏∞ÌôîÎêòÍ≥† ÏÉàÎ°úÏö¥ Ïó≠Ìï†Î°ú Îã§Ïãú ÏãúÏûëÎê©ÎãàÎã§. 
                        Î≥ÄÍ≤Ω Ï†ÑÏóê Ï§ëÏöîÌïú Îç∞Ïù¥ÌÑ∞Î•º Ï†ÄÏû•Ìï¥ÎëêÏÑ∏Ïöî.
                    </p>
                </div>

                <div style="display: grid; gap: 15px; margin-bottom: 30px;">
                    <button onclick="confirmRoleChange('entrepreneur')" style="
                        padding: 20px; background: linear-gradient(135deg, #3b82f6, #1d4ed8);
                        color: white; border: none; border-radius: 12px; cursor: pointer;
                        display: flex; align-items: center; gap: 15px;
                        ${gameState.currentUser.role === 'entrepreneur' ? 'opacity: 0.5; cursor: not-allowed;' : ''}
                    ">
                        <div style="font-size: 2rem;">üíº</div>
                        <div style="text-align: left;">
                            <div style="font-size: 1.1rem; font-weight: bold;">ÏÇ¨ÏóÖÍ∞Ä <span style="color: #ef4444; font-size: 0.8rem;">[ÏµúÍ≥† ÎÇúÏù¥ÎèÑ]</span></div>
                            <div style="font-size: 0.9rem; opacity: 0.8;">ÏÇ¨ÏóÖÏùÑ ÎßåÎì§Í≥† Ïö¥ÏòÅÌïòÎ©∞ Í≤ΩÏ†ú Ï†úÍµ≠ÏùÑ Í±¥ÏÑ§ÌïòÏÑ∏Ïöî (1Îßå ÎπÑÌä∏ÌÅ¨Î†àÎîß)</div>
                        </div>
                        ${gameState.currentUser.role === 'entrepreneur' ? '<div style="margin-left: auto; color: var(--success);">ÌòÑÏû¨ Ïó≠Ìï†</div>' : ''}
                    </button>

                    <button onclick="confirmRoleChange('banker')" style="
                        padding: 20px; background: linear-gradient(135deg, #10b981, #059669);
                        color: white; border: none; border-radius: 12px; cursor: pointer;
                        display: flex; align-items: center; gap: 15px;
                        ${gameState.currentUser.role === 'banker' ? 'opacity: 0.5; cursor: not-allowed;' : ''}
                    ">
                        <div style="font-size: 2rem;">üè¶</div>
                        <div style="text-align: left;">
                            <div style="font-size: 1.1rem; font-weight: bold;">ÏùÄÌñâÍ∞Ä <span style="color: #10b981; font-size: 0.8rem;">[ÏµúÏ†Ä ÎÇúÏù¥ÎèÑ]</span></div>
                            <div style="font-size: 0.9rem; opacity: 0.8;">ÏùÄÌñâÏùÑ Ïö¥ÏòÅÌïòÍ≥† Í∏àÏúµ ÏÑúÎπÑÏä§Î•º Ï†úÍ≥µÌïòÏÑ∏Ïöî (100Ïñµ ÎπÑÌä∏ÌÅ¨Î†àÎîß)</div>
                        </div>
                        ${gameState.currentUser.role === 'banker' ? '<div style="margin-left: auto; color: var(--success);">ÌòÑÏû¨ Ïó≠Ìï†</div>' : ''}
                    </button>

                    <button onclick="confirmRoleChange('investor')" style="
                        padding: 20px; background: linear-gradient(135deg, #8b5cf6, #7c3aed);
                        color: white; border: none; border-radius: 12px; cursor: pointer;
                        display: flex; align-items: center; gap: 15px;
                        ${gameState.currentUser.role === 'investor' ? 'opacity: 0.5; cursor: not-allowed;' : ''}
                    ">
                        <div style="font-size: 2rem;">üìà</div>
                        <div style="text-align: left;">
                            <div style="font-size: 1.1rem; font-weight: bold;">Ìà¨ÏûêÏûê <span style="color: #f59e0b; font-size: 0.8rem;">[ÎÜíÏùÄ ÎÇúÏù¥ÎèÑ]</span></div>
                            <div style="font-size: 0.9rem; opacity: 0.8;">Ï£ºÏãùÍ≥º ÏûêÏÇ∞Ïóê Ìà¨ÏûêÌïòÏó¨ ÏàòÏùµÏùÑ Ï∞ΩÏ∂úÌïòÏÑ∏Ïöî (1Îßå ÎπÑÌä∏ÌÅ¨Î†àÎîß)</div>
                        </div>
                        ${gameState.currentUser.role === 'investor' ? '<div style="margin-left: auto; color: var(--success);">ÌòÑÏû¨ Ïó≠Ìï†</div>' : ''}
                    </button>

                    <button onclick="confirmRoleChange('worker')" style="
                        padding: 20px; background: linear-gradient(135deg, #f59e0b, #d97706);
                        color: white; border: none; border-radius: 12px; cursor: pointer;
                        display: flex; align-items: center; gap: 15px;
                        ${gameState.currentUser.role === 'worker' ? 'opacity: 0.5; cursor: not-allowed;' : ''}
                    ">
                        <div style="font-size: 2rem;">üë∑</div>
                        <div style="text-align: left;">
                            <div style="font-size: 1.1rem; font-weight: bold;">ÏßÅÏû•Ïù∏ <span style="color: #fbbf24; font-size: 0.8rem;">[Î≥¥ÌÜµ ÎÇúÏù¥ÎèÑ]</span></div>
                            <div style="font-size: 0.9rem; opacity: 0.8;">ÌöåÏÇ¨ÏóêÏÑú ÏùºÌïòÎ©∞ ÏïàÏ†ïÏ†ÅÏù∏ ÏàòÏûÖÏùÑ ÏñªÏúºÏÑ∏Ïöî (1Îßå ÎπÑÌä∏ÌÅ¨Î†àÎîß)</div>
                        </div>
                        ${gameState.currentUser.role === 'worker' ? '<div style="margin-left: auto; color: var(--success);">ÌòÑÏû¨ Ïó≠Ìï†</div>' : ''}
                    </button>
                </div>

                <div style="text-align: center;">
                    <button onclick="showAccountMenu()" style="
                        padding: 10px 20px; border: 1px solid rgba(255,255,255,0.2);
                        background: rgba(255,255,255,0.05); color: #e2e8f0;
                        border-radius: 8px; cursor: pointer;
                    ">Ï∑®ÏÜå</button>
                </div>
            `;
            
            showModal(modalContent);
        }

        // Ïó≠Ìï† Î≥ÄÍ≤Ω ÌôïÏù∏
        function confirmRoleChange(newRole) {
            const roleNames = {
                'entrepreneur': 'ÏÇ¨ÏóÖÍ∞Ä',
                'banker': 'ÏùÄÌñâÍ∞Ä', 
                'investor': 'Ìà¨ÏûêÏûê',
                'worker': 'ÏßÅÏû•Ïù∏'
            };

            if (gameState.currentUser.role === newRole) {
                showNotification('Ïù¥ÎØ∏ ÏÑ†ÌÉùÎêú Ïó≠Ìï†ÏûÖÎãàÎã§', 'warning');
                return;
            }

            const roleName = roleNames[newRole];
            
            if (confirm(`Ï†ïÎßê ${roleName}Î°ú Ïó≠Ìï†ÏùÑ Î≥ÄÍ≤ΩÌïòÏãúÍ≤†ÏäµÎãàÍπå?\n\nÌòÑÏû¨ Í≤åÏûÑ Îç∞Ïù¥ÌÑ∞Í∞Ä Ï¥àÍ∏∞ÌôîÎêòÍ≥† ÏÉàÎ°ú ÏãúÏûëÎê©ÎãàÎã§.`)) {
                // ÌòÑÏû¨ ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥ Î≥¥Ï°¥ (Ïù¥Î¶Ñ, Ïù¥Î©îÏùºÏùÄ Ïú†ÏßÄ)
                const username = gameState.currentUser.username;
                const email = gameState.currentUser.email;
                const id = gameState.currentUser.id;

                // Ïó≠Ìï† Î≥ÄÍ≤Ω Î∞è Îç∞Ïù¥ÌÑ∞ Ï¥àÍ∏∞Ìôî
                gameState.currentUser.role = newRole;
                gameState.selectedRole = newRole;

                // Ïó≠Ìï†Î≥Ñ Ï¥àÍ∏∞ ÏûêÍ∏à ÏÑ§Ï†ï
                const initialBalance = {
                    'entrepreneur': 10000,
                    'banker': 10000000000, // 100Ïñµ
                    'investor': 10000,
                    'worker': 10000
                };

                gameState.currentUser.game_balance = initialBalance[newRole];

                // roleData Ï¥àÍ∏∞Ìôî
                initializeRoleData(newRole);

                // UI ÏóÖÎç∞Ïù¥Ìä∏
                updateDisplay();
                updateUserDisplay();
                showRoleSpecificMenu();

                closeModal();
                showNotification(`üéâ ${roleName}Î°ú Ïó≠Ìï†Ïù¥ Î≥ÄÍ≤ΩÎêòÏóàÏäµÎãàÎã§! ÏÉàÎ°úÏö¥ Ïó¨Ï†ïÏùÑ ÏãúÏûëÌïòÏÑ∏Ïöî!`, 'success');
            }
        }

        // Ïó≠Ìï†Î≥Ñ Îç∞Ïù¥ÌÑ∞ Ï¥àÍ∏∞Ìôî
        function initializeRoleData(role) {
            // roleData ÏôÑÏ†Ñ Ï¥àÍ∏∞Ìôî
            gameState.roleData = {
                businesses: [],
                investments: [],
                workHistory: [],
                workStats: {
                    salary: 3000,
                    experience: 0,
                    position: 'ÏÇ¨Ïõê',
                    bonuses: 0
                },
                publicCompany: null,
                companyRating: {
                    creditRating: 'BBB',
                    reputation: 75,
                    esgScore: 50,
                    marketShare: 5.0
                },
                rdProjects: [],
                competitors: [],
                supplyChain: {
                    rawMaterials: [],
                    manufacturers: [],
                    distributors: [],
                    retailers: [],
                    contracts: [],
                    inventory: new Map(),
                    marketPrices: new Map()
                },
                workforce: {
                    workers: [],
                    jobMarket: [],
                    unions: [],
                    trainingPrograms: [],
                    satisfactionFactors: {
                        baseSalary: 100,
                        benefits: 50,
                        workEnvironment: 50,
                        growthOpportunity: 50
                    }
                }
            };

            // Ïó≠Ìï†Î≥Ñ Ï¥àÍ∏∞ ÏÑ§Ï†ï
            if (role === 'entrepreneur') {
                initializeBusinessData();
                initializeMarketPrices();
            } else if (role === 'banker') {
                // ÏùÄÌñâÍ∞ÄÏùò Í≤ΩÏö∞ ÏùÄÌñâ Îç∞Ïù¥ÌÑ∞ Ï¥àÍ∏∞Ìôî
                if (gameState.gameData.banks.length === 0) {
                    gameState.gameData.banks.push({
                        id: Date.now(),
                        name: gameState.currentUser.username + ' ÏùÄÌñâ',
                        owner: gameState.currentUser.id,
                        totalDeposits: 0,
                        totalLoans: 0,
                        reserves: gameState.currentUser.game_balance,
                        interestRate: 0.05,
                        loanRate: 0.08,
                        creditRating: 'BBB',
                        branches: 1
                    });
                }
            } else if (role === 'investor') {
                // Ìà¨ÏûêÏûêÏùò Í≤ΩÏö∞ Í∏∞Î≥∏ Ìà¨Ïûê Ìè¨Ìä∏Ìè¥Î¶¨Ïò§ ÏÉùÏÑ±
                gameState.roleData.investments = [];
            } else if (role === 'worker') {
                // ÏßÅÏû•Ïù∏Ïùò Í≤ΩÏö∞ Í∑ºÎ¨¥ ÌÜµÍ≥Ñ Ï¥àÍ∏∞Ìôî
                gameState.roleData.workStats = {
                    salary: 3000,
                    experience: 0,
                    position: 'ÏÇ¨Ïõê',
                    bonuses: 0
                };
            }
        }

        // Ïó≠Ìï†Î≥Ñ Î©îÎâ¥ ÌëúÏãú
        function showRoleSpecificMenu() {
            // Î™®Îì† Ïó≠Ìï†Ïù¥ Î™®Îì† Î©îÎâ¥Ïóê Ï†ëÍ∑º Í∞ÄÎä•ÌïòÎèÑÎ°ù Î≥ÄÍ≤Ω
            document.getElementById('bankMenu').style.display = 'none';
            document.getElementById('investmentMenu').style.display = 'block'; // Î™®Îì† Ïó≠Ìï†Ïù¥ Ìà¨Ïûê Î©îÎâ¥ ÏÇ¨Ïö© Í∞ÄÎä•
            document.getElementById('workMenu').style.display = 'none';

            // Î™®Îì† Ïó≠Ìï†Ïù¥ ÏÇ¨ÏóÖÍ≥º Ìà¨Ïûê Îç∞Ïù¥ÌÑ∞ Ï¥àÍ∏∞Ìôî
            const role = gameState.currentUser.role;
            initializeBusinessData();
            initializeInvestmentData();
            
            if (role === 'banker') {
                document.getElementById('bankMenu').style.display = 'block';
            } else if (role === 'worker') {
                document.getElementById('workMenu').style.display = 'block';
            }

            // ÌòÑÏû¨ ÏÑπÏÖò ÏóÖÎç∞Ïù¥Ìä∏ (Í∏∞Î≥∏Ï†ÅÏúºÎ°ú ÏÇ¨ÏóÖ ÏÑπÏÖò ÌëúÏãú)
            showSection('business');
        }

        // Í≥ÑÏ†ï Ï†ÑÌôò
        function switchAccount() {
            if (confirm('Îã§Î•∏ Í≥ÑÏ†ïÏúºÎ°ú Ï†ÑÌôòÌïòÏãúÍ≤†ÏäµÎãàÍπå? ÌòÑÏû¨ Í≤åÏûÑ Îç∞Ïù¥ÌÑ∞Îäî Ï†ÄÏû•ÎêòÏßÄ ÏïäÏäµÎãàÎã§.')) {
                closeModal();
                logout();
            }
        }

        // Í≤åÏûÑ ÌÜµÍ≥Ñ ÌëúÏãú
        function showGameStats() {
            const businesses = gameState.roleData?.businesses || [];
            const workers = gameState.roleData?.workforce?.workers || [];
            
            const modalContent = `
                <h2 style="text-align: center; margin-bottom: 30px; color: var(--primary);">üìä Í≤åÏûÑ ÌÜµÍ≥Ñ</h2>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px;">
                    <!-- Ïû¨Ï†ï ÌÜµÍ≥Ñ -->
                    <div style="background: rgba(34, 197, 94, 0.1); border: 1px solid rgba(34, 197, 94, 0.3); border-radius: 12px; padding: 15px;">
                        <h3 style="color: var(--success); margin: 0 0 15px 0;">üí∞ Ïû¨Ï†ï ÌòÑÌô©</h3>
                        <div style="display: grid; gap: 8px; font-size: 0.9rem;">
                            <div style="display: flex; justify-content: space-between;">
                                <span>ÌòÑÏû¨ ÏûîÍ≥†:</span>
                                <span style="font-weight: bold;">${gameState.currentUser.game_balance.toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß</span>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span>Ï¥ù ÏûêÏÇ∞:</span>
                                <span style="font-weight: bold;">${(gameState.currentUser.totalAssets || gameState.currentUser.game_balance).toLocaleString()} ÎπÑÌä∏ÌÅ¨Î†àÎîß</span>
                            </div>
                        </div>
                    </div>

                    <!-- ÏÇ¨ÏóÖ ÌÜµÍ≥Ñ -->
                    <div style="background: rgba(59, 130, 246, 0.1); border: 1px solid rgba(59, 130, 246, 0.3); border-radius: 12px; padding: 15px;">
                        <h3 style="color: var(--primary); margin: 0 0 15px 0;">üè¢ ÏÇ¨ÏóÖ ÌòÑÌô©</h3>
                        <div style="display: grid; gap: 8px; font-size: 0.9rem;">
                            <div style="display: flex; justify-content: space-between;">
                                <span>Î≥¥Ïú† ÏÇ¨ÏóÖ:</span>
                                <span style="font-weight: bold;">${businesses.length}Í∞ú</span>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span>Ï¥ù ÏßÅÏõê:</span>
                                <span style="font-weight: bold;">${workers.length}Î™Ö</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ÏÑ±Ï∑® ÌÜµÍ≥Ñ -->
                <div style="background: rgba(168, 85, 247, 0.1); border: 1px solid rgba(168, 85, 247, 0.3); border-radius: 12px; padding: 15px; margin-bottom: 20px;">
                    <h3 style="color: #a855f7; margin: 0 0 15px 0;">üèÜ ÏÑ±Ï∑® ÌòÑÌô©</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; font-size: 0.8rem;">
                        <div style="text-align: center; padding: 10px; background: rgba(255,255,255,0.05); border-radius: 8px;">
                            <div style="font-size: 1.2rem; margin-bottom: 5px;">${businesses.length >= 10 ? 'üåü' : businesses.length >= 5 ? '‚≠ê' : businesses.length >= 1 ? 'üå±' : '‚ùì'}</div>
                            <div>ÏÇ¨ÏóÖÍ∞Ä Îì±Í∏â</div>
                        </div>
                        <div style="text-align: center; padding: 10px; background: rgba(255,255,255,0.05); border-radius: 8px;">
                            <div style="font-size: 1.2rem; margin-bottom: 5px;">${workers.length >= 50 ? 'üè≠' : workers.length >= 20 ? 'üè¢' : workers.length >= 5 ? 'üè™' : '‚ùì'}</div>
                            <div>Í≥†Ïö©Ï£º Îì±Í∏â</div>
                        </div>
                        <div style="text-align: center; padding: 10px; background: rgba(255,255,255,0.05); border-radius: 8px;">
                            <div style="font-size: 1.2rem; margin-bottom: 5px;">${gameState.currentUser.game_balance >= 1000000 ? 'üíé' : gameState.currentUser.game_balance >= 100000 ? 'üí∞' : gameState.currentUser.game_balance >= 10000 ? 'ü™ô' : '‚ùì'}</div>
                            <div>Î∂ÄÏûê Îì±Í∏â</div>
                        </div>
                    </div>
                </div>

                <div style="text-align: center;">
                    <button onclick="showAccountMenu()" style="
                        padding: 10px 20px; border: 1px solid rgba(255,255,255,0.2);
                        background: rgba(255,255,255,0.05); color: #e2e8f0;
                        border-radius: 8px; cursor: pointer;
                    ">ÎèåÏïÑÍ∞ÄÍ∏∞</button>
                </div>
            `;
            
            showModal(modalContent);
        }

        // ÎÖ∏ÎèôÏûê Í¥ÄÎ¶¨ ÏãúÏä§ÌÖúÏùÑ Î©îÏù∏ Î©îÎâ¥Ïóê Ï∂îÍ∞ÄÌïòÍ∏∞ ÏúÑÌïú Ìï®Ïàò
        function addWorkforceButton() {
            // Ïù¥ÎØ∏ Î≤ÑÌäºÏù¥ ÏûàÎäîÏßÄ ÌôïÏù∏
            if (document.getElementById('workforceButton')) return;
            
            const businessMenu = document.querySelector('.business-menu');
            if (businessMenu) {
                const workforceButton = document.createElement('button');
                workforceButton.id = 'workforceButton';
                workforceButton.className = 'btn';
                workforceButton.innerHTML = 'üë• ÎÖ∏ÎèôÏûê Í¥ÄÎ¶¨';
                workforceButton.onclick = showWorkforceManagement;
                workforceButton.style.marginTop = '10px';
                businessMenu.appendChild(workforceButton);
            }
        }

        // Îç∞Ïù¥ÌÑ∞ ÏòÅÏÜçÏÑ± ÏãúÏä§ÌÖú
        function saveGameState() {
            try {
                // Ï§ëÏöîÌïú Í≤åÏûÑ ÏÉÅÌÉúÎßå Ï†ÄÏû• (ÎØºÍ∞êÌïú Ï†ïÎ≥¥ Ï†úÏô∏)
                const saveData = {
                    currentUser: gameState.currentUser,
                    selectedRole: gameState.selectedRole,
                    roleData: gameState.roleData,
                    economy: gameState.economy,
                    bankSettings: gameState.bankSettings,
                    landMarket: gameState.landMarket,
                    cryptos: gameState.cryptos,
                    p2pMarket: gameState.p2pMarket,
                    laborMarket: gameState.laborMarket,
                    resourceSystem: gameState.resourceSystem ? {
                        resources: Object.fromEntries(gameState.resourceSystem.resources),
                        scarcityEffects: gameState.resourceSystem.scarcityEffects
                    } : null,
                    countrySystem: gameState.countrySystem,
                    lastSaved: Date.now()
                };
                
                localStorage.setItem('economyGameSave', JSON.stringify(saveData));
                localStorage.setItem('saveTimestamp', Date.now().toString());
                console.log('Í≤åÏûÑ ÏÉÅÌÉú Ï†ÄÏû• ÏôÑÎ£å');
                return true;
            } catch (error) {
                console.error('Í≤åÏûÑ Ï†ÄÏû• Ïã§Ìå®:', error);
                showNotification('‚ùå Í≤åÏûÑ Ï†ÄÏû•Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§', 'error');
                return false;
            }
        }

        function loadGameState() {
            try {
                const saveData = localStorage.getItem('economyGameSave');
                if (!saveData) return false;

                const parsedData = JSON.parse(saveData);
                
                // Í≤åÏûÑ ÏÉÅÌÉú Î≥µÏõê
                if (parsedData.currentUser) gameState.currentUser = parsedData.currentUser;
                if (parsedData.selectedRole) gameState.selectedRole = parsedData.selectedRole;
                if (parsedData.roleData) gameState.roleData = parsedData.roleData;
                if (parsedData.economy) gameState.economy = { ...gameState.economy, ...parsedData.economy };
                if (parsedData.bankSettings) gameState.bankSettings = { ...gameState.bankSettings, ...parsedData.bankSettings };
                if (parsedData.landMarket) gameState.landMarket = { ...gameState.landMarket, ...parsedData.landMarket };
                if (parsedData.cryptos) gameState.cryptos = parsedData.cryptos;
                if (parsedData.p2pMarket) gameState.p2pMarket = parsedData.p2pMarket;
                if (parsedData.laborMarket) gameState.laborMarket = parsedData.laborMarket;
                
                // ÏûêÏõê ÏãúÏä§ÌÖú Î≥µÏõê (Map Í∞ùÏ≤¥ Î≥µÏõê)
                if (parsedData.resourceSystem) {
                    gameState.resourceSystem = {
                        ...gameState.resourceSystem,
                        resources: new Map(Object.entries(parsedData.resourceSystem.resources)),
                        scarcityEffects: parsedData.resourceSystem.scarcityEffects
                    };
                }
                
                if (parsedData.countrySystem) gameState.countrySystem = parsedData.countrySystem;

                const lastSaved = new Date(parsedData.lastSaved);
                console.log(`Í≤åÏûÑ ÏÉÅÌÉú Î°úÎìú ÏôÑÎ£å (ÎßàÏßÄÎßâ Ï†ÄÏû•: ${lastSaved.toLocaleString()})`);
                showNotification('‚úÖ Ï†ÄÏû•Îêú Í≤åÏûÑÏùÑ Î∂àÎü¨ÏôîÏäµÎãàÎã§', 'success');
                
                // UI ÏóÖÎç∞Ïù¥Ìä∏
                updateDisplay();
                updateEconomyDisplay();
                if (gameState.resourceSystem) updateResourceDisplay();
                if (gameState.countrySystem) updateCountryDisplay();
                
                return true;
            } catch (error) {
                console.error('Í≤åÏûÑ Î°úÎìú Ïã§Ìå®:', error);
                showNotification('‚ùå Ï†ÄÏû•Îêú Í≤åÏûÑÏùÑ Î∂àÎü¨Ïò§ÎäîÎç∞ Ïã§Ìå®ÌñàÏäµÎãàÎã§', 'error');
                return false;
            }
        }

        function autoSaveGame() {
            if (gameState.currentUser && !gameState.isDemo) {
                saveGameState();
            }
        }

        function resetGameData() {
            if (confirm('Ï†ïÎßêÎ°ú Î™®Îì† Í≤åÏûÑ Îç∞Ïù¥ÌÑ∞Î•º Ï¥àÍ∏∞ÌôîÌïòÏãúÍ≤†ÏäµÎãàÍπå? Ïù¥ ÏûëÏóÖÏùÄ ÎêòÎèåÎ¶¥ Ïàò ÏóÜÏäµÎãàÎã§.')) {
                localStorage.removeItem('economyGameSave');
                localStorage.removeItem('saveTimestamp');
                location.reload(); // ÌéòÏù¥ÏßÄ ÏÉàÎ°úÍ≥†Ïπ®ÏúºÎ°ú Ï¥àÍ∏∞ ÏÉÅÌÉúÎ°ú Î≥µÏõê
            }
        }

        function exportGameData() {
            try {
                const saveData = localStorage.getItem('economyGameSave');
                if (!saveData) {
                    showNotification('‚ùå ÎÇ¥Î≥¥ÎÇº Ï†ÄÏû• Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§', 'error');
                    return;
                }

                const dataBlob = new Blob([saveData], { type: 'application/json' });
                const url = URL.createObjectURL(dataBlob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `economy_game_save_${new Date().toISOString().slice(0, 10)}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                showNotification('‚úÖ Í≤åÏûÑ Îç∞Ïù¥ÌÑ∞Í∞Ä ÎÇ¥Î≥¥ÎÇ¥Í∏∞ ÏôÑÎ£åÎêòÏóàÏäµÎãàÎã§', 'success');
            } catch (error) {
                console.error('Îç∞Ïù¥ÌÑ∞ ÎÇ¥Î≥¥ÎÇ¥Í∏∞ Ïã§Ìå®:', error);
                showNotification('‚ùå Îç∞Ïù¥ÌÑ∞ ÎÇ¥Î≥¥ÎÇ¥Í∏∞Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§', 'error');
            }
        }

        function importGameData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(event) {
                const file = event.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const importedData = JSON.parse(e.target.result);
                        
                        // Îç∞Ïù¥ÌÑ∞ Ïú†Ìö®ÏÑ± Í≤ÄÏÇ¨
                        if (!importedData.currentUser || !importedData.selectedRole) {
                            throw new Error('Ïú†Ìö®ÌïòÏßÄ ÏïäÏùÄ Ï†ÄÏû• ÌååÏùºÏûÖÎãàÎã§');
                        }

                        localStorage.setItem('economyGameSave', JSON.stringify(importedData));
                        showNotification('‚úÖ Í≤åÏûÑ Îç∞Ïù¥ÌÑ∞ Í∞ÄÏ†∏Ïò§Í∏∞ ÏôÑÎ£å! ÌéòÏù¥ÏßÄÎ•º ÏÉàÎ°úÍ≥†Ïπ®Ìï©ÎãàÎã§.', 'success');
                        
                        setTimeout(() => {
                            location.reload();
                        }, 2000);
                        
                    } catch (error) {
                        console.error('Îç∞Ïù¥ÌÑ∞ Í∞ÄÏ†∏Ïò§Í∏∞ Ïã§Ìå®:', error);
                        showNotification('‚ùå Ïú†Ìö®ÌïòÏßÄ ÏïäÏùÄ Ï†ÄÏû• ÌååÏùºÏûÖÎãàÎã§', 'error');
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        }

        // Supabase Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû•/Î°úÎìú ÏãúÏä§ÌÖú
        async function saveGameStateToSupabase() {
            if (!supabaseClient || gameState.isDemo) {
                console.log('Supabase ÌÅ¥ÎùºÏù¥Ïñ∏Ìä∏Í∞Ä ÏóÜÍ±∞ÎÇò Îç∞Î™® Î™®ÎìúÏûÖÎãàÎã§');
                return false;
            }

            try {
                const saveData = {
                    user_id: gameState.currentUser.email || gameState.currentUser.username,
                    username: gameState.currentUser.username,
                    role: gameState.selectedRole,
                    game_data: {
                        currentUser: gameState.currentUser,
                        selectedRole: gameState.selectedRole,
                        roleData: gameState.roleData,
                        economy: gameState.economy,
                        bankSettings: gameState.bankSettings,
                        landMarket: gameState.landMarket,
                        cryptos: gameState.cryptos,
                        p2pMarket: gameState.p2pMarket,
                        laborMarket: gameState.laborMarket,
                        resourceSystem: gameState.resourceSystem ? {
                            resources: Object.fromEntries(gameState.resourceSystem.resources),
                            scarcityEffects: gameState.resourceSystem.scarcityEffects
                        } : null,
                        countrySystem: gameState.countrySystem
                    },
                    last_saved: new Date().toISOString()
                };

                // Í∏∞Ï°¥ Îç∞Ïù¥ÌÑ∞ ÌôïÏù∏
                const { data: existingData } = await supabaseClient
                    .from('game_saves')
                    .select('id')
                    .eq('user_id', saveData.user_id)
                    .single();

                let result;
                if (existingData) {
                    // ÏóÖÎç∞Ïù¥Ìä∏
                    result = await supabaseClient
                        .from('game_saves')
                        .update(saveData)
                        .eq('user_id', saveData.user_id);
                } else {
                    // ÏÉàÎ°ú ÏÉùÏÑ±
                    result = await supabaseClient
                        .from('game_saves')
                        .insert([saveData]);
                }

                if (result.error) {
                    throw result.error;
                }

                console.log('SupabaseÏóê Í≤åÏûÑ ÏÉÅÌÉú Ï†ÄÏû• ÏôÑÎ£å');
                showNotification('‚òÅÔ∏è ÌÅ¥ÎùºÏö∞ÎìúÏóê Ï†ÄÏû• ÏôÑÎ£å!', 'success');
                return true;
            } catch (error) {
                console.error('Supabase Ï†ÄÏû• Ïã§Ìå®:', error);
                showNotification('‚ùå ÌÅ¥ÎùºÏö∞Îìú Ï†ÄÏû•Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§', 'error');
                return false;
            }
        }

        async function loadGameStateFromSupabase() {
            if (!supabaseClient) {
                console.log('Supabase ÌÅ¥ÎùºÏù¥Ïñ∏Ìä∏Í∞Ä ÏóÜÏäµÎãàÎã§');
                return false;
            }

            try {
                const userIdentifier = gameState.currentUser?.email || gameState.currentUser?.username;
                if (!userIdentifier) {
                    console.log('ÏÇ¨Ïö©Ïûê ÏãùÎ≥ÑÏûêÍ∞Ä ÏóÜÏäµÎãàÎã§');
                    return false;
                }

                const { data, error } = await supabaseClient
                    .from('game_saves')
                    .select('*')
                    .eq('user_id', userIdentifier)
                    .single();

                if (error) {
                    if (error.code === 'PGRST116') {
                        console.log('Ï†ÄÏû•Îêú Í≤åÏûÑ Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§');
                        return false;
                    }
                    throw error;
                }

                if (data && data.game_data) {
                    const gameData = data.game_data;
                    
                    // Í≤åÏûÑ ÏÉÅÌÉú Î≥µÏõê
                    if (gameData.currentUser) gameState.currentUser = gameData.currentUser;
                    if (gameData.selectedRole) gameState.selectedRole = gameData.selectedRole;
                    if (gameData.roleData) gameState.roleData = gameData.roleData;
                    if (gameData.economy) gameState.economy = { ...gameState.economy, ...gameData.economy };
                    if (gameData.bankSettings) gameState.bankSettings = { ...gameState.bankSettings, ...gameData.bankSettings };
                    if (gameData.landMarket) gameState.landMarket = { ...gameState.landMarket, ...gameData.landMarket };
                    if (gameData.cryptos) gameState.cryptos = gameData.cryptos;
                    if (gameData.p2pMarket) gameState.p2pMarket = gameData.p2pMarket;
                    if (gameData.laborMarket) gameState.laborMarket = gameData.laborMarket;
                    
                    // ÏûêÏõê ÏãúÏä§ÌÖú Î≥µÏõê
                    if (gameData.resourceSystem) {
                        gameState.resourceSystem = {
                            ...gameState.resourceSystem,
                            resources: new Map(Object.entries(gameData.resourceSystem.resources)),
                            scarcityEffects: gameData.resourceSystem.scarcityEffects
                        };
                    }
                    
                    if (gameData.countrySystem) gameState.countrySystem = gameData.countrySystem;

                    const lastSaved = new Date(data.last_saved);
                    console.log(`SupabaseÏóêÏÑú Í≤åÏûÑ ÏÉÅÌÉú Î°úÎìú ÏôÑÎ£å (ÎßàÏßÄÎßâ Ï†ÄÏû•: ${lastSaved.toLocaleString()})`);
                    showNotification('‚òÅÔ∏è ÌÅ¥ÎùºÏö∞ÎìúÏóêÏÑú Í≤åÏûÑÏùÑ Î∂àÎü¨ÏôîÏäµÎãàÎã§!', 'success');
                    
                    // UI ÏóÖÎç∞Ïù¥Ìä∏
                    updateDisplay();
                    updateEconomyDisplay();
                    if (gameState.resourceSystem) updateResourceDisplay();
                    if (gameState.countrySystem) updateCountryDisplay();
                    
                    return true;
                }
                
                return false;
            } catch (error) {
                console.error('Supabase Î°úÎìú Ïã§Ìå®:', error);
                showNotification('‚ùå ÌÅ¥ÎùºÏö∞ÎìúÏóêÏÑú Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨Ïò§ÎäîÎç∞ Ïã§Ìå®ÌñàÏäµÎãàÎã§', 'error');
                return false;
            }
        }

        async function deleteGameStateFromSupabase() {
            if (!supabaseClient || gameState.isDemo) return false;

            try {
                const userIdentifier = gameState.currentUser?.email || gameState.currentUser?.username;
                if (!userIdentifier) return false;

                const { error } = await supabaseClient
                    .from('game_saves')
                    .delete()
                    .eq('user_id', userIdentifier);

                if (error) throw error;

                console.log('SupabaseÏóêÏÑú Í≤åÏûÑ Îç∞Ïù¥ÌÑ∞ ÏÇ≠Ï†ú ÏôÑÎ£å');
                showNotification('‚òÅÔ∏è ÌÅ¥ÎùºÏö∞Îìú Îç∞Ïù¥ÌÑ∞Í∞Ä ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§', 'info');
                return true;
            } catch (error) {
                console.error('Supabase ÏÇ≠Ï†ú Ïã§Ìå®:', error);
                showNotification('‚ùå ÌÅ¥ÎùºÏö∞Îìú Îç∞Ïù¥ÌÑ∞ ÏÇ≠Ï†úÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§', 'error');
                return false;
            }
        }

        // ÏûêÎèô Ï†ÄÏû• ÏãúÏä§ÌÖú (Î°úÏª¨ + ÌÅ¥ÎùºÏö∞Îìú)
        async function autoSaveGame() {
            if (gameState.currentUser && !gameState.isDemo) {
                // Î°úÏª¨ Ï†ÄÏû•
                const localSaved = saveGameState();
                
                // ÌÅ¥ÎùºÏö∞Îìú Ï†ÄÏû• (Supabase Ïó∞Í≤∞ÎêòÏñ¥ ÏûàÏúºÎ©¥)
                if (supabaseClient) {
                    await saveGameStateToSupabase();
                }
            }
        }

        // ÏûêÎèô Ï†ÄÏû• Í∞ÑÍ≤© ÏÑ§Ï†ï (5Î∂ÑÎßàÎã§)
        let autoSaveInterval;
        
        function startAutoSave() {
            if (autoSaveInterval) clearInterval(autoSaveInterval);
            autoSaveInterval = setInterval(autoSaveGame, 5 * 60 * 1000); // 5Î∂ÑÎßàÎã§
        }

        function stopAutoSave() {
            if (autoSaveInterval) {
                clearInterval(autoSaveInterval);
                autoSaveInterval = null;
            }
        }

        // ÌéòÏù¥ÏßÄÎ•º Îñ†ÎÇ† Îïå ÏûêÎèô Ï†ÄÏû•
        window.addEventListener('beforeunload', function(e) {
            if (gameState.currentUser && !gameState.isDemo) {
                autoSaveGame();
            }
        });

        // ÎπÑÌôúÏÑ±Ìôî ÏãúÏóêÎèÑ Ï†ÄÏû•
        document.addEventListener('visibilitychange', function() {
            if (document.visibilityState === 'hidden' && gameState.currentUser && !gameState.isDemo) {
                autoSaveGame();
            }
        });

        // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú Ï≤¥ÌÅ¨
        window.onload = function() {
            // Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà Ï∂îÍ∞Ä
            setupEventListeners();
            
            // Ï†ÄÏû•Îêú Í≤åÏûÑ Îç∞Ïù¥ÌÑ∞ Î°úÎìú ÏãúÎèÑ
            loadGameState();
            
            const savedUrl = localStorage.getItem('supabaseUrl');
            const savedKey = localStorage.getItem('supabaseKey');
            
            if (savedUrl && savedKey) {
                try {
                    const { createClient } = supabase;
                    supabaseClient = createClient(savedUrl, savedKey);
                    
                    document.getElementById('setupScreen').style.display = 'none';
                    document.getElementById('loginScreen').style.display = 'flex';
                } catch (error) {
                    console.log('Supabase ÏûêÎèô Ïó∞Í≤∞ Ïã§Ìå®, Îç∞Î™® Î™®Îìú ÏÇ¨Ïö© Í∞ÄÎä•');
                }
            }
        };
    </script>
</body>
</html>