<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CryptoEconomy - ì‹¤ì œ ê²½ì œ ì‹œë®¬ë ˆì´ì…˜ ê²Œì„</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ’°</text></svg>">
    
    <!-- Supabase í´ë¼ì´ì–¸íŠ¸ -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;900&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --primary: #6366f1;
            --secondary: #8b5cf6;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --dark: #0f172a;
            --light: #f8fafc;
            --btc: #f7931a;
            --eth: #627eea;
            --bnb: #f3ba2f;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: #e2e8f0;
            min-height: 100vh;
        }
        
        /* Setup Screen */
        .setup-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }
        
        .setup-box {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 40px;
            width: 100%;
            max-width: 500px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }
        
        .setup-logo {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .setup-logo h1 {
            font-size: 2.5rem;
            font-weight: 900;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .setup-info {
            background: rgba(99, 102, 241, 0.1);
            border: 1px solid rgba(99, 102, 241, 0.3);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
        }
        
        .setup-info h3 {
            color: var(--primary);
            margin-bottom: 10px;
        }
        
        .setup-info p {
            color: #cbd5e1;
            line-height: 1.6;
            margin-bottom: 10px;
        }
        
        /* Login Screen */
        .login-container {
            display: none;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }
        
        .login-box {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 40px;
            width: 100%;
            max-width: 450px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }
        
        .login-logo {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .login-logo h1 {
            font-size: 2.5rem;
            font-weight: 900;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .login-logo p {
            color: #94a3b8;
            margin-top: 10px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            color: #cbd5e1;
            font-size: 0.9rem;
        }
        
        .form-input {
            width: 100%;
            padding: 12px 16px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            color: white;
            font-size: 1rem;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: var(--primary);
            background: rgba(255, 255, 255, 0.08);
        }
        
        .btn {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(99, 102, 241, 0.3);
        }
        
        .btn-secondary {
            background: transparent;
            border: 1px solid rgba(255, 255, 255, 0.2);
            margin-top: 10px;
        }
        
        /* Role Selection */
        .role-selection {
            display: none;
            padding: 40px;
        }
        
        .role-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        
        .role-card {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid transparent;
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .role-card:hover {
            border-color: var(--primary);
            background: rgba(255, 255, 255, 0.08);
            transform: translateY(-5px);
        }
        
        .role-card.selected {
            border-color: var(--success);
            background: rgba(16, 185, 129, 0.1);
        }
        
        .role-icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }
        
        .role-name {
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 10px;
        }
        
        .role-desc {
            font-size: 0.9rem;
            color: #94a3b8;
        }
        
        /* Main Game Container */
        .game-container {
            display: none;
            padding: 20px;
        }
        
        /* Top Bar */
        .top-bar {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .user-avatar {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1.2rem;
        }
        
        .user-details h3 {
            font-size: 1.1rem;
            margin-bottom: 3px;
        }
        
        .user-role {
            font-size: 0.9rem;
            color: #94a3b8;
        }
        
        .balance-display {
            display: flex;
            gap: 30px;
            align-items: center;
        }
        
        .balance-item {
            text-align: center;
        }
        
        .balance-label {
            font-size: 0.8rem;
            color: #94a3b8;
            margin-bottom: 5px;
        }
        
        .balance-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--success);
        }
        
        /* Game Board */
        .game-board {
            display: grid;
            grid-template-columns: 250px 1fr 300px;
            gap: 20px;
        }
        
        @media (max-width: 1200px) {
            .game-board {
                grid-template-columns: 1fr;
            }
        }
        
        /* Sidebar */
        .sidebar {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
        }
        
        .menu-item {
            display: block;
            width: 100%;
            padding: 12px;
            background: none;
            border: none;
            color: #94a3b8;
            text-align: left;
            border-radius: 8px;
            margin-bottom: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .menu-item:hover {
            background: rgba(255, 255, 255, 0.05);
            color: white;
        }
        
        .menu-item.active {
            background: var(--primary);
            color: white;
        }
        
        /* Main Content */
        .main-content {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 25px;
        }
        
        .content-header {
            margin-bottom: 25px;
        }
        
        .content-title {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 10px;
        }
        
        .content-subtitle {
            color: #94a3b8;
        }
        
        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 20px;
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: #94a3b8;
            margin-bottom: 10px;
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: 700;
        }
        
        /* Action Grid */
        .action-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .action-btn {
            padding: 15px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(99, 102, 241, 0.3);
        }
        
        /* Business Card */
        .business-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .business-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .business-name {
            font-size: 1.3rem;
            font-weight: 600;
        }
        
        .business-profit {
            color: var(--success);
            font-weight: 700;
        }
        
        /* Loan Applications */
        .loan-card {
            padding: 15px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 10px;
            margin-bottom: 15px;
        }
        
        .loan-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .loan-applicant {
            font-weight: 600;
        }
        
        .loan-amount {
            color: var(--primary);
            font-weight: 700;
        }
        
        .loan-actions {
            display: flex;
            gap: 10px;
        }
        
        .loan-actions .btn {
            flex: 1;
            padding: 8px;
            font-size: 0.9rem;
        }
        
        /* Market Sidebar */
        .market-sidebar {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
        }
        
        .market-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 20px;
        }
        
        .market-item {
            padding: 12px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 8px;
            margin-bottom: 10px;
        }
        
        .market-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px;
        }
        
        .market-item-name {
            font-weight: 600;
        }
        
        .market-item-price {
            color: var(--success);
        }
        
        .market-item-change {
            font-size: 0.9rem;
            color: var(--success);
        }
        
        .market-item-change.negative {
            color: var(--danger);
        }
        
        /* Notification */
        .notification {
            position: fixed;
            bottom: 20px;
            right: -400px;
            background: #1e293b;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 20px;
            max-width: 350px;
            transition: right 0.3s ease-in-out;
            z-index: 1000;
        }
        
        .notification.show {
            right: 20px;
        }
        
        .notification.success {
            border-left: 4px solid var(--success);
        }
        
        .notification.error {
            border-left: 4px solid var(--danger);
        }
        
        .notification.info {
            border-left: 4px solid var(--primary);
        }
        
        .notification.warning {
            border-left: 4px solid var(--warning);
        }
        
        /* Leaderboard */
        .leaderboard-list {
            margin-top: 20px;
        }
        
        .leaderboard-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 8px;
            margin-bottom: 10px;
        }
        
        .leaderboard-rank {
            font-weight: 700;
            color: var(--warning);
            margin-right: 15px;
        }
        
        .leaderboard-name {
            flex: 1;
        }
        
        .leaderboard-balance {
            color: var(--success);
            font-weight: 700;
        }
    </style>
</head>
<body>
    <!-- Setup Screen (ì²˜ìŒ ë³´ì´ëŠ” í™”ë©´) -->
    <div class="setup-container" id="setupScreen">
        <div class="setup-box">
            <div class="setup-logo">
                <h1>ğŸ’° CryptoEconomy</h1>
                <p>ì‹¤ì œ ì•”í˜¸í™”í ê²½ì œ ì‹œë®¬ë ˆì´ì…˜</p>
            </div>
            
            <div class="setup-info">
                <h3>ğŸ® ê²Œì„ ì‹œì‘í•˜ê¸°</h3>
                <p>ë°ëª¨ ëª¨ë“œë¡œ ë°”ë¡œ í”Œë ˆì´í•˜ê±°ë‚˜</p>
                <p>Supabaseë¥¼ ì—°ë™í•˜ì—¬ ë©€í‹°í”Œë ˆì´ì–´ë¡œ ì¦ê¸°ì„¸ìš”!</p>
            </div>
            
            <button class="btn" id="playDemoBtn" style="margin-bottom: 10px;">ğŸ¯ ë°ëª¨ ëª¨ë“œë¡œ ì‹œì‘</button>
            
            <button class="btn btn-secondary" id="supabaseSetupBtn" style="
                background: linear-gradient(135deg, #3b82f6, #1d4ed8) !important;
                color: white !important;
                border: none !important;
                padding: 12px 24px !important;
                font-weight: 600 !important;
                cursor: pointer !important;
                margin-bottom: 15px;
            ">ğŸ”— Supabase ì—°ë™í•˜ê¸°</button>
            
            <div id="supabaseSetup" style="display: none; margin-top: 20px; padding: 20px; background: rgba(59, 130, 246, 0.1); border: 1px solid rgba(59, 130, 246, 0.3); border-radius: 12px;">
                <h3 style="color: var(--primary); margin-bottom: 15px; text-align: center;">ğŸ”— Supabase ì—°ë™ ì„¤ì •</h3>
                
                <div class="form-group">
                    <label class="form-label">Supabase URL</label>
                    <input type="text" class="form-input" id="supabaseUrl" 
                           placeholder="https://xxxxx.supabase.co" style="margin-bottom: 10px;">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Supabase Anon Key</label>
                    <input type="text" class="form-input" id="supabaseKey" 
                           placeholder="eyJhbGc..." style="margin-bottom: 15px;">
                </div>
                
                <div style="text-align: center; margin-top: 15px;">
                    <button class="btn" id="setupSupabaseBtn" style="
                        background: var(--success) !important;
                        color: white !important;
                        padding: 12px 24px !important;
                        font-weight: 600 !important;
                        margin-right: 10px;
                    ">âœ… ì—°ë™ ì™„ë£Œ</button>
                    
                    <button class="btn btn-secondary" id="cancelSupabaseBtn" style="
                        background: rgba(107, 114, 128, 0.8) !important;
                        color: white !important;
                        padding: 12px 24px !important;
                    ">âŒ ì·¨ì†Œ</button>
                </div>
                
                <div style="margin-top: 15px; padding: 10px; background: rgba(245, 158, 11, 0.1); border: 1px solid rgba(245, 158, 11, 0.3); border-radius: 8px;">
                    <p style="color: #f59e0b; margin: 0; font-size: 0.8rem; text-align: center;">
                        ğŸ’¡ Supabase í”„ë¡œì íŠ¸ë¥¼ ìƒì„±í•˜ê³  ìœ„ì˜ ì •ë³´ë¥¼ ì…ë ¥í•˜ì„¸ìš”
                    </p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Login Screen -->
    <div class="login-container" id="loginScreen">
        <div class="login-box">
            <div class="login-logo">
                <h1>ğŸ’° CryptoEconomy</h1>
                <p>ì‹¤ì œ ì•”í˜¸í™”í ê²½ì œ ì‹œë®¬ë ˆì´ì…˜</p>
            </div>
            
            <div class="form-group">
                <label class="form-label">ì´ë©”ì¼</label>
                <input type="email" class="form-input" id="email" placeholder="your@email.com">
            </div>
            
            <div class="form-group">
                <label class="form-label">ì‚¬ìš©ìëª… (ê²Œì„ ë‚´ ë‹‰ë„¤ì„)</label>
                <input type="text" class="form-input" id="username" placeholder="ì›í•˜ëŠ” ë‹‰ë„¤ì„ (3ì ì´ìƒ)">
            </div>
            
            <div class="form-group">
                <label class="form-label">ë¹„ë°€ë²ˆí˜¸</label>
                <input type="password" class="form-input" id="password" placeholder="ë¹„ë°€ë²ˆí˜¸ (ìµœì†Œ 6ì)">
            </div>
            
            <button class="btn" id="loginBtn">ë¡œê·¸ì¸ / íšŒì›ê°€ì…</button>
            <button class="btn btn-secondary" id="loginHelpBtn">ì²˜ìŒì´ì‹ ê°€ìš”?</button>
            <button class="btn btn-secondary" id="loginAsGuestBtn">ê²ŒìŠ¤íŠ¸ë¡œ í”Œë ˆì´</button>
        </div>
    </div>
    
    <!-- Role Selection -->
    <div class="role-selection" id="roleSelection">
        <div class="login-box" style="max-width: 800px;">
            <h2 style="text-align: center; margin-bottom: 10px;">ì—­í• ì„ ì„ íƒí•˜ì„¸ìš”</h2>
            <p style="text-align: center; color: #94a3b8; margin-bottom: 30px;">
                ì€í–‰ì¥ì€ 1ëª…ë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤ (ì„ ì°©ìˆœ)
            </p>
            
            <div class="role-grid">
                <div class="role-card" onclick="selectRole('banker')" id="role-banker">
                    <div class="role-icon">ğŸ¦</div>
                    <div class="role-name">ì€í–‰ì¥</div>
                    <div class="role-desc">ì€í–‰ ìš´ì˜, ëŒ€ì¶œ ìŠ¹ì¸, ê¸ˆë¦¬ ê²°ì •</div>
                </div>
                
                <div class="role-card" onclick="selectRole('entrepreneur')" id="role-entrepreneur">
                    <div class="role-icon">ğŸ’¼</div>
                    <div class="role-name">ì‚¬ì—…ê°€</div>
                    <div class="role-desc">ì‚¬ì—… ìš´ì˜, íˆ¬ì, ê±°ë˜</div>
                </div>
                
                <div class="role-card" onclick="selectRole('investor')" id="role-investor">
                    <div class="role-icon">ğŸ“ˆ</div>
                    <div class="role-name">íˆ¬ìì</div>
                    <div class="role-desc">ì£¼ì‹, ë¶€ë™ì‚°, ì•”í˜¸í™”í íˆ¬ì</div>
                </div>
                
                <div class="role-card" onclick="selectRole('worker')" id="role-worker">
                    <div class="role-icon">ğŸ‘·</div>
                    <div class="role-name">ì§ì¥ì¸</div>
                    <div class="role-desc">ì•ˆì •ì  ìˆ˜ì…, ì €ì¶•, ëŒ€ì¶œ</div>
                </div>
            </div>
            
            <button class="btn" style="margin-top: 30px;" onclick="confirmRole()">ì„ íƒ ì™„ë£Œ</button>
        </div>
    </div>
    
    <!-- Main Game -->
    <div class="game-container" id="gameContainer">
        <!-- Top Bar -->
        <div class="top-bar">
            <div class="user-info">
                <div class="user-avatar" id="userAvatar">A</div>
                <div class="user-details">
                    <h3 id="userName">Player</h3>
                    <div class="user-role" id="userRole">ì—­í• </div>
                </div>
            </div>
            
            <div class="balance-display">
                <div class="balance-item">
                    <div class="balance-label">ì‚¬ìš©ì</div>
                    <div class="balance-value" id="currentUserName" style="font-size: 1.2rem; color: var(--primary);">-</div>
                    <div style="display: flex; gap: 5px; margin-top: 8px;">
                        <button onclick="showAccountMenu()" style="
                            padding: 4px 8px; background: var(--primary); 
                            color: white; border: none; border-radius: 4px; 
                            cursor: pointer; font-size: 0.8rem;
                        ">ê³„ì •</button>
                        <button onclick="logout()" style="
                            padding: 4px 8px; background: var(--danger); 
                            color: white; border: none; border-radius: 4px; 
                            cursor: pointer; font-size: 0.8rem;
                        ">ë¡œê·¸ì•„ì›ƒ</button>
                    </div>
                </div>
                <div class="balance-item">
                    <div class="balance-label">ë¹„íŠ¸í¬ë ˆë”§</div>
                    <div class="balance-value" id="gameBalance">0</div>
                </div>
                <div class="balance-item">
                    <div class="balance-label">ì´ ìì‚°</div>
                    <div class="balance-value" id="totalAssets">0</div>
                </div>
                <div class="balance-item">
                    <div class="balance-label">ì‹ ìš©ë“±ê¸‰</div>
                    <div class="balance-value" id="creditGrade" style="font-size: 1.5rem;">-</div>
                    <div style="font-size: 0.9rem; margin-top: 5px;">
                        ì ìˆ˜: <span id="creditScore">-</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Game Board -->
        <div class="game-board">
            <!-- Left Sidebar -->
            <div class="sidebar">
                <button class="menu-item active" onclick="showSection('overview')">
                    ğŸ“Š ê°œìš”
                </button>
                <button class="menu-item" onclick="showSection('bank')" id="bankMenu" style="display: none;">
                    ğŸ¦ ì€í–‰ ê´€ë¦¬
                </button>
                <button class="menu-item" onclick="showSection('business')">
                    ğŸ’¼ ì‚¬ì—…
                </button>
                <button class="menu-item" onclick="showSection('investments')" id="investmentMenu" style="display: none;">
                    ğŸ“ˆ íˆ¬ì
                </button>
                <button class="menu-item" onclick="showSection('work')" id="workMenu" style="display: none;">
                    ğŸ‘· ì§ì¥
                </button>
                <button class="menu-item" onclick="showSection('p2p')">
                    ğŸ¤ P2P ê±°ë˜
                </button>
                <button class="menu-item" onclick="showSection('labor')">
                    ğŸ‘¥ ë…¸ë™ì‹œì¥
                </button>
                <button class="menu-item" onclick="showSection('loans')">
                    ğŸ’³ ëŒ€ì¶œ
                </button>
                <button class="menu-item" onclick="showSection('leaderboard')">
                    ğŸ† ìˆœìœ„
                </button>
                <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid rgba(255,255,255,0.1);">
                    <button class="menu-item" onclick="changeRole()" style="background: linear-gradient(135deg, #8b5cf6, #7c3aed);">
                        ğŸ­ ì—­í•  ë³€ê²½
                    </button>
                </div>
            </div>
            
            <!-- Main Content -->
            <div class="main-content">
                <!-- Overview Section -->
                <div id="overview-section" class="content-section">
                    <div class="content-header">
                        <h2 class="content-title">ê²½ì œ í˜„í™©</h2>
                        <p class="content-subtitle">ì‹¤ì‹œê°„ ê²½ì œ ì§€í‘œ</p>
                    </div>
                    
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-label">ì´ ìœ ì €</div>
                            <div class="stat-value" id="totalUsers">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">ì´ ìì‚°</div>
                            <div class="stat-value" id="totalEconomy">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">í™œì„± ì‚¬ì—…</div>
                            <div class="stat-value" id="totalBusinesses">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">ì´ ëŒ€ì¶œ</div>
                            <div class="stat-value" id="totalLoans">0</div>
                        </div>
                    </div>
                    
                    <!-- ê²½ì œ ì§€í‘œ ì„¹ì…˜ -->
                    <div style="margin-top: 20px;">
                        <h3 style="color: var(--primary); margin-bottom: 15px;">ğŸ“Š ê²½ì œ ì§€í‘œ</h3>
                        <div class="stat-grid" style="grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 10px;">
                            <div class="stat-card" style="padding: 10px;">
                                <div class="stat-label" style="font-size: 0.8rem;">ì¸í”Œë ˆì´ì…˜</div>
                                <div class="stat-value" id="inflationRate" style="font-size: 1rem;">2.5%</div>
                            </div>
                            <div class="stat-card" style="padding: 10px;">
                                <div class="stat-label" style="font-size: 0.8rem;">ê²½ê¸°êµ­ë©´</div>
                                <div class="stat-value" id="economicPhase" style="font-size: 1rem;">í™•ì¥ê¸°</div>
                            </div>
                            <div class="stat-card" style="padding: 10px;">
                                <div class="stat-label" style="font-size: 0.8rem;">GDPì„±ì¥</div>
                                <div class="stat-value" id="gdpGrowth" style="font-size: 1rem;">3.2%</div>
                            </div>
                            <div class="stat-card" style="padding: 10px;">
                                <div class="stat-label" style="font-size: 0.8rem;">ì‹¤ì—…ë¥ </div>
                                <div class="stat-value" id="unemploymentRate" style="font-size: 1rem;">4.5%</div>
                            </div>
                            <div class="stat-card" style="padding: 10px;">
                                <div class="stat-label" style="font-size: 0.8rem;">ê¸°ì¤€ê¸ˆë¦¬</div>
                                <div class="stat-value" id="interestRate" style="font-size: 1rem;">3.5%</div>
                            </div>
                            <div class="stat-card" style="padding: 10px;">
                                <div class="stat-label" style="font-size: 0.8rem;">ì†Œë¹„ìì‹ ë¢°</div>
                                <div class="stat-value" id="consumerConfidence" style="font-size: 1rem;">75</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ìì› & êµ­ê°€ í˜„í™© ì„¹ì…˜ -->
                    <div style="margin-top: 20px;">
                        <h3 style="color: var(--success); margin-bottom: 15px;">ğŸŒ êµ­ê°€ & ìì› í˜„í™©</h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                            <!-- ìì› í˜„í™© -->
                            <div style="background: rgba(34, 34, 34, 0.6); border-radius: 12px; padding: 15px;">
                                <div id="resourceStatus">
                                    <!-- ìì› ìƒíƒœê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                                </div>
                            </div>
                            
                            <!-- êµ­ê°€ ê²½ì œ í˜„í™© -->
                            <div style="background: rgba(34, 34, 34, 0.6); border-radius: 12px; padding: 15px;">
                                <h4 style="color: var(--primary); margin-bottom: 15px;">ğŸ›ï¸ êµ­ê°€ ê²½ì œ ì§€í‘œ</h4>
                                <div style="display: flex; flex-direction: column; gap: 8px;">
                                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 6px; background: rgba(255,255,255,0.05); border-radius: 6px;">
                                        <span>ğŸ‘¥ ì´ ì¸êµ¬</span>
                                        <span id="countryPopulation" style="font-weight: bold;">52,000,000ëª…</span>
                                    </div>
                                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 6px; background: rgba(255,255,255,0.05); border-radius: 6px;">
                                        <span>ğŸ“Š ê²½ì œí™œì„±ë„</span>
                                        <span id="economicActivity" style="font-weight: bold;">75%</span>
                                    </div>
                                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 6px; background: rgba(255,255,255,0.05); border-radius: 6px;">
                                        <span>ğŸ’° 1ì¸ë‹¹ GDP</span>
                                        <span id="gdpPerCapita" style="font-weight: bold;">$35,000</span>
                                    </div>
                                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 6px; background: rgba(255,255,255,0.05); border-radius: 6px;">
                                        <span>ğŸ’¸ ì†Œë¹„ì§€ì¶œ</span>
                                        <span id="consumerSpendingIndex" style="font-weight: bold;">80%</span>
                                    </div>
                                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 6px; background: rgba(255,255,255,0.05); border-radius: 6px;">
                                        <span>ğŸš€ ì°½ì—…ë¥ </span>
                                        <span id="businessFormation" style="font-weight: bold;">15%</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="action-grid">
                        <button class="action-btn" onclick="startBusiness()">
                            ğŸª ì‚¬ì—… ì‹œì‘í•˜ê¸°
                        </button>
                        <button class="action-btn" onclick="applyLoan()">
                            ğŸ’³ ëŒ€ì¶œ ì‹ ì²­í•˜ê¸°
                        </button>
                        <button class="action-btn" onclick="refreshData()">
                            ğŸ”„ ë°ì´í„° ìƒˆë¡œê³ ì¹¨
                        </button>
                    </div>
                </div>
                
                <!-- Bank Section (Bank Owner Only) -->
                <div id="bank-section" class="content-section" style="display: none;">
                    <div class="content-header">
                        <h2 class="content-title">ì€í–‰ ê´€ë¦¬</h2>
                        <p class="content-subtitle">ëŒ€ì¶œ ìŠ¹ì¸, ê¸ˆë¦¬ ì„¤ì •</p>
                    </div>
                    
                    <!-- ì€í–‰ ê¸ˆë¦¬ ì„¤ì • -->
                    <div class="stats-grid" style="margin-bottom: 30px;">
                        <div class="stat-card">
                            <div class="stat-label">ê¸°ì¤€ ê¸ˆë¦¬</div>
                            <div class="stat-value" id="baseRate">5.0%</div>
                            <div class="action-grid" style="margin-top: 10px; grid-template-columns: repeat(4, 1fr);">
                                <button class="action-btn" style="padding: 10px; font-size: 0.8rem;" onclick="adjustRate('base', -1)">-1%</button>
                                <button class="action-btn" style="padding: 10px; font-size: 0.8rem;" onclick="adjustRate('base', -0.1)">-0.1%</button>
                                <button class="action-btn" style="padding: 10px; font-size: 0.8rem;" onclick="adjustRate('base', 0.1)">+0.1%</button>
                                <button class="action-btn" style="padding: 10px; font-size: 0.8rem;" onclick="adjustRate('base', 1)">+1%</button>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">ëŒ€ì¶œ ê¸ˆë¦¬</div>
                            <div class="stat-value" id="loanRate">8.0%</div>
                            <div class="action-grid" style="margin-top: 10px; grid-template-columns: repeat(4, 1fr);">
                                <button class="action-btn" style="padding: 10px; font-size: 0.8rem;" onclick="adjustRate('loan', -1)">-1%</button>
                                <button class="action-btn" style="padding: 10px; font-size: 0.8rem;" onclick="adjustRate('loan', -0.1)">-0.1%</button>
                                <button class="action-btn" style="padding: 10px; font-size: 0.8rem;" onclick="adjustRate('loan', 0.1)">+0.1%</button>
                                <button class="action-btn" style="padding: 10px; font-size: 0.8rem;" onclick="adjustRate('loan', 1)">+1%</button>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">ì˜ˆê¸ˆ ê¸ˆë¦¬</div>
                            <div class="stat-value" id="depositRate">3.0%</div>
                            <div class="action-grid" style="margin-top: 10px; grid-template-columns: repeat(4, 1fr);">
                                <button class="action-btn" style="padding: 10px; font-size: 0.8rem;" onclick="adjustRate('deposit', -1)">-1%</button>
                                <button class="action-btn" style="padding: 10px; font-size: 0.8rem;" onclick="adjustRate('deposit', -0.1)">-0.1%</button>
                                <button class="action-btn" style="padding: 10px; font-size: 0.8rem;" onclick="adjustRate('deposit', 0.1)">+0.1%</button>
                                <button class="action-btn" style="padding: 10px; font-size: 0.8rem;" onclick="adjustRate('deposit', 1)">+1%</button>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">ì€í–‰ ìì‚°</div>
                            <div class="stat-value" id="bankAssets">0</div>
                        </div>
                    </div>
                    
                    <!-- ì€í–‰ ì •ì±… ì„¤ì • -->
                    <div style="background: rgba(255, 255, 255, 0.05); border-radius: 10px; padding: 20px; margin-bottom: 30px;">
                        <h3 style="margin-bottom: 20px;">ì€í–‰ ì •ì±…</h3>
                        <div class="action-grid">
                            <button class="action-btn" onclick="setBankPolicy('conservative')">
                                ğŸ›¡ï¸ ë³´ìˆ˜ì  ì •ì±…
                                <div style="font-size: 0.8rem; margin-top: 5px;">ë‚®ì€ ìœ„í—˜, ë‚®ì€ ìˆ˜ìµ</div>
                            </button>
                            <button class="action-btn" onclick="setBankPolicy('balanced')">
                                âš–ï¸ ê· í˜• ì •ì±…
                                <div style="font-size: 0.8rem; margin-top: 5px;">ì¤‘ê°„ ìœ„í—˜, ì¤‘ê°„ ìˆ˜ìµ</div>
                            </button>
                            <button class="action-btn" onclick="setBankPolicy('aggressive')">
                                ğŸš€ ê³µê²©ì  ì •ì±…
                                <div style="font-size: 0.8rem; margin-top: 5px;">ë†’ì€ ìœ„í—˜, ë†’ì€ ìˆ˜ìµ</div>
                            </button>
                        </div>
                    </div>
                    
                    <!-- ê³ ê¸‰ ì€í–‰ ê¸°ëŠ¥ -->
                    <div style="background: rgba(255, 255, 255, 0.05); border-radius: 10px; padding: 20px; margin-bottom: 30px;">
                        <h3 style="margin-bottom: 20px;">ê³ ê¸‰ ì€í–‰ ê¸°ëŠ¥</h3>
                        <div class="action-grid">
                            <button class="action-btn" onclick="issueGovernmentBond()">
                                ğŸ›ï¸ êµ­ì±„ ë°œí–‰
                                <div style="font-size: 0.8rem; margin-top: 5px;">ì•ˆì „í•œ íˆ¬ì ìƒí’ˆ</div>
                            </button>
                            <button class="action-btn" onclick="adjustMoneySupply()">
                                ğŸ’° í†µí™”ëŸ‰ ì¡°ì ˆ
                                <div style="font-size: 0.8rem; margin-top: 5px;">ê²½ì œ ì•ˆì •í™”</div>
                            </button>
                            <button class="action-btn" onclick="provideLoanGuarantee()">
                                ğŸ›¡ï¸ ëŒ€ì¶œ ë³´ì¦
                                <div style="font-size: 0.8rem; margin-top: 5px;">ì¤‘ì†Œê¸°ì—… ì§€ì›</div>
                            </button>
                            <button class="action-btn" onclick="createSpecialProduct()">
                                â­ íŠ¹ë³„ ê¸ˆìœµìƒí’ˆ
                                <div style="font-size: 0.8rem; margin-top: 5px;">ê³ ìˆ˜ìµ ìƒí’ˆ ì¶œì‹œ</div>
                            </button>
                        </div>
                    </div>
                    
                    <!-- ì€í–‰ í†µê³„ -->
                    <div style="background: rgba(255, 255, 255, 0.05); border-radius: 10px; padding: 20px; margin-bottom: 30px;">
                        <h3 style="margin-bottom: 20px;">ì€í–‰ í†µê³„</h3>
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-label">ì´ ëŒ€ì¶œì•¡</div>
                                <div class="stat-value" id="totalLoansIssued">0</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">ì´ ì˜ˆê¸ˆì•¡</div>
                                <div class="stat-value" id="totalDeposits">0</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">ì€í–‰ ì‹ ìš©ë„</div>
                                <div class="stat-value" id="bankRating">AAA</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">ì‹œì¥ ì ìœ ìœ¨</div>
                                <div class="stat-value" id="marketShare">0%</div>
                            </div>
                        </div>
                    </div>
                    
                    <h3 style="margin-top: 30px; margin-bottom: 20px;">ëŒ€ì¶œ ì‹ ì²­ ëª©ë¡</h3>
                    <div id="loanApplications">
                        <!-- ëŒ€ì¶œ ì‹ ì²­ ëª©ë¡ -->
                    </div>
                </div>
                
                <!-- Business Section -->
                <div id="business-section" class="content-section" style="display: none;">
                    <div class="content-header">
                        <h2 class="content-title">ë‚´ ì‚¬ì—…</h2>
                        <p class="content-subtitle">ì‚¬ì—… ê´€ë¦¬ ë° í™•ì¥</p>
                    </div>
                    
                    <!-- ì‚¬ì—…ê°€ ì „ìš© ê¸°ëŠ¥ -->
                    <div class="stats-grid" style="margin-bottom: 30px;">
                        <div class="stat-card">
                            <div class="stat-label">ì´ ì‚¬ì—… ìˆ˜</div>
                            <div class="stat-value" id="businessCount">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">ì›” ìˆ˜ìµ</div>
                            <div class="stat-value" id="monthlyProfit" style="color: var(--success);">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">ì‚¬ì—… í‰ê°€ì•¡</div>
                            <div class="stat-value" id="businessValue">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">ì§ì› ìˆ˜</div>
                            <div class="stat-value" id="employeeCount">0</div>
                        </div>
                    </div>
                    
                    <div class="action-grid" style="margin-bottom: 30px;">
                        <button class="action-btn" onclick="createNewBusiness()">
                            ğŸª ìƒˆ ì‚¬ì—… ì‹œì‘
                        </button>
                        <button class="action-btn" onclick="expandBusiness()">
                            ğŸ“ˆ ì‚¬ì—… í™•ì¥
                        </button>
                        <button class="action-btn" onclick="hirEmployee()">
                            ğŸ‘¥ ì§ì› ì±„ìš©
                        </button>
                        <button class="action-btn" onclick="sellBusiness()">
                            ğŸ’° ì‚¬ì—… ë§¤ê°
                        </button>
                        <button class="action-btn" onclick="goPublic()">
                            ğŸ›ï¸ ê¸°ì—… ìƒì¥
                        </button>
                        <button class="action-btn" onclick="buyBackShares()">
                            ğŸ“Š ìì‚¬ì£¼ ë§¤ì…
                        </button>
                        <button class="action-btn" onclick="rightOffering()">
                            ğŸ’ ìœ ìƒì¦ì
                        </button>
                        <button class="action-btn" onclick="showMAPanel()">
                            ğŸ¤ M&A
                        </button>
                        <button class="action-btn" onclick="showRDPanel()">
                            ğŸ”¬ R&D
                        </button>
                        <button class="action-btn" onclick="showWorkforceManagement()">
                            ğŸ‘¥ ë…¸ë™ì ê´€ë¦¬
                        </button>
                    </div>
                    
                    <!-- ê¸°ì—… ë“±ê¸‰ & í‰íŒ ì •ë³´ -->
                    <div style="background: rgba(255, 255, 255, 0.05); border-radius: 10px; padding: 20px; margin-bottom: 30px;">
                        <h3 style="color: var(--primary); margin-bottom: 15px;">ğŸ“Š ê¸°ì—… í‰ê°€</h3>
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-label">ì‹ ìš©ë“±ê¸‰</div>
                                <div class="stat-value" id="creditRating">BBB</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">ê¸°ì—… í‰íŒ</div>
                                <div class="stat-value" id="companyReputation">75ì </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">ESG ì ìˆ˜</div>
                                <div class="stat-value" id="esgScore">50ì </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">ì‹œì¥ ì ìœ ìœ¨</div>
                                <div class="stat-value" id="marketSharePercent">5.0%</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- R&D í”„ë¡œì íŠ¸ í˜„í™© -->
                    <div id="rdProjectsSection" style="display: none; background: rgba(16, 185, 129, 0.1); border-radius: 10px; padding: 20px; margin-bottom: 30px;">
                        <h3 style="color: var(--success); margin-bottom: 15px;">ğŸ”¬ R&D í”„ë¡œì íŠ¸</h3>
                        <div id="rdProjectsList">
                            <!-- R&D í”„ë¡œì íŠ¸ ëª©ë¡ -->
                        </div>
                    </div>
                    
                    <!-- ê²½ìŸì‚¬ í˜„í™© -->
                    <div style="background: rgba(239, 68, 68, 0.1); border-radius: 10px; padding: 20px; margin-bottom: 30px;">
                        <h3 style="color: var(--danger); margin-bottom: 15px;">âš”ï¸ ì—…ê³„ ê²½ìŸ í˜„í™©</h3>
                        <div id="competitorsList">
                            <!-- ê²½ìŸì‚¬ ëª©ë¡ -->
                        </div>
                    </div>
                    
                    <!-- ìƒì¥ ì •ë³´ -->
                    <div id="publicCompanyInfo" style="display: none; background: rgba(99, 102, 241, 0.1); border: 1px solid rgba(99, 102, 241, 0.3); border-radius: 10px; padding: 20px; margin-bottom: 30px;">
                        <h3 style="color: var(--primary); margin-bottom: 15px;">ğŸ›ï¸ ìƒì¥ ê¸°ì—… ì •ë³´</h3>
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-label">ì£¼ì‹ ì‹œì„¸</div>
                                <div class="stat-value" id="stockPrice">0ì›</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">ì‹œê°€ì´ì•¡</div>
                                <div class="stat-value" id="marketCap">0</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">ë³´ìœ  ì§€ë¶„</div>
                                <div class="stat-value" id="ownershipPercent">100%</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">ë°œí–‰ ì£¼ì‹ ìˆ˜</div>
                                <div class="stat-value" id="totalShares">0ì£¼</div>
                            </div>
                        </div>
                    </div>
                    
                    <div id="myBusinesses">
                        <!-- ì‚¬ì—… ëª©ë¡ -->
                    </div>
                </div>
                
                <!-- Investment Section -->
                <div id="investments-section" class="content-section" style="display: none;">
                    <div class="content-header">
                        <h2 class="content-title">íˆ¬ì í¬íŠ¸í´ë¦¬ì˜¤</h2>
                        <p class="content-subtitle">ë‹¤ì–‘í•œ íˆ¬ì ìƒí’ˆ ê´€ë¦¬</p>
                    </div>
                    
                    <!-- íˆ¬ìì ì „ìš© ê¸°ëŠ¥ -->
                    <div class="stats-grid" style="margin-bottom: 30px;">
                        <div class="stat-card">
                            <div class="stat-label">ì´ íˆ¬ìì•¡</div>
                            <div class="stat-value" id="totalInvestment">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">íˆ¬ì ìˆ˜ìµë¥ </div>
                            <div class="stat-value" id="investmentReturn" style="color: var(--success);">0%</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">ë³´ìœ  ì¢…ëª©</div>
                            <div class="stat-value" id="stockCount">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">ì›” ë°°ë‹¹ê¸ˆ</div>
                            <div class="stat-value" id="dividends" style="color: var(--success);">0</div>
                        </div>
                    </div>
                    
                    <div class="action-grid" style="margin-bottom: 30px; display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                        <button class="action-btn" onclick="openStockMarket()">
                            ğŸ“Š ì£¼ì‹ ì‹œì¥
                        </button>
                        <button class="action-btn" onclick="openCryptoMarket()">
                            â‚¿ ì•”í˜¸í™”í ì‹œì¥
                        </button>
                        <button class="action-btn" onclick="openForexMarket()">
                            ğŸ’± ì™¸í™˜(í™˜ìœ¨) íˆ¬ì
                        </button>
                        <button class="action-btn" onclick="openCommodityMarket()">
                            ğŸ¥‡ ì›ìì¬ íˆ¬ì
                        </button>
                        <button class="action-btn" onclick="openFuturesMarket()">
                            ğŸ“Š ì„ ë¬¼íˆ¬ì (ë ˆë²„ë¦¬ì§€)
                        </button>
                        <button class="action-btn" onclick="openRealEstateModal()">
                            ğŸ  ë¶€ë™ì‚° íˆ¬ì
                        </button>
                        <button class="action-btn" onclick="openLandMarketplace()">
                            ğŸª í† ì§€ ë§¤ë§¤ ì‹œì¥
                        </button>
                        <button class="action-btn" onclick="sellInvestments()">
                            ğŸ’¸ íˆ¬ì ìƒí’ˆ ë§¤ê°
                        </button>
                        <button class="action-btn" onclick="showPortfolioAnalysis()">
                            ğŸ“ˆ í¬íŠ¸í´ë¦¬ì˜¤ ë¶„ì„
                        </button>
                    </div>
                    
                    <div id="investmentPortfolio">
                        <!-- íˆ¬ì í¬íŠ¸í´ë¦¬ì˜¤ -->
                    </div>
                </div>
                
                <!-- Work Section -->
                <div id="work-section" class="content-section" style="display: none;">
                    <div class="content-header">
                        <h2 class="content-title">ì§ì¥ ìƒí™œ</h2>
                        <p class="content-subtitle">ì•ˆì •ì ì¸ ìˆ˜ì…ê³¼ ê²½ë ¥ ê´€ë¦¬</p>
                    </div>
                    
                    <!-- ì§ì¥ì¸ ì „ìš© ê¸°ëŠ¥ -->
                    <div class="stats-grid" style="margin-bottom: 30px;">
                        <div class="stat-card">
                            <div class="stat-label">ì›” ê¸‰ì—¬</div>
                            <div class="stat-value" id="monthlySalary" style="color: var(--success);">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">ê²½ë ¥</div>
                            <div class="stat-value" id="workExperience">0ë…„</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">ì§ê¸‰</div>
                            <div class="stat-value" id="jobTitle">ì‚¬ì›</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">ì—°ì°¨/ë³´ë„ˆìŠ¤</div>
                            <div class="stat-value" id="bonusAvailable">0</div>
                        </div>
                    </div>
                    
                    <div class="action-grid" style="margin-bottom: 30px;">
                        <button class="action-btn" onclick="workOvertime()">
                            â° ì•¼ê·¼í•˜ê¸°
                        </button>
                        <button class="action-btn" onclick="attendTraining()">
                            ğŸ“ êµìœ¡ ë°›ê¸°
                        </button>
                        <button class="action-btn" onclick="requestPromotion()">
                            ğŸ“ˆ ìŠ¹ì§„ ì‹ ì²­
                        </button>
                        <button class="action-btn" onclick="changeJob()">
                            ğŸ”„ ì´ì§í•˜ê¸°
                        </button>
                    </div>
                    
                    <div id="workHistory">
                        <!-- ê·¼ë¬´ ì´ë ¥ -->
                    </div>
                </div>
                
                <!-- Loans Section -->
                <div id="loans-section" class="content-section" style="display: none;">
                    <div class="content-header">
                        <h2 class="content-title">ëŒ€ì¶œ ê´€ë¦¬</h2>
                        <p class="content-subtitle">ë‚´ ëŒ€ì¶œ í˜„í™©</p>
                    </div>
                    
                    <div id="myLoans">
                        <!-- ëŒ€ì¶œ ëª©ë¡ -->
                    </div>
                </div>
                
                <!-- Leaderboard Section -->
                <!-- P2P ê±°ë˜ ì„¹ì…˜ -->
                <div id="p2p-section" class="content-section" style="display: none;">
                    <div class="content-header">
                        <h2 class="content-title">ğŸ¤ P2P ë§ˆì¼“í”Œë ˆì´ìŠ¤</h2>
                        <p class="content-subtitle">í”Œë ˆì´ì–´ê°„ ìì‚°/ì‚¬ì—…ì²´ ê±°ë˜</p>
                    </div>

                    <!-- P2P ê±°ë˜ íƒ­ ë©”ë‰´ -->
                    <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                        <button class="btn" onclick="showP2PTab('browse')" id="p2pBrowseTab" style="background: var(--primary);">
                            ğŸ›’ ë§¤ë¬¼ ë‘˜ëŸ¬ë³´ê¸°
                        </button>
                        <button class="btn btn-secondary" onclick="showP2PTab('sell')" id="p2pSellTab">
                            ğŸ’° ë‚´ ìì‚° íŒë§¤
                        </button>
                        <button class="btn btn-secondary" onclick="showP2PTab('history')" id="p2pHistoryTab">
                            ğŸ“‹ ê±°ë˜ ë‚´ì—­
                        </button>
                    </div>

                    <!-- ë§¤ë¬¼ ë‘˜ëŸ¬ë³´ê¸° íƒ­ -->
                    <div id="p2pBrowseContent">
                        <div style="display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap;">
                            <button class="btn btn-sm" onclick="filterP2PListings('all')" id="filterAll" style="background: var(--primary);">ì „ì²´</button>
                            <button class="btn btn-sm btn-secondary" onclick="filterP2PListings('business')" id="filterBusiness">ì‚¬ì—…ì²´</button>
                            <button class="btn btn-sm btn-secondary" onclick="filterP2PListings('investment')" id="filterInvestment">íˆ¬ììì‚°</button>
                            <button class="btn btn-sm btn-secondary" onclick="filterP2PListings('land')" id="filterLand">ë¶€ë™ì‚°</button>
                        </div>
                        
                        <div id="p2pListings">
                            <!-- ë§¤ë¬¼ ëª©ë¡ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                        </div>
                    </div>

                    <!-- ë‚´ ìì‚° íŒë§¤ íƒ­ -->
                    <div id="p2pSellContent" style="display: none;">
                        <h3 style="color: var(--primary); margin-bottom: 15px;">íŒë§¤í•  ìì‚° ì„ íƒ</h3>
                        
                        <div style="margin-bottom: 20px;">
                            <h4 style="color: #cbd5e1; margin-bottom: 10px;">ë‚´ ì‚¬ì—…ì²´</h4>
                            <div id="myBusinessesToSell">
                                <!-- ë‚´ ì‚¬ì—…ì²´ ëª©ë¡ -->
                            </div>
                        </div>

                        <div style="margin-bottom: 20px;">
                            <h4 style="color: #cbd5e1; margin-bottom: 10px;">ë‚´ íˆ¬ììì‚°</h4>
                            <div id="myInvestmentsToSell">
                                <!-- ë‚´ íˆ¬ììì‚° ëª©ë¡ -->
                            </div>
                        </div>
                    </div>

                    <!-- ê±°ë˜ ë‚´ì—­ íƒ­ -->
                    <div id="p2pHistoryContent" style="display: none;">
                        <h3 style="color: var(--primary); margin-bottom: 15px;">ë‚˜ì˜ ê±°ë˜ ë‚´ì—­</h3>
                        <div id="p2pTransactionHistory">
                            <!-- ê±°ë˜ ë‚´ì—­ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                        </div>
                    </div>
                </div>

                <!-- ë…¸ë™ì‹œì¥ ì„¹ì…˜ -->
                <div id="labor-section" class="content-section" style="display: none;">
                    <div class="content-header">
                        <h2 class="content-title">ğŸ‘¥ ë…¸ë™ì‹œì¥</h2>
                        <p class="content-subtitle">í”Œë ˆì´ì–´ê°„ ê³ ìš©/êµ¬ì§ ì‹œìŠ¤í…œ</p>
                    </div>

                    <!-- ë…¸ë™ì‹œì¥ íƒ­ ë©”ë‰´ -->
                    <div style="display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap;">
                        <button class="btn" onclick="showLaborTab('jobs')" id="laborJobsTab" style="background: var(--primary);">
                            ğŸ” êµ¬ì¸ê³µê³ 
                        </button>
                        <button class="btn btn-secondary" onclick="showLaborTab('hire')" id="laborHireTab">
                            ğŸ“ ì§ì› ì±„ìš©
                        </button>
                        <button class="btn btn-secondary" onclick="showLaborTab('my-jobs')" id="laborMyJobsTab">
                            ğŸ’¼ ë‚´ ê³ ìš©í˜„í™©
                        </button>
                        <button class="btn btn-secondary" onclick="showLaborTab('freelance')" id="laborFreelanceTab">
                            ğŸ¯ í”„ë¦¬ëœìŠ¤
                        </button>
                    </div>

                    <!-- êµ¬ì¸ê³µê³  íƒ­ -->
                    <div id="laborJobsContent">
                        <div style="display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap;">
                            <select id="jobSkillFilter" onchange="filterJobPostings()" style="padding: 8px; border-radius: 6px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: #e2e8f0;">
                                <option value="all">ëª¨ë“  ì§ì¢…</option>
                                <option value="programming">ê°œë°œ</option>
                                <option value="design">ë””ìì¸</option>
                                <option value="marketing">ë§ˆì¼€íŒ…</option>
                                <option value="sales">ì˜ì—…</option>
                                <option value="management">ê´€ë¦¬</option>
                            </select>
                            <select id="jobLevelFilter" onchange="filterJobPostings()" style="padding: 8px; border-radius: 6px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: #e2e8f0;">
                                <option value="all">ëª¨ë“  ë ˆë²¨</option>
                                <option value="junior">ì‹ ì…</option>
                                <option value="mid">ì¤‘ê¸‰</option>
                                <option value="senior">ê³ ê¸‰</option>
                                <option value="lead">íŒ€ì¥ê¸‰</option>
                                <option value="executive">ì„ì›ê¸‰</option>
                            </select>
                        </div>
                        
                        <div id="jobPostingsList">
                            <!-- êµ¬ì¸ê³µê³  ëª©ë¡ -->
                        </div>
                    </div>

                    <!-- ì§ì› ì±„ìš© íƒ­ -->
                    <div id="laborHireContent" style="display: none;">
                        <h3 style="color: var(--primary); margin-bottom: 15px;">êµ¬ì¸ê³µê³  ì‘ì„±</h3>
                        
                        <div style="background: rgba(34, 34, 34, 0.6); border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                            <div style="margin-bottom: 15px;">
                                <label style="display: block; color: #cbd5e1; margin-bottom: 8px;">í¬ì§€ì…˜ëª…</label>
                                <input type="text" id="jobTitle" placeholder="ì˜ˆ: ì‹œë‹ˆì–´ ê°œë°œì, ë§ˆì¼€íŒ… ë§¤ë‹ˆì €" 
                                       style="width: 100%; padding: 10px; border-radius: 6px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: #e2e8f0;">
                            </div>
                            
                            <div style="margin-bottom: 15px;">
                                <label style="display: block; color: #cbd5e1; margin-bottom: 8px;">ìš”êµ¬ ìŠ¤í‚¬</label>
                                <select id="jobSkill" style="width: 100%; padding: 10px; border-radius: 6px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: #e2e8f0;">
                                    <option value="programming">ê°œë°œ</option>
                                    <option value="design">ë””ìì¸</option>
                                    <option value="marketing">ë§ˆì¼€íŒ…</option>
                                    <option value="sales">ì˜ì—…</option>
                                    <option value="management">ê´€ë¦¬</option>
                                    <option value="accounting">íšŒê³„</option>
                                    <option value="legal">ë²•ë¬´</option>
                                    <option value="engineering">ì—”ì§€ë‹ˆì–´ë§</option>
                                    <option value="research">ì—°êµ¬</option>
                                    <option value="consulting">ì»¨ì„¤íŒ…</option>
                                </select>
                            </div>
                            
                            <div style="margin-bottom: 15px;">
                                <label style="display: block; color: #cbd5e1; margin-bottom: 8px;">ê²½í—˜ ë ˆë²¨</label>
                                <select id="jobLevel" onchange="updateSalaryRange()" style="width: 100%; padding: 10px; border-radius: 6px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: #e2e8f0;">
                                    <option value="junior">ì‹ ì… (2,500~4,000 ë¹„íŠ¸í¬ë ˆë”§)</option>
                                    <option value="mid">ì¤‘ê¸‰ (4,000~7,000 ë¹„íŠ¸í¬ë ˆë”§)</option>
                                    <option value="senior">ê³ ê¸‰ (7,000~12,000 ë¹„íŠ¸í¬ë ˆë”§)</option>
                                    <option value="lead">íŒ€ì¥ê¸‰ (12,000~20,000 ë¹„íŠ¸í¬ë ˆë”§)</option>
                                    <option value="executive">ì„ì›ê¸‰ (20,000~50,000 ë¹„íŠ¸í¬ë ˆë”§)</option>
                                </select>
                            </div>
                            
                            <div style="margin-bottom: 15px;">
                                <label style="display: block; color: #cbd5e1; margin-bottom: 8px;">ì›”ê¸‰ì—¬ (ë¹„íŠ¸í¬ë ˆë”§)</label>
                                <input type="number" id="jobSalary" placeholder="3500" min="1000" 
                                       style="width: 100%; padding: 10px; border-radius: 6px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: #e2e8f0;">
                                <div style="color: #94a3b8; font-size: 0.9rem; margin-top: 5px;" id="salaryGuideline">
                                    ì‹ ì… ê¶Œì¥ ë²”ìœ„: 2,500~4,000 ë¹„íŠ¸í¬ë ˆë”§
                                </div>
                            </div>
                            
                            <div style="margin-bottom: 20px;">
                                <label style="display: block; color: #cbd5e1; margin-bottom: 8px;">ì—…ë¬´ ì„¤ëª…</label>
                                <textarea id="jobDescription" placeholder="ì—…ë¬´ ë‚´ìš©, ê·¼ë¬´ ì¡°ê±´ ë“±ì„ ì„¤ëª…í•´ì£¼ì„¸ìš”..." 
                                          style="width: 100%; height: 80px; padding: 10px; border-radius: 6px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: #e2e8f0; resize: vertical;"></textarea>
                            </div>
                            
                            <button class="btn" onclick="postJob()" style="width: 100%;">
                                êµ¬ì¸ê³µê³  ë“±ë¡í•˜ê¸°
                            </button>
                        </div>

                        <div id="myBusinessesForHiring">
                            <h4 style="color: #cbd5e1; margin-bottom: 10px;">ë‚´ ì‚¬ì—…ì²´ë³„ ì§ì› í˜„í™©</h4>
                            <!-- ì‚¬ì—…ì²´ë³„ ì§ì› í˜„í™© -->
                        </div>
                    </div>

                    <!-- ë‚´ ê³ ìš©í˜„í™© íƒ­ -->
                    <div id="laborMyJobsContent" style="display: none;">
                        <div style="display: flex; gap: 20px; margin-bottom: 20px;">
                            <div style="flex: 1;">
                                <h3 style="color: var(--success); margin-bottom: 15px;">ğŸ’¼ ë‚´ê°€ ê³ ìš©í•œ ì§ì›ë“¤</h3>
                                <div id="myEmployeesList">
                                    <!-- ë‚´ ì§ì› ëª©ë¡ -->
                                </div>
                            </div>
                            <div style="flex: 1;">
                                <h3 style="color: var(--primary); margin-bottom: 15px;">ğŸ¢ ë‚´ ì§ì¥ ì •ë³´</h3>
                                <div id="myEmploymentStatus">
                                    <!-- ë‚´ ê³ ìš© ìƒíƒœ -->
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- í”„ë¦¬ëœìŠ¤ íƒ­ -->
                    <div id="laborFreelanceContent" style="display: none;">
                        <h3 style="color: var(--warning); margin-bottom: 15px;">ğŸ¯ í”„ë¦¬ëœìŠ¤ í”„ë¡œì íŠ¸</h3>
                        <div id="freelanceJobsList">
                            <!-- í”„ë¦¬ëœìŠ¤ ëª©ë¡ -->
                        </div>
                    </div>
                </div>

                <div id="leaderboard-section" class="content-section" style="display: none;">
                    <div class="content-header">
                        <h2 class="content-title">ë¦¬ë”ë³´ë“œ</h2>
                        <p class="content-subtitle">Top 10 í”Œë ˆì´ì–´</p>
                    </div>
                    
                    <div class="leaderboard-list" id="leaderboardList">
                        <!-- ë¦¬ë”ë³´ë“œ -->
                    </div>
                </div>
            </div>
            
            <!-- Right Sidebar - Market -->
            <div class="market-sidebar">
                <h3 class="market-title">ğŸ“ˆ ì‹¤ì‹œê°„ ì‹œì¥</h3>
                
                <!-- ì£¼ì‹ ì‹œì¥ -->
                <div style="margin-bottom: 20px;">
                    <h4 style="color: #cbd5e1; margin-bottom: 10px; font-size: 0.9rem;">ğŸ“Š ì£¼ì‹ ì‹œì¥</h4>
                    <div id="stockMarket">
                        <!-- ì£¼ì‹ ëª©ë¡ -->
                    </div>
                </div>
                
                <!-- ì•”í˜¸í™”í ì‹œì¥ -->
                <div style="margin-bottom: 20px;">
                    <h4 style="color: #cbd5e1; margin-bottom: 10px; font-size: 0.9rem;">â‚¿ ì•”í˜¸í™”í</h4>
                    <div id="cryptoMarket">
                        <!-- ì•”í˜¸í™”í ëª©ë¡ -->
                    </div>
                </div>
                
                <!-- ê²½ì œ ì§€í‘œ -->
                <div>
                    <h4 style="color: #cbd5e1; margin-bottom: 10px; font-size: 0.9rem;">ğŸ“Š ê²½ì œ ì§€í‘œ</h4>
                    <div class="market-item">
                        <div class="market-item-header">
                            <span class="market-item-name">ì½”ìŠ¤í”¼</span>
                            <span class="market-item-price" id="kospiIndex">2,400</span>
                        </div>
                        <div class="market-item-change" id="kospiChange">+0.5%</div>
                    </div>
                    <div class="market-item">
                        <div class="market-item-header">
                            <span class="market-item-name">USD/KRW</span>
                            <span class="market-item-price" id="usdkrw">1,320</span>
                        </div>
                        <div class="market-item-change" id="usdkrwChange">-0.2%</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Notification -->
    <div class="notification" id="notification">
        <div id="notificationText"></div>
    </div>
    
    <!-- IPO Modal -->
    <div id="ipoModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 2000; justify-content: center; align-items: center;">
        <div style="background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%); border: 1px solid rgba(255,255,255,0.1); border-radius: 20px; padding: 40px; max-width: 500px; width: 90%;">
            <h2 style="text-align: center; margin-bottom: 30px; color: var(--primary);">ğŸ›ï¸ ê¸°ì—…ê³µê°œ (IPO)</h2>
            
            <div style="margin-bottom: 20px;">
                <div style="background: rgba(255,255,255,0.05); padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <span>ê¸°ì—…ê°€ì¹˜:</span>
                        <span id="ipoCompanyValue">0</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <span>ìƒì¥ ë¹„ìš©:</span>
                        <span>50,000 ë¹„íŠ¸í¬ë ˆë”§</span>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <span>IPO í”„ë¦¬ë¯¸ì—„:</span>
                        <span style="color: var(--success);">+40%</span>
                    </div>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 10px; color: #cbd5e1;">ê³µê°œ ì§€ë¶„ìœ¨ ì„ íƒ (1.0% - 49.0%)</label>
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <input type="range" id="equitySlider" min="1" max="49" step="0.5" value="30" 
                               style="flex: 1;" oninput="updateIPOCalculation()">
                        <input type="number" id="equityInput" min="1" max="49" step="0.5" value="30" 
                               style="width: 80px; padding: 5px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 5px; color: white;" 
                               oninput="updateIPOCalculation()">
                        <span style="color: #94a3b8;">%</span>
                    </div>
                </div>
                
                <div style="background: rgba(99,102,241,0.1); padding: 15px; border-radius: 10px; margin-bottom: 20px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                        <span>ì¡°ë‹¬ ì˜ˆìƒì•¡:</span>
                        <span id="expectedRaise" style="color: var(--success); font-weight: 700;">0</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                        <span>ì˜ˆìƒ ì£¼ê°€:</span>
                        <span id="expectedStockPrice">0ì›</span>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <span>ë³´ìœ  ì§€ë¶„:</span>
                        <span id="remainingOwnership">70.0%</span>
                    </div>
                </div>
            </div>
            
            <div style="display: flex; gap: 15px;">
                <button class="btn btn-secondary" style="flex: 1;" onclick="closeIPOModal()">ì·¨ì†Œ</button>
                <button class="btn" style="flex: 1;" onclick="executeIPO()">ìƒì¥í•˜ê¸°</button>
            </div>
        </div>
    </div>
    
    <!-- Rights Offering Modal -->
    <div id="rightsModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 2000; justify-content: center; align-items: center;">
        <div style="background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%); border: 1px solid rgba(255,255,255,0.1); border-radius: 20px; padding: 40px; max-width: 500px; width: 90%;">
            <h2 style="text-align: center; margin-bottom: 30px; color: var(--success);">ğŸ’ ìœ ìƒì¦ì</h2>
            
            <div style="margin-bottom: 20px;">
                <div style="background: rgba(255,255,255,0.05); padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <span>í˜„ì¬ ì£¼ê°€:</span>
                        <span id="currentStockPrice">0ì›</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <span>í˜„ì¬ ì§€ë¶„ìœ¨:</span>
                        <span id="currentOwnership">0%</span>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <span>ì‹œê°€ì´ì•¡:</span>
                        <span id="currentMarketCap">0</span>
                    </div>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 10px; color: #cbd5e1;">ì¶”ê°€ ì§€ë¶„ í¬ì„ë¥  (1.0% - 30.0%)</label>
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <input type="range" id="rightsEquitySlider" min="1" max="30" step="0.5" value="10" 
                               style="flex: 1;" oninput="updateRightsCalculation()">
                        <input type="number" id="rightsEquityInput" min="1" max="30" step="0.5" value="10" 
                               style="width: 80px; padding: 5px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 5px; color: white;" 
                               oninput="updateRightsCalculation()">
                        <span style="color: #94a3b8;">%</span>
                    </div>
                </div>
                
                <div style="background: rgba(16,185,129,0.1); padding: 15px; border-radius: 10px; margin-bottom: 20px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                        <span>ì˜ˆìƒ ì¡°ë‹¬ì•¡:</span>
                        <span id="rightsExpectedRaise" style="color: var(--success); font-weight: 700;">0</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                        <span>ì¦ì í›„ ì§€ë¶„:</span>
                        <span id="rightsNewOwnership">0%</span>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <span>ì‹ ì£¼ ë°œí–‰ê°€:</span>
                        <span id="rightsPrice">0ì›</span>
                    </div>
                </div>
            </div>
            
            <div style="display: flex; gap: 15px;">
                <button class="btn btn-secondary" style="flex: 1;" onclick="closeRightsModal()">ì·¨ì†Œ</button>
                <button class="btn" style="flex: 1;" onclick="executeRightsOffering()">ì¦ìí•˜ê¸°</button>
            </div>
        </div>
    </div>
    
    <!-- M&A Modal -->
    <div id="maModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 2000; justify-content: center; align-items: center;">
        <div style="background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%); border: 1px solid rgba(255,255,255,0.1); border-radius: 20px; padding: 40px; max-width: 600px; width: 90%; max-height: 80vh; overflow-y: auto;">
            <h2 style="text-align: center; margin-bottom: 30px; color: var(--warning);">ğŸ¤ M&A ì„¼í„°</h2>
            
            <div style="margin-bottom: 30px;">
                <h3 style="margin-bottom: 15px; color: #cbd5e1;">ğŸ’° ì¸ìˆ˜ ê°€ëŠ¥í•œ ê¸°ì—…ë“¤</h3>
                <div id="acquisitionTargets">
                    <!-- ì¸ìˆ˜ ëŒ€ìƒ ëª©ë¡ -->
                </div>
            </div>
            
            <div style="display: flex; gap: 15px;">
                <button class="btn btn-secondary" style="flex: 1;" onclick="closeMAModal()">ë‹«ê¸°</button>
            </div>
        </div>
    </div>
    
    <!-- R&D Modal -->
    <div id="rdModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 2000; justify-content: center; align-items: center;">
        <div style="background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%); border: 1px solid rgba(255,255,255,0.1); border-radius: 20px; padding: 40px; max-width: 600px; width: 90%; max-height: 80vh; overflow-y: auto;">
            <h2 style="text-align: center; margin-bottom: 30px; color: var(--success);">ğŸ”¬ ì—°êµ¬ê°œë°œì„¼í„°</h2>
            
            <div style="margin-bottom: 30px;">
                <h3 style="margin-bottom: 15px; color: #cbd5e1;">ğŸš€ ì‹ ê·œ R&D í”„ë¡œì íŠ¸</h3>
                <div id="availableRDProjects">
                    <!-- ê°€ëŠ¥í•œ R&D í”„ë¡œì íŠ¸ë“¤ -->
                </div>
            </div>
            
            <div style="margin-bottom: 30px;">
                <h3 style="margin-bottom: 15px; color: #cbd5e1;">ğŸ“‹ ì§„í–‰ì¤‘ì¸ í”„ë¡œì íŠ¸</h3>
                <div id="activeRDProjects">
                    <!-- ì§„í–‰ì¤‘ì¸ R&D í”„ë¡œì íŠ¸ë“¤ -->
                </div>
            </div>
            
            <div style="display: flex; gap: 15px;">
                <button class="btn btn-secondary" style="flex: 1;" onclick="closeRDModal()">ë‹«ê¸°</button>
            </div>
        </div>
    </div>
    
    <!-- Real Estate Investment Modal -->
    <div id="realEstateModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 2000; justify-content: center; align-items: center;">
        <div style="background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%); border: 1px solid rgba(255,255,255,0.1); border-radius: 20px; padding: 40px; max-width: 700px; width: 90%; max-height: 80vh; overflow-y: auto;">
            <h2 style="text-align: center; margin-bottom: 30px; color: var(--primary);">ğŸ  ë¶€ë™ì‚° íˆ¬ì ì„ íƒ</h2>
            
            <div class="action-grid" style="grid-template-columns: repeat(2, 1fr); gap: 20px; margin-bottom: 30px;">
                <div class="business-card" style="cursor: pointer;" onclick="buySpecificRealEstate('apartment')">
                    <div class="business-header">
                        <div class="business-name">ğŸ¢ ì•„íŒŒíŠ¸</div>
                        <div style="color: var(--success);">ì•ˆì •í˜•</div>
                    </div>
                    <div style="font-size: 0.9rem; color: #94a3b8; margin: 10px 0;">
                        <div>â€¢ íˆ¬ìê¸ˆì•¡: 300ë§Œ ~ 500ë§Œ ë¹„íŠ¸í¬ë ˆë”§</div>
                        <div>â€¢ ìˆ˜ìµë¥ : 5~12% (ì•ˆì •ì )</div>
                        <div>â€¢ ì›”ì„¸ìˆ˜ìµ: 0.3%/ì›” (í˜„ì‹¤ì )</div>
                        <div>â€¢ ë¦¬ìŠ¤í¬: ë‚®ìŒ</div>
                    </div>
                </div>
                
                <div class="business-card" style="cursor: pointer;" onclick="buySpecificRealEstate('officetel')">
                    <div class="business-header">
                        <div class="business-name">ğŸ¬ ì˜¤í”¼ìŠ¤í…”</div>
                        <div style="color: var(--warning);">ê· í˜•í˜•</div>
                    </div>
                    <div style="font-size: 0.9rem; color: #94a3b8; margin: 10px 0;">
                        <div>â€¢ íˆ¬ìê¸ˆì•¡: 150ë§Œ ~ 300ë§Œ ë¹„íŠ¸í¬ë ˆë”§</div>
                        <div>â€¢ ìˆ˜ìµë¥ : 3~18% (ì¤‘ìœ„í—˜)</div>
                        <div>â€¢ ì›”ì„¸ìˆ˜ìµ: 0.25%/ì›” (í˜„ì‹¤ì )</div>
                        <div>â€¢ ë¦¬ìŠ¤í¬: ë³´í†µ</div>
                    </div>
                </div>
                
                <div class="business-card" style="cursor: pointer;" onclick="buySpecificRealEstate('commercial')">
                    <div class="business-header">
                        <div class="business-name">ğŸª ìƒê°€</div>
                        <div style="color: var(--danger);">ê³µê²©í˜•</div>
                    </div>
                    <div style="font-size: 0.9rem; color: #94a3b8; margin: 10px 0;">
                        <div>â€¢ íˆ¬ìê¸ˆì•¡: 250ë§Œ ~ 750ë§Œ ë¹„íŠ¸í¬ë ˆë”§</div>
                        <div>â€¢ ìˆ˜ìµë¥ : -5~25% (ê³ ìœ„í—˜)</div>
                        <div>â€¢ ì›”ì„¸ìˆ˜ìµ: 0.4%/ì›” (ì„±ê³µì‹œ)</div>
                        <div>â€¢ ë¦¬ìŠ¤í¬: ë†’ìŒ</div>
                    </div>
                </div>
                
                <div class="business-card" style="cursor: pointer;" onclick="openLandModal()">
                    <div class="business-header">
                        <div class="business-name">ğŸï¸ í† ì§€</div>
                        <div style="color: var(--primary);">ê°œë°œí˜•</div>
                    </div>
                    <div style="font-size: 0.9rem; color: #94a3b8; margin: 10px 0;">
                        <div>â€¢ ì§€ì—­ë³„ ê°€ê²© ì°¨ë³„í™”</div>
                        <div>â€¢ í•œì •ëœ í† ì§€ ê³µê¸‰</div>
                        <div>â€¢ <strong style="color: var(--danger);">ìµœì†Œ 1000í‰ ì´ìƒ êµ¬ë§¤</strong></div>
                        <div>â€¢ <strong style="color: var(--warning);">ì§„ì…ë¹„ìš©: ìµœì†Œ 350ë§Œ ë¹„íŠ¸í¬ë ˆë”§</strong></div>
                        <div>â€¢ <span id="totalLandStatus">ì´ 100ë§Œí‰ ì¤‘ 100ë§Œí‰ ë‚¨ìŒ</span></div>
                    </div>
                </div>
            </div>
            
            <div style="display: flex; gap: 15px;">
                <button class="btn btn-secondary" style="flex: 1;" onclick="closeRealEstateModal()">ì·¨ì†Œ</button>
            </div>
        </div>
    </div>
    
    <!-- Land Investment Modal -->
    <div id="landModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 2001; justify-content: center; align-items: center;">
        <div style="background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%); border: 1px solid rgba(255,255,255,0.1); border-radius: 20px; padding: 40px; max-width: 800px; width: 90%; max-height: 80vh; overflow-y: auto;">
            <h2 style="text-align: center; margin-bottom: 20px; color: var(--primary);">ğŸï¸ í† ì§€ íˆ¬ì ì„ íƒ</h2>
            
            <div style="text-align: center; margin-bottom: 30px; padding: 15px; background: rgba(59, 130, 246, 0.1); border-radius: 10px;">
                <div style="font-size: 1.1rem; font-weight: bold; color: var(--primary);" id="landMarketStatus">
                    ì „êµ­ í† ì§€ í˜„í™©: ì´ 100ë§Œí‰ ì¤‘ 100ë§Œí‰ ë‚¨ìŒ
                </div>
                <div style="font-size: 0.9rem; color: #94a3b8; margin-top: 5px;">
                    í† ì§€ëŠ” í•œì •ì ì´ë©° ë‹¤ë¥¸ íˆ¬ììë“¤ê³¼ ê²½ìŸí•´ì•¼ í•©ë‹ˆë‹¤
                </div>
            </div>
            
            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 30px;" id="landRegionsList">
                <!-- ì§€ì—­ë³„ í† ì§€ ëª©ë¡ -->
            </div>
            
            <div style="margin-bottom: 30px; padding: 15px; background: rgba(255, 255, 255, 0.05); border-radius: 10px;">
                <h4 style="color: var(--warning); margin-bottom: 10px;">ğŸ“‹ í† ì§€ íˆ¬ì ê°€ì´ë“œ</h4>
                <div style="font-size: 0.9rem; color: #94a3b8; line-height: 1.5;">
                    â€¢ <strong>í‰ìˆ˜ ì„ íƒ:</strong> 1000í‰~50000í‰ê¹Œì§€ íˆ¬ì ê°€ëŠ¥ (ìµœì†Œ 1000í‰)<br>
                    â€¢ <strong>ì§„ì…ë¹„ìš©:</strong> ìµœì € 350ë§Œ ë¹„íŠ¸í¬ë ˆë”§ (ì§€ë°© 1000í‰) ~ ìµœëŒ€ 1650ë§Œ ë¹„íŠ¸í¬ë ˆë”§ (ê°•ë‚¨ 1000í‰)<br>
                    â€¢ <strong>ê°€ê²© ê²°ì •:</strong> (ê¸°ë³¸ê°€ê²© 5000ë¹„íŠ¸í¬ë ˆë”§/í‰ Ã— ì§€ì—­ë°°ìˆ˜ Ã— í‰ìˆ˜) + í¬ì†Œì„± í”„ë¦¬ë¯¸ì—„<br>
                    â€¢ <strong>ê°œë°œ ì¡°ê±´:</strong> ìˆ˜ìµë¥  10% ì´ìƒ ì‹œ ì›” 1% ê°œë°œìˆ˜ìµ ë°œìƒ<br>
                    â€¢ <strong>í¬ì†Œì„±:</strong> í† ì§€ê°€ ë¶€ì¡±í• ìˆ˜ë¡ ê¸°í•˜ê¸‰ìˆ˜ì  ê°€ê²© ìƒìŠ¹ ğŸš€
                </div>
            </div>
            
            <div style="display: flex; gap: 15px;">
                <button class="btn btn-secondary" style="flex: 1;" onclick="closeLandModal()">ì·¨ì†Œ</button>
            </div>
        </div>
    </div>
    
    <!-- Land Purchase Detail Modal -->
    <div id="landDetailModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 2002; justify-content: center; align-items: center;">
        <div style="background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%); border: 1px solid rgba(255,255,255,0.1); border-radius: 20px; padding: 40px; max-width: 500px; width: 90%;">
            <h3 style="text-align: center; margin-bottom: 20px; color: var(--primary);" id="landDetailTitle">í† ì§€ êµ¬ë§¤</h3>
            
            <div style="margin-bottom: 20px; padding: 15px; background: rgba(255, 255, 255, 0.05); border-radius: 10px;">
                <div id="landDetailInfo">
                    <!-- ì„ íƒëœ í† ì§€ ì •ë³´ -->
                </div>
            </div>
            
            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 10px; color: #cbd5e1;">êµ¬ë§¤í•  í‰ìˆ˜ ì„ íƒ:</label>
                <input type="range" id="landSizeSlider" min="1000" max="50000" value="1000" 
                       style="width: 100%; margin-bottom: 10px;"
                       oninput="updateLandCalculation()">
                <div style="display: flex; justify-content: space-between; color: #94a3b8; font-size: 0.9rem;">
                    <span>1000í‰ (ìµœì†Œ)</span>
                    <span id="selectedLandSize">1000í‰</span>
                    <span>50000í‰ (5ë§Œí‰)</span>
                </div>
            </div>
            
            <div style="margin-bottom: 20px; padding: 15px; background: rgba(59, 130, 246, 0.1); border-radius: 10px;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                    <span>ê¸°ë³¸ ê°€ê²©:</span>
                    <span id="landBasePrice">200,000 ë¹„íŠ¸í¬ë ˆë”§</span>
                </div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                    <span>ì§€ì—­ í”„ë¦¬ë¯¸ì—„:</span>
                    <span id="landRegionPrice">+100,000 ë¹„íŠ¸í¬ë ˆë”§</span>
                </div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                    <span>í¬ì†Œì„± í”„ë¦¬ë¯¸ì—„:</span>
                    <span id="landScarcityPrice">+50,000 ë¹„íŠ¸í¬ë ˆë”§</span>
                </div>
                <hr style="border: 1px solid rgba(255,255,255,0.1); margin: 10px 0;">
                <div style="display: flex; justify-content: space-between; font-weight: bold; color: var(--warning);">
                    <span>ì´ êµ¬ë§¤ê°€ê²©:</span>
                    <span id="landTotalPrice">350,000 ë¹„íŠ¸í¬ë ˆë”§</span>
                </div>
            </div>
            
            <div style="display: flex; gap: 15px;">
                <button class="btn btn-secondary" style="flex: 1;" onclick="closeLandDetailModal()">ì·¨ì†Œ</button>
                <button class="btn" style="flex: 1;" onclick="confirmLandPurchase()" id="landPurchaseBtn">êµ¬ë§¤í•˜ê¸°</button>
            </div>
        </div>
    </div>
    
    <!-- Land Marketplace Modal -->
    <div id="landMarketplaceModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 2001; justify-content: center; align-items: center;">
        <div style="background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%); border: 1px solid rgba(255,255,255,0.1); border-radius: 20px; padding: 40px; max-width: 900px; width: 90%; max-height: 85vh; overflow-y: auto;">
            <h2 style="text-align: center; margin-bottom: 20px; color: var(--primary);">ğŸª í† ì§€ ë§¤ë§¤ ì‹œì¥</h2>
            
            <div style="display: flex; gap: 20px; margin-bottom: 30px;">
                <button class="btn" onclick="showMarketplaceBuy()" id="marketplaceBuyBtn" style="flex: 1;">ë§¤ìˆ˜ (êµ¬ë§¤í•˜ê¸°)</button>
                <button class="btn btn-secondary" onclick="showMarketplaceSell()" id="marketplaceSellBtn" style="flex: 1;">ë§¤ë„ (íŒë§¤í•˜ê¸°)</button>
            </div>
            
            <!-- ë§¤ìˆ˜ ì„¹ì…˜ -->
            <div id="marketplaceBuySection">
                <h3 style="color: var(--success); margin-bottom: 15px;">ğŸ’° ë§¤ìˆ˜ ê°€ëŠ¥í•œ í† ì§€</h3>
                <div id="landForSaleList">
                    <!-- íŒë§¤ì¤‘ì¸ í† ì§€ ëª©ë¡ -->
                </div>
            </div>
            
            <!-- ë§¤ë„ ì„¹ì…˜ -->
            <div id="marketplaceSellSection" style="display: none;">
                <h3 style="color: var(--warning); margin-bottom: 15px;">ğŸ“‹ ë‚´ ë³´ìœ  í† ì§€</h3>
                <div id="myLandList">
                    <!-- ë‚´ê°€ ë³´ìœ í•œ í† ì§€ ëª©ë¡ -->
                </div>
            </div>
            
            <div style="display: flex; gap: 15px; margin-top: 30px;">
                <button class="btn btn-secondary" style="flex: 1;" onclick="closeLandMarketplace()">ë‹«ê¸°</button>
            </div>
        </div>
    </div>
    
    <!-- Land Sale Modal -->
    <div id="landSaleModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 2002; justify-content: center; align-items: center;">
        <div style="background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%); border: 1px solid rgba(255,255,255,0.1); border-radius: 20px; padding: 40px; max-width: 500px; width: 90%;">
            <h3 style="text-align: center; margin-bottom: 20px; color: var(--warning);">ğŸ’¸ í† ì§€ ë§¤ë„</h3>
            
            <div style="margin-bottom: 20px; padding: 15px; background: rgba(255, 255, 255, 0.05); border-radius: 10px;">
                <div id="saleItemInfo">
                    <!-- ë§¤ë„í•  í† ì§€ ì •ë³´ -->
                </div>
            </div>
            
            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 10px; color: #cbd5e1;">ë§¤ë„ ê°€ê²© ì„¤ì •:</label>
                <input type="range" id="salePriceSlider" min="10" max="1000" value="100" 
                       style="width: 100%; margin-bottom: 10px;"
                       oninput="updateSalePrice()">
                <div style="display: flex; justify-content: space-between; color: #94a3b8; font-size: 0.9rem;">
                    <span>10% (í­íƒ„ì„¸ì¼)</span>
                    <span id="salePricePercent">100% (í˜„ì¬ê°€)</span>
                    <span>1000% (íˆ¬ê¸°)</span>
                </div>
            </div>
            
            <div style="margin-bottom: 20px; padding: 15px; background: rgba(59, 130, 246, 0.1); border-radius: 10px;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                    <span>êµ¬ë§¤ ë‹¹ì‹œ ê°€ê²©:</span>
                    <span id="originalPurchasePrice">0 ë¹„íŠ¸í¬ë ˆë”§</span>
                </div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                    <span>í˜„ì¬ ì‹œì„¸:</span>
                    <span id="currentMarketPrice">0 ë¹„íŠ¸í¬ë ˆë”§</span>
                </div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                    <span>ë§¤ë„ ê°€ê²©:</span>
                    <span id="finalSalePrice" style="font-weight: bold; color: var(--warning);">0 ë¹„íŠ¸í¬ë ˆë”§</span>
                </div>
                <hr style="border: 1px solid rgba(255,255,255,0.1); margin: 10px 0;">
                <div style="display: flex; justify-content: space-between; font-weight: bold;">
                    <span>ì˜ˆìƒ ì†ìµ:</span>
                    <span id="expectedProfit" style="color: var(--success);">+0 ë¹„íŠ¸í¬ë ˆë”§</span>
                </div>
            </div>
            
            <div style="display: flex; gap: 15px;">
                <button class="btn btn-secondary" style="flex: 1;" onclick="closeLandSaleModal()">ì·¨ì†Œ</button>
                <button class="btn" style="flex: 1;" onclick="confirmLandSale()" id="confirmSaleBtn">ë§¤ë„í•˜ê¸°</button>
            </div>
        </div>
    </div>
    
    <!-- Stock Market Modal -->
    <div id="stockMarketModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 2001; justify-content: center; align-items: center;">
        <div style="background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%); border: 1px solid rgba(255,255,255,0.1); border-radius: 20px; padding: 40px; max-width: 800px; width: 90%; max-height: 85vh; overflow-y: auto;">
            <h2 style="text-align: center; margin-bottom: 20px; color: var(--primary);">ğŸ“Š ì£¼ì‹ ì‹œì¥</h2>
            
            <div style="margin-bottom: 30px; padding: 15px; background: rgba(59, 130, 246, 0.1); border-radius: 10px; text-align: center;">
                <div style="font-size: 1.1rem; font-weight: bold; color: var(--primary);">
                    KOSPI: <span id="stockModalKospi">2,400</span> 
                    (<span id="stockModalKospiChange" style="color: var(--success);">+0.00%</span>)
                </div>
                <div style="font-size: 0.9rem; color: #94a3b8; margin-top: 5px;">
                    ì‹¤ì‹œê°„ ì£¼ì‹ ì‹œì¥ í˜„í™©
                </div>
            </div>
            
            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 30px;" id="stocksList">
                <!-- ì£¼ì‹ ëª©ë¡ -->
            </div>
            
            <div style="display: flex; gap: 15px;">
                <button class="btn btn-secondary" style="flex: 1;" onclick="closeStockMarket()">ë‹«ê¸°</button>
            </div>
        </div>
    </div>
    
    <!-- Crypto Market Modal -->
    <div id="cryptoMarketModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 2001; justify-content: center; align-items: center;">
        <div style="background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%); border: 1px solid rgba(255,255,255,0.1); border-radius: 20px; padding: 40px; max-width: 800px; width: 90%; max-height: 85vh; overflow-y: auto;">
            <h2 style="text-align: center; margin-bottom: 20px; color: var(--warning);">â‚¿ ì•”í˜¸í™”í ì‹œì¥</h2>
            
            <div style="margin-bottom: 30px; padding: 15px; background: rgba(245, 158, 11, 0.1); border-radius: 10px; text-align: center;">
                <div style="font-size: 1.1rem; font-weight: bold; color: var(--warning);">
                    ì•”í˜¸í™”í ì‹œì¥ ì´ì•¡: <span id="cryptoMarketCap">â‚©2,847ì¡°</span>
                </div>
                <div style="font-size: 0.9rem; color: #94a3b8; margin-top: 5px;">
                    24ì‹œê°„ ë³€ë™ë¥  ê¸°ì¤€
                </div>
            </div>
            
            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 30px;" id="cryptosList">
                <!-- ì•”í˜¸í™”í ëª©ë¡ -->
            </div>
            
            <div style="display: flex; gap: 15px;">
                <button class="btn btn-secondary" style="flex: 1;" onclick="closeCryptoMarket()">ë‹«ê¸°</button>
            </div>
        </div>
    </div>
    
    <!-- Investment Detail Modal -->
    <div id="investmentDetailModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 2002; justify-content: center; align-items: center;">
        <div style="background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%); border: 1px solid rgba(255,255,255,0.1); border-radius: 20px; padding: 40px; max-width: 500px; width: 90%;">
            <h3 style="text-align: center; margin-bottom: 20px;" id="investmentDetailTitle">íˆ¬ì ìƒí’ˆ êµ¬ë§¤</h3>
            
            <div style="margin-bottom: 20px; padding: 15px; background: rgba(255, 255, 255, 0.05); border-radius: 10px;">
                <div id="investmentDetailInfo">
                    <!-- ì„ íƒëœ íˆ¬ì ìƒí’ˆ ì •ë³´ -->
                </div>
            </div>
            
            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 10px; color: #cbd5e1;">íˆ¬ì ê¸ˆì•¡ ì„¤ì •:</label>
                <input type="range" id="investmentAmountSlider" min="500000" max="10000000" value="1000000" 
                       style="width: 100%; margin-bottom: 10px;"
                       oninput="updateInvestmentAmount()">
                <div style="display: flex; justify-content: space-between; color: #94a3b8; font-size: 0.9rem;">
                    <span>50ë§Œ ë¹„íŠ¸í¬ë ˆë”§</span>
                    <span id="selectedInvestmentAmount">100ë§Œ ë¹„íŠ¸í¬ë ˆë”§</span>
                    <span>1000ë§Œ ë¹„íŠ¸í¬ë ˆë”§</span>
                </div>
            </div>
            
            <div style="margin-bottom: 20px; padding: 15px; background: rgba(59, 130, 246, 0.1); border-radius: 10px;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                    <span>íˆ¬ì ê¸ˆì•¡:</span>
                    <span id="finalInvestmentAmount" style="font-weight: bold; color: var(--primary);">1,000,000 ë¹„íŠ¸í¬ë ˆë”§</span>
                </div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                    <span>ì˜ˆìƒ ì›” ìˆ˜ìµ:</span>
                    <span id="expectedMonthlyReturn">2,000 ë¹„íŠ¸í¬ë ˆë”§</span>
                </div>
                <div style="display: flex; justify-content: space-between;">
                    <span>ì˜ˆìƒ ì—° ìˆ˜ìµë¥ :</span>
                    <span id="expectedAnnualReturn">+12%</span>
                </div>
            </div>
            
            <div style="display: flex; gap: 15px;">
                <button class="btn btn-secondary" style="flex: 1;" onclick="closeInvestmentDetail()">ì·¨ì†Œ</button>
                <button class="btn" style="flex: 1;" onclick="confirmInvestment()" id="confirmInvestmentBtn">íˆ¬ìí•˜ê¸°</button>
            </div>
        </div>
    </div>

    <script>
        // ë³€ìˆ˜ ì„ ì–¸
        let supabaseClient = null;
        
        // ë¨¼ì € í•„ìš”í•œ í•¨ìˆ˜ë“¤ì„ ì •ì˜
        function playDemo() {
            gameState.isDemo = true;
            showNotification('ë°ëª¨ ëª¨ë“œë¡œ í”Œë ˆì´í•©ë‹ˆë‹¤', 'info');
            showRoleSelection();
        }

        function showSupabaseSetup() {
            console.log('showSupabaseSetup í•¨ìˆ˜ ì‹¤í–‰ë¨');
            const supabaseSetupDiv = document.getElementById('supabaseSetup');
            if (supabaseSetupDiv) {
                supabaseSetupDiv.style.display = 'block';
                console.log('supabaseSetup div í‘œì‹œë¨');
            } else {
                console.error('supabaseSetup divë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ');
            }
        }

        function setupSupabase() {
            const url = document.getElementById('supabaseUrl').value;
            const key = document.getElementById('supabaseKey').value;
            
            if (!url || !key) {
                showNotification('Supabase URLê³¼ Keyë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”', 'error');
                return;
            }
            
            try {
                const { createClient } = supabase;
                supabaseClient = createClient(url, key);
                
                localStorage.setItem('supabaseUrl', url);
                localStorage.setItem('supabaseKey', key);
                
                showNotification('Supabase ì—°ê²° ì„±ê³µ!', 'success');
                document.getElementById('setupScreen').style.display = 'none';
                document.getElementById('loginScreen').style.display = 'flex';
            } catch (error) {
                showNotification('Supabase ì—°ê²° ì‹¤íŒ¨: ' + error.message, 'error');
            }
        }

        function showNotification(message, type = 'info') {
            const notification = document.getElementById('notification');
            const notificationText = document.getElementById('notificationText');
            
            notificationText.textContent = message;
            notification.className = `notification ${type} show`;
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        function showRoleSelection() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('roleSelection').style.display = 'block';
        }

        function setupEventListeners() {
            // ì²« í™”ë©´ ë²„íŠ¼ë“¤
            document.getElementById('playDemoBtn')?.addEventListener('click', playDemo);
            document.getElementById('supabaseSetupBtn')?.addEventListener('click', function() {
                console.log('Supabase ì—°ë™í•˜ê¸° ë²„íŠ¼ í´ë¦­ë¨');
                showSupabaseSetup();
            });
            
            // Supabase ì„¤ì • ë²„íŠ¼ë“¤
            document.getElementById('setupSupabaseBtn')?.addEventListener('click', setupSupabase);
            document.getElementById('cancelSupabaseBtn')?.addEventListener('click', function() {
                document.getElementById('supabaseSetup').style.display = 'none';
            });
            
            // ë¡œê·¸ì¸ í™”ë©´ ë²„íŠ¼ë“¤
            document.getElementById('loginBtn')?.addEventListener('click', login);
            document.getElementById('loginHelpBtn')?.addEventListener('click', showLoginHelp);
            document.getElementById('loginAsGuestBtn')?.addEventListener('click', loginAsGuest);
            
            console.log('ëª¨ë“  ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆê°€ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤');
        }

        function showLoginHelp() {
            showNotification('ì´ë©”ì¼ê³¼ ë‹‰ë„¤ì„, ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ë©´ ìë™ìœ¼ë¡œ ê³„ì •ì´ ìƒì„±ë©ë‹ˆë‹¤!', 'info');
        }

        function login() {
            const email = document.getElementById('email').value || 'demo@demo.com';
            const username = document.getElementById('username').value || 'Player' + Math.floor(Math.random() * 1000);
            
            if (username.length < 3) {
                showNotification('ì‚¬ìš©ìëª…ì€ 3ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤', 'error');
                return;
            }
            
            gameState.currentUser = {
                id: 'demo_' + Date.now(),
                username: username,
                email: email,
                game_balance: 1000,
                role: null
            };
            
            updateUserDisplay();
            showRoleSelection();
        }

        function loginAsGuest() {
            gameState.isDemo = true;
            gameState.currentUser = {
                id: 'guest_' + Date.now(),
                username: 'Guest_' + Math.floor(Math.random() * 10000),
                email: 'guest@demo.com',
                game_balance: 500,
                role: null
            };
            
            updateUserDisplay();
            showRoleSelection();
        }

        let gameState = {
            currentUser: null,
            selectedRole: null,
            isDemo: false,
            economy: {
                totalUsers: 0,
                totalEconomy: 0,
                totalBusinesses: 0,
                totalLoans: 0,
                // ì¸í”Œë ˆì´ì…˜/ë””í”Œë ˆì´ì…˜ ì‹œìŠ¤í…œ
                inflationRate: 2.5, // ì—°ê°„ ì¸í”Œë ˆì´ì…˜ìœ¨ (%)
                cumulativeInflation: 1.0, // ëˆ„ì  ì¸í”Œë ˆì´ì…˜ ì§€ìˆ˜ (1.0 = ê¸°ì¤€)
                priceLevel: 1.0, // í˜„ì¬ ë¬¼ê°€ ìˆ˜ì¤€
                // ê²½ê¸° ì‚¬ì´í´
                economicCycle: {
                    phase: 'expansion', // expansion, peak, contraction, trough
                    duration: 0, // í˜„ì¬ êµ­ë©´ ì§€ì† ê¸°ê°„ (ì›”)
                    intensity: 0.5, // ê²½ê¸° ê°•ë„ (-1~1, -1=ì‹¬ê°í•œ ë¶ˆí™©, 1=ê³¼ì—´ í˜¸í™©)
                    gdpGrowthRate: 3.2, // GDP ì„±ì¥ë¥  (%)
                    unemploymentRate: 4.5, // ì‹¤ì—…ë¥  (%)
                    consumerConfidence: 75 // ì†Œë¹„ì ì‹ ë¢°ë„ (0-100)
                },
                // ê²½ì œ ì§€í‘œë“¤
                indicators: {
                    interestRate: 3.5, // ê¸°ì¤€ ê¸ˆë¦¬ (%)
                    bondYield: 4.2, // 10ë…„ êµ­ì±„ ìˆ˜ìµë¥ 
                    commodityIndex: 100, // ì›ìì¬ ì§€ìˆ˜
                    realEstateIndex: 100, // ë¶€ë™ì‚° ì§€ìˆ˜
                    manufacturingIndex: 52.5 // ì œì¡°ì—… PMI
                }
            },
            bankSettings: {
                baseRate: 5.0,
                loanRate: 8.0,
                depositRate: 3.0,
                bankAssets: 1000000,
                policy: 'balanced',
                totalLoansIssued: 0,
                totalDeposits: 850000,
                bankRating: 'AAA',
                marketShare: 25.0
            },
            roleData: {
                businesses: [],
                investments: [],
                workHistory: [],
                workStats: {
                    salary: 3000,
                    experience: 0,
                    position: 'ì‚¬ì›',
                    bonuses: 0
                },
                publicCompany: null, // ìƒì¥ ê¸°ì—… ì •ë³´
                companyRating: {
                    creditRating: 'BBB',
                    reputation: 75,
                    esgScore: 50,
                    marketShare: 5.0
                },
                rdProjects: [],
                competitors: [],
                // ìºí”¼íƒˆë¦¬ì¦˜ ìŠ¤íƒ€ì¼ ê²½ì œ ì‹œìŠ¤í…œ
                supplyChain: {
                    rawMaterials: [], // ì›ìì¬ ìƒì‚°ì—…ì²´ (ë†ì¥, ê´‘ì‚°, ëª©ì¥)
                    manufacturers: [], // ì œì¡°ì—…ì²´ (ê³µì¥, ê°€ê³µì—…ì²´)
                    distributors: [], // ìœ í†µì—…ì²´ (ë„ë§¤ì , ë¬¼ë¥˜ì„¼í„°)
                    retailers: [], // ì†Œë§¤ì—…ì²´ (ì†Œë§¤ì , ëŒ€ë¦¬ì )
                    contracts: [], // ê³µê¸‰ ê³„ì•½ë“¤
                    inventory: new Map(), // ì¬ê³  ê´€ë¦¬
                    marketPrices: new Map() // ìƒí’ˆë³„ ì‹œì¥ ê°€ê²©
                },
                // ë…¸ë™ì ê´€ë¦¬ ì‹œìŠ¤í…œ
                workforce: {
                    workers: [], // ì „ì²´ ë…¸ë™ì ëª©ë¡
                    jobMarket: [], // êµ¬ì¸ ì‹œì¥
                    unions: [], // ë…¸ë™ì¡°í•© ëª©ë¡
                    trainingPrograms: [], // êµìœ¡ í”„ë¡œê·¸ë¨
                    satisfactionFactors: {
                        baseSalary: 100, // ê¸°ë³¸ ê¸‰ì—¬ ë§Œì¡±ë„ ê¸°ì¤€
                        benefits: 50, // ë³µë¦¬í›„ìƒ ìˆ˜ì¤€
                        workEnvironment: 50, // ê·¼ë¬´í™˜ê²½ ìˆ˜ì¤€
                        growthOpportunity: 50 // ì„±ì¥ê¸°íšŒ ìˆ˜ì¤€
                    }
                }
            },
            landMarket: {
                totalLand: 1000000, // 100ë§Œ í‰ ì´ í† ì§€
                availableLand: 1000000, // ë‚¨ì€ í† ì§€
                landPricePerUnit: 5000, // í‰ë‹¹ ê¸°ë³¸ ê°€ê²© (ë¹„íŠ¸í¬ë ˆë”§) - 25ë°° ìƒìŠ¹
                regions: [
                    { name: 'ê°•ë‚¨êµ¬', priceMultiplier: 3.0, available: 50000, total: 50000 },
                    { name: 'ì„œì´ˆêµ¬', priceMultiplier: 2.5, available: 60000, total: 60000 },
                    { name: 'ì†¡íŒŒêµ¬', priceMultiplier: 2.2, available: 70000, total: 70000 },
                    { name: 'ë§ˆí¬êµ¬', priceMultiplier: 1.8, available: 80000, total: 80000 },
                    { name: 'ì„±ë™êµ¬', priceMultiplier: 1.5, available: 90000, total: 90000 },
                    { name: 'ê²½ê¸°ë„', priceMultiplier: 1.2, available: 150000, total: 150000 },
                    { name: 'ì¸ì²œ', priceMultiplier: 1.0, available: 200000, total: 200000 },
                    { name: 'ì§€ë°©', priceMultiplier: 0.7, available: 300000, total: 300000 }
                ],
                marketplace: [] // ë§¤ë§¤ ì‹œì¥ì— ì˜¬ë¼ì˜¨ í† ì§€ë“¤
            },
            p2pMarket: {
                listings: [], // ë§¤ë¬¼ ëª©ë¡
                transactions: [], // ê±°ë˜ ë‚´ì—­
                escrow: [], // ì—ìŠ¤í¬ë¡œ (ê±°ë˜ ì¤‘ì¸ í•­ëª©)
                fees: {
                    businessSale: 0.05, // ì‚¬ì—…ì²´ ë§¤ë§¤ ìˆ˜ìˆ˜ë£Œ 5%
                    assetSale: 0.03, // ìì‚° ë§¤ë§¤ ìˆ˜ìˆ˜ë£Œ 3%
                    landSale: 0.04 // ë¶€ë™ì‚° ë§¤ë§¤ ìˆ˜ìˆ˜ë£Œ 4%
                }
            },
            laborMarket: {
                jobPostings: [], // êµ¬ì¸ ê³µê³ 
                applications: [], // êµ¬ì§ ì§€ì›
                contracts: [], // ê³ ìš© ê³„ì•½
                freelanceJobs: [], // í”„ë¦¬ëœìŠ¤ ì¼ìë¦¬
                skills: [ // ìŠ¤í‚¬ ì‹œìŠ¤í…œ
                    'programming', 'design', 'marketing', 'sales', 'management',
                    'accounting', 'legal', 'engineering', 'research', 'consulting'
                ],
                salaryRanges: { // ì§ì¢…ë³„ í‰ê·  ê¸‰ì—¬
                    'junior': { min: 2500, max: 4000 },
                    'mid': { min: 4000, max: 7000 },
                    'senior': { min: 7000, max: 12000 },
                    'lead': { min: 12000, max: 20000 },
                    'executive': { min: 20000, max: 50000 }
                }
            },
            resourceSystem: {
                resources: new Map([ // ìì› í˜„í™©
                    ['raw_materials', { current: 1000000, max: 1000000, regenerationRate: 100 }],
                    ['energy', { current: 800000, max: 1000000, regenerationRate: 150 }],
                    ['technology', { current: 500000, max: 1000000, regenerationRate: 50 }],
                    ['human_capital', { current: 900000, max: 1000000, regenerationRate: 80 }],
                    ['infrastructure', { current: 700000, max: 1000000, regenerationRate: 30 }]
                ]),
                globalConsumption: 0, // ì „ì²´ ì†Œëª¨ëŸ‰
                scarcityEffects: new Map(), // í¬ì†Œì„±ì— ë”°ë¥¸ íš¨ê³¼
                priceMultipliers: new Map() // ìì› ë¶€ì¡±ì‹œ ê°€ê²© ìƒìŠ¹
            },
            countrySystem: {
                population: 52000000, // 5ì²œ2ë°±ë§Œëª… (í•œêµ­ ê¸°ì¤€)
                economicActivity: 0.75, // ê²½ì œí™œì„±ë„ (0-1)
                gdpPerCapita: 35000, // 1ì¸ë‹¹ GDP (ë‹¬ëŸ¬)
                unemploymentRate: 3.2, // ì‹¤ì—…ë¥ 
                consumerSpending: 0.8, // ì†Œë¹„ì§€ì¶œ ì§€ìˆ˜
                businessFormationRate: 0.15, // ì°½ì—…ë¥ 
                innovationIndex: 0.7, // í˜ì‹ ì§€ìˆ˜
                regions: [
                    { name: 'ì„œìš¸íŠ¹ë³„ì‹œ', population: 9700000, economicWeight: 0.25, businessBonus: 1.3 },
                    { name: 'ê²½ê¸°ë„', population: 13500000, economicWeight: 0.22, businessBonus: 1.1 },
                    { name: 'ë¶€ì‚°ê´‘ì—­ì‹œ', population: 3400000, economicWeight: 0.08, businessBonus: 0.95 },
                    { name: 'ëŒ€êµ¬ê´‘ì—­ì‹œ', population: 2400000, economicWeight: 0.05, businessBonus: 0.9 },
                    { name: 'ì¸ì²œê´‘ì—­ì‹œ', population: 3000000, economicWeight: 0.07, businessBonus: 1.05 },
                    { name: 'ê¸°íƒ€ì§€ì—­', population: 20000000, economicWeight: 0.33, businessBonus: 0.8 }
                ]
            },
            stockMarket: {
                stocks: [
                    { name: 'ì‚¼ì„±ì „ì', price: 75000, change: 0, sector: 'tech', dividend: 0.25, description: 'ë°˜ë„ì²´, ìŠ¤ë§ˆíŠ¸í° ê¸€ë¡œë²Œ 1ìœ„' },
                    { name: 'SKí•˜ì´ë‹‰ìŠ¤', price: 120000, change: 0, sector: 'tech', dividend: 0.18, description: 'ë©”ëª¨ë¦¬ ë°˜ë„ì²´ ì „ë¬¸ê¸°ì—…' },
                    { name: 'ë„¤ì´ë²„', price: 180000, change: 0, sector: 'tech', dividend: 0.15, description: 'êµ­ë‚´ ìµœëŒ€ ê²€ìƒ‰í¬í„¸' },
                    { name: 'LGí™”í•™', price: 450000, change: 0, sector: 'chemical', dividend: 0.22, description: 'ë°°í„°ë¦¬, í™”í•™ì†Œì¬ ì„ ë„ê¸°ì—…' },
                    { name: 'í˜„ëŒ€ì°¨', price: 190000, change: 0, sector: 'auto', dividend: 0.35, description: 'ê¸€ë¡œë²Œ ì™„ì„±ì°¨ ì œì¡°ì—…ì²´' },
                    { name: 'LGì „ì', price: 95000, change: 0, sector: 'electronics', dividend: 0.28, description: 'ê°€ì „, ì „ìì œí’ˆ ê¸€ë¡œë²Œ ë¸Œëœë“œ' },
                    { name: 'í¬ìŠ¤ì½”', price: 380000, change: 0, sector: 'steel', dividend: 0.45, description: 'ì² ê°• ì—…ê³„ ì„ ë„ê¸°ì—…' },
                    { name: 'KBê¸ˆìœµ', price: 52000, change: 0, sector: 'finance', dividend: 0.55, description: 'êµ­ë‚´ ì£¼ìš” ê¸ˆìœµì§€ì£¼ì‚¬' },
                    { name: 'ì‹ í•œì§€ì£¼', price: 41000, change: 0, sector: 'finance', dividend: 0.48, description: 'ì¢…í•© ê¸ˆìœµì„œë¹„ìŠ¤ ê·¸ë£¹' },
                    { name: 'ê¸°ì•„', price: 87000, change: 0, sector: 'auto', dividend: 0.32, description: 'ê¸€ë¡œë²Œ ìë™ì°¨ ë¸Œëœë“œ' },
                    { name: 'ì¹´ì¹´ì˜¤', price: 82000, change: 0, sector: 'tech', dividend: 0.08, description: 'ëª¨ë°”ì¼ í”Œë«í¼ ì„ ë„ê¸°ì—…' },
                    { name: 'NFLX', price: 520000, change: 0, sector: 'media', dividend: 0, description: 'ê¸€ë¡œë²Œ ìŠ¤íŠ¸ë¦¬ë° ì„œë¹„ìŠ¤' },
                    { name: 'AAPL', price: 195000, change: 0, sector: 'tech', dividend: 0.12, description: 'ì•„ì´í°, ë§¥ë¶ ì œì¡°ì‚¬' },
                    { name: 'TSLA', price: 240000, change: 0, sector: 'auto', dividend: 0, description: 'ì „ê¸°ì°¨ ë° ì—ë„ˆì§€ ì†”ë£¨ì…˜' },
                    { name: 'NVDA', price: 890000, change: 0, sector: 'tech', dividend: 0.05, description: 'AI ì¹© ì „ë¬¸ê¸°ì—…' }
                ],
                cryptos: [
                    // ë©”ì´ì € ì•”í˜¸í™”í (1-10)
                    { name: 'Bitcoin', symbol: 'BTC', price: 65000000, change: 0, marketCap: 1280000000000, description: 'ìµœì´ˆì´ì ìµœëŒ€ ì•”í˜¸í™”í' },
                    { name: 'Ethereum', symbol: 'ETH', price: 4500000, change: 0, marketCap: 540000000000, description: 'ìŠ¤ë§ˆíŠ¸ ì»¨íŠ¸ë™íŠ¸ í”Œë«í¼' },
                    { name: 'Tether', symbol: 'USDT', price: 1320, change: 0, marketCap: 95000000000, description: 'ë‹¬ëŸ¬ ì—°ë™ ìŠ¤í…Œì´ë¸”ë¹„íŠ¸í¬ë ˆë”§' },
                    { name: 'BNB', symbol: 'BNB', price: 380000, change: 0, marketCap: 58000000000, description: 'ë°”ì´ë‚¸ìŠ¤ ê±°ë˜ì†Œ í† í°' },
                    { name: 'XRP', symbol: 'XRP', price: 820, change: 0, marketCap: 46000000000, description: 'êµ­ì œì†¡ê¸ˆ ì†”ë£¨ì…˜' },
                    { name: 'Solana', symbol: 'SOL', price: 180000, change: 0, marketCap: 85000000000, description: 'ê³ ì† ë¸”ë¡ì²´ì¸ í”Œë«í¼' },
                    { name: 'USD Coin', symbol: 'USDC', price: 1320, change: 0, marketCap: 32000000000, description: 'ê·œì œ ì¤€ìˆ˜ ìŠ¤í…Œì´ë¸”ë¹„íŠ¸í¬ë ˆë”§' },
                    { name: 'Cardano', symbol: 'ADA', price: 650, change: 0, marketCap: 23000000000, description: 'ì§€ì†ê°€ëŠ¥í•œ ë¸”ë¡ì²´ì¸' },
                    { name: 'Dogecoin', symbol: 'DOGE', price: 150, change: 0, marketCap: 22000000000, description: 'ë°ˆì—ì„œ ì‹œì‘ëœ ì•”í˜¸í™”í' },
                    { name: 'TRON', symbol: 'TRX', price: 140, change: 0, marketCap: 12000000000, description: 'ì—”í„°í…Œì¸ë¨¼íŠ¸ ì¤‘ì‹¬ í”Œë«í¼' },

                    // ë ˆì´ì–´1 ë¸”ë¡ì²´ì¸ (11-20)
                    { name: 'Avalanche', symbol: 'AVAX', price: 42000, change: 0, marketCap: 15000000000, description: 'ê³ ì„±ëŠ¥ ìŠ¤ë§ˆíŠ¸ ì»¨íŠ¸ë™íŠ¸' },
                    { name: 'Polygon', symbol: 'MATIC', price: 1200, change: 0, marketCap: 11000000000, description: 'ì´ë”ë¦¬ì›€ í™•ì¥ ì†”ë£¨ì…˜' },
                    { name: 'Chainlink', symbol: 'LINK', price: 19000, change: 0, marketCap: 11000000000, description: 'íƒˆì¤‘ì•™í™” ì˜¤ë¼í´ ë„¤íŠ¸ì›Œí¬' },
                    { name: 'Litecoin', symbol: 'LTC', price: 95000, change: 0, marketCap: 7000000000, description: 'ë¹„íŠ¸ë¹„íŠ¸í¬ë ˆë”§ì˜ ì€' },
                    { name: 'Near Protocol', symbol: 'NEAR', price: 6800, change: 0, marketCap: 6500000000, description: 'ê°œë°œì ì¹œí™”ì  í”Œë«í¼' },
                    { name: 'Internet Computer', symbol: 'ICP', price: 13000, change: 0, marketCap: 6000000000, description: 'íƒˆì¤‘ì•™í™” ì¸í„°ë„·' },
                    { name: 'Aptos', symbol: 'APT', price: 12500, change: 0, marketCap: 5800000000, description: 'ë©”íƒ€ì˜ Diem í›„ê³„ì' },
                    { name: 'Arbitrum', symbol: 'ARB', price: 2100, change: 0, marketCap: 5500000000, description: 'ì´ë”ë¦¬ì›€ ë ˆì´ì–´2' },
                    { name: 'VeChain', symbol: 'VET', price: 34, change: 0, marketCap: 2500000000, description: 'ê³µê¸‰ë§ ì¶”ì  í”Œë«í¼' },
                    { name: 'Algorand', symbol: 'ALGO', price: 270, change: 0, marketCap: 2200000000, description: 'ìˆœìˆ˜ ì§€ë¶„ì¦ëª… ë¸”ë¡ì²´ì¸' },

                    // DeFi í† í° (21-30)
                    { name: 'Uniswap', symbol: 'UNI', price: 8900, change: 0, marketCap: 5300000000, description: 'íƒˆì¤‘ì•™í™” ê±°ë˜ì†Œ' },
                    { name: 'Aave', symbol: 'AAVE', price: 135000, change: 0, marketCap: 2000000000, description: 'íƒˆì¤‘ì•™í™” ëŒ€ì¶œ í”Œë«í¼' },
                    { name: 'Maker', symbol: 'MKR', price: 1850000, change: 0, marketCap: 1800000000, description: 'DAI ìŠ¤í…Œì´ë¸”ë¹„íŠ¸í¬ë ˆë”§ ë°œí–‰' },
                    { name: 'Compound', symbol: 'COMP', price: 68000, change: 0, marketCap: 450000000, description: 'ìë™í™”ëœ ëŒ€ì¶œ í”„ë¡œí† ì½œ' },
                    { name: 'SushiSwap', symbol: 'SUSHI', price: 1450, change: 0, marketCap: 380000000, description: 'ì»¤ë®¤ë‹ˆí‹° ì£¼ë„ DEX' },
                    { name: 'Curve', symbol: 'CRV', price: 580, change: 0, marketCap: 650000000, description: 'ìŠ¤í…Œì´ë¸”ë¹„íŠ¸í¬ë ˆë”§ ìµœì í™” AMM' },
                    { name: 'PancakeSwap', symbol: 'CAKE', price: 3200, change: 0, marketCap: 480000000, description: 'BSC ìµœëŒ€ DEX' },
                    { name: 'Synthetix', symbol: 'SNX', price: 3800, change: 0, marketCap: 720000000, description: 'í•©ì„± ìì‚° í”„ë¡œí† ì½œ' },
                    { name: '1inch', symbol: '1INCH', price: 560, change: 0, marketCap: 560000000, description: 'DEX ì–´ê·¸ë¦¬ê²Œì´í„°' },
                    { name: 'Balancer', symbol: 'BAL', price: 3400, change: 0, marketCap: 200000000, description: 'ìë™ í¬íŠ¸í´ë¦¬ì˜¤ ê´€ë¦¬' },

                    // ê²Œì„/ë©”íƒ€ë²„ìŠ¤ í† í° (31-40)
                    { name: 'Axie Infinity', symbol: 'AXS', price: 8500, change: 0, marketCap: 800000000, description: 'P2E ê²Œì„ì˜ ì„ êµ¬ì' },
                    { name: 'The Sandbox', symbol: 'SAND', price: 650, change: 0, marketCap: 1200000000, description: 'ê°€ìƒì„¸ê³„ í”Œë«í¼' },
                    { name: 'Decentraland', symbol: 'MANA', price: 680, change: 0, marketCap: 1100000000, description: 'VR ë©”íƒ€ë²„ìŠ¤ í”Œë«í¼' },
                    { name: 'Gala', symbol: 'GALA', price: 45, change: 0, marketCap: 1500000000, description: 'ë¸”ë¡ì²´ì¸ ê²Œì„ ìƒíƒœê³„' },
                    { name: 'Enjin Coin', symbol: 'ENJ', price: 380, change: 0, marketCap: 320000000, description: 'ê²Œì„ NFT í”Œë«í¼' },
                    { name: 'Immutable X', symbol: 'IMX', price: 2100, change: 0, marketCap: 2800000000, description: 'NFT ì „ìš© ë ˆì´ì–´2' },
                    { name: 'Flow', symbol: 'FLOW', price: 1200, change: 0, marketCap: 1200000000, description: 'NBA Top Shot í”Œë«í¼' },
                    { name: 'WAX', symbol: 'WAXP', price: 85, change: 0, marketCap: 380000000, description: 'ê²Œì„ ì „ìš© ë¸”ë¡ì²´ì¸' },
                    { name: 'Smooth Love Potion', symbol: 'SLP', price: 5, change: 0, marketCap: 120000000, description: 'Axie Infinity ê²Œì„ í† í°' },
                    { name: 'STEPN', symbol: 'GMT', price: 280, change: 0, marketCap: 180000000, description: 'Move-to-Earn ì•±' },

                    // ë°ˆë¹„íŠ¸í¬ë ˆë”§ & ê¸°íƒ€ (41-50)
                    { name: 'Shiba Inu', symbol: 'SHIB', price: 0.03, change: 0, marketCap: 17000000000, description: 'ë„ì§€ í‚¬ëŸ¬ ë°ˆë¹„íŠ¸í¬ë ˆë”§' },
                    { name: 'Pepe', symbol: 'PEPE', price: 0.000025, change: 0, marketCap: 4200000000, description: 'ê°œêµ¬ë¦¬ ë°ˆ í† í°' },
                    { name: 'Floki', symbol: 'FLOKI', price: 0.0003, change: 0, marketCap: 2800000000, description: 'ì¼ë¡  ë¨¸ìŠ¤í¬ì˜ ê°œ ì´ë¦„' },
                    { name: 'Bonk', symbol: 'BONK', price: 0.00005, change: 0, marketCap: 3200000000, description: 'ì†”ë¼ë‚˜ ë°ˆë¹„íŠ¸í¬ë ˆë”§' },
                    { name: 'SafeMoon', symbol: 'SAFEMOON', price: 0.0008, change: 0, marketCap: 480000000, description: 'BSC ë°ˆë¹„íŠ¸í¬ë ˆë”§' },
                    { name: 'Basic Attention Token', symbol: 'BAT', price: 320, change: 0, marketCap: 480000000, description: 'ë¸Œë ˆì´ë¸Œ ë¸Œë¼ìš°ì € í† í°' },
                    { name: 'Chiliz', symbol: 'CHZ', price: 125, change: 0, marketCap: 1100000000, description: 'ìŠ¤í¬ì¸  íŒ¬ í† í°' },
                    { name: 'Theta', symbol: 'THETA', price: 1850, change: 0, marketCap: 1850000000, description: 'íƒˆì¤‘ì•™í™” ë¹„ë””ì˜¤ ìŠ¤íŠ¸ë¦¬ë°' },
                    { name: 'Holo', symbol: 'HOT', price: 0.35, change: 0, marketCap: 730000000, description: 'P2P ë¶„ì‚° ì»´í“¨íŒ…' },
                    { name: 'Helium', symbol: 'HNT', price: 8500, change: 0, marketCap: 1400000000, description: 'IoT ë¬´ì„  ë„¤íŠ¸ì›Œí¬' },

                    // AI & ë¨¸ì‹ ëŸ¬ë‹ í† í° (51-60)
                    { name: 'Render', symbol: 'RNDR', price: 9800, change: 0, marketCap: 3600000000, description: 'GPU ë Œë”ë§ ë„¤íŠ¸ì›Œí¬' },
                    { name: 'Fetch.ai', symbol: 'FET', price: 2100, change: 0, marketCap: 1800000000, description: 'AI ììœ¨ ê²½ì œ ì—ì´ì „íŠ¸' },
                    { name: 'SingularityNET', symbol: 'AGIX', price: 520, change: 0, marketCap: 680000000, description: 'AI ë§ˆì¼“í”Œë ˆì´ìŠ¤' },
                    { name: 'Ocean Protocol', symbol: 'OCEAN', price: 780, change: 0, marketCap: 420000000, description: 'ë°ì´í„° ê²½ì œ í”„ë¡œí† ì½œ' },
                    { name: 'Numeraire', symbol: 'NMR', price: 21000, change: 0, marketCap: 130000000, description: 'í—¤ì§€í€ë“œ AI í† í°' },
                    { name: 'iExec RLC', symbol: 'RLC', price: 2400, change: 0, marketCap: 180000000, description: 'ë¶„ì‚° í´ë¼ìš°ë“œ ì»´í“¨íŒ…' },
                    { name: 'Cortex', symbol: 'CTXC', price: 420, change: 0, marketCap: 95000000, description: 'AI ë¸”ë¡ì²´ì¸ í”Œë«í¼' },
                    { name: 'Matrix AI Network', symbol: 'MAN', price: 85, change: 0, marketCap: 45000000, description: 'AI ê¸°ë°˜ ë¸”ë¡ì²´ì¸' },
                    { name: 'DeepBrain Chain', symbol: 'DBC', price: 15, change: 0, marketCap: 38000000, description: 'AI í›ˆë ¨ í”Œë«í¼' },
                    { name: 'Artificial Superintelligence', symbol: 'ASI', price: 1800, change: 0, marketCap: 2200000000, description: 'AI í†µí•© í† í°' },

                    // ì¸í”„ë¼ & ì˜¤ë¼í´ í† í° (61-70)
                    { name: 'Filecoin', symbol: 'FIL', price: 8200, change: 0, marketCap: 4600000000, description: 'íƒˆì¤‘ì•™í™” ìŠ¤í† ë¦¬ì§€' },
                    { name: 'Arweave', symbol: 'AR', price: 28000, change: 0, marketCap: 1800000000, description: 'ì˜êµ¬ ë°ì´í„° ìŠ¤í† ë¦¬ì§€' },
                    { name: 'Storj', symbol: 'STORJ', price: 850, change: 0, marketCap: 320000000, description: 'ë¶„ì‚° í´ë¼ìš°ë“œ ìŠ¤í† ë¦¬ì§€' },
                    { name: 'Band Protocol', symbol: 'BAND', price: 1900, change: 0, marketCap: 190000000, description: 'í¬ë¡œìŠ¤ì²´ì¸ ì˜¤ë¼í´' },
                    { name: 'API3', symbol: 'API3', price: 2800, change: 0, marketCap: 280000000, description: 'ì²« ë²ˆì§¸ íŒŒí‹° ì˜¤ë¼í´' },
                    { name: 'The Graph', symbol: 'GRT', price: 280, change: 0, marketCap: 2600000000, description: 'ì¸ë±ì‹± í”„ë¡œí† ì½œ' },
                    { name: 'Livepeer', symbol: 'LPT', price: 18000, change: 0, marketCap: 550000000, description: 'íƒˆì¤‘ì•™í™” ë¹„ë””ì˜¤ ì¸í”„ë¼' },
                    { name: 'Siacoin', symbol: 'SC', price: 8.5, change: 0, marketCap: 480000000, description: 'ë¶„ì‚° ìŠ¤í† ë¦¬ì§€' },
                    { name: 'Golem', symbol: 'GLM', price: 650, change: 0, marketCap: 650000000, description: 'ë¶„ì‚° ì»´í“¨íŒ… íŒŒì›Œ' },
                    { name: 'PowerLedger', symbol: 'POWR', price: 480, change: 0, marketCap: 240000000, description: 'P2P ì—ë„ˆì§€ ê±°ë˜' },

                    // í”„ë¼ì´ë²„ì‹œ ë¹„íŠ¸í¬ë ˆë”§ (71-80)
                    { name: 'Monero', symbol: 'XMR', price: 185000, change: 0, marketCap: 3400000000, description: 'ì™„ì „ ìµëª… ì•”í˜¸í™”í' },
                    { name: 'Zcash', symbol: 'ZEC', price: 38000, change: 0, marketCap: 580000000, description: 'zk-SNARK í”„ë¼ì´ë²„ì‹œ' },
                    { name: 'Dash', symbol: 'DASH', price: 42000, change: 0, marketCap: 480000000, description: 'ì¦‰ì‹œ ê±°ë˜ í”„ë¼ì´ë²„ì‹œ ë¹„íŠ¸í¬ë ˆë”§' },
                    { name: 'Secret', symbol: 'SCRT', price: 680, change: 0, marketCap: 420000000, description: 'í”„ë¼ì´ë²„ì‹œ ìŠ¤ë§ˆíŠ¸ ì»¨íŠ¸ë™íŠ¸' },
                    { name: 'Oasis Network', symbol: 'ROSE', price: 125, change: 0, marketCap: 780000000, description: 'í”„ë¼ì´ë²„ì‹œ ë³´ì¥ í”Œë«í¼' },
                    { name: 'Horizen', symbol: 'ZEN', price: 14500, change: 0, marketCap: 180000000, description: 'í”„ë¼ì´ë²„ì‹œ ê¸°ë°˜ í”Œë«í¼' },
                    { name: 'PIVX', symbol: 'PIVX', price: 680, change: 0, marketCap: 45000000, description: 'í”„ë¼ì´ë²„ì‹œ ì§€ë¶„ì¦ëª…' },
                    { name: 'Beam', symbol: 'BEAM', price: 85, change: 0, marketCap: 48000000, description: 'í™•ì¥ê°€ëŠ¥í•œ í”„ë¼ì´ë²„ì‹œ ë¹„íŠ¸í¬ë ˆë”§' },
                    { name: 'Grin', symbol: 'GRIN', price: 58, change: 0, marketCap: 32000000, description: 'MimbleWimble í”„ë¡œí† ì½œ' },
                    { name: 'Firo', symbol: 'FIRO', price: 2800, change: 0, marketCap: 38000000, description: 'ê¸ˆìœµ í”„ë¼ì´ë²„ì‹œ' },

                    // ë ˆì´ì–´2 & ìŠ¤ì¼€ì¼ë§ (81-90)
                    { name: 'Optimism', symbol: 'OP', price: 3200, change: 0, marketCap: 3200000000, description: 'ì´ë”ë¦¬ì›€ ë ˆì´ì–´2 ì†”ë£¨ì…˜' },
                    { name: 'Loopring', symbol: 'LRC', price: 420, change: 0, marketCap: 520000000, description: 'zkRollup DEX í”„ë¡œí† ì½œ' },
                    { name: 'StarkNet', symbol: 'STRK', price: 850, change: 0, marketCap: 6800000000, description: 'zk-STARK ë ˆì´ì–´2' },
                    { name: 'Metis', symbol: 'METIS', price: 58000, change: 0, marketCap: 380000000, description: 'ì´ë”ë¦¬eum ë ˆì´ì–´2' },
                    { name: 'Boba Network', symbol: 'BOBA', price: 380, change: 0, marketCap: 95000000, description: 'í•˜ì´ë¸Œë¦¬ë“œ ë ˆì´ì–´2' },
                    { name: 'OMG Network', symbol: 'OMG', price: 680, change: 0, marketCap: 95000000, description: 'í”Œë¼ì¦ˆë§ˆ ìŠ¤ì¼€ì¼ë§' },
                    { name: 'Skale', symbol: 'SKL', price: 85, change: 0, marketCap: 320000000, description: 'ë©€í‹°ì²´ì¸ ë„¤íŠ¸ì›Œí¬' },
                    { name: 'Cartesi', symbol: 'CTSI', price: 280, change: 0, marketCap: 190000000, description: 'ë¦¬ëˆ…ìŠ¤ dApp í”Œë«í¼' },
                    { name: 'xDAI', symbol: 'STAKE', price: 1200, change: 0, marketCap: 95000000, description: 'ìŠ¤í…Œì´ë¸” ì²´ì¸' },
                    { name: 'Hermez', symbol: 'HEZ', price: 850, change: 0, marketCap: 85000000, description: 'zk-Rollup ë„¤íŠ¸ì›Œí¬' },

                    // ì¤‘ì•™ê±°ë˜ì†Œ í† í° (91-100)
                    { name: 'FTX Token', symbol: 'FTT', price: 2800, change: 0, marketCap: 950000000, description: 'FTX ê±°ë˜ì†Œ í† í°' },
                    { name: 'KuCoin Token', symbol: 'KCS', price: 12500, change: 0, marketCap: 1200000000, description: 'ì¿ ë¹„íŠ¸í¬ë ˆë”§ ê±°ë˜ì†Œ í† í°' },
                    { name: 'Huobi Token', symbol: 'HT', price: 850, change: 0, marketCap: 180000000, description: 'í›„ì˜¤ë¹„ ê±°ë˜ì†Œ í† í°' },
                    { name: 'Crypto.com Coin', symbol: 'CRO', price: 150, change: 0, marketCap: 3800000000, description: 'Crypto.com ìƒíƒœê³„' },
                    { name: 'Gate Token', symbol: 'GT', price: 8500, change: 0, marketCap: 850000000, description: 'Gate.io ê±°ë˜ì†Œ í† í°' },
                    { name: 'MEXC Token', symbol: 'MX', price: 4200, change: 0, marketCap: 680000000, description: 'MEXC ê±°ë˜ì†Œ í† í°' },
                    { name: 'Biswap', symbol: 'BSW', price: 185, change: 0, marketCap: 85000000, description: 'BSC DEX í† í°' },
                    { name: 'Bitget Token', symbol: 'BGB', price: 1200, change: 0, marketCap: 1800000000, description: 'Bitget ê±°ë˜ì†Œ í† í°' },
                    { name: 'OKB', symbol: 'OKB', price: 58000, change: 0, marketCap: 3500000000, description: 'OKX ê±°ë˜ì†Œ í† í°' },
                    { name: 'LEO Token', symbol: 'LEO', price: 8200, change: 0, marketCap: 7600000000, description: 'Bitfinex ê±°ë˜ì†Œ í† í°' },

                    // ì†Œì…œ & ì°½ì‘ì í† í° (101-110)
                    { name: 'Rally', symbol: 'RLY', price: 28, change: 0, marketCap: 85000000, description: 'ì°½ì‘ì ê²½ì œ í”Œë«í¼' },
                    { name: 'BitClout', symbol: 'CLOUT', price: 1200, change: 0, marketCap: 180000000, description: 'ì†Œì…œ ë¸”ë¡ì²´ì¸' },
                    { name: 'Friend.tech', symbol: 'FRIEND', price: 850, change: 0, marketCap: 420000000, description: 'ì†Œì…œíŒŒì´ í”Œë«í¼' },
                    { name: 'Lens Protocol', symbol: 'LENS', price: 2800, change: 0, marketCap: 280000000, description: 'íƒˆì¤‘ì•™í™” ì†Œì…œ ê·¸ë˜í”„' },
                    { name: 'Mirror', symbol: 'MIR', price: 480, change: 0, marketCap: 38000000, description: 'íƒˆì¤‘ì•™í™” í¼ë¸”ë¦¬ì‹±' },
                    { name: 'Audius', symbol: 'AUDIO', price: 280, change: 0, marketCap: 190000000, description: 'ìŒì•… ìŠ¤íŠ¸ë¦¬ë° í”Œë«í¼' },
                    { name: 'Steem', symbol: 'STEEM', price: 380, change: 0, marketCap: 140000000, description: 'ì†Œì…œ ë¸”ë¡ì²´ì¸ í”Œë«í¼' },
                    { name: 'Hive', symbol: 'HIVE', price: 580, change: 0, marketCap: 220000000, description: 'íƒˆì¤‘ì•™í™” ì†Œì…œ ë¯¸ë””ì–´' },
                    { name: 'Minds', symbol: 'MINDS', price: 125, change: 0, marketCap: 28000000, description: 'ì˜¤í”ˆì†ŒìŠ¤ ì†Œì…œ ë„¤íŠ¸ì›Œí¬' },
                    { name: 'Steemit', symbol: 'SBD', price: 1200, change: 0, marketCap: 12000000, description: 'ìŠ¤íŒ€ ë‹¬ëŸ¬' },

                    // ì‹¤í—˜ì  & ìƒˆë¡œìš´ í”„ë¡œì íŠ¸ (111-120)
                    { name: 'Worldcoin', symbol: 'WLD', price: 3200, change: 0, marketCap: 1200000000, description: 'ê¸€ë¡œë²Œ UBI í”„ë¡œì íŠ¸' },
                    { name: 'Bitcoin Ordinals', symbol: 'ORDI', price: 58000, change: 0, marketCap: 1200000000, description: 'ë¹„íŠ¸ë¹„íŠ¸í¬ë ˆë”§ NFT' },
                    { name: 'Kaspa', symbol: 'KAS', price: 185, change: 0, marketCap: 4500000000, description: 'DAG ë¸”ë¡ì²´ì¸' },
                    { name: 'Sei', symbol: 'SEI', price: 680, change: 0, marketCap: 2800000000, description: 'ê±°ë˜ íŠ¹í™” ë ˆì´ì–´1' },
                    { name: 'Celestia', symbol: 'TIA', price: 8500, change: 0, marketCap: 1400000000, description: 'ëª¨ë“ˆëŸ¬ ë¸”ë¡ì²´ì¸' },
                    { name: 'Pendle', symbol: 'PENDLE', price: 7200, change: 0, marketCap: 1100000000, description: 'ìˆ˜ìµë¥  í† í¬ë‚˜ì´ì œì´ì…˜' },
                    { name: 'JasmyCoin', symbol: 'JASMY', price: 42, change: 0, marketCap: 2000000000, description: 'ì¼ë³¸ IoT í”Œë«í¼' },
                    { name: 'Stacks', symbol: 'STX', price: 2800, change: 0, marketCap: 4100000000, description: 'ë¹„íŠ¸ë¹„íŠ¸í¬ë ˆë”§ ìŠ¤ë§ˆíŠ¸ ì»¨íŠ¸ë™íŠ¸' },
                    { name: 'Radix', symbol: 'XRD', price: 58, change: 0, marketCap: 680000000, description: 'DeFi íŠ¹í™” ë ˆì´ì–´1' },
                    { name: 'MultiversX', symbol: 'EGLD', price: 38000, change: 0, marketCap: 980000000, description: 'ê³ ì„±ëŠ¥ ìƒ¤ë”© ë¸”ë¡ì²´ì¸' }
                ],
                kospi: 2400,
                kospiChange: 0,
                usdkrw: 1320,
                usdkrwChange: 0
            }
        };
        
        // ê¸°íƒ€ í•¨ìˆ˜ë“¤ (ì¤‘ë³µ ì œê±°ë¨)
        
        function showRoleSelection() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('roleSelection').style.display = 'block';
        }
        
        function selectRole(role) {
            document.querySelectorAll('.role-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            document.getElementById(`role-${role}`).classList.add('selected');
            gameState.selectedRole = role;
        }
        
        function confirmRole() {
            if (!gameState.selectedRole) {
                showNotification('ì—­í• ì„ ì„ íƒí•´ì£¼ì„¸ìš”', 'error');
                return;
            }
            
            gameState.currentUser.role = gameState.selectedRole;
            
            // ì—­í•  ë³´ë„ˆìŠ¤
            switch (gameState.selectedRole) {
                case 'banker':
                    gameState.currentUser.game_balance += 10000;
                    break;
                case 'entrepreneur':
                    gameState.currentUser.game_balance += 5000;
                    break;
                case 'investor':
                    gameState.currentUser.game_balance += 7000;
                    break;
                case 'worker':
                    gameState.currentUser.game_balance += 2000;
                    break;
            }
            
            showGame();
        }
        
        async function showGame() {
            document.getElementById('roleSelection').style.display = 'none';
            document.getElementById('gameContainer').style.display = 'block';
            
            // UI ì—…ë°ì´íŠ¸
            document.getElementById('userAvatar').textContent = gameState.currentUser.username[0].toUpperCase();
            document.getElementById('userName').textContent = gameState.currentUser.username;
            
            const roleNames = {
                'banker': 'ì€í–‰ì¥',
                'entrepreneur': 'ì‚¬ì—…ê°€',
                'investor': 'íˆ¬ìì',
                'worker': 'ì§ì¥ì¸'
            };
            document.getElementById('userRole').textContent = roleNames[gameState.currentUser.role] || 'ì‹œë¯¼';
            
            // ìºí”¼íƒˆë¦¬ì¦˜ ì‹œì¥ ê°€ê²© ì´ˆê¸°í™”
            initializeMarketPrices();
            
            // ì—­í• ë³„ ë©”ë‰´ í‘œì‹œ - ëª¨ë“  ì—­í• ì´ ì‚¬ì—…ê³¼ íˆ¬ì ê¸°ëŠ¥ ì‚¬ìš© ê°€ëŠ¥
            initializeBusinessData(); // ëª¨ë“  ì—­í• ì— ì‚¬ì—… ë°ì´í„° ì´ˆê¸°í™”
            initializeInvestmentData(); // ëª¨ë“  ì—­í• ì— íˆ¬ì ë°ì´í„° ì´ˆê¸°í™”
            document.getElementById('investmentMenu').style.display = 'block'; // ëª¨ë“  ì—­í• ì´ íˆ¬ì ë©”ë‰´ ì‚¬ìš© ê°€ëŠ¥
            
            if (gameState.currentUser.role === 'banker') {
                document.getElementById('bankMenu').style.display = 'block';
                updateBankDisplay();
            } else if (gameState.currentUser.role === 'worker') {
                document.getElementById('workMenu').style.display = 'block';
                initializeWorkData();
            }
            
            updateDisplay();
            updateUserDisplay(); // ì‚¬ìš©ì ì •ë³´ í‘œì‹œ
            
            // Supabaseì—ì„œ ê¸°ì¡´ ë°ì´í„° ë¡œë“œ ì‹œë„
            if (supabaseClient && !gameState.isDemo) {
                const cloudLoaded = await loadGameStateFromSupabase();
                if (!cloudLoaded) {
                    // í´ë¼ìš°ë“œì— ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ë¡œì»¬ ë°ì´í„° ì‹œë„
                    loadGameState();
                }
            } else {
                // ë°ëª¨ ëª¨ë“œì´ê±°ë‚˜ Supabase ì—°ê²°ì´ ì—†ìœ¼ë©´ ë¡œì»¬ ë°ì´í„°ë§Œ
                loadGameState();
            }
            
            startIncomeSystem(); // ìë™ ìˆ˜ìµ ì‹œìŠ¤í…œ ì‹œì‘
            startEconomicSystem(); // ê²½ì œ ì‚¬ì´í´ ì‹œìŠ¤í…œ ì‹œì‘
            startResourceSystem(); // ìì› ì‹œìŠ¤í…œ ì‹œì‘
            updateMarketDisplay(); // ì‹œì¥ ë°ì´í„° ì—…ë°ì´íŠ¸
            startMarketSystem(); // ì‹œì¥ ë³€ë™ ì‹œìŠ¤í…œ ì‹œì‘
            startAutoSave(); // ìë™ ì €ì¥ ì‹œìŠ¤í…œ ì‹œì‘
            showNotification(`í™˜ì˜í•©ë‹ˆë‹¤, ${gameState.currentUser.username}ë‹˜!`, 'success');
        }
        
        // ì£¼ì‹ ì‹œì¥ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateMarketDisplay() {
            // ì£¼ì‹ ì‹œì¥ ì—…ë°ì´íŠ¸
            const stockMarketDiv = document.getElementById('stockMarket');
            stockMarketDiv.innerHTML = '';
            
            gameState.stockMarket.stocks.forEach(stock => {
                const stockItem = document.createElement('div');
                stockItem.className = 'market-item';
                const changeColor = stock.change >= 0 ? 'var(--success)' : 'var(--danger)';
                const changeSign = stock.change >= 0 ? '+' : '';
                
                stockItem.innerHTML = `
                    <div class="market-item-header">
                        <span class="market-item-name">${stock.name}</span>
                        <span class="market-item-price">${stock.price.toLocaleString()}ì›</span>
                    </div>
                    <div class="market-item-change" style="color: ${changeColor}">${changeSign}${stock.change.toFixed(2)}%</div>
                `;
                stockMarketDiv.appendChild(stockItem);
            });
            
            // ì•”í˜¸í™”í ì‹œì¥ ì—…ë°ì´íŠ¸
            const cryptoMarketDiv = document.getElementById('cryptoMarket');
            cryptoMarketDiv.innerHTML = '';
            
            gameState.stockMarket.cryptos.forEach(crypto => {
                const cryptoItem = document.createElement('div');
                cryptoItem.className = 'market-item';
                const changeColor = crypto.change >= 0 ? 'var(--success)' : 'var(--danger)';
                const changeSign = crypto.change >= 0 ? '+' : '';
                
                cryptoItem.innerHTML = `
                    <div class="market-item-header">
                        <span class="market-item-name">${crypto.name}</span>
                        <span class="market-item-price">â‚©${crypto.price.toLocaleString()}</span>
                    </div>
                    <div class="market-item-change" style="color: ${changeColor}">${changeSign}${crypto.change.toFixed(2)}%</div>
                `;
                cryptoMarketDiv.appendChild(cryptoItem);
            });
            
            // ê²½ì œ ì§€í‘œ ì—…ë°ì´íŠ¸
            document.getElementById('kospiIndex').textContent = gameState.stockMarket.kospi.toLocaleString();
            document.getElementById('kospiChange').textContent = (gameState.stockMarket.kospiChange >= 0 ? '+' : '') + 
                gameState.stockMarket.kospiChange.toFixed(2) + '%';
            document.getElementById('kospiChange').style.color = gameState.stockMarket.kospiChange >= 0 ? 'var(--success)' : 'var(--danger)';
            
            document.getElementById('usdkrw').textContent = gameState.stockMarket.usdkrw.toLocaleString();
            document.getElementById('usdkrwChange').textContent = (gameState.stockMarket.usdkrwChange >= 0 ? '+' : '') + 
                gameState.stockMarket.usdkrwChange.toFixed(2) + '%';
            document.getElementById('usdkrwChange').style.color = gameState.stockMarket.usdkrwChange >= 0 ? 'var(--success)' : 'var(--danger)';
        }
        
        // ì£¼ì‹ ì‹œì¥ ë³€ë™ ì‹œìŠ¤í…œ
        function startMarketSystem() {
            setInterval(() => {
                // ì£¼ì‹ ê°€ê²© ë³€ë™ (ì¼ì¼ ìµœëŒ€ 30%)
                gameState.stockMarket.stocks.forEach(stock => {
                    // ëˆ„ì  ì¼ì¼ ë³€ë™ë¥  ì¶”ì 
                    if (!stock.dailyChangeAccumulated) stock.dailyChangeAccumulated = 0;
                    
                    const volatility = stock.sector === 'tech' ? 0.08 : 0.05; // í…Œí¬ ì£¼ì‹ì´ ë” ë³€ë™ì„± í¼
                    let priceChange = (Math.random() - 0.5) * volatility * 2;
                    
                    // ì¼ì¼ ìµœëŒ€ 30% ì œí•œ
                    const maxDailyChange = 0.3;
                    if (Math.abs(stock.dailyChangeAccumulated + priceChange) > maxDailyChange) {
                        priceChange = Math.sign(priceChange) * (maxDailyChange - Math.abs(stock.dailyChangeAccumulated));
                    }
                    
                    stock.dailyChangeAccumulated += priceChange;
                    stock.change = priceChange * 100;
                    stock.price = Math.max(stock.price * (1 + priceChange), 1000);
                });
                
                // ì•”í˜¸í™”í ê°€ê²© ë³€ë™ (ì œí•œ ì—†ìŒ)
                gameState.stockMarket.cryptos.forEach(crypto => {
                    const priceChange = (Math.random() - 0.5) * 0.2; // Â±10% ë³€ë™ (ë” í° ë³€ë™ì„±)
                    crypto.change = priceChange * 100;
                    crypto.price = Math.max(crypto.price * (1 + priceChange), 1);
                });
                
                // ì½”ìŠ¤í”¼ ì§€ìˆ˜ ë³€ë™ (ìµœëŒ€ 5%)
                let kospiChange = (Math.random() - 0.5) * 0.1; // Â±5% ë³€ë™
                if (!gameState.stockMarket.kospiDailyChange) gameState.stockMarket.kospiDailyChange = 0;
                
                const maxKospiChange = 0.05;
                if (Math.abs(gameState.stockMarket.kospiDailyChange + kospiChange) > maxKospiChange) {
                    kospiChange = Math.sign(kospiChange) * (maxKospiChange - Math.abs(gameState.stockMarket.kospiDailyChange));
                }
                
                gameState.stockMarket.kospiDailyChange += kospiChange;
                gameState.stockMarket.kospiChange = kospiChange * 100;
                gameState.stockMarket.kospi = Math.max(gameState.stockMarket.kospi * (1 + kospiChange), 1000);
                
                // í™˜ìœ¨ ë³€ë™ (ìµœëŒ€ 3%)
                let usdChange = (Math.random() - 0.5) * 0.06; // Â±3% ë³€ë™
                if (!gameState.stockMarket.usdkrwDailyChange) gameState.stockMarket.usdkrwDailyChange = 0;
                
                const maxUsdChange = 0.03;
                if (Math.abs(gameState.stockMarket.usdkrwDailyChange + usdChange) > maxUsdChange) {
                    usdChange = Math.sign(usdChange) * (maxUsdChange - Math.abs(gameState.stockMarket.usdkrwDailyChange));
                }
                
                gameState.stockMarket.usdkrwDailyChange += usdChange;
                gameState.stockMarket.usdkrwChange = usdChange * 100;
                gameState.stockMarket.usdkrw = Math.max(gameState.stockMarket.usdkrw * (1 + usdChange), 1000);
                
                updateMarketDisplay();
                
                // ì‹œì¥ ìƒí™©ì— ë”°ë¥¸ ì‚¬ì—… ê°€ì¹˜ ì˜í–¥
                if (gameState.currentUser && gameState.currentUser.role === 'entrepreneur') {
                    applyMarketEffectToBusiness();
                }
            }, 8000); // 8ì´ˆë§ˆë‹¤ ì‹œì¥ ë³€ë™
        }
        
        // ì‹œì¥ ìƒí™©ì´ ì‚¬ì—…ì— ë¯¸ì¹˜ëŠ” ì˜í–¥
        function applyMarketEffectToBusiness() {
            if (gameState.roleData.businesses.length === 0) return;
            
            // ì½”ìŠ¤í”¼ ì§€ìˆ˜ì— ë”°ë¥¸ ì „ì²´ì ì¸ ì‹œì¥ ì˜í–¥
            const marketSentiment = gameState.stockMarket.kospiChange;
            
            gameState.roleData.businesses.forEach(business => {
                // ì‚¬ì—… ì¢…ë¥˜ì— ë”°ë¥¸ ì‹œì¥ ë¯¼ê°ë„
                let marketSensitivity = 0.002; // ê¸°ë³¸ ë¯¼ê°ë„
                
                if (business.name.includes('IT') || business.name.includes('ìŠ¤íƒ€íŠ¸ì—…')) {
                    // IT ê´€ë ¨ ì‚¬ì—…ì€ í…Œí¬ ì£¼ì‹ê³¼ ì—°ë™
                    const techStocks = gameState.stockMarket.stocks.filter(s => s.sector === 'tech');
                    const avgTechChange = techStocks.reduce((sum, s) => sum + s.change, 0) / techStocks.length;
                    marketSensitivity = 0.005;
                    
                    const techEffect = avgTechChange * marketSensitivity;
                    business.value = Math.max(Math.floor(business.value * (1 + techEffect / 100)), 1000);
                    
                    if (Math.abs(avgTechChange) > 3) { // í° ë³€ë™ ì‹œ ì•Œë¦¼
                        const direction = avgTechChange > 0 ? 'ìƒìŠ¹' : 'í•˜ë½';
                        showNotification(`ğŸ“ˆ í…Œí¬ ì‹œì¥ ${direction}ìœ¼ë¡œ ${business.name} ê°€ì¹˜ ë³€ë™`, avgTechChange > 0 ? 'info' : 'warning');
                    }
                    
                } else if (business.name.includes('ìŒì‹ì ') || business.name.includes('ì¹´í˜')) {
                    // ì™¸ì‹ì—…ì€ í™˜ìœ¨ê³¼ ë°˜ëŒ€ë¡œ ì—°ë™ (í™˜ìœ¨ ìƒìŠ¹ ì‹œ ë‚´ìˆ˜ ì¦ê°€)
                    const usdEffect = -gameState.stockMarket.usdkrwChange * 0.003;
                    business.value = Math.max(Math.floor(business.value * (1 + usdEffect / 100)), 1000);
                    
                } else {
                    // ì¼ë°˜ ì‚¬ì—…ì€ ì½”ìŠ¤í”¼ì™€ ì—°ë™
                    const kospiEffect = marketSentiment * marketSensitivity;
                    business.value = Math.max(Math.floor(business.value * (1 + kospiEffect / 100)), 1000);
                }
                
                // ê·¹ë‹¨ì ì¸ ì‹œì¥ ìƒí™©ì—ì„œëŠ” íŠ¹ë³„ ì´ë²¤íŠ¸
                if (Math.abs(marketSentiment) > 3) { // ì½”ìŠ¤í”¼ 3% ì´ìƒ ë³€ë™
                    if (Math.random() < 0.1) { // 10% í™•ë¥ 
                        if (marketSentiment > 0) {
                            // í˜¸í™© ì´ë²¤íŠ¸
                            business.profit = Math.floor(business.profit * 1.1);
                            business.value = Math.floor(business.value * 1.05);
                            showNotification(`ğŸ“ˆ ê²½ì œ í˜¸í™©ìœ¼ë¡œ ${business.name}ì˜ ì‹¤ì ì´ ê°œì„ ë˜ì—ˆìŠµë‹ˆë‹¤!`, 'success');
                        } else {
                            // ë¶ˆí™© ì´ë²¤íŠ¸
                            business.profit = Math.max(Math.floor(business.profit * 0.9), 50);
                            business.value = Math.max(Math.floor(business.value * 0.95), 1000);
                            showNotification(`ğŸ“‰ ê²½ì œ ë¶ˆí™©ìœ¼ë¡œ ${business.name}ì´ íƒ€ê²©ì„ ë°›ì•˜ìŠµë‹ˆë‹¤.`, 'warning');
                        }
                    }
                }
            });
            
            updateBusinessDisplay();
        }
        
        // ê¸°ì—… ìƒì¥ ì‹œìŠ¤í…œ (ìƒˆë¡œìš´ ëª¨ë‹¬ ë°©ì‹)
        function goPublic() {
            if (gameState.roleData.businesses.length === 0) {
                showNotification('ìƒì¥í•  ì‚¬ì—…ì´ ì—†ìŠµë‹ˆë‹¤', 'error');
                return;
            }
            
            openIPOModal();
        }

        function openIPOModal() {
            const modalContent = `
                <h2 style="text-align: center; margin-bottom: 30px; color: var(--primary);">ğŸ›ï¸ ê¸°ì—…ê³µê°œ (IPO)</h2>
                
                <div style="margin-bottom: 20px;">
                    <p style="text-align: center; color: #cbd5e1; margin-bottom: 20px;">
                        ìƒì¥í•  ê¸°ì—…ì„ ì„ íƒí•˜ì„¸ìš”. ìƒì¥ì„ í†µí•´ ìê¸ˆì„ ì¡°ë‹¬í•˜ê³  ê¸°ì—…ì„ ì„±ì¥ì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                    </p>
                </div>

                <div id="ipoBusinesses" style="display: grid; gap: 15px; margin-bottom: 30px;">
                    <!-- ìƒì¥ ê°€ëŠ¥í•œ ì‚¬ì—…ë“¤ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                </div>
            `;
            
            showModal(modalContent);
            loadIPOBusinesses();
        }

        function loadIPOBusinesses() {
            const container = document.getElementById('ipoBusinesses');
            if (!container) return;

            const eligibleBusinesses = gameState.roleData.businesses.filter(business => {
                return business.value >= 100000 && !business.isPublic; // ìµœì†Œ 10ë§Œ ë¹„íŠ¸í¬ë ˆë”§ ê°€ì¹˜, ë¹„ìƒì¥ ê¸°ì—…ë§Œ
            });

            if (eligibleBusinesses.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #64748b;">
                        <div style="font-size: 2rem; margin-bottom: 15px;">ğŸ“ˆ</div>
                        <h3 style="color: var(--warning); margin-bottom: 10px;">ìƒì¥ ê°€ëŠ¥í•œ ê¸°ì—…ì´ ì—†ìŠµë‹ˆë‹¤</h3>
                        <p style="margin-bottom: 20px;">ìƒì¥ì„ ìœ„í•´ì„œëŠ”:</p>
                        <ul style="text-align: left; max-width: 300px; margin: 0 auto;">
                            <li>ìµœì†Œ ê¸°ì—… ê°€ì¹˜ 100,000 ë¹„íŠ¸í¬ë ˆë”§</li>
                            <li>ë¹„ìƒì¥ ê¸°ì—…ì´ì–´ì•¼ í•¨</li>
                            <li>ìƒì¥ ë¹„ìš© 50,000 ë¹„íŠ¸í¬ë ˆë”§ í•„ìš”</li>
                        </ul>
                    </div>
                `;
                return;
            }

            container.innerHTML = eligibleBusinesses.map(business => {
                const ipoValue = Math.floor(business.value * 1.4); // IPO í”„ë¦¬ë¯¸ì—„ 40%
                const minEquity = 25; // ìµœì†Œ 25% ì§€ë¶„ ê³µê°œ
                const maxEquity = 75; // ìµœëŒ€ 75% ì§€ë¶„ ê³µê°œ
                const ipoCost = 50000;
                const canAfford = gameState.currentUser.game_balance >= ipoCost;
                
                return `
                    <div class="ipo-business-card ${canAfford ? '' : 'disabled'}" 
                         onclick="${canAfford ? `selectBusinessForIPO(${business.id})` : ''}"
                         style="
                            padding: 20px;
                            background: ${canAfford ? 'rgba(255,255,255,0.05)' : 'rgba(255,255,255,0.02)'};
                            border: 1px solid ${canAfford ? 'rgba(255,255,255,0.1)' : 'rgba(255,255,255,0.05)'};
                            border-radius: 12px;
                            cursor: ${canAfford ? 'pointer' : 'not-allowed'};
                            transition: all 0.3s ease;
                            opacity: ${canAfford ? '1' : '0.5'};
                         "
                         onmouseover="this.style.backgroundColor='${canAfford ? 'rgba(255,255,255,0.08)' : 'rgba(255,255,255,0.02)'}'"
                         onmouseout="this.style.backgroundColor='${canAfford ? 'rgba(255,255,255,0.05)' : 'rgba(255,255,255,0.02)'}'">
                        
                        <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 15px;">
                            <div>
                                <h3 style="color: var(--primary); margin: 0; margin-bottom: 5px;">${business.name}</h3>
                                <p style="color: #94a3b8; margin: 0; font-size: 0.9rem;">ë ˆë²¨ ${business.level} | ${business.sector} | ì„¤ë¦½ ${business.founded}ë…„</p>
                            </div>
                            <div style="text-align: right;">
                                <div style="color: var(--success); font-weight: 600; font-size: 1.1rem;">
                                    ${ipoValue.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§
                                </div>
                                <div style="color: #64748b; font-size: 0.8rem;">
                                    IPO í‰ê°€ê°€ì¹˜
                                </div>
                            </div>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-bottom: 15px; font-size: 0.85rem;">
                            <div>
                                <span style="color: #64748b;">ì›” ìˆ˜ìµ:</span>
                                <div style="color: var(--success); font-weight: 600;">${business.profit.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§</div>
                            </div>
                            <div>
                                <span style="color: #64748b;">ì§ì› ìˆ˜:</span>
                                <div style="color: #e2e8f0; font-weight: 600;">${business.employees}ëª…</div>
                            </div>
                            <div>
                                <span style="color: #64748b;">í˜„ì¬ ê°€ì¹˜:</span>
                                <div style="color: #cbd5e1; font-weight: 600;">${business.value.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§</div>
                            </div>
                        </div>

                        <div style="background: rgba(99, 102, 241, 0.1); border: 1px solid rgba(99, 102, 241, 0.2); border-radius: 8px; padding: 12px; font-size: 0.85rem;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                <span style="color: #64748b;">ì˜ˆìƒ ìê¸ˆì¡°ë‹¬ (${minEquity}%~${maxEquity}%):</span>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span style="color: var(--success); font-weight: 600;">
                                    ${Math.floor(ipoValue * minEquity / 100).toLocaleString()} ~ ${Math.floor(ipoValue * maxEquity / 100).toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§
                                </span>
                            </div>
                            ${!canAfford ? `<div style="color: var(--danger); font-size: 0.8rem; margin-top: 8px;">âš ï¸ ìƒì¥ ë¹„ìš© ${ipoCost.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§ ë¶€ì¡±</div>` : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }

        function selectBusinessForIPO(businessId) {
            const business = gameState.roleData.businesses.find(b => b.id === businessId);
            if (!business) return;

            const ipoValue = Math.floor(business.value * 1.4); // IPO í”„ë¦¬ë¯¸ì—„ 40%
            const ipoCost = 50000;

            const modalContent = `
                <h2 style="text-align: center; margin-bottom: 30px; color: var(--primary);">ğŸ›ï¸ ${business.name} IPO ì„¤ì •</h2>
                
                <div style="background: rgba(99, 102, 241, 0.1); border: 1px solid rgba(99, 102, 241, 0.3); border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px; font-size: 0.9rem;">
                        <div><span style="color: #64748b;">íšŒì‚¬ëª…:</span> <span style="color: #e2e8f0; font-weight: 600;">${business.name}</span></div>
                        <div><span style="color: #64748b;">ì—…ì¢…:</span> <span style="color: #e2e8f0; font-weight: 600;">${business.sector}</span></div>
                        <div><span style="color: #64748b;">í˜„ì¬ ê°€ì¹˜:</span> <span style="color: #e2e8f0; font-weight: 600;">${business.value.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§</span></div>
                        <div><span style="color: #64748b;">IPO í‰ê°€ê°€ì¹˜:</span> <span style="color: var(--success); font-weight: 600;">${ipoValue.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§</span></div>
                    </div>
                    <div style="background: rgba(16, 185, 129, 0.1); border: 1px solid rgba(16, 185, 129, 0.3); border-radius: 8px; padding: 12px;">
                        <div style="color: var(--success); font-weight: 600; margin-bottom: 5px;">ğŸ’° IPO í”„ë¦¬ë¯¸ì—„ +40%</div>
                        <div style="color: #64748b; font-size: 0.85rem;">ìƒì¥ì„ í†µí•´ ê¸°ì—… ê°€ì¹˜ê°€ ${(business.value * 0.4).toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§ ìƒìŠ¹í•©ë‹ˆë‹¤</div>
                    </div>
                </div>

                <div style="background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                    <h3 style="color: var(--primary); margin-bottom: 15px;">ğŸ“Š ì§€ë¶„ ê³µê°œ ì„¤ì •</h3>
                    
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; color: #cbd5e1; margin-bottom: 10px;">ê³µê°œí•  ì§€ë¶„ ë¹„ìœ¨:</label>
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <input type="range" id="equitySlider" min="25" max="75" value="40" 
                                   style="flex: 1; height: 8px; background: rgba(255,255,255,0.2); border-radius: 4px; outline: none;"
                                   oninput="updateIPOPreview(${businessId})">
                            <input type="number" id="equityInput" min="25" max="75" value="40" 
                                   style="width: 80px; padding: 8px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); 
                                          border-radius: 4px; color: #e2e8f0; text-align: center;"
                                   oninput="updateIPOPreview(${businessId})">
                            <span style="color: #64748b;">%</span>
                        </div>
                    </div>

                    <div id="ipoPreview" style="background: rgba(99, 102, 241, 0.1); border: 1px solid rgba(99, 102, 241, 0.2); border-radius: 8px; padding: 15px;">
                        <!-- IPO ë¯¸ë¦¬ë³´ê¸°ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                    </div>
                </div>

                <div style="background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.3); border-radius: 12px; padding: 15px; margin-bottom: 20px;">
                    <div style="color: var(--danger); font-weight: 600; margin-bottom: 8px;">âš ï¸ IPO ìœ„í—˜ ì‚¬í•­</div>
                    <ul style="color: #cbd5e1; font-size: 0.9rem; margin: 0; padding-left: 20px;">
                        <li>ìƒì¥ í›„ ì§€ë¶„ ë¹„ìœ¨ë§Œí¼ ì›” ìˆ˜ìµì´ ê°ì†Œí•©ë‹ˆë‹¤</li>
                        <li>ì‹œì¥ ë³€ë™ì— ë”°ë¼ ì£¼ì‹ ê°€ì¹˜ê°€ ë³€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</li>
                        <li>ìƒì¥ ë¹„ìš© ${ipoCost.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§ì´ ì†Œìš”ë©ë‹ˆë‹¤</li>
                        <li>ìƒì¥ ì‹¤íŒ¨ ì‹œ ë¹„ìš©ì˜ 50%ë§Œ íšŒìˆ˜ë©ë‹ˆë‹¤</li>
                    </ul>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 30px;">
                    <button onclick="openIPOModal()" style="
                        padding: 12px 20px;
                        border: 1px solid rgba(255,255,255,0.2);
                        background: rgba(255,255,255,0.05);
                        color: #e2e8f0;
                        border-radius: 8px;
                        cursor: pointer;
                        transition: all 0.3s ease;
                    ">ë‹¤ë¥¸ ê¸°ì—… ì„ íƒ</button>
                    
                    <button onclick="executeIPO(${businessId})" style="
                        padding: 12px 20px;
                        border: none;
                        background: var(--primary);
                        color: white;
                        border-radius: 8px;
                        cursor: pointer;
                        font-weight: 600;
                        transition: all 0.3s ease;
                    ">IPO ì§„í–‰</button>
                </div>
            `;

            showModal(modalContent);
            updateIPOPreview(businessId);
        }

        function updateIPOPreview(businessId) {
            const business = gameState.roleData.businesses.find(b => b.id === businessId);
            if (!business) return;

            const slider = document.getElementById('equitySlider');
            const input = document.getElementById('equityInput');
            const preview = document.getElementById('ipoPreview');

            if (!slider || !input || !preview) return;

            // ìŠ¬ë¼ì´ë”ì™€ ì…ë ¥ê°’ ë™ê¸°í™”
            const equityPercent = parseFloat(slider.value);
            input.value = equityPercent;
            slider.value = equityPercent;

            const ipoValue = Math.floor(business.value * 1.4);
            const fundingAmount = Math.floor(ipoValue * equityPercent / 100);
            const remainingEquity = 100 - equityPercent;
            const newMonthlyProfit = Math.floor(business.profit * (remainingEquity / 100));
            const profitReduction = business.profit - newMonthlyProfit;

            preview.innerHTML = `
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; font-size: 0.9rem;">
                    <div>
                        <span style="color: #64748b;">ì¡°ë‹¬ ìê¸ˆ:</span>
                        <div style="color: var(--success); font-weight: 600; font-size: 1.1rem;">${fundingAmount.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§</div>
                    </div>
                    <div>
                        <span style="color: #64748b;">ë³´ìœ  ì§€ë¶„:</span>
                        <div style="color: #e2e8f0; font-weight: 600; font-size: 1.1rem;">${remainingEquity}%</div>
                    </div>
                    <div>
                        <span style="color: #64748b;">ì‹ ê·œ ì›” ìˆ˜ìµ:</span>
                        <div style="color: var(--success); font-weight: 600;">${newMonthlyProfit.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§</div>
                    </div>
                    <div>
                        <span style="color: #64748b;">ìˆ˜ìµ ê°ì†Œ:</span>
                        <div style="color: var(--danger); font-weight: 600;">-${profitReduction.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§</div>
                    </div>
                </div>
            `;
        }

        function executeIPO(businessId) {
            const business = gameState.roleData.businesses.find(b => b.id === businessId);
            if (!business) return;

            const equityPercent = parseFloat(document.getElementById('equityInput').value);
            const ipoCost = 50000;

            if (gameState.currentUser.game_balance < ipoCost) {
                showNotification(`IPO ì§„í–‰ì„ ìœ„í•´ ${ipoCost.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§ì´ í•„ìš”í•©ë‹ˆë‹¤`, 'error');
                return;
            }

            gameState.currentUser.game_balance -= ipoCost;

            // IPO ì„±ê³µë¥ : ê¸°ì—… ë ˆë²¨ê³¼ ê°€ì¹˜ì— ë”°ë¼ ê²°ì •
            const baseSuccessRate = 0.7;
            const levelBonus = business.level * 0.05;
            const valueBonus = business.value > 500000 ? 0.1 : business.value > 200000 ? 0.05 : 0;
            const successRate = Math.min(baseSuccessRate + levelBonus + valueBonus, 0.95);

            const isSuccess = Math.random() < successRate;

            closeModal();

            if (isSuccess) {
                // IPO ì„±ê³µ
                const ipoValue = Math.floor(business.value * 1.4);
                const fundingAmount = Math.floor(ipoValue * equityPercent / 100);
                const remainingEquity = 100 - equityPercent;

                gameState.currentUser.game_balance += fundingAmount;
                business.profit = Math.floor(business.profit * (remainingEquity / 100));
                business.value = ipoValue;
                business.isPublic = true;
                business.publicShares = Math.floor(business.shares * equityPercent / 100);
                business.stockPrice = Math.floor(ipoValue / business.shares);

                // ìƒì¥ ê¸°ì—… ì •ë³´ ì—…ë°ì´íŠ¸
                gameState.roleData.publicCompany = {
                    businessId: business.id,
                    name: business.name,
                    stockPrice: business.stockPrice,
                    shares: business.publicShares,
                    equityPercent: equityPercent,
                    ipoDate: new Date().toISOString().split('T')[0]
                };

                updateBusinessDisplay();
                updateDisplay();
                showNotification(`ğŸ‰ ${business.name} IPO ì„±ê³µ! ${fundingAmount.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§ì„ ì¡°ë‹¬í–ˆìŠµë‹ˆë‹¤!`, 'success');
            } else {
                // IPO ì‹¤íŒ¨
                const recoveredAmount = Math.floor(ipoCost * 0.5);
                gameState.currentUser.game_balance += recoveredAmount;
                updateDisplay();
                showNotification(`âŒ ${business.name} IPO ì‹¤íŒ¨... ì‹œì¥ ìƒí™©ì´ ì¢‹ì§€ ì•ŠìŠµë‹ˆë‹¤. ${recoveredAmount.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§ë§Œ íšŒìˆ˜í–ˆìŠµë‹ˆë‹¤.`, 'error');
            }
        }
        
        // IPO ê³„ì‚° ì—…ë°ì´íŠ¸
        function updateIPOCalculation() {
            const slider = document.getElementById('equitySlider');
            const input = document.getElementById('equityInput');
            
            // ìŠ¬ë¼ì´ë”ì™€ ì…ë ¥ê°’ ë™ê¸°í™”
            if (document.activeElement === slider) {
                input.value = slider.value;
            } else if (document.activeElement === input) {
                slider.value = input.value;
            }
            
            const equityPercent = parseFloat(input.value);
            const mainBusiness = gameState.roleData.businesses[0];
            
            // 40% IPO í”„ë¦¬ë¯¸ì—„ ì ìš©
            const companyValueWithPremium = Math.floor(mainBusiness.value * 1.4);
            const totalShares = 1000000;
            const stockPrice = Math.floor(companyValueWithPremium / totalShares);
            const capitalRaise = Math.floor(companyValueWithPremium * (equityPercent / 100));
            const remainingOwnership = 100 - equityPercent;
            
            document.getElementById('expectedRaise').textContent = capitalRaise.toLocaleString() + ' ë¹„íŠ¸í¬ë ˆë”§';
            document.getElementById('expectedStockPrice').textContent = stockPrice.toLocaleString() + 'ì›';
            document.getElementById('remainingOwnership').textContent = remainingOwnership.toFixed(1) + '%';
        }
        
        // IPO ì‹¤í–‰
        function executeIPO() {
            const equityPercent = parseFloat(document.getElementById('equityInput').value);
            const mainBusiness = gameState.roleData.businesses[0];
            const ipoCost = 50000;
            
            // ìƒì¥ ì§„í–‰
            gameState.currentUser.game_balance -= ipoCost;
            
            // 40% IPO í”„ë¦¬ë¯¸ì—„ìœ¼ë¡œ ìë³¸ ì¡°ë‹¬
            const companyValueWithPremium = Math.floor(mainBusiness.value * 1.4);
            const capitalRaise = Math.floor(companyValueWithPremium * (equityPercent / 100));
            gameState.currentUser.game_balance += capitalRaise;
            
            // ìƒì¥ ê¸°ì—… ì •ë³´ ìƒì„±
            const totalShares = 1000000; // ì´ ë°œí–‰ ì£¼ì‹ 100ë§Œì£¼
            const sharesOffered = Math.floor(totalShares * (equityPercent / 100));
            const stockPrice = Math.floor(companyValueWithPremium / totalShares);
            
            gameState.roleData.publicCompany = {
                name: mainBusiness.name,
                sector: mainBusiness.type,
                stockPrice: stockPrice,
                totalShares: totalShares,
                publicShares: sharesOffered,
                ownerShares: totalShares - sharesOffered,
                marketCap: stockPrice * totalShares,
                baseValue: mainBusiness.value,
                dailyChangeAccumulated: 0
            };
            
            // ì‚¬ì—… ì •ë³´ ì—…ë°ì´íŠ¸ (ìƒì¥ íš¨ê³¼)
            mainBusiness.value = Math.floor(mainBusiness.value * 1.3); // 30% ê°€ì¹˜ ì¦ê°€
            mainBusiness.profit = Math.floor(mainBusiness.profit * 1.2); // 20% ìˆ˜ìµ ì¦ê°€
            mainBusiness.isPublic = true;
            
            // ì£¼ì‹ ì‹œì¥ì— ì¶”ê°€
            gameState.stockMarket.stocks.push({
                name: mainBusiness.name,
                price: stockPrice,
                change: 0,
                sector: mainBusiness.type,
                isUserCompany: true,
                dailyChangeAccumulated: 0
            });
            
            closeIPOModal();
            updateBusinessDisplay();
            updatePublicCompanyDisplay();
            updateMarketDisplay();
            
            showNotification(`ğŸ‰ ${mainBusiness.name} ìƒì¥ ì„±ê³µ!\nì¡°ë‹¬ì•¡: +${capitalRaise.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§\nì§€ë¶„ í¬ì„: ${equityPercent}%\nì£¼ì‹ ì‹œì„¸: ${stockPrice.toLocaleString()}ì›`, 'success');
        }
        
        // IPO ëª¨ë‹¬ ë‹«ê¸°
        function closeIPOModal() {
            document.getElementById('ipoModal').style.display = 'none';
        }
        
        // ìœ ìƒì¦ì ì‹œìŠ¤í…œ
        function rightOffering() {
            if (!gameState.roleData.publicCompany) {
                showNotification('ìƒì¥ëœ ê¸°ì—…ì´ ì—†ìŠµë‹ˆë‹¤', 'error');
                return;
            }
            
            const company = gameState.roleData.publicCompany;
            
            // ì¦ì ëª¨ë‹¬ ì—´ê¸°
            document.getElementById('currentStockPrice').textContent = company.stockPrice.toLocaleString() + 'ì›';
            document.getElementById('currentOwnership').textContent = ((company.ownerShares / company.totalShares) * 100).toFixed(1) + '%';
            document.getElementById('currentMarketCap').textContent = company.marketCap.toLocaleString() + ' ë¹„íŠ¸í¬ë ˆë”§';
            document.getElementById('rightsModal').style.display = 'flex';
            updateRightsCalculation();
        }
        
        // ì¦ì ê³„ì‚° ì—…ë°ì´íŠ¸
        function updateRightsCalculation() {
            const slider = document.getElementById('rightsEquitySlider');
            const input = document.getElementById('rightsEquityInput');
            
            // ìŠ¬ë¼ì´ë”ì™€ ì…ë ¥ê°’ ë™ê¸°í™”
            if (document.activeElement === slider) {
                input.value = slider.value;
            } else if (document.activeElement === input) {
                slider.value = input.value;
            }
            
            const additionalEquity = parseFloat(input.value);
            const company = gameState.roleData.publicCompany;
            
            // í˜„ì¬ ì†Œìœ  ì§€ë¶„ìœ¨
            const currentOwnershipPercent = (company.ownerShares / company.totalShares) * 100;
            
            // ì¦ì í›„ ì§€ë¶„ìœ¨ ê³„ì‚° (í¬ì„ íš¨ê³¼)
            const newOwnershipPercent = currentOwnershipPercent * (100 / (100 + additionalEquity));
            
            // ì‹ ì£¼ ë°œí–‰ê°€ (í˜„ì¬ ì£¼ê°€ì˜ 85% - í• ì¸ ë°œí–‰)
            const rightsPrice = Math.floor(company.stockPrice * 0.85);
            
            // ì¡°ë‹¬ ì˜ˆìƒì•¡
            const newShares = Math.floor(company.totalShares * (additionalEquity / 100));
            const expectedRaise = newShares * rightsPrice;
            
            document.getElementById('rightsExpectedRaise').textContent = expectedRaise.toLocaleString() + ' ë¹„íŠ¸í¬ë ˆë”§';
            document.getElementById('rightsNewOwnership').textContent = newOwnershipPercent.toFixed(1) + '%';
            document.getElementById('rightsPrice').textContent = rightsPrice.toLocaleString() + 'ì›';
        }
        
        // ìœ ìƒì¦ì ì‹¤í–‰
        function executeRightsOffering() {
            const additionalEquity = parseFloat(document.getElementById('rightsEquityInput').value);
            const company = gameState.roleData.publicCompany;
            
            // ì‹ ì£¼ ë°œí–‰ ê³„ì‚°
            const rightsPrice = Math.floor(company.stockPrice * 0.85);
            const newShares = Math.floor(company.totalShares * (additionalEquity / 100));
            const capitalRaise = newShares * rightsPrice;
            
            // ìë³¸ ì¡°ë‹¬
            gameState.currentUser.game_balance += capitalRaise;
            
            // ì£¼ì‹ ì •ë³´ ì—…ë°ì´íŠ¸
            company.totalShares += newShares;
            company.publicShares += newShares; // ëª¨ë“  ì‹ ì£¼ëŠ” ê³µê°œë¨
            company.marketCap = company.stockPrice * company.totalShares;
            
            // ì£¼ì‹ ì‹œì¥ì—ì„œ ì—…ë°ì´íŠ¸
            const marketStock = gameState.stockMarket.stocks.find(s => s.isUserCompany);
            if (marketStock) {
                // ì¦ìë¡œ ì¸í•œ ì£¼ê°€ í•˜ë½ (10-15%)
                const priceDecline = 0.85 + Math.random() * 0.1; // 85-95%
                company.stockPrice = Math.floor(company.stockPrice * priceDecline);
                marketStock.price = company.stockPrice;
                marketStock.change = ((priceDecline - 1) * 100);
            }
            
            closeRightsModal();
            updatePublicCompanyDisplay();
            updateMarketDisplay();
            
            showNotification(`ğŸ’ ìœ ìƒì¦ì ì™„ë£Œ!\nì¡°ë‹¬ì•¡: +${capitalRaise.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§\nì‹ ì£¼ ë°œí–‰: ${newShares.toLocaleString()}ì£¼\nì§€ë¶„ í¬ì„: ${additionalEquity}%`, 'success');
        }
        
        // ì¦ì ëª¨ë‹¬ ë‹«ê¸°
        function closeRightsModal() {
            document.getElementById('rightsModal').style.display = 'none';
        }
        
        // ìì‚¬ì£¼ ë§¤ì…
        function buyBackShares() {
            if (!gameState.roleData.publicCompany) {
                showNotification('ìƒì¥ëœ ê¸°ì—…ì´ ì—†ìŠµë‹ˆë‹¤', 'error');
                return;
            }
            
            const company = gameState.roleData.publicCompany;
            const sharesAvailable = company.publicShares;
            
            if (sharesAvailable === 0) {
                showNotification('ë§¤ì… ê°€ëŠ¥í•œ ê³µê°œ ì£¼ì‹ì´ ì—†ìŠµë‹ˆë‹¤', 'info');
                return;
            }
            
            const sharesToBuy = Math.min(50000, sharesAvailable); // ìµœëŒ€ 5ë§Œì£¼
            const buybackCost = sharesToBuy * company.stockPrice;
            
            if (gameState.currentUser.game_balance < buybackCost) {
                showNotification(`ìì‚¬ì£¼ ë§¤ì…ì— ${buybackCost.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§ì´ í•„ìš”í•©ë‹ˆë‹¤`, 'error');
                return;
            }
            
            // ìì‚¬ì£¼ ë§¤ì… ì‹¤í–‰
            gameState.currentUser.game_balance -= buybackCost;
            company.ownerShares += sharesToBuy;
            company.publicShares -= sharesToBuy;
            
            // ì£¼ì‹ ê°€ê²© ìƒìŠ¹ íš¨ê³¼ (10-20%)
            const priceIncrease = 1.1 + Math.random() * 0.1;
            company.stockPrice = Math.floor(company.stockPrice * priceIncrease);
            company.marketCap = company.stockPrice * company.totalShares;
            
            // ì£¼ì‹ ì‹œì¥ì—ì„œ ê°€ê²© ì—…ë°ì´íŠ¸
            const marketStock = gameState.stockMarket.stocks.find(s => s.isUserCompany);
            if (marketStock) {
                const oldPrice = marketStock.price;
                marketStock.price = company.stockPrice;
                marketStock.change = ((marketStock.price / oldPrice) - 1) * 100;
            }
            
            updatePublicCompanyDisplay();
            updateMarketDisplay();
            
            showNotification(`ìì‚¬ì£¼ ${sharesToBuy.toLocaleString()}ì£¼ ë§¤ì… ì™„ë£Œ!\nì§€ë¶„ìœ¨: ${((company.ownerShares / company.totalShares) * 100).toFixed(1)}%\nì£¼ê°€ ìƒìŠ¹: +${((priceIncrease - 1) * 100).toFixed(1)}%`, 'success');
        }
        
        // ìƒì¥ ê¸°ì—… ì •ë³´ ì—…ë°ì´íŠ¸
        function updatePublicCompanyDisplay() {
            const company = gameState.roleData.publicCompany;
            if (!company) {
                document.getElementById('publicCompanyInfo').style.display = 'none';
                return;
            }
            
            document.getElementById('publicCompanyInfo').style.display = 'block';
            document.getElementById('stockPrice').textContent = company.stockPrice.toLocaleString() + 'ì›';
            document.getElementById('marketCap').textContent = company.marketCap.toLocaleString();
            document.getElementById('ownershipPercent').textContent = ((company.ownerShares / company.totalShares) * 100).toFixed(1) + '%';
            document.getElementById('totalShares').textContent = company.totalShares.toLocaleString() + 'ì£¼';
        }
        
        function showSection(section) {
            document.querySelectorAll('.content-section').forEach(sec => {
                sec.style.display = 'none';
            });
            
            document.getElementById(`${section}-section`).style.display = 'block';
            
            document.querySelectorAll('.menu-item').forEach(item => {
                item.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // ë¦¬ë”ë³´ë“œ ì„¹ì…˜ì¸ ê²½ìš° ë°ì´í„° ë¡œë“œ
            if (section === 'leaderboard') {
                loadLeaderboard();
            } else if (section === 'p2p') {
                loadP2PMarketplace();
            } else if (section === 'labor') {
                loadLaborMarket();
            }
        }

        function loadLeaderboard() {
            // ê°€ìƒì˜ ë¦¬ë”ë³´ë“œ ë°ì´í„° ìƒì„±
            const leaderboardData = [
                { rank: 1, username: 'íˆ¬ìì™•ê¹€ì”¨', role: 'investor', balance: 15420000, businesses: 8 },
                { rank: 2, username: 'ì‚¬ì—…ê°€ë°•ì”¨', role: 'entrepreneur', balance: 12800000, businesses: 12 },
                { rank: 3, username: 'ì€í–‰ê°€ì´ì”¨', role: 'banker', balance: 11200000, businesses: 5 },
                { rank: 4, username: 'ì›Œì»¤ìµœì”¨', role: 'worker', balance: 8900000, businesses: 3 },
                { rank: 5, username: 'ìºí”¼íƒˆì •ì”¨', role: 'entrepreneur', balance: 7600000, businesses: 9 },
                { rank: 6, username: 'ê¸ˆìœµì „ë¬¸ê°€', role: 'banker', balance: 6800000, businesses: 4 },
                { rank: 7, username: 'ìŠ¤íƒ€íŠ¸ì—…í™ì”¨', role: 'entrepreneur', balance: 5900000, businesses: 7 },
                { rank: 8, username: 'íˆ¬ìë§ˆë‹ˆì•„', role: 'investor', balance: 4700000, businesses: 2 },
                { rank: 9, username: 'ì§ì¥ì¸ê°•ì”¨', role: 'worker', balance: 3800000, businesses: 1 },
                { rank: 10, username: 'ë¹„ì¦ˆë‹ˆìŠ¤í‚¹', role: 'entrepreneur', balance: 3200000, businesses: 6 }
            ];

            // í˜„ì¬ ì‚¬ìš©ì ì¶”ê°€ (11ìœ„ë¡œ)
            if (gameState.currentUser) {
                leaderboardData.push({
                    rank: 11,
                    username: gameState.currentUser.username,
                    role: gameState.currentUser.role,
                    balance: gameState.roleData.balance,
                    businesses: gameState.roleData.businesses ? gameState.roleData.businesses.length : 0,
                    isCurrentUser: true
                });
            }

            const roleNames = {
                'entrepreneur': 'ì‚¬ì—…ê°€',
                'banker': 'ì€í–‰ê°€',
                'investor': 'íˆ¬ìì',
                'worker': 'ì§ì¥ì¸'
            };

            const roleColors = {
                'entrepreneur': '#ef4444',
                'banker': '#3b82f6',
                'investor': '#10b981',
                'worker': '#f59e0b'
            };

            const leaderboardHtml = leaderboardData.map(player => `
                <div style="
                    background: ${player.isCurrentUser ? 'linear-gradient(135deg, rgba(99, 102, 241, 0.2), rgba(139, 92, 246, 0.2))' : 'rgba(71, 85, 105, 0.1)'};
                    border: ${player.isCurrentUser ? '2px solid var(--primary)' : '1px solid rgba(71, 85, 105, 0.3)'};
                    border-radius: 12px; padding: 15px; margin-bottom: 10px;
                    display: flex; align-items: center; justify-content: space-between;
                    ${player.isCurrentUser ? 'position: relative; transform: scale(1.02);' : ''}
                ">
                    ${player.isCurrentUser ? '<div style="position: absolute; top: -8px; left: 50%; transform: translateX(-50%); background: var(--primary); color: white; padding: 4px 12px; border-radius: 15px; font-size: 0.7rem; font-weight: 600;">ë‚´ ìˆœìœ„</div>' : ''}
                    
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <div style="
                            background: ${player.rank <= 3 ? (player.rank === 1 ? '#fbbf24' : player.rank === 2 ? '#94a3b8' : '#cd7f32') : '#64748b'};
                            color: white; width: 35px; height: 35px; border-radius: 50%;
                            display: flex; align-items: center; justify-content: center;
                            font-weight: bold; font-size: ${player.rank <= 3 ? '1.1rem' : '0.9rem'};
                        ">
                            ${player.rank <= 3 ? (player.rank === 1 ? 'ğŸ¥‡' : player.rank === 2 ? 'ğŸ¥ˆ' : 'ğŸ¥‰') : player.rank}
                        </div>
                        
                        <div>
                            <div style="color: #e2e8f0; font-weight: bold; margin-bottom: 4px;">${player.username}</div>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <span style="
                                    background: ${roleColors[player.role]}; color: white;
                                    padding: 2px 8px; border-radius: 12px; font-size: 0.7rem; font-weight: 600;
                                ">${roleNames[player.role]}</span>
                                <span style="color: #94a3b8; font-size: 0.8rem;">ì‚¬ì—… ${player.businesses}ê°œ</span>
                            </div>
                        </div>
                    </div>
                    
                    <div style="text-align: right;">
                        <div style="color: var(--success); font-weight: bold; font-size: 1.1rem;">
                            ${player.balance.toLocaleString()}
                        </div>
                        <div style="color: #94a3b8; font-size: 0.8rem;">ë¹„íŠ¸í¬ë ˆë”§</div>
                    </div>
                </div>
            `).join('');

            document.getElementById('leaderboardList').innerHTML = leaderboardHtml;
        }
        
        // P2P ë§ˆì¼“í”Œë ˆì´ìŠ¤ ê´€ë ¨ í•¨ìˆ˜ë“¤
        function loadP2PMarketplace() {
            // ê°€ìƒì˜ P2P ê±°ë˜ ë°ì´í„° ìƒì„± (í˜„ì‹¤ì ì¸ í”Œë ˆì´ì–´ê°„ ê±°ë˜ ì‹œë®¬ë ˆì´ì…˜)
            generateSampleP2PListings();
            displayP2PListings('all');
            updateP2PSellableAssets();
        }
        
        function generateSampleP2PListings() {
            // ê¸°ì¡´ ëª©ë¡ ì´ˆê¸°í™” í›„ ìƒˆë¡œìš´ ìƒ˜í”Œ ë°ì´í„° ìƒì„±
            gameState.p2pMarket.listings = [];
            
            const sampleBusinesses = [
                { name: 'AI ìŠ¤íƒ€íŠ¸ì—…', type: 'business', subType: 'tech_startup', profit: 8500, employees: 12, value: 180000, price: 220000, sellerName: 'TechGuru2024', description: 'ChatGPT ê²½ìŸ ì„œë¹„ìŠ¤ ê°œë°œ ì¤‘. ì›” 8.5M ìˆ˜ìµ, ì„±ì¥ì„± ë†’ìŒ' },
                { name: 'ê°•ë‚¨ ì¹´í˜', type: 'business', subType: 'cafe', profit: 4200, employees: 6, value: 85000, price: 110000, sellerName: 'CafeKing', description: 'ê°•ë‚¨ì—­ ë„ë³´ 2ë¶„, ë‹¨ê³¨ ë§ìŒ. ì•ˆì •ì  ìˆ˜ìµ ë³´ì¥' },
                { name: 'Eì»¤ë¨¸ìŠ¤ ì‡¼í•‘ëª°', type: 'business', subType: 'ecommerce', profit: 12000, employees: 8, value: 250000, price: 320000, sellerName: 'ShopMaster', description: 'íŒ¨ì…˜ ì „ë¬¸ëª°, ì›” 1200ë§Œì› ìˆ˜ìµ. ë¸Œëœë“œ ê°€ì¹˜ ë†’ìŒ' },
                { name: 'ì œì¡°ì—…ì²´', type: 'business', subType: 'manufacturing', profit: 15000, employees: 25, value: 400000, price: 480000, sellerName: 'Factory_Owner', description: 'ìë™ì°¨ ë¶€í’ˆ ì œì¡°. ëŒ€ê¸°ì—… ë‚©í’ˆ ê³„ì•½ ë³´ìœ ' }
            ];
            
            const sampleInvestments = [
                { name: 'ì‚¼ì„±ì „ì ëŒ€ëŸ‰ ë³´ìœ ', type: 'investment', subType: 'stock', amount: 500000, returnRate: 0.15, price: 580000, sellerName: 'StockPro', description: 'ì‚¼ì„±ì „ì ì£¼ì‹ ëŒ€ëŸ‰ ë³´ìœ ë¶„. 15% ìˆ˜ìµë¥  ë‹¬ì„±' },
                { name: 'Bitcoin í¬ì§€ì…˜', type: 'investment', subType: 'crypto', amount: 800000, returnRate: 0.25, price: 1050000, sellerName: 'CryptoWhale', description: 'ë¹„íŠ¸ë¹„íŠ¸í¬ë ˆë”§ 80ë§Œì› ì–´ì¹˜, 25% ìˆ˜ìµ ì¤‘' },
                { name: 'ë¶€ë™ì‚° íˆ¬ì', type: 'investment', subType: 'realestate', amount: 1200000, returnRate: 0.08, price: 1300000, sellerName: 'RealEstate_King', description: 'ê°•ë‚¨ ì˜¤í”¼ìŠ¤í…”, ì›” ì„ëŒ€ìˆ˜ìµ 8%' },
                { name: 'Tech ETF í¬íŠ¸í´ë¦¬ì˜¤', type: 'investment', subType: 'stock', amount: 350000, returnRate: 0.18, price: 420000, sellerName: 'ETF_Investor', description: 'NASDAQ í…Œí¬ ETF ë¶„ì‚°íˆ¬ì' }
            ];
            
            // ì‚¬ì—…ì²´ì™€ íˆ¬ì ìì‚°ì„ P2P ëª©ë¡ì— ì¶”ê°€
            [...sampleBusinesses, ...sampleInvestments].forEach((item, index) => {
                gameState.p2pMarket.listings.push({
                    id: `p2p_${Date.now()}_${index}`,
                    ...item,
                    listedAt: new Date(Date.now() - Math.random() * 86400000 * 7), // ìµœê·¼ 7ì¼ ë‚´ ë“±ë¡
                    views: Math.floor(Math.random() * 50) + 5,
                    sellerId: `user_${Math.floor(Math.random() * 1000)}`
                });
            });
        }
        
        function showP2PTab(tab) {
            // íƒ­ ë²„íŠ¼ ìŠ¤íƒ€ì¼ ì—…ë°ì´íŠ¸
            document.querySelectorAll('#p2p-section .btn').forEach(btn => {
                btn.className = btn.className.includes('p2p') ? 'btn btn-secondary' : btn.className;
            });
            document.getElementById(`p2p${tab.charAt(0).toUpperCase() + tab.slice(1)}Tab`).className = 'btn';
            
            // íƒ­ ì»¨í…ì¸  í‘œì‹œ/ìˆ¨ê¹€
            document.getElementById('p2pBrowseContent').style.display = tab === 'browse' ? 'block' : 'none';
            document.getElementById('p2pSellContent').style.display = tab === 'sell' ? 'block' : 'none';
            document.getElementById('p2pHistoryContent').style.display = tab === 'history' ? 'block' : 'none';
            
            if (tab === 'browse') {
                displayP2PListings('all');
            } else if (tab === 'sell') {
                updateP2PSellableAssets();
            } else if (tab === 'history') {
                displayP2PTransactionHistory();
            }
        }
        
        function filterP2PListings(category) {
            // í•„í„° ë²„íŠ¼ ìŠ¤íƒ€ì¼ ì—…ë°ì´íŠ¸
            document.querySelectorAll('#p2pBrowseContent .btn-sm').forEach(btn => {
                btn.className = 'btn btn-sm btn-secondary';
            });
            document.getElementById(`filter${category.charAt(0).toUpperCase() + category.slice(1)}`).className = 'btn btn-sm';
            document.getElementById(`filter${category.charAt(0).toUpperCase() + category.slice(1)}`).style.background = 'var(--primary)';
            
            displayP2PListings(category);
        }
        
        function displayP2PListings(category) {
            const listings = gameState.p2pMarket.listings.filter(item => {
                if (category === 'all') return true;
                if (category === 'business') return item.type === 'business';
                if (category === 'investment') return item.type === 'investment';
                if (category === 'land') return item.type === 'land';
                return true;
            });
            
            const listingsHtml = listings.map(listing => {
                const typeIcon = listing.type === 'business' ? 'ğŸ¢' : listing.type === 'investment' ? 'ğŸ“ˆ' : 'ğŸ ';
                const typeText = listing.type === 'business' ? 'ì‚¬ì—…ì²´' : listing.type === 'investment' ? 'íˆ¬ììì‚°' : 'ë¶€ë™ì‚°';
                
                return `
                    <div class="business-card" style="margin-bottom: 15px; cursor: pointer;" onclick="showP2PBuyModal(${JSON.stringify(listing).replace(/"/g, '&quot;')})">
                        <div class="business-header">
                            <div class="business-name">${typeIcon} ${listing.name}</div>
                            <div style="color: var(--primary); font-weight: bold;">${listing.price.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§</div>
                        </div>
                        <div style="font-size: 0.9rem; color: #94a3b8; margin: 8px 0;">
                            <div style="margin-bottom: 5px;">
                                <span style="background: rgba(59, 130, 246, 0.2); color: #60a5fa; padding: 2px 8px; border-radius: 12px; font-size: 0.8rem; margin-right: 8px;">
                                    ${typeText}
                                </span>
                                <span style="color: #cbd5e1;">íŒë§¤ì: ${listing.sellerName}</span>
                            </div>
                            ${listing.type === 'business' ? `
                                <div>â€¢ ì›” ìˆ˜ìµ: ${listing.profit.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§ | ì§ì›: ${listing.employees}ëª…</div>
                                <div>â€¢ ê¸°ì—… ê°€ì¹˜: ${listing.value.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§</div>
                            ` : `
                                <div>â€¢ íˆ¬ìê¸ˆ: ${listing.amount.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§ | ìˆ˜ìµë¥ : ${(listing.returnRate * 100).toFixed(1)}%</div>
                            `}
                            <div style="font-size: 0.8rem; color: #64748b; margin-top: 8px;">
                                ${listing.description}
                            </div>
                            <div style="font-size: 0.8rem; color: #64748b; margin-top: 5px; display: flex; justify-content: space-between;">
                                <span>ğŸ‘€ ${listing.views}íšŒ ì¡°íšŒ</span>
                                <span>ğŸ“… ${new Date(listing.listedAt).toLocaleDateString()}</span>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            document.getElementById('p2pListings').innerHTML = listings.length > 0 ? listingsHtml : 
                '<div style="text-align: center; color: #64748b; padding: 40px;">ë“±ë¡ëœ ë§¤ë¬¼ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
        }
        
        function updateP2PSellableAssets() {
            // ë‚´ ì‚¬ì—…ì²´ ëª©ë¡
            const businessesHtml = gameState.roleData.businesses.map(business => `
                <div class="business-card" style="margin-bottom: 10px;">
                    <div class="business-header">
                        <div class="business-name">ğŸ¢ ${business.name}</div>
                        <div style="color: var(--success);">${(business.value * 1.2).toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§ (ê¶Œì¥)</div>
                    </div>
                    <div style="font-size: 0.9rem; color: #94a3b8; margin: 8px 0;">
                        <div>â€¢ ì›” ìˆ˜ìµ: ${business.profit.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§</div>
                        <div>â€¢ ì§ì›: ${business.employees}ëª…</div>
                    </div>
                    <button class="btn btn-sm" onclick="showP2PSellModal(${JSON.stringify(business).replace(/"/g, '&quot;')}, 'business')" style="width: 100%; margin-top: 10px;">
                        íŒë§¤ ë“±ë¡í•˜ê¸°
                    </button>
                </div>
            `).join('');
            
            // ë‚´ íˆ¬ììì‚° ëª©ë¡
            const investmentsHtml = gameState.roleData.investments.map(investment => `
                <div class="business-card" style="margin-bottom: 10px;">
                    <div class="business-header">
                        <div class="business-name">ğŸ“ˆ ${investment.name}</div>
                        <div style="color: var(--success);">${Math.floor(investment.amount * (1 + investment.returnRate)).toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§ (ê¶Œì¥)</div>
                    </div>
                    <div style="font-size: 0.9rem; color: #94a3b8; margin: 8px 0;">
                        <div>â€¢ íˆ¬ìê¸ˆ: ${investment.amount.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§</div>
                        <div>â€¢ í˜„ì¬ ìˆ˜ìµë¥ : ${(investment.returnRate * 100).toFixed(1)}%</div>
                    </div>
                    <button class="btn btn-sm" onclick="showP2PSellModal(${JSON.stringify(investment).replace(/"/g, '&quot;')}, 'investment')" style="width: 100%; margin-top: 10px;">
                        íŒë§¤ ë“±ë¡í•˜ê¸°
                    </button>
                </div>
            `).join('');
            
            document.getElementById('myBusinessesToSell').innerHTML = businessesHtml.length > 0 ? businessesHtml : 
                '<div style="text-align: center; color: #64748b; padding: 20px;">ë³´ìœ í•œ ì‚¬ì—…ì²´ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
                
            document.getElementById('myInvestmentsToSell').innerHTML = investmentsHtml.length > 0 ? investmentsHtml : 
                '<div style="text-align: center; color: #64748b; padding: 20px;">ë³´ìœ í•œ íˆ¬ììì‚°ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
        }
        
        function displayP2PTransactionHistory() {
            // ê°€ìƒì˜ ê±°ë˜ ë‚´ì—­ ë°ì´í„°
            const sampleHistory = [
                { type: 'buy', item: 'Tech ìŠ¤íƒ€íŠ¸ì—…', price: 150000, date: new Date(Date.now() - 86400000 * 2), counterparty: 'InvestorPro' },
                { type: 'sell', item: 'ì‚¼ì„±ì „ì ì£¼ì‹', price: 280000, date: new Date(Date.now() - 86400000 * 5), counterparty: 'StockTrader' },
                { type: 'buy', item: 'ê°•ë‚¨ ë¶€ë™ì‚°', price: 1200000, date: new Date(Date.now() - 86400000 * 10), counterparty: 'RealtyKing' }
            ];
            
            const historyHtml = sampleHistory.map(transaction => {
                const typeIcon = transaction.type === 'buy' ? 'ğŸ›’' : 'ğŸ’°';
                const typeText = transaction.type === 'buy' ? 'êµ¬ë§¤' : 'íŒë§¤';
                const typeColor = transaction.type === 'buy' ? 'var(--danger)' : 'var(--success)';
                
                return `
                    <div class="business-card" style="margin-bottom: 10px;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <div style="color: ${typeColor}; font-weight: bold; margin-bottom: 5px;">
                                    ${typeIcon} ${typeText}: ${transaction.item}
                                </div>
                                <div style="color: #94a3b8; font-size: 0.9rem;">
                                    ${transaction.type === 'buy' ? 'êµ¬ë§¤ì²˜' : 'íŒë§¤ì²˜'}: ${transaction.counterparty}
                                </div>
                                <div style="color: #64748b; font-size: 0.8rem;">
                                    ${transaction.date.toLocaleDateString()}
                                </div>
                            </div>
                            <div style="color: ${typeColor}; font-weight: bold; font-size: 1.1rem;">
                                ${transaction.type === 'buy' ? '-' : '+'}${transaction.price.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            document.getElementById('p2pTransactionHistory').innerHTML = historyHtml.length > 0 ? historyHtml :
                '<div style="text-align: center; color: #64748b; padding: 40px;">ê±°ë˜ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
        }
        
        function updateP2PSellPreview() {
            const price = parseInt(document.getElementById('p2pSellPrice').value) || 0;
            const type = window.currentP2PSellType || 'business';
            const fee = Math.floor(price * gameState.p2pMarket.fees[type + 'Sale']);
            const netReceive = price - fee;
            
            document.getElementById('sellPriceDisplay').textContent = price.toLocaleString() + ' ë¹„íŠ¸í¬ë ˆë”§';
            document.getElementById('sellFeeDisplay').textContent = '-' + fee.toLocaleString() + ' ë¹„íŠ¸í¬ë ˆë”§';
            document.getElementById('netReceiveDisplay').textContent = netReceive.toLocaleString() + ' ë¹„íŠ¸í¬ë ˆë”§';
        }
        
        function confirmP2PBuy(listingId) {
            const listing = gameState.p2pMarket.listings.find(l => l.id === listingId);
            if (!listing) {
                showNotification('ë§¤ë¬¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤', 'error');
                return;
            }
            
            const fee = listing.price * gameState.p2pMarket.fees[listing.type + 'Sale'];
            const totalCost = listing.price + fee;
            
            if (gameState.currentUser.game_balance < totalCost) {
                showNotification('êµ¬ë§¤ ìê¸ˆì´ ë¶€ì¡±í•©ë‹ˆë‹¤', 'error');
                return;
            }
            
            // ê²°ì œ ì²˜ë¦¬
            gameState.currentUser.game_balance -= totalCost;
            
            // ìì‚° ì¶”ê°€
            if (listing.type === 'business') {
                gameState.roleData.businesses.push({
                    id: Date.now(),
                    name: listing.name,
                    type: listing.subType,
                    profit: listing.profit,
                    employees: listing.employees,
                    value: listing.value,
                    monthlyExpenses: Math.floor(listing.profit * 0.6)
                });
            } else if (listing.type === 'investment') {
                gameState.roleData.investments.push({
                    type: listing.subType,
                    name: listing.name,
                    amount: listing.amount,
                    returnRate: listing.returnRate,
                    dividends: Math.floor(listing.amount * 0.002)
                });
            }
            
            // ê±°ë˜ ë‚´ì—­ ì¶”ê°€
            gameState.p2pMarket.transactions.push({
                type: 'buy',
                itemId: listing.id,
                itemName: listing.name,
                price: listing.price,
                fee: fee,
                buyerId: gameState.currentUser.username,
                sellerId: listing.sellerId,
                date: new Date()
            });
            
            // ë§¤ë¬¼ ëª©ë¡ì—ì„œ ì œê±°
            gameState.p2pMarket.listings = gameState.p2pMarket.listings.filter(l => l.id !== listingId);
            
            closeModal();
            showNotification(`${listing.name} êµ¬ë§¤ ì™„ë£Œ! (ì´ ${totalCost.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§ ê²°ì œ)`, 'success');
            updateDisplay();
            loadP2PMarketplace(); // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
        }
        
        function confirmP2PSell(assetId, type) {
            const price = parseInt(document.getElementById('p2pSellPrice').value);
            const description = document.getElementById('p2pSellDescription').value;
            
            if (!price || price < 1000) {
                showNotification('ìµœì†Œ 1,000 ë¹„íŠ¸í¬ë ˆë”§ ì´ìƒìœ¼ë¡œ ì„¤ì •í•´ì£¼ì„¸ìš”', 'error');
                return;
            }
            
            let asset;
            if (type === 'business') {
                asset = gameState.roleData.businesses.find(b => b.id === assetId || b.name === assetId);
            } else if (type === 'investment') {
                asset = gameState.roleData.investments.find(i => i.name === assetId);
            }
            
            if (!asset) {
                showNotification('ìì‚°ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤', 'error');
                return;
            }
            
            // P2P ë§¤ë¬¼ë¡œ ë“±ë¡
            const listing = {
                id: `p2p_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
                name: asset.name,
                type: type,
                subType: asset.type || 'unknown',
                price: price,
                description: description,
                sellerName: gameState.currentUser.username,
                sellerId: gameState.currentUser.username,
                listedAt: new Date(),
                views: 0,
                ...asset
            };
            
            gameState.p2pMarket.listings.push(listing);
            
            // ë‚´ ìì‚°ì—ì„œ ì œê±°
            if (type === 'business') {
                gameState.roleData.businesses = gameState.roleData.businesses.filter(b => b.id !== asset.id && b.name !== asset.name);
            } else if (type === 'investment') {
                gameState.roleData.investments = gameState.roleData.investments.filter(i => i.name !== asset.name);
            }
            
            closeModal();
            showNotification(`${asset.name} íŒë§¤ ë“±ë¡ ì™„ë£Œ! (${price.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§)`, 'success');
            updateDisplay();
            showP2PTab('sell'); // íŒë§¤ íƒ­ ìƒˆë¡œê³ ì¹¨
        }
        
        // ë…¸ë™ì‹œì¥ ê´€ë ¨ í•¨ìˆ˜ë“¤
        function loadLaborMarket() {
            generateSampleJobPostings();
            displayJobPostings();
            updateMyBusinessesForHiring();
            showLaborTab('jobs');
        }
        
        function generateSampleJobPostings() {
            // ìƒ˜í”Œ êµ¬ì¸ê³µê³  ìƒì„±
            gameState.laborMarket.jobPostings = [
                {
                    id: 'job_1', title: 'í’€ìŠ¤íƒ ê°œë°œì', skill: 'programming', level: 'senior',
                    salary: 8500, company: 'TechCorp', employer: 'DevMaster2024',
                    description: 'React/Node.js ê¸°ë°˜ ì›¹ ì„œë¹„ìŠ¤ ê°œë°œ. ì›ê²©ê·¼ë¬´ ê°€ëŠ¥, ìŠ¤í†¡ì˜µì…˜ ì œê³µ',
                    postedAt: new Date(Date.now() - 86400000 * 2), applicants: 12
                },
                {
                    id: 'job_2', title: 'UI/UX ë””ìì´ë„ˆ', skill: 'design', level: 'mid',
                    salary: 5500, company: 'DesignStudio', employer: 'CreativeGuru',
                    description: 'ëª¨ë°”ì¼ ì•± UI ë””ìì¸ ì „ë¬¸. Figma, Adobe XD í•„ìˆ˜',
                    postedAt: new Date(Date.now() - 86400000 * 1), applicants: 8
                },
                {
                    id: 'job_3', title: 'ë””ì§€í„¸ ë§ˆì¼€íŒ… ë§¤ë‹ˆì €', skill: 'marketing', level: 'lead',
                    salary: 12000, company: 'MarketingPro', employer: 'GrowthHacker',
                    description: 'í¼í¬ë¨¼ìŠ¤ ë§ˆì¼€íŒ… ì „ëµ ìˆ˜ë¦½ ë° ì‹¤í–‰. Google Ads, Facebook Ads ê²½í—˜ í•„ìˆ˜',
                    postedAt: new Date(Date.now() - 86400000 * 3), applicants: 15
                },
                {
                    id: 'job_4', title: 'ì˜ì—… ë‹´ë‹¹ì', skill: 'sales', level: 'junior',
                    salary: 3200, company: 'ì„¸ì¼ì¦ˆì»´í¼ë‹ˆ', employer: 'SalesKing',
                    description: 'B2B ì˜ì—…, ì¸ì„¼í‹°ë¸Œ ë³„ë„ ì§€ê¸‰. ì‹ ì… í™˜ì˜',
                    postedAt: new Date(Date.now() - 86400000 * 4), applicants: 6
                },
                {
                    id: 'job_5', title: 'CTO (ìµœê³ ê¸°ìˆ ì±…ì„ì)', skill: 'management', level: 'executive',
                    salary: 35000, company: 'AIìŠ¤íƒ€íŠ¸ì—…', employer: 'StartupFounder',
                    description: 'ê¸°ìˆ íŒ€ ë¦¬ë“œ ë° ì•„í‚¤í…ì²˜ ì„¤ê³„. 10ë…„+ ê²½í—˜ í•„ìˆ˜',
                    postedAt: new Date(Date.now() - 86400000 * 5), applicants: 3
                },
                {
                    id: 'job_6', title: 'íšŒê³„ ë‹´ë‹¹ì', skill: 'accounting', level: 'mid',
                    salary: 4800, company: 'íšŒê³„ë²•ì¸', employer: 'AccountingPro',
                    description: 'ì „ì‚°ì„¸ë¬´, ì¬ë¬´ì œí‘œ ì‘ì„±. íšŒê³„ì‚¬ ìš°ëŒ€',
                    postedAt: new Date(Date.now() - 86400000 * 6), applicants: 10
                }
            ];
        }
        
        function showLaborTab(tab) {
            // íƒ­ ë²„íŠ¼ ìŠ¤íƒ€ì¼ ì—…ë°ì´íŠ¸
            document.querySelectorAll('[id^="labor"][id$="Tab"]').forEach(btn => {
                btn.className = 'btn btn-secondary';
            });
            document.getElementById(`labor${tab.charAt(0).toUpperCase() + tab.slice(1).replace('-', '')}Tab`).className = 'btn';
            
            // íƒ­ ì»¨í…ì¸  í‘œì‹œ/ìˆ¨ê¹€
            document.getElementById('laborJobsContent').style.display = tab === 'jobs' ? 'block' : 'none';
            document.getElementById('laborHireContent').style.display = tab === 'hire' ? 'block' : 'none';
            document.getElementById('laborMyJobsContent').style.display = tab === 'my-jobs' ? 'block' : 'none';
            document.getElementById('laborFreelanceContent').style.display = tab === 'freelance' ? 'block' : 'none';
            
            if (tab === 'jobs') {
                displayJobPostings();
            } else if (tab === 'hire') {
                updateMyBusinessesForHiring();
            } else if (tab === 'my-jobs') {
                displayMyEmploymentInfo();
            } else if (tab === 'freelance') {
                displayFreelanceJobs();
            }
        }
        
        function filterJobPostings() {
            displayJobPostings();
        }
        
        function displayJobPostings() {
            const skillFilter = document.getElementById('jobSkillFilter')?.value || 'all';
            const levelFilter = document.getElementById('jobLevelFilter')?.value || 'all';
            
            const filteredJobs = gameState.laborMarket.jobPostings.filter(job => {
                const skillMatch = skillFilter === 'all' || job.skill === skillFilter;
                const levelMatch = levelFilter === 'all' || job.level === levelFilter;
                return skillMatch && levelMatch;
            });
            
            const skillNames = {
                'programming': 'ê°œë°œ', 'design': 'ë””ìì¸', 'marketing': 'ë§ˆì¼€íŒ…',
                'sales': 'ì˜ì—…', 'management': 'ê´€ë¦¬', 'accounting': 'íšŒê³„',
                'legal': 'ë²•ë¬´', 'engineering': 'ì—”ì§€ë‹ˆì–´ë§', 'research': 'ì—°êµ¬', 'consulting': 'ì»¨ì„¤íŒ…'
            };
            
            const levelNames = {
                'junior': 'ì‹ ì…', 'mid': 'ì¤‘ê¸‰', 'senior': 'ê³ ê¸‰', 'lead': 'íŒ€ì¥ê¸‰', 'executive': 'ì„ì›ê¸‰'
            };
            
            const jobsHtml = filteredJobs.map(job => `
                <div class="business-card" style="margin-bottom: 15px; cursor: pointer;" onclick="showJobApplicationModal('${job.id}')">
                    <div class="business-header">
                        <div class="business-name">ğŸ’¼ ${job.title}</div>
                        <div style="color: var(--success); font-weight: bold;">${job.salary.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§/ì›”</div>
                    </div>
                    <div style="font-size: 0.9rem; color: #94a3b8; margin: 8px 0;">
                        <div style="margin-bottom: 8px; display: flex; gap: 10px; flex-wrap: wrap;">
                            <span style="background: rgba(59, 130, 246, 0.2); color: #60a5fa; padding: 2px 8px; border-radius: 12px; font-size: 0.8rem;">
                                ${skillNames[job.skill] || job.skill}
                            </span>
                            <span style="background: rgba(34, 197, 94, 0.2); color: #4ade80; padding: 2px 8px; border-radius: 12px; font-size: 0.8rem;">
                                ${levelNames[job.level] || job.level}
                            </span>
                            <span style="color: #cbd5e1;">ğŸ¢ ${job.company}</span>
                        </div>
                        <div style="margin-bottom: 8px;">
                            ğŸ‘¤ ì±„ìš©ë‹´ë‹¹ì: ${job.employer}
                        </div>
                        <div style="color: #e2e8f0; margin-bottom: 8px;">
                            ${job.description}
                        </div>
                        <div style="font-size: 0.8rem; color: #64748b; display: flex; justify-content: space-between;">
                            <span>ğŸ“‹ ì§€ì›ì ${job.applicants}ëª…</span>
                            <span>ğŸ“… ${job.postedAt.toLocaleDateString()}</span>
                        </div>
                    </div>
                </div>
            `).join('');
            
            document.getElementById('jobPostingsList').innerHTML = jobsHtml.length > 0 ? jobsHtml : 
                '<div style="text-align: center; color: #64748b; padding: 40px;">ê²€ìƒ‰ ì¡°ê±´ì— ë§ëŠ” êµ¬ì¸ê³µê³ ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
        }
        
        function updateSalaryRange() {
            const level = document.getElementById('jobLevel')?.value;
            const ranges = gameState.laborMarket.salaryRanges[level];
            if (ranges) {
                document.getElementById('salaryGuideline').textContent = 
                    `${level} ê¶Œì¥ ë²”ìœ„: ${ranges.min.toLocaleString()}~${ranges.max.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§`;
            }
        }
        
        function postJob() {
            const title = document.getElementById('jobTitle')?.value;
            const skill = document.getElementById('jobSkill')?.value;
            const level = document.getElementById('jobLevel')?.value;
            const salary = parseInt(document.getElementById('jobSalary')?.value);
            const description = document.getElementById('jobDescription')?.value;
            
            if (!title || !salary || salary < 1000) {
                showNotification('ëª¨ë“  í•„ë“œë¥¼ ì˜¬ë°”ë¥´ê²Œ ì…ë ¥í•´ì£¼ì„¸ìš” (ìµœì†Œ ê¸‰ì—¬ 1,000 ë¹„íŠ¸í¬ë ˆë”§)', 'error');
                return;
            }
            
            if (gameState.roleData.businesses.length === 0) {
                showNotification('êµ¬ì¸ê³µê³ ë¥¼ ë“±ë¡í•˜ë ¤ë©´ ì‚¬ì—…ì²´ê°€ í•„ìš”í•©ë‹ˆë‹¤', 'error');
                return;
            }
            
            const newJob = {
                id: `job_${Date.now()}`,
                title: title,
                skill: skill,
                level: level,
                salary: salary,
                company: gameState.roleData.businesses[0].name, // ì²« ë²ˆì§¸ ì‚¬ì—…ì²´
                employer: gameState.currentUser.username,
                description: description,
                postedAt: new Date(),
                applicants: 0,
                isMyPosting: true
            };
            
            gameState.laborMarket.jobPostings.unshift(newJob);
            
            // í¼ ì´ˆê¸°í™”
            document.getElementById('jobTitle').value = '';
            document.getElementById('jobSalary').value = '';
            document.getElementById('jobDescription').value = '';
            
            showNotification('êµ¬ì¸ê³µê³ ê°€ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
            showLaborTab('jobs'); // êµ¬ì¸ê³µê³  íƒ­ìœ¼ë¡œ ì´ë™
        }
        
        function updateMyBusinessesForHiring() {
            const businessesHtml = gameState.roleData.businesses.map(business => `
                <div class="business-card" style="margin-bottom: 10px;">
                    <div class="business-header">
                        <div class="business-name">ğŸ¢ ${business.name}</div>
                        <div style="color: var(--primary);">${business.employees}ëª… ê³ ìš©ì¤‘</div>
                    </div>
                    <div style="font-size: 0.9rem; color: #94a3b8; margin: 8px 0;">
                        <div>â€¢ ì›” ê¸‰ì—¬ ì§€ì¶œ: ${Math.floor(business.employees * 3000).toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§ (ì¶”ì •)</div>
                        <div>â€¢ ì‚¬ì—…ì²´ ìˆ˜ìµ: ${business.profit.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§/ì›”</div>
                        <div style="color: ${business.profit > business.employees * 3000 ? 'var(--success)' : 'var(--danger)'};">
                            â€¢ ê¸‰ì—¬ ëŒ€ë¹„ ìˆ˜ìµ: ${business.profit > business.employees * 3000 ? 'í‘ì' : 'ì ì'}
                        </div>
                    </div>
                </div>
            `).join('');
            
            document.getElementById('myBusinessesForHiring').innerHTML = businessesHtml.length > 0 ? 
                '<h4 style="color: #cbd5e1; margin-bottom: 10px;">ë‚´ ì‚¬ì—…ì²´ë³„ ì§ì› í˜„í™©</h4>' + businessesHtml : 
                '<div style="text-align: center; color: #64748b; padding: 20px;">ë³´ìœ í•œ ì‚¬ì—…ì²´ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
        }
        
        function displayMyEmploymentInfo() {
            // ë‚´ê°€ ê³ ìš©í•œ ì§ì›ë“¤
            const myEmployees = gameState.laborMarket.contracts.filter(contract => 
                contract.employerId === gameState.currentUser.username
            );
            
            const employeesHtml = myEmployees.map(contract => `
                <div class="business-card" style="margin-bottom: 10px;">
                    <div class="business-header">
                        <div class="business-name">ğŸ‘¤ ${contract.employeeName}</div>
                        <div style="color: var(--success);">${contract.salary.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§/ì›”</div>
                    </div>
                    <div style="font-size: 0.9rem; color: #94a3b8; margin: 8px 0;">
                        <div>â€¢ ì§ì±…: ${contract.title}</div>
                        <div>â€¢ ì…ì‚¬ì¼: ${contract.startDate.toLocaleDateString()}</div>
                        <div>â€¢ ê·¼ë¬´ê¸°ê°„: ${Math.floor((Date.now() - contract.startDate) / (1000 * 60 * 60 * 24))}ì¼</div>
                    </div>
                    <button class="btn btn-sm" onclick="terminateEmployee('${contract.id}')" style="background: var(--danger); margin-top: 8px;">
                        ê³„ì•½ í•´ì§€
                    </button>
                </div>
            `).join('');
            
            // ë‚´ ê³ ìš© ìƒíƒœ
            const myJob = gameState.laborMarket.contracts.find(contract => 
                contract.employeeId === gameState.currentUser.username
            );
            
            const employmentStatusHtml = myJob ? `
                <div class="business-card">
                    <div class="business-header">
                        <div class="business-name">ğŸ¢ ${myJob.company}</div>
                        <div style="color: var(--success);">${myJob.salary.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§/ì›”</div>
                    </div>
                    <div style="font-size: 0.9rem; color: #94a3b8; margin: 8px 0;">
                        <div>â€¢ ì§ì±…: ${myJob.title}</div>
                        <div>â€¢ ìƒì‚¬: ${myJob.employerName}</div>
                        <div>â€¢ ì…ì‚¬ì¼: ${myJob.startDate.toLocaleDateString()}</div>
                        <div>â€¢ ê·¼ë¬´ê¸°ê°„: ${Math.floor((Date.now() - myJob.startDate) / (1000 * 60 * 60 * 24))}ì¼</div>
                    </div>
                    <button class="btn btn-sm btn-secondary" onclick="quitJob('${myJob.id}')" style="margin-top: 8px;">
                        í‡´ì‚¬í•˜ê¸°
                    </button>
                </div>
            ` : '<div style="text-align: center; color: #64748b; padding: 40px;">í˜„ì¬ ì·¨ì—…í•˜ì§€ ì•Šì€ ìƒíƒœì…ë‹ˆë‹¤.</div>';
            
            document.getElementById('myEmployeesList').innerHTML = employeesHtml.length > 0 ? employeesHtml : 
                '<div style="text-align: center; color: #64748b; padding: 20px;">ê³ ìš©í•œ ì§ì›ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
                
            document.getElementById('myEmploymentStatus').innerHTML = employmentStatusHtml;
        }
        
        function displayFreelanceJobs() {
            const freelanceJobs = [
                { title: 'ì›¹ì‚¬ì´íŠ¸ ë¦¬ë‰´ì–¼', skill: 'design', payment: 15000, duration: '2ì£¼', client: 'WebCompany', description: 'ê¸°ì—… ì›¹ì‚¬ì´íŠ¸ UI/UX ê°œì„ ' },
                { title: 'SEO ìµœì í™”', skill: 'marketing', payment: 8000, duration: '1ì£¼', client: 'SEOExpert', description: 'ê²€ìƒ‰ì—”ì§„ ìµœì í™” ë° í‚¤ì›Œë“œ ë¶„ì„' },
                { title: 'ëª¨ë°”ì¼ ì•± ê°œë°œ', skill: 'programming', payment: 25000, duration: '1ê°œì›”', client: 'AppStudio', description: 'React Native ê¸°ë°˜ ëª¨ë°”ì¼ ì•±' },
                { title: 'ì˜ì—… í”„ë ˆì  í…Œì´ì…˜', skill: 'sales', payment: 5000, duration: '3ì¼', client: 'SalesTeam', description: 'B2B ì˜ì—…ìš© PPT ì œì‘' }
            ];
            
            const skillNames = {
                'programming': 'ê°œë°œ', 'design': 'ë””ìì¸', 'marketing': 'ë§ˆì¼€íŒ…', 'sales': 'ì˜ì—…'
            };
            
            const freelanceHtml = freelanceJobs.map((job, index) => `
                <div class="business-card" style="margin-bottom: 15px; cursor: pointer;" onclick="applyFreelance(${index})">
                    <div class="business-header">
                        <div class="business-name">ğŸ¯ ${job.title}</div>
                        <div style="color: var(--warning); font-weight: bold;">${job.payment.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§</div>
                    </div>
                    <div style="font-size: 0.9rem; color: #94a3b8; margin: 8px 0;">
                        <div style="margin-bottom: 8px; display: flex; gap: 10px; flex-wrap: wrap;">
                            <span style="background: rgba(245, 158, 11, 0.2); color: #fbbf24; padding: 2px 8px; border-radius: 12px; font-size: 0.8rem;">
                                ${skillNames[job.skill]}
                            </span>
                            <span style="color: #cbd5e1;">â±ï¸ ${job.duration}</span>
                            <span style="color: #cbd5e1;">ğŸ‘¤ ${job.client}</span>
                        </div>
                        <div style="color: #e2e8f0;">
                            ${job.description}
                        </div>
                    </div>
                </div>
            `).join('');
            
            document.getElementById('freelanceJobsList').innerHTML = freelanceHtml;
        }
        
        function showJobApplicationModal(jobId) {
            const job = gameState.laborMarket.jobPostings.find(j => j.id === jobId);
            if (!job) return;
            
            if (job.employer === gameState.currentUser.username) {
                showNotification('ë³¸ì¸ì´ ì˜¬ë¦° êµ¬ì¸ê³µê³ ì—ëŠ” ì§€ì›í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤', 'error');
                return;
            }
            
            // ì´ë¯¸ ì·¨ì—…ì¤‘ì¸ì§€ í™•ì¸
            const hasJob = gameState.laborMarket.contracts.some(contract => 
                contract.employeeId === gameState.currentUser.username && contract.isActive
            );
            
            const skillNames = { 'programming': 'ê°œë°œ', 'design': 'ë””ìì¸', 'marketing': 'ë§ˆì¼€íŒ…', 'sales': 'ì˜ì—…', 'management': 'ê´€ë¦¬', 'accounting': 'íšŒê³„' };
            const levelNames = { 'junior': 'ì‹ ì…', 'mid': 'ì¤‘ê¸‰', 'senior': 'ê³ ê¸‰', 'lead': 'íŒ€ì¥ê¸‰', 'executive': 'ì„ì›ê¸‰' };
            
            const modalContent = `
                <h2 style="text-align: center; margin-bottom: 30px; color: var(--primary);">ğŸ“‹ ì…ì‚¬ì§€ì›</h2>
                
                <div style="background: rgba(59, 130, 246, 0.1); border: 1px solid rgba(59, 130, 246, 0.3); border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                    <div style="margin-bottom: 15px;">
                        <div style="font-size: 1.2rem; font-weight: bold; color: var(--primary);">${job.title}</div>
                        <div style="color: #94a3b8; font-size: 0.9rem;">íšŒì‚¬: ${job.company} | ë‹´ë‹¹ì: ${job.employer}</div>
                    </div>
                    <div style="margin-bottom: 15px; display: flex; gap: 10px;">
                        <span style="background: rgba(59, 130, 246, 0.2); color: #60a5fa; padding: 2px 8px; border-radius: 12px; font-size: 0.8rem;">
                            ${skillNames[job.skill]}
                        </span>
                        <span style="background: rgba(34, 197, 94, 0.2); color: #4ade80; padding: 2px 8px; border-radius: 12px; font-size: 0.8rem;">
                            ${levelNames[job.level]}
                        </span>
                    </div>
                    <div style="color: #e2e8f0; margin-bottom: 15px;">
                        ${job.description}
                    </div>
                    <div style="color: var(--success); font-size: 1.1rem; font-weight: bold;">
                        ì›”ê¸‰: ${job.salary.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§
                    </div>
                </div>

                ${hasJob ? `
                    <div style="background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.3); border-radius: 12px; padding: 15px; margin-bottom: 20px; text-align: center;">
                        <div style="color: var(--danger); font-weight: bold;">âš ï¸ ì´ë¯¸ ì·¨ì—…ì¤‘ì…ë‹ˆë‹¤</div>
                        <div style="color: #94a3b8; font-size: 0.9rem; margin-top: 5px;">í˜„ì¬ ì§ì¥ì„ í‡´ì‚¬í•œ í›„ ì§€ì›í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</div>
                    </div>
                ` : ''}

                <div style="display: flex; gap: 15px; margin-top: 20px;">
                    <button onclick="closeModal()" class="btn btn-secondary" style="flex: 1;">ì·¨ì†Œ</button>
                    <button onclick="applyForJob('${job.id}')" 
                            ${hasJob ? 'disabled class="btn btn-secondary"' : 'class="btn"'} 
                            style="flex: 1;">
                        ${hasJob ? 'ì·¨ì—…ì¤‘' : 'ì§€ì›í•˜ê¸°'}
                    </button>
                </div>
            `;
            
            showModal(modalContent);
        }
        
        function applyForJob(jobId) {
            const job = gameState.laborMarket.jobPostings.find(j => j.id === jobId);
            if (!job) return;
            
            // ì§€ì›ì ìˆ˜ ì¦ê°€
            job.applicants += 1;
            
            // ìë™ ì±„ìš© í™•ë¥  (70%)
            if (Math.random() < 0.7) {
                // ê³ ìš© ê³„ì•½ ìƒì„±
                const contract = {
                    id: `contract_${Date.now()}`,
                    jobId: jobId,
                    employeeId: gameState.currentUser.username,
                    employeeName: gameState.currentUser.username,
                    employerId: job.employer,
                    employerName: job.employer,
                    company: job.company,
                    title: job.title,
                    salary: job.salary,
                    startDate: new Date(),
                    isActive: true
                };
                
                gameState.laborMarket.contracts.push(contract);
                
                closeModal();
                showNotification(`ì¶•í•˜í•©ë‹ˆë‹¤! ${job.company}ì— ${job.title}ë¡œ ì·¨ì—…í•˜ì…¨ìŠµë‹ˆë‹¤!`, 'success');
                
                // êµ¬ì¸ê³µê³  ì œê±° (1ëª… ì±„ìš© ì™„ë£Œ)
                gameState.laborMarket.jobPostings = gameState.laborMarket.jobPostings.filter(j => j.id !== jobId);
            } else {
                closeModal();
                showNotification('ì§€ì›ì„œê°€ ì ‘ìˆ˜ë˜ì—ˆì§€ë§Œ ì•„ì‰½ê²Œë„ ì±„ìš©ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.', 'info');
            }
            
            displayJobPostings();
        }
        
        function applyFreelance(index) {
            const jobs = [
                { title: 'ì›¹ì‚¬ì´íŠ¸ ë¦¬ë‰´ì–¼', skill: 'design', payment: 15000, duration: '2ì£¼', client: 'WebCompany', description: 'ê¸°ì—… ì›¹ì‚¬ì´íŠ¸ UI/UX ê°œì„ ' },
                { title: 'SEO ìµœì í™”', skill: 'marketing', payment: 8000, duration: '1ì£¼', client: 'SEOExpert', description: 'ê²€ìƒ‰ì—”ì§„ ìµœì í™” ë° í‚¤ì›Œë“œ ë¶„ì„' },
                { title: 'ëª¨ë°”ì¼ ì•± ê°œë°œ', skill: 'programming', payment: 25000, duration: '1ê°œì›”', client: 'AppStudio', description: 'React Native ê¸°ë°˜ ëª¨ë°”ì¼ ì•±' },
                { title: 'ì˜ì—… í”„ë ˆì  í…Œì´ì…˜', skill: 'sales', payment: 5000, duration: '3ì¼', client: 'SalesTeam', description: 'B2B ì˜ì—…ìš© PPT ì œì‘' }
            ];
            
            const job = jobs[index];
            if (Math.random() < 0.6) { // 60% ì„±ê³µë¥ 
                gameState.currentUser.game_balance += job.payment;
                showNotification(`í”„ë¦¬ëœìŠ¤ í”„ë¡œì íŠ¸ "${job.title}" ì™„ë£Œ! +${job.payment.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§`, 'success');
                updateDisplay();
            } else {
                showNotification(`í”„ë¦¬ëœìŠ¤ í”„ë¡œì íŠ¸ "${job.title}"ì— ì„ ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.`, 'info');
            }
        }
        
        function terminateEmployee(contractId) {
            if (!confirm('ì •ë§ ì´ ì§ì›ê³¼ì˜ ê³„ì•½ì„ í•´ì§€í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            
            const contract = gameState.laborMarket.contracts.find(c => c.id === contractId);
            if (contract) {
                contract.isActive = false;
                contract.endDate = new Date();
                showNotification(`${contract.employeeName}ë‹˜ê³¼ì˜ ê³ ìš©ê³„ì•½ì´ í•´ì§€ë˜ì—ˆìŠµë‹ˆë‹¤.`, 'info');
                displayMyEmploymentInfo();
            }
        }
        
        function quitJob(contractId) {
            if (!confirm('ì •ë§ í‡´ì‚¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            
            const contract = gameState.laborMarket.contracts.find(c => c.id === contractId);
            if (contract) {
                contract.isActive = false;
                contract.endDate = new Date();
                showNotification(`${contract.company}ì—ì„œ í‡´ì‚¬í–ˆìŠµë‹ˆë‹¤.`, 'info');
                displayMyEmploymentInfo();
            }
        }
        
        // ìì› ì‹œìŠ¤í…œ ê´€ë¦¬
        function startResourceSystem() {
            setInterval(() => {
                updateResourceConsumption();
                regenerateResources();
                updateResourceEffects();
                updateCountryEconomics();
            }, 15000); // 15ì´ˆë§ˆë‹¤ ìì› ì‹œìŠ¤í…œ ì—…ë°ì´íŠ¸
        }
        
        function updateResourceConsumption() {
            // í”Œë ˆì´ì–´ í™œë™ì— ë”°ë¥¸ ìì› ì†Œëª¨ ê³„ì‚°
            let totalConsumption = {
                raw_materials: 0,
                energy: 0,
                technology: 0,
                human_capital: 0,
                infrastructure: 0
            };
            
            // ì‚¬ì—…ì²´ ìš´ì˜ìœ¼ë¡œ ì¸í•œ ìì› ì†Œëª¨
            const totalBusinesses = Object.keys(gameState.roleData || {}).reduce((count, key) => {
                return count + ((gameState.roleData[key]?.businesses || []).length);
            }, 0);
            
            // íˆ¬ì í™œë™ìœ¼ë¡œ ì¸í•œ ìì› ì†Œëª¨  
            const totalInvestments = Object.keys(gameState.roleData || {}).reduce((count, key) => {
                return count + ((gameState.roleData[key]?.investments || []).length);
            }, 0);
            
            // ì€í–‰ í™œë™ìœ¼ë¡œ ì¸í•œ ìì› ì†Œëª¨
            const bankAssets = gameState.bankSettings?.bankAssets || 0;
            
            // ê¸°ë³¸ ì†Œëª¨ëŸ‰ + í™œë™ì— ë¹„ë¡€í•œ ì†Œëª¨ëŸ‰
            totalConsumption.raw_materials = 50 + (totalBusinesses * 15) + (totalInvestments * 5);
            totalConsumption.energy = 80 + (totalBusinesses * 25) + (bankAssets / 100000);
            totalConsumption.technology = 20 + (totalInvestments * 8) + (totalBusinesses * 3);
            totalConsumption.human_capital = 30 + (gameState.laborMarket?.contracts?.filter(c => c.isActive)?.length * 10 || 0);
            totalConsumption.infrastructure = 40 + (totalBusinesses * 12) + (totalInvestments * 4);
            
            // ê²½ì œ í™œì„±ë„ì— ë”°ë¥¸ ì†Œëª¨ëŸ‰ ì¡°ì •
            const economicActivity = gameState.countrySystem.economicActivity;
            Object.keys(totalConsumption).forEach(resource => {
                totalConsumption[resource] = Math.floor(totalConsumption[resource] * economicActivity);
            });
            
            // ìì› ì†Œëª¨ ì ìš©
            gameState.resourceSystem.resources.forEach((resourceData, resourceName) => {
                const consumption = totalConsumption[resourceName] || 0;
                resourceData.current = Math.max(0, resourceData.current - consumption);
            });
            
            gameState.resourceSystem.globalConsumption = Object.values(totalConsumption).reduce((sum, val) => sum + val, 0);
        }
        
        function regenerateResources() {
            // ìì›ë³„ ì¬ìƒì‚°
            gameState.resourceSystem.resources.forEach((resourceData, resourceName) => {
                // ê¸°ë³¸ ì¬ìƒì‚°ìœ¨ì— ê²½ì œ í™œì„±ë„ ë°˜ì˜
                const baseRegenRate = resourceData.regenerationRate;
                const economicBonus = gameState.countrySystem.economicActivity * 0.5; // ìµœëŒ€ 50% ë³´ë„ˆìŠ¤
                const actualRegenRate = Math.floor(baseRegenRate * (1 + economicBonus));
                
                // ìì› ì¬ìƒì‚° (ìµœëŒ€ì¹˜ ì´ˆê³¼ ë¶ˆê°€)
                resourceData.current = Math.min(resourceData.max, resourceData.current + actualRegenRate);
                
                // ìì› í¬ì†Œì„± ê³„ì‚° (í˜„ì¬ëŸ‰/ìµœëŒ€ëŸ‰)
                const scarcityLevel = resourceData.current / resourceData.max;
                gameState.resourceSystem.scarcityEffects.set(resourceName, scarcityLevel);
                
                // í¬ì†Œì„±ì— ë”°ë¥¸ ê°€ê²© ë°°ìˆ˜ (ìì›ì´ ë¶€ì¡±í• ìˆ˜ë¡ ë¹„ì‹¸ì§)
                const priceMultiplier = 2.0 - scarcityLevel; // 1.0 ~ 2.0 ë°°
                gameState.resourceSystem.priceMultipliers.set(resourceName, priceMultiplier);
            });
        }
        
        function updateResourceEffects() {
            // ìì› ë¶€ì¡±ì´ ê²Œì„ ê²½ì œì— ë¯¸ì¹˜ëŠ” ì˜í–¥
            const avgScarcity = Array.from(gameState.resourceSystem.scarcityEffects.values()).reduce((sum, val) => sum + val, 0) / 5;
            
            // ìì› ë¶€ì¡±ì‹œ ì‚¬ì—… ìˆ˜ìµ ê°ì†Œ
            if (avgScarcity < 0.3) { // í‰ê·  ìì›ëŸ‰ì´ 30% ì´í•˜
                gameState.roleData.businesses?.forEach(business => {
                    business.profit = Math.max(business.profit * 0.95, 100); // 5% ê°ì†Œ, ìµœì†Œ 100
                });
                
                // ê²½ì œ í™œì„±ë„ ê°ì†Œ
                gameState.countrySystem.economicActivity = Math.max(0.1, gameState.countrySystem.economicActivity * 0.98);
                
                if (Math.random() < 0.1) { // 10% í™•ë¥ ë¡œ ê²½ê³  ë©”ì‹œì§€
                    showNotification('âš ï¸ ìì› ë¶€ì¡±ìœ¼ë¡œ ê²½ì œ í™œë™ì´ ë‘”í™”ë˜ê³  ìˆìŠµë‹ˆë‹¤!', 'warning');
                }
            }
            
            // ìì› í’ë¶€ì‹œ ì‚¬ì—… ìˆ˜ìµ ì¦ê°€
            if (avgScarcity > 0.8) { // í‰ê·  ìì›ëŸ‰ì´ 80% ì´ìƒ
                gameState.roleData.businesses?.forEach(business => {
                    business.profit = Math.floor(business.profit * 1.02); // 2% ì¦ê°€
                });
                
                // ê²½ì œ í™œì„±ë„ ì¦ê°€
                gameState.countrySystem.economicActivity = Math.min(1.0, gameState.countrySystem.economicActivity * 1.01);
            }
            
            // íŠ¹ì • ìì› ë¶€ì¡±ì‹œ í•´ë‹¹ ì—…ì¢… ì˜í–¥
            const energyScarcity = gameState.resourceSystem.scarcityEffects.get('energy');
            if (energyScarcity < 0.2) { // ì—ë„ˆì§€ 20% ì´í•˜
                gameState.roleData.businesses?.forEach(business => {
                    if (business.type === 'manufacturing' || business.type === 'tech_startup') {
                        business.monthlyExpenses = Math.floor(business.monthlyExpenses * 1.2); // ìš´ì˜ë¹„ 20% ì¦ê°€
                    }
                });
            }
            
            const technologyScarcity = gameState.resourceSystem.scarcityEffects.get('technology');
            if (technologyScarcity < 0.2) { // ê¸°ìˆ  ìì› 20% ì´í•˜
                gameState.stockMarket.stocks.forEach(stock => {
                    if (stock.sector === 'tech') {
                        stock.price *= 0.995; // ê¸°ìˆ ì£¼ ê°€ê²© í•˜ë½
                    }
                });
            }
        }
        
        function updateCountryEconomics() {
            const country = gameState.countrySystem;
            
            // ê²½ì œ í™œì„±ë„ì— ë”°ë¥¸ ì¸êµ¬ ë™ì  ë³€í™”
            const economicGrowth = (country.economicActivity - 0.5) * 0.02; // -1% ~ +1%
            country.population = Math.max(45000000, Math.floor(country.population * (1 + economicGrowth / 12))); // ì›”ë‹¨ìœ„
            
            // GDP per capita ë³€í™”
            const gdpGrowth = country.economicActivity * 0.005 + (Math.random() - 0.5) * 0.01;
            country.gdpPerCapita = Math.max(20000, Math.floor(country.gdpPerCapita * (1 + gdpGrowth)));
            
            // ì‹¤ì—…ë¥  ì¡°ì •
            const unemploymentChange = (0.5 - country.economicActivity) * 0.1;
            country.unemploymentRate = Math.max(1.5, Math.min(15.0, country.unemploymentRate + unemploymentChange));
            
            // ì†Œë¹„ì§€ì¶œ ì§€ìˆ˜ ì¡°ì •
            const spendingChange = (country.economicActivity - 0.5) * 0.02;
            country.consumerSpending = Math.max(0.3, Math.min(1.2, country.consumerSpending + spendingChange));
            
            // ì°½ì—…ë¥  ì¡°ì • (ê²½ì œ í™œì„±ë„ì™€ ì—°ê´€)
            country.businessFormationRate = Math.max(0.05, Math.min(0.3, 0.1 + (country.economicActivity - 0.5) * 0.4));
            
            // ì§€ì—­ë³„ ê²½ì œ ê°€ì¤‘ì¹˜ ì¡°ì •
            country.regions.forEach(region => {
                const regionGrowth = (country.economicActivity - 0.5) * 0.01 * (Math.random() + 0.5);
                region.economicWeight = Math.max(0.01, Math.min(0.4, region.economicWeight + regionGrowth));
                
                // ì‚¬ì—… ë³´ë„ˆìŠ¤ ì¡°ì •
                if (region.name === 'ì„œìš¸íŠ¹ë³„ì‹œ' || region.name === 'ê²½ê¸°ë„') {
                    region.businessBonus = Math.max(0.8, Math.min(1.5, 1.0 + (country.economicActivity - 0.5)));
                }
            });
            
            // ê²½ì œ ì§€í‘œê°€ ì‚¬ì—… ì„±ê³µë¥ ì— ë¯¸ì¹˜ëŠ” ì˜í–¥ ê³„ì‚°
            updateBusinessSuccessRates();
        }
        
        function updateBusinessSuccessRates() {
            const country = gameState.countrySystem;
            
            // ê¸°ë³¸ ì„±ê³µë¥ ì— ê²½ì œ ì§€í‘œ ë°˜ì˜
            const economicMultiplier = 
                (country.economicActivity * 0.3) + 
                (country.consumerSpending * 0.2) + 
                (country.businessFormationRate * 0.2) + 
                ((10 - country.unemploymentRate) / 10 * 0.15) + 
                (country.innovationIndex * 0.15);
                
            // ì‚¬ì—… ì‹œì‘ì‹œ ì„±ê³µ í™•ë¥  ì¡°ì • (ì €ì¥í•´ì„œ ë‚˜ì¤‘ì— ì‚¬ìš©)
            gameState.countrySystem.currentBusinessSuccessRate = Math.max(0.3, Math.min(1.2, economicMultiplier));
            
            // ìì› ë¶€ì¡±ì´ ì‚¬ì—…ì— ë¯¸ì¹˜ëŠ” ì¶”ê°€ ì˜í–¥
            const resourceAvailability = Array.from(gameState.resourceSystem.scarcityEffects.values()).reduce((sum, val) => sum + val, 0) / 5;
            gameState.countrySystem.resourceSuccessBonus = Math.max(0.5, Math.min(1.5, resourceAvailability));
            
            // ê·¹ë‹¨ì  ìƒí™©ì—ì„œ ì•Œë¦¼
            if (economicMultiplier < 0.4) {
                if (Math.random() < 0.05) { // 5% í™•ë¥ 
                    showNotification('ğŸ“‰ ê²½ê¸°ì¹¨ì²´ë¡œ ì°½ì—… í™˜ê²½ì´ ì•…í™”ë˜ì—ˆìŠµë‹ˆë‹¤', 'error');
                }
            } else if (economicMultiplier > 1.0) {
                if (Math.random() < 0.05) { // 5% í™•ë¥ 
                    showNotification('ğŸ“ˆ ê²½ì œí˜¸í™©ìœ¼ë¡œ ì°½ì—… ê¸°íšŒê°€ ëŠ˜ì–´ë‚¬ìŠµë‹ˆë‹¤!', 'success');
                }
            }
        }
        
        // ê²Œì„ì˜ ê¸°ì¡´ ë¹„ì¦ˆë‹ˆìŠ¤ ìƒì„± í•¨ìˆ˜ì— ê²½ì œ ì§€í‘œ ë°˜ì˜
        function getBusinessSuccessBonus() {
            const baseRate = gameState.countrySystem?.currentBusinessSuccessRate || 1.0;
            const resourceBonus = gameState.countrySystem?.resourceSuccessBonus || 1.0;
            return Math.min(2.0, baseRate * resourceBonus); // ìµœëŒ€ 2ë°°
        }
        
        // ìì› ìƒíƒœë¥¼ UIì— í‘œì‹œí•˜ëŠ” í•¨ìˆ˜
        function displayResourceStatus() {
            const resources = gameState.resourceSystem.resources;
            let statusHtml = '<h4 style="color: var(--primary); margin-bottom: 15px;">ğŸ­ êµ­ê°€ ìì› í˜„í™©</h4>';
            
            const resourceNames = {
                'raw_materials': 'ì›ìì¬',
                'energy': 'ì—ë„ˆì§€', 
                'technology': 'ê¸°ìˆ ë ¥',
                'human_capital': 'ì¸ì ìì›',
                'infrastructure': 'ì¸í”„ë¼'
            };
            
            const resourceIcons = {
                'raw_materials': 'ğŸ­',
                'energy': 'âš¡',
                'technology': 'ğŸ’»', 
                'human_capital': 'ğŸ‘¥',
                'infrastructure': 'ğŸ—ï¸'
            };
            
            resources.forEach((data, name) => {
                const percentage = (data.current / data.max * 100).toFixed(1);
                const scarcityLevel = data.current / data.max;
                const statusColor = scarcityLevel > 0.6 ? 'var(--success)' : scarcityLevel > 0.3 ? 'var(--warning)' : 'var(--danger)';
                
                statusHtml += `
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; padding: 8px; background: rgba(255,255,255,0.05); border-radius: 6px;">
                        <span>${resourceIcons[name]} ${resourceNames[name]}</span>
                        <span style="color: ${statusColor}; font-weight: bold;">${percentage}%</span>
                    </div>
                `;
            });
            
            return statusHtml;
        }
        
        function startBusiness() {
            if (gameState.currentUser.game_balance < 10000) {
                showNotification('ì‚¬ì—… ì‹œì‘ì—ëŠ” ìµœì†Œ 10,000 ë¹„íŠ¸í¬ë ˆë”§ì´ í•„ìš”í•©ë‹ˆë‹¤', 'error');
                return;
            }
            
            const businessTypes = [
                { name: 'ì¹´í˜', profit: 2000, value: 15000, employees: 2 },
                { name: 'í¸ì˜ì ', profit: 1800, value: 12000, employees: 1 },
                { name: 'ì˜¨ë¼ì¸ ì‡¼í•‘ëª°', profit: 3500, value: 25000, employees: 3 },
                { name: 'ìŒì‹ì ', profit: 2800, value: 20000, employees: 4 },
                { name: 'IT ìŠ¤íƒ€íŠ¸ì—…', profit: 4500, value: 35000, employees: 5 }
            ];
            const businessTemplate = businessTypes[Math.floor(Math.random() * businessTypes.length)];
            
            // ê²½ì œ ì§€í‘œì— ë”°ë¥¸ ì‚¬ì—… ì„±ê³µë¥  ì ìš©
            const successBonus = getBusinessSuccessBonus();
            const isSuccess = Math.random() < (0.7 * successBonus); // ê¸°ë³¸ 70% ì„±ê³µë¥ ì— ê²½ì œ ë³´ë„ˆìŠ¤ ì ìš©
            
            gameState.currentUser.game_balance -= 10000;
            
            if (isSuccess) {
                // ì„±ê³µì‹œ ì‚¬ì—…ì²´ë¥¼ roleDataì— ì¶”ê°€
                const newBusiness = {
                    id: Date.now(),
                    name: businessTemplate.name + ' (' + Math.floor(Math.random() * 1000) + 'í˜¸ì )',
                    type: businessTemplate.name,
                    profit: Math.floor(businessTemplate.profit * successBonus),
                    value: Math.floor(businessTemplate.value * successBonus),
                    employees: businessTemplate.employees,
                    monthlyExpenses: Math.floor(businessTemplate.profit * 0.6)
                };
                
                if (!gameState.roleData.businesses) {
                    gameState.roleData.businesses = [];
                }
                gameState.roleData.businesses.push(newBusiness);
                
                showNotification(`${businessTemplate.name} ì‚¬ì—… ì„±ê³µ! ì›” ${newBusiness.profit.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§ ìˆ˜ìµ ì˜ˆìƒ`, 'success');
            } else {
                showNotification(`${businessTemplate.name} ì‚¬ì—…ì´ ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤... (ê²½ì œ ì—¬ê±´ ë¶ˆë¦¬)`, 'error');
            }
            updateDisplay();
        }
        
        function applyLoan() {
            const loanAmount = prompt('ëŒ€ì¶œ ê¸ˆì•¡ì„ ì…ë ¥í•˜ì„¸ìš” (ìµœëŒ€ 50,000 ë¹„íŠ¸í¬ë ˆë”§):');
            if (!loanAmount || isNaN(loanAmount)) return;
            
            const amount = parseInt(loanAmount);
            if (amount > 50000) {
                showNotification('ìµœëŒ€ ëŒ€ì¶œ í•œë„ëŠ” 50,000 ë¹„íŠ¸í¬ë ˆë”§ì…ë‹ˆë‹¤', 'error');
                return;
            }
            
            gameState.currentUser.game_balance += amount;
            showNotification(`ëŒ€ì¶œ ìŠ¹ì¸! ${amount.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§ì„ ë°›ì•˜ìŠµë‹ˆë‹¤.`, 'success');
            updateDisplay();
        }
        
        function refreshData() {
            // ë°ëª¨ ë°ì´í„° ì—…ë°ì´íŠ¸
            gameState.economy.totalUsers = Math.floor(Math.random() * 100) + 50;
            gameState.economy.totalEconomy = Math.floor(Math.random() * 1000000) + 500000;
            gameState.economy.totalBusinesses = Math.floor(Math.random() * 50) + 20;
            gameState.economy.totalLoans = Math.floor(Math.random() * 200000) + 100000;
            
            updateDisplay();
            showNotification('ë°ì´í„°ë¥¼ ìƒˆë¡œê³ ì¹¨í–ˆìŠµë‹ˆë‹¤', 'success');
        }
        
        function adjustRate(type, change) {
            if (gameState.currentUser.role !== 'banker') {
                showNotification('ì€í–‰ì¥ë§Œ ê¸ˆë¦¬ë¥¼ ì¡°ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤', 'error');
                return;
            }
            
            switch(type) {
                case 'base':
                    gameState.bankSettings.baseRate = Math.round((gameState.bankSettings.baseRate + change) * 10) / 10;
                    gameState.bankSettings.baseRate = Math.max(0, Math.min(20, gameState.bankSettings.baseRate));
                    break;
                case 'loan':
                    gameState.bankSettings.loanRate = Math.round((gameState.bankSettings.loanRate + change) * 10) / 10;
                    gameState.bankSettings.loanRate = Math.max(0, Math.min(30, gameState.bankSettings.loanRate));
                    break;
                case 'deposit':
                    gameState.bankSettings.depositRate = Math.round((gameState.bankSettings.depositRate + change) * 10) / 10;
                    gameState.bankSettings.depositRate = Math.max(0, Math.min(20, gameState.bankSettings.depositRate));
                    break;
            }
            
            updateBankDisplay();
            showNotification(`ê¸ˆë¦¬ê°€ ${change > 0 ? 'ì¸ìƒ' : 'ì¸í•˜'}ë˜ì—ˆìŠµë‹ˆë‹¤`, 'success');
        }
        
        function setBankPolicy(policy) {
            if (gameState.currentUser.role !== 'banker') {
                showNotification('ì€í–‰ì¥ë§Œ ì •ì±…ì„ ë³€ê²½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤', 'error');
                return;
            }
            
            gameState.bankSettings.policy = policy;
            
            switch(policy) {
                case 'conservative':
                    gameState.bankSettings.baseRate = 3.0;
                    gameState.bankSettings.loanRate = 5.0;
                    gameState.bankSettings.depositRate = 2.0;
                    showNotification('ë³´ìˆ˜ì  ì •ì±…: ë‚®ì€ ê¸ˆë¦¬, ì•ˆì •ì  ìš´ì˜', 'info');
                    break;
                case 'balanced':
                    gameState.bankSettings.baseRate = 5.0;
                    gameState.bankSettings.loanRate = 8.0;
                    gameState.bankSettings.depositRate = 3.0;
                    showNotification('ê· í˜• ì •ì±…: ì ì • ê¸ˆë¦¬, ê· í˜• ì„±ì¥', 'info');
                    break;
                case 'aggressive':
                    gameState.bankSettings.baseRate = 8.0;
                    gameState.bankSettings.loanRate = 12.0;
                    gameState.bankSettings.depositRate = 5.0;
                    showNotification('ê³µê²©ì  ì •ì±…: ë†’ì€ ê¸ˆë¦¬, ë¹ ë¥¸ ì„±ì¥', 'info');
                    break;
            }
            
            updateBankDisplay();
        }
        
        function updateBankDisplay() {
            document.getElementById('baseRate').textContent = gameState.bankSettings.baseRate.toFixed(1) + '%';
            document.getElementById('loanRate').textContent = gameState.bankSettings.loanRate.toFixed(1) + '%';
            document.getElementById('depositRate').textContent = gameState.bankSettings.depositRate.toFixed(1) + '%';
            document.getElementById('bankAssets').textContent = gameState.bankSettings.bankAssets.toLocaleString();
            
            // ì€í–‰ í†µê³„ ì—…ë°ì´íŠ¸
            if (document.getElementById('totalLoansIssued')) {
                document.getElementById('totalLoansIssued').textContent = gameState.bankSettings.totalLoansIssued.toLocaleString();
                document.getElementById('totalDeposits').textContent = gameState.bankSettings.totalDeposits.toLocaleString();
                document.getElementById('bankRating').textContent = gameState.bankSettings.bankRating;
                document.getElementById('marketShare').textContent = gameState.bankSettings.marketShare.toFixed(1) + '%';
            }
        }
        
        // ì€í–‰ì¥ ê³ ê¸‰ ê¸°ëŠ¥ë“¤
        function issueGovernmentBond() {
            if (gameState.currentUser.role !== 'banker') {
                showNotification('ì€í–‰ì¥ë§Œ êµ­ì±„ë¥¼ ë°œí–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤', 'error');
                return;
            }
            
            const bondAmount = 100000;
            const bondRate = gameState.bankSettings.baseRate + 1.0;
            
            gameState.bankSettings.bankAssets += bondAmount;
            gameState.bankSettings.totalDeposits += bondAmount;
            gameState.currentUser.game_balance += Math.floor(bondAmount * 0.02); // ìˆ˜ìˆ˜ë£Œ
            
            gameState.economy.totalEconomy += bondAmount;
            
            updateBankDisplay();
            updateDisplay();
            showNotification(`êµ­ì±„ ${bondAmount.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§ ë°œí–‰ ì™„ë£Œ! (ê¸ˆë¦¬: ${bondRate.toFixed(1)}%)`, 'success');
        }
        
        function adjustMoneySupply() {
            if (gameState.currentUser.role !== 'banker') {
                showNotification('ì€í–‰ì¥ë§Œ í†µí™”ëŸ‰ì„ ì¡°ì ˆí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤', 'error');
                return;
            }
            
            const supplyChange = Math.floor(Math.random() * 200000) + 50000;
            const isIncrease = Math.random() > 0.5;
            
            if (isIncrease) {
                gameState.economy.totalEconomy += supplyChange;
                gameState.bankSettings.bankAssets += Math.floor(supplyChange * 0.1);
                showNotification(`í†µí™”ëŸ‰ í™•ëŒ€: +${supplyChange.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§`, 'info');
            } else {
                gameState.economy.totalEconomy = Math.max(0, gameState.economy.totalEconomy - supplyChange);
                showNotification(`í†µí™”ëŸ‰ ì¶•ì†Œ: -${supplyChange.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§`, 'warning');
            }
            
            // ê¸ˆë¦¬ì— ì˜í–¥
            if (isIncrease) {
                gameState.bankSettings.baseRate = Math.max(0.1, gameState.bankSettings.baseRate - 0.2);
            } else {
                gameState.bankSettings.baseRate = Math.min(15.0, gameState.bankSettings.baseRate + 0.3);
            }
            
            updateBankDisplay();
            updateDisplay();
        }
        
        function provideLoanGuarantee() {
            if (gameState.currentUser.role !== 'banker') {
                showNotification('ì€í–‰ì¥ë§Œ ëŒ€ì¶œ ë³´ì¦ì„ ì œê³µí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤', 'error');
                return;
            }
            
            const guaranteeAmount = 50000;
            const guaranteeFee = Math.floor(guaranteeAmount * 0.03);
            
            if (gameState.bankSettings.bankAssets < guaranteeAmount) {
                showNotification('ì€í–‰ ìì‚°ì´ ë¶€ì¡±í•©ë‹ˆë‹¤', 'error');
                return;
            }
            
            gameState.bankSettings.totalLoansIssued += guaranteeAmount;
            gameState.currentUser.game_balance += guaranteeFee;
            gameState.bankSettings.marketShare += 0.5;
            
            // ì‹ ìš©ë„ í–¥ìƒ
            if (gameState.bankSettings.marketShare > 30 && gameState.bankSettings.bankRating === 'AA') {
                gameState.bankSettings.bankRating = 'AAA';
                showNotification('ì€í–‰ ì‹ ìš©ë“±ê¸‰ì´ AAAë¡œ ìƒìŠ¹í–ˆìŠµë‹ˆë‹¤!', 'success');
            }
            
            updateBankDisplay();
            updateDisplay();
            showNotification(`ì¤‘ì†Œê¸°ì—… ëŒ€ì¶œ ë³´ì¦ ì™„ë£Œ! ìˆ˜ìˆ˜ë£Œ: ${guaranteeFee.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§`, 'success');
        }
        
        function createSpecialProduct() {
            if (gameState.currentUser.role !== 'banker') {
                showNotification('ì€í–‰ì¥ë§Œ íŠ¹ë³„ ìƒí’ˆì„ ì¶œì‹œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤', 'error');
                return;
            }
            
            const products = [
                { name: 'ê³ ìˆ˜ìµ ì •ê¸°ì˜ˆê¸ˆ', revenue: 30000, cost: 10000 },
                { name: 'íˆ¬ìì—°ê³„ìƒí’ˆ', revenue: 50000, cost: 20000 },
                { name: 'ì™¸í™”ì˜ˆê¸ˆ', revenue: 25000, cost: 8000 },
                { name: 'êµ¬ì¡°í™”ìƒí’ˆ', revenue: 80000, cost: 35000 }
            ];
            
            const product = products[Math.floor(Math.random() * products.length)];
            
            if (gameState.bankSettings.bankAssets < product.cost) {
                showNotification('ìƒí’ˆ ì¶œì‹œ ë¹„ìš©ì´ ë¶€ì¡±í•©ë‹ˆë‹¤', 'error');
                return;
            }
            
            gameState.bankSettings.bankAssets -= product.cost;
            gameState.bankSettings.totalDeposits += product.revenue;
            gameState.currentUser.game_balance += Math.floor(product.revenue * 0.05); // ìˆ˜ìˆ˜ë£Œ
            
            updateBankDisplay();
            updateDisplay();
            showNotification(`${product.name} ì¶œì‹œ ì™„ë£Œ! ìˆœìµ: ${(product.revenue - product.cost).toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§`, 'success');
        }
        
        function updateDisplay() {
            // ì§ì—…ë³„ ì´ ìì‚° ê³„ì‚°
            let totalAssets = gameState.currentUser.game_balance;
            
            // ì‚¬ì—…ê°€: ì‚¬ì—… ê°€ì¹˜ í¬í•¨
            if (gameState.currentUser.role === 'entrepreneur') {
                const businessValue = gameState.roleData.businesses.reduce((sum, b) => sum + b.value, 0);
                totalAssets += businessValue;
                
                // ì‚¬ì—…ê°€ ì „ìš© ì—…ë°ì´íŠ¸
                if (document.getElementById('businessCount')) {
                    updateBusinessDisplay();
                }
            }
            
            // íˆ¬ìì: íˆ¬ì ìƒí’ˆ ê°€ì¹˜ í¬í•¨
            if (gameState.currentUser.role === 'investor') {
                const investmentValue = gameState.roleData.investments.reduce((sum, i) => 
                    sum + Math.floor(i.amount * (1 + i.returnRate)), 0);
                totalAssets += investmentValue;
                
                // íˆ¬ìì ì „ìš© ì—…ë°ì´íŠ¸
                if (document.getElementById('totalInvestment')) {
                    updateInvestmentDisplay();
                }
            }
            
            // ì§ì¥ì¸: ì—°ë´‰ì˜ ì¼ë¶€ë¥¼ ìì‚°ìœ¼ë¡œ ê³„ì‚°
            if (gameState.currentUser.role === 'worker') {
                totalAssets += gameState.roleData.workStats.bonuses;
                
                // ì§ì¥ì¸ ì „ìš© ì—…ë°ì´íŠ¸
                if (document.getElementById('monthlySalary')) {
                    updateWorkDisplay();
                }
            }
            
            document.getElementById('gameBalance').textContent = gameState.currentUser.game_balance.toLocaleString();
            document.getElementById('totalAssets').textContent = totalAssets.toLocaleString();
            
            // ì‹ ìš©ì ìˆ˜ ê³„ì‚° (ì´ ìì‚° ê¸°ë°˜)
            const creditScore = 500 + Math.floor(totalAssets / 100);
            const creditGrade = creditScore >= 800 ? 'AAA' : 
                               creditScore >= 700 ? 'AA' :
                               creditScore >= 600 ? 'A' :
                               creditScore >= 500 ? 'BBB' : 'BB';
            
            document.getElementById('creditGrade').textContent = creditGrade;
            document.getElementById('creditScore').textContent = creditScore;
            
            document.getElementById('totalUsers').textContent = gameState.economy.totalUsers;
            document.getElementById('totalEconomy').textContent = gameState.economy.totalEconomy.toLocaleString();
            document.getElementById('totalBusinesses').textContent = gameState.economy.totalBusinesses;
            document.getElementById('totalLoans').textContent = gameState.economy.totalLoans.toLocaleString();
        }
        
        // ì§ì—…ë³„ ìë™ ìˆ˜ìµ ì‹œìŠ¤í…œ
        function startIncomeSystem() {
            setInterval(() => {
                if (!gameState.currentUser) return;
                
                // ì‚¬ì—…ê°€: ì‚¬ì—… ìˆ˜ìµ
                if (gameState.currentUser.role === 'entrepreneur') {
                    const totalProfit = gameState.roleData.businesses.reduce((sum, b) => sum + b.profit, 0);
                    const totalExpenses = gameState.roleData.businesses.reduce((sum, b) => sum + b.monthlyExpenses, 0);
                    const netProfit = totalProfit - totalExpenses;
                    
                    if (netProfit > 0) {
                        gameState.currentUser.game_balance += Math.floor(netProfit / 30); // ì¼ì¼ ìˆ˜ìµ
                        if (Math.random() < 0.1) { // 10% í™•ë¥ ë¡œ ì•Œë¦¼
                            showNotification(`ì‚¬ì—… ìˆ˜ìµ: +${Math.floor(netProfit / 30).toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§`, 'success');
                        }
                    }
                    
                    // ëœë¤ ì‚¬ì—… ì´ë²¤íŠ¸ (ë§¤ìš° ë‚®ì€ í™•ë¥ )
                    if (Math.random() < 0.002 && gameState.roleData.businesses.length > 0) { // 0.2% í™•ë¥ 
                        triggerBusinessEvent();
                    }
                }
                
                // íˆ¬ìì: ë°°ë‹¹ê¸ˆ ë° ìˆ˜ìµ
                if (gameState.currentUser.role === 'investor') {
                    const dailyDividends = gameState.roleData.investments.reduce((sum, i) => sum + Math.floor(i.dividends / 30), 0);
                    if (dailyDividends > 0) {
                        gameState.currentUser.game_balance += dailyDividends;
                        if (Math.random() < 0.1) { // 10% í™•ë¥ ë¡œ ì•Œë¦¼
                            showNotification(`íˆ¬ì ìˆ˜ìµ: +${dailyDividends.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§`, 'success');
                        }
                    }
                    
                    // íˆ¬ì ê°€ê²© ë³€ë™ (íƒ€ì…ë³„ ì°¨ë³„í™”)
                    gameState.roleData.investments.forEach(investment => {
                        let priceChange;
                        
                        if (investment.type === 'realestate' && investment.riskFactor) {
                            // ë¶€ë™ì‚°ì€ ë¦¬ìŠ¤í¬ íŒ©í„°ì— ë”°ë¼ ë³€ë™ì„± ì¡°ì • (í˜„ì‹¤ì ìœ¼ë¡œ ë‚®ì¶¤)
                            const volatility = investment.riskFactor * 0.005; // 0.8~2.0 * 0.5% = 0.4%~1% (í˜„ì‹¤ì )
                            priceChange = (Math.random() - 0.5) * volatility;
                        } else if (investment.type === 'crypto') {
                            // ì•”í˜¸í™”íëŠ” ë†’ì€ ë³€ë™ì„±
                            const volatility = investment.volatility || 0.08;
                            priceChange = (Math.random() - 0.5) * volatility; // ë†’ì€ ë³€ë™ì„±
                        } else if (investment.type === 'stock') {
                            // ì£¼ì‹ì€ ë³´í†µ ë³€ë™ì„±
                            const volatility = investment.volatility || 0.02;
                            priceChange = (Math.random() - 0.5) * volatility; // ë³´í†µ ë³€ë™ì„±
                        } else if (investment.type === 'forex') {
                            // ì™¸í™˜ì€ ë‚®ì€ ë³€ë™ì„±
                            const volatility = investment.volatility || 0.03;
                            priceChange = (Math.random() - 0.5) * volatility; // Â±1.5%
                        } else if (investment.type === 'commodity') {
                            // ì›ìì¬ëŠ” ì¤‘ê°„ ë³€ë™ì„±
                            const volatility = investment.volatility || 0.05;
                            priceChange = (Math.random() - 0.5) * volatility; // Â±2.5%
                        } else if (investment.type === 'futures') {
                            // ì„ ë¬¼ì€ ê·¹ë„ë¡œ ë†’ì€ ë³€ë™ì„± (ë ˆë²„ë¦¬ì§€ ë°˜ì˜)
                            const volatility = investment.volatility || 0.1;
                            const rawChange = (Math.random() - 0.5) * volatility;
                            
                            // í¬ì§€ì…˜ì— ë”°ë¥¸ ìˆ˜ìµ/ì†ì‹¤ ê³„ì‚°
                            if (investment.position === 'short') {
                                priceChange = -rawChange; // ìˆ í¬ì§€ì…˜ì€ ë°˜ëŒ€ ë°©í–¥
                            } else {
                                priceChange = rawChange; // ë¡± í¬ì§€ì…˜
                            }
                            
                            // ë ˆë²„ë¦¬ì§€ ì ìš©
                            priceChange = priceChange * investment.leverage;
                            
                            // ë§ˆì§„ì½œ ì²´í¬
                            const currentReturn = investment.returnRate + priceChange;
                            if (currentReturn <= investment.marginCallThreshold) {
                                // ë§ˆì§„ì½œ ë°œìƒ - í¬ì§€ì…˜ ì²­ì‚°
                                investment.isActive = false;
                                investment.returnRate = -0.99; // 99% ì†ì‹¤ (ê±°ì˜ ì „ì•¡ ì†ì‹¤)
                                setTimeout(() => {
                                    showNotification(`ğŸš¨ ë§ˆì§„ì½œ! ${investment.name} í¬ì§€ì…˜ì´ ì²­ì‚°ë˜ì—ˆìŠµë‹ˆë‹¤!`, 'error');
                                }, Math.random() * 3000);
                                return; // ì¶”ê°€ ë³€ë™ ì—†ìŒ
                            }
                        } else {
                            // ê¸°íƒ€ íˆ¬ìëŠ” ê¸°ë³¸ ë³€ë™ì„±
                            priceChange = (Math.random() - 0.5) * 0.02; // Â±1%
                        }
                        
                        investment.returnRate += priceChange;
                        
                        // íˆ¬ììƒí’ˆë³„ ë°°ë‹¹ê¸ˆ ì¬ì¡°ì • (í˜„ì‹¤ì ìœ¼ë¡œ ì¡°ì •)
                        if (investment.type === 'realestate') {
                            if (investment.subType === 'commercial') {
                                investment.dividends = investment.returnRate > 0 ? Math.floor(investment.amount * 0.004) : 0; // 0.4%/ì›”
                            } else if (investment.subType === 'land') {
                                investment.dividends = investment.returnRate > 0.1 ? Math.floor(investment.amount * 0.001) : 0; // 0.1%/ì›”
                            } else if (investment.subType === 'apartment') {
                                investment.dividends = Math.floor(investment.amount * 0.003); // 0.3%/ì›”
                            } else if (investment.subType === 'officetel') {
                                investment.dividends = Math.floor(investment.amount * 0.0025); // 0.25%/ì›”
                            }
                        } else if (investment.type === 'stock') {
                            // ì£¼ì‹ ë°°ë‹¹ê¸ˆì€ ê³ ì • (í˜„ì‹¤ì )
                            investment.dividends = Math.floor(investment.amount * 0.002); // 0.2%/ì›” ê³ ì •
                        }
                        // ì•”í˜¸í™”íëŠ” ë°°ë‹¹ê¸ˆ ì—†ìŒ
                    });
                }
                
                // ì§ì¥ì¸: ì •ê¸° ê¸‰ì—¬
                if (gameState.currentUser.role === 'worker') {
                    const dailySalary = Math.floor(gameState.roleData.workStats.salary / 30);
                    gameState.currentUser.game_balance += dailySalary;
                    
                    // ê²½ë ¥ ì¦ê°€
                    if (Math.random() < 0.01) { // 1% í™•ë¥ ë¡œ ê²½ë ¥ ì¦ê°€
                        gameState.roleData.workStats.experience += 1;
                        if (Math.random() < 0.3) { // 30% í™•ë¥ ë¡œ ê¸‰ì—¬ ì¸ìƒ
                            gameState.roleData.workStats.salary += 100;
                            showNotification('ì„±ê³¼ê°€ ì¢‹ì•„ ê¸‰ì—¬ê°€ ì¸ìƒë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
                        }
                    }
                }
                
                // ì€í–‰ì¥: ì€í–‰ ìˆ˜ìµ
                if (gameState.currentUser.role === 'banker') {
                    const bankProfit = Math.floor(gameState.bankSettings.bankAssets * 0.001); // 0.1% ì¼ì¼ ìˆ˜ìµ
                    gameState.currentUser.game_balance += bankProfit;
                    gameState.bankSettings.bankAssets += bankProfit;
                    
                    if (Math.random() < 0.1) { // 10% í™•ë¥ ë¡œ ì•Œë¦¼
                        showNotification(`ì€í–‰ ìˆ˜ìµ: +${bankProfit.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§`, 'success');
                    }
                }
                
                // ì‹œì¥ ê²½ìŸ ì‹œë®¬ë ˆì´ì…˜ (ë‚®ì€ í™•ë¥ ë¡œ)
                if (gameState.currentUser.role === 'entrepreneur' && Math.random() < 0.05) { // 5% í™•ë¥ 
                    simulateMarketCompetition();
                }
                
                // AI í† ì§€ êµ¬ë§¤ ì‹œë®¬ë ˆì´ì…˜ (íˆ¬ìì ì—­í• ì¼ ë•Œ)
                if (gameState.currentUser.role === 'investor' && Math.random() < 0.03) { // 3% í™•ë¥ 
                    simulateLandMarket();
                }
                
                updateDisplay();
            }, 5000); // 5ì´ˆë§ˆë‹¤ ìˆ˜ìµ ë°œìƒ
        }
        
        // ê²½ì œ ì‚¬ì´í´ ê´€ë¦¬ ì‹œìŠ¤í…œ
        function startEconomicSystem() {
            setInterval(() => {
                updateInflation();
                updateEconomicCycle();
                updateEconomicIndicators();
                updateEconomyDisplay();
            }, 10000); // 10ì´ˆë§ˆë‹¤ ê²½ì œ ì§€í‘œ ì—…ë°ì´íŠ¸
        }
        
        // ì¸í”Œë ˆì´ì…˜/ë””í”Œë ˆì´ì…˜ ì—…ë°ì´íŠ¸
        function updateInflation() {
            const cycle = gameState.economy.economicCycle;
            
            // ê²½ê¸° êµ­ë©´ì— ë”°ë¥¸ ì¸í”Œë ˆì´ì…˜ ì¡°ì •
            let baseInflation = 2.5; // ê¸°ë³¸ ì¸í”Œë ˆì´ì…˜ 2.5%
            
            switch(cycle.phase) {
                case 'expansion':
                    baseInflation += cycle.intensity * 2.0; // í™•ì¥ê¸°: +0~4%
                    break;
                case 'peak':
                    baseInflation += cycle.intensity * 3.0; // ì •ì : +0~6% (ê³¼ì—´ ìœ„í—˜)
                    break;
                case 'contraction':
                    baseInflation -= Math.abs(cycle.intensity) * 2.5; // ìˆ˜ì¶•ê¸°: -5~0%
                    break;
                case 'trough':
                    baseInflation -= Math.abs(cycle.intensity) * 3.0; // ì €ì : -6~0% (ë””í”Œë ˆì´ì…˜ ìœ„í—˜)
                    break;
            }
            
            // ëœë¤ ë³€ë™ ì¶”ê°€ (Â±0.5%)
            const randomFactor = (Math.random() - 0.5) * 1.0;
            gameState.economy.inflationRate = Math.max(-3.0, Math.min(10.0, baseInflation + randomFactor));
            
            // ëˆ„ì  ì¸í”Œë ˆì´ì…˜ ì ìš© (ë§¤ë²ˆ 0.1% ì ìš©)
            const monthlyInflation = gameState.economy.inflationRate / 1200; // ì—°ê°„ â†’ ì›”ê°„ ë³€í™˜ í›„ 10ì´ˆê°„ê²© ì ìš©
            gameState.economy.cumulativeInflation *= (1 + monthlyInflation);
            gameState.economy.priceLevel = gameState.economy.cumulativeInflation;
            
            // ë¬¼ê°€ ìƒìŠ¹ìœ¼ë¡œ ëª¨ë“  ê°€ê²©ì— ì˜í–¥
            applyInflationEffects(monthlyInflation);
        }
        
        // ê²½ê¸° ì‚¬ì´í´ ì—…ë°ì´íŠ¸
        function updateEconomicCycle() {
            const cycle = gameState.economy.economicCycle;
            cycle.duration += 1; // ê¸°ê°„ ì¦ê°€ (10ì´ˆ = 1ë‹¨ìœ„)
            
            // ê²½ê¸° êµ­ë©´ ì „í™˜ ë¡œì§
            switch(cycle.phase) {
                case 'expansion':
                    // í™•ì¥ê¸° â†’ ì •ì  (18-36ê°œì›”)
                    if (cycle.duration > 18 + Math.random() * 18) {
                        cycle.phase = 'peak';
                        cycle.duration = 0;
                        cycle.intensity = 0.7 + Math.random() * 0.3; // 0.7~1.0
                        showNotification('ğŸ“ˆ ê²½ê¸°ê°€ ì •ì ì— ë„ë‹¬í–ˆìŠµë‹ˆë‹¤!', 'info');
                    } else {
                        cycle.intensity = Math.min(1.0, cycle.intensity + (Math.random() * 0.1));
                    }
                    break;
                    
                case 'peak':
                    // ì •ì  â†’ ìˆ˜ì¶•ê¸° (3-9ê°œì›”)
                    if (cycle.duration > 3 + Math.random() * 6) {
                        cycle.phase = 'contraction';
                        cycle.duration = 0;
                        cycle.intensity = -0.1;
                        showNotification('ğŸ“‰ ê²½ê¸° ì¹¨ì²´ê°€ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤', 'warning');
                    }
                    break;
                    
                case 'contraction':
                    // ìˆ˜ì¶•ê¸° â†’ ì €ì  (6-18ê°œì›”)
                    if (cycle.duration > 6 + Math.random() * 12) {
                        cycle.phase = 'trough';
                        cycle.duration = 0;
                        cycle.intensity = -0.7 - Math.random() * 0.3; // -1.0~-0.7
                        showNotification('ğŸ“Š ê²½ê¸°ê°€ ì €ì ì— ë„ë‹¬í–ˆìŠµë‹ˆë‹¤', 'error');
                    } else {
                        cycle.intensity = Math.max(-1.0, cycle.intensity - (Math.random() * 0.1));
                    }
                    break;
                    
                case 'trough':
                    // ì €ì  â†’ í™•ì¥ê¸° (3-12ê°œì›”)
                    if (cycle.duration > 3 + Math.random() * 9) {
                        cycle.phase = 'expansion';
                        cycle.duration = 0;
                        cycle.intensity = 0.1;
                        showNotification('ğŸš€ ê²½ê¸° íšŒë³µì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
                    }
                    break;
            }
            
            // ê²½ê¸° ê°•ë„ì— ë”°ë¥¸ ê²½ì œ ì§€í‘œ ì—…ë°ì´íŠ¸
            updateGDPAndEmployment();
        }
        
        // GDPì™€ ê³ ìš© ì§€í‘œ ì—…ë°ì´íŠ¸
        function updateGDPAndEmployment() {
            const cycle = gameState.economy.economicCycle;
            
            // GDP ì„±ì¥ë¥  (ê²½ê¸° ê°•ë„ì— ë¹„ë¡€)
            const baseGDP = 2.5;
            cycle.gdpGrowthRate = baseGDP + (cycle.intensity * 4.0) + (Math.random() - 0.5) * 1.0;
            cycle.gdpGrowthRate = Math.max(-8.0, Math.min(12.0, cycle.gdpGrowthRate));
            
            // ì‹¤ì—…ë¥  (ê²½ê¸° ê°•ë„ì— ë°˜ë¹„ë¡€)
            const baseUnemployment = 5.0;
            cycle.unemploymentRate = baseUnemployment - (cycle.intensity * 3.0) + (Math.random() - 0.5) * 0.5;
            cycle.unemploymentRate = Math.max(2.0, Math.min(15.0, cycle.unemploymentRate));
            
            // ì†Œë¹„ì ì‹ ë¢°ë„
            const baseConfidence = 60;
            cycle.consumerConfidence = baseConfidence + (cycle.intensity * 25) + (Math.random() - 0.5) * 10;
            cycle.consumerConfidence = Math.max(20, Math.min(100, cycle.consumerConfidence));
        }
        
        // ê¸°íƒ€ ê²½ì œ ì§€í‘œ ì—…ë°ì´íŠ¸
        function updateEconomicIndicators() {
            const indicators = gameState.economy.indicators;
            const cycle = gameState.economy.economicCycle;
            
            // ê¸°ì¤€ ê¸ˆë¦¬ (ì¸í”Œë ˆì´ì…˜ê³¼ ê²½ê¸°ì— ë”°ë¼ ì¡°ì •)
            let targetRate = 2.0 + gameState.economy.inflationRate * 0.5;
            if (cycle.phase === 'contraction' || cycle.phase === 'trough') {
                targetRate -= 2.0; // ì¹¨ì²´ê¸°ì—ëŠ” ê¸ˆë¦¬ ì¸í•˜
            }
            indicators.interestRate += (targetRate - indicators.interestRate) * 0.1; // ì ì§„ì  ì¡°ì •
            indicators.interestRate = Math.max(0.0, Math.min(10.0, indicators.interestRate));
            
            // êµ­ì±„ ìˆ˜ìµë¥ 
            indicators.bondYield = indicators.interestRate + 0.5 + (Math.random() - 0.5) * 0.3;
            
            // ì›ìì¬ ì§€ìˆ˜
            const commodityChange = (Math.random() - 0.5) * 10 * (1 + Math.abs(cycle.intensity));
            indicators.commodityIndex += commodityChange;
            indicators.commodityIndex = Math.max(50, Math.min(200, indicators.commodityIndex));
            
            // ë¶€ë™ì‚° ì§€ìˆ˜
            const realEstateChange = cycle.intensity * 5 + (Math.random() - 0.5) * 8;
            indicators.realEstateIndex += realEstateChange;
            indicators.realEstateIndex = Math.max(60, Math.min(300, indicators.realEstateIndex));
            
            // ì œì¡°ì—… PMI
            const pmiBase = 50 + cycle.intensity * 15;
            indicators.manufacturingIndex += (pmiBase - indicators.manufacturingIndex) * 0.2;
            indicators.manufacturingIndex = Math.max(25, Math.min(75, indicators.manufacturingIndex));
        }
        
        // ì¸í”Œë ˆì´ì…˜ íš¨ê³¼ ì ìš©
        function applyInflationEffects(monthlyInflation) {
            if (Math.abs(monthlyInflation) < 0.001) return; // ë¯¸ë¯¸í•œ ë³€ë™ì€ ë¬´ì‹œ
            
            // ì£¼ì‹ ê°€ê²©ì— ì˜í–¥ (ì¸í”Œë ˆì´ì…˜ì— ì¼ë¶€ ì—°ë™)
            gameState.stockMarket.stocks.forEach(stock => {
                if (Math.random() < 0.3) { // 30% í™•ë¥ ë¡œ ì ìš©
                    stock.price *= (1 + monthlyInflation * 0.7);
                }
            });
            
            // ì•”í˜¸í™”íëŠ” ì¸í”Œë ˆì´ì…˜ í—¤ì§€ ìì‚°ìœ¼ë¡œ ë” í° ì˜í–¥
            gameState.stockMarket.cryptos.forEach(crypto => {
                if (Math.random() < 0.2) { // 20% í™•ë¥ ë¡œ ì ìš©
                    crypto.price *= (1 + monthlyInflation * 1.2);
                }
            });
            
            // ë¶€ë™ì‚° ê°€ê²© ì˜í–¥
            gameState.landMarket.landPricePerUnit *= (1 + monthlyInflation * 0.8);
            
            // ì‚¬ì—… ë¹„ìš© ì¦ê°€
            gameState.roleData.businesses.forEach(business => {
                business.monthlyExpenses = Math.floor(business.monthlyExpenses * (1 + monthlyInflation * 0.9));
            });
        }
        
        // ê²½ì œ ì§€í‘œ í‘œì‹œ ì—…ë°ì´íŠ¸
        function updateEconomyDisplay() {
            const economy = gameState.economy;
            const cycle = economy.economicCycle;
            const indicators = economy.indicators;
            
            // ì¸í”Œë ˆì´ì…˜ìœ¨ í‘œì‹œ
            const inflationEl = document.getElementById('inflationRate');
            if (inflationEl) {
                inflationEl.textContent = economy.inflationRate.toFixed(1) + '%';
                inflationEl.style.color = economy.inflationRate > 4 ? 'var(--danger)' : 
                                         economy.inflationRate < 0 ? 'var(--warning)' : 'var(--success)';
            }
            
            // ê²½ê¸° êµ­ë©´ í‘œì‹œ
            const phaseEl = document.getElementById('economicPhase');
            if (phaseEl) {
                const phaseNames = {
                    'expansion': 'í™•ì¥ê¸°',
                    'peak': 'ì •ì ',
                    'contraction': 'ì¹¨ì²´ê¸°',
                    'trough': 'ì €ì '
                };
                phaseEl.textContent = phaseNames[cycle.phase];
                phaseEl.style.color = cycle.phase === 'expansion' || cycle.phase === 'peak' ? 'var(--success)' : 'var(--danger)';
            }
            
            // GDP ì„±ì¥ë¥ 
            const gdpEl = document.getElementById('gdpGrowth');
            if (gdpEl) {
                gdpEl.textContent = cycle.gdpGrowthRate.toFixed(1) + '%';
                gdpEl.style.color = cycle.gdpGrowthRate > 0 ? 'var(--success)' : 'var(--danger)';
            }
            
            // ì‹¤ì—…ë¥ 
            const unemploymentEl = document.getElementById('unemploymentRate');
            if (unemploymentEl) {
                unemploymentEl.textContent = cycle.unemploymentRate.toFixed(1) + '%';
                unemploymentEl.style.color = cycle.unemploymentRate < 5 ? 'var(--success)' : 'var(--danger)';
            }
            
            // ê¸°ì¤€ê¸ˆë¦¬
            const rateEl = document.getElementById('interestRate');
            if (rateEl) {
                rateEl.textContent = indicators.interestRate.toFixed(1) + '%';
            }
            
            // ì†Œë¹„ì ì‹ ë¢°ë„
            const confidenceEl = document.getElementById('consumerConfidence');
            if (confidenceEl) {
                confidenceEl.textContent = Math.round(cycle.consumerConfidence);
                confidenceEl.style.color = cycle.consumerConfidence > 70 ? 'var(--success)' : 
                                          cycle.consumerConfidence < 40 ? 'var(--danger)' : 'var(--warning)';
            }
            
            // ìì› ìƒíƒœ ì—…ë°ì´íŠ¸
            const resourceEl = document.getElementById('resourceStatus');
            if (resourceEl) {
                resourceEl.innerHTML = displayResourceStatus();
            }
            
            // êµ­ê°€ ê²½ì œ ì§€í‘œ ì—…ë°ì´íŠ¸
            const country = gameState.countrySystem;
            
            const populationEl = document.getElementById('countryPopulation');
            if (populationEl) {
                populationEl.textContent = (country.population / 1000000).toFixed(1) + 'ë°±ë§Œëª…';
            }
            
            const activityEl = document.getElementById('economicActivity');
            if (activityEl) {
                activityEl.textContent = (country.economicActivity * 100).toFixed(1) + '%';
                activityEl.style.color = country.economicActivity > 0.7 ? 'var(--success)' : 
                                        country.economicActivity < 0.4 ? 'var(--danger)' : 'var(--warning)';
            }
            
            const gdpPerCapitaEl = document.getElementById('gdpPerCapita');
            if (gdpPerCapitaEl) {
                gdpPerCapitaEl.textContent = '$' + country.gdpPerCapita.toLocaleString();
            }
            
            const spendingEl = document.getElementById('consumerSpendingIndex');
            if (spendingEl) {
                spendingEl.textContent = (country.consumerSpending * 100).toFixed(1) + '%';
                spendingEl.style.color = country.consumerSpending > 0.8 ? 'var(--success)' : 
                                        country.consumerSpending < 0.5 ? 'var(--danger)' : 'var(--warning)';
            }
            
            const formationEl = document.getElementById('businessFormation');
            if (formationEl) {
                formationEl.textContent = (country.businessFormationRate * 100).toFixed(1) + '%';
                formationEl.style.color = country.businessFormationRate > 0.2 ? 'var(--success)' : 
                                         country.businessFormationRate < 0.1 ? 'var(--danger)' : 'var(--warning)';
            }
        }
        
        // ëœë¤ ì‚¬ì—… ì´ë²¤íŠ¸ ì‹œìŠ¤í…œ (ì¢‹ìŒ 51%, ë‚˜ì¨ 49%)
        function triggerBusinessEvent() {
            if (gameState.roleData.businesses.length === 0) return;
            
            const isGoodEvent = Math.random() < 0.51; // 51% ì¢‹ì€ ì´ë²¤íŠ¸
            const business = gameState.roleData.businesses[Math.floor(Math.random() * gameState.roleData.businesses.length)];
            
            if (isGoodEvent) {
                // ì¢‹ì€ ì´ë²¤íŠ¸ë“¤
                const goodEvents = [
                    {
                        title: 'ğŸ‰ ëŒ€ë°• ë§¤ì¶œ',
                        description: 'ì˜ˆìƒì¹˜ ëª»í•œ ì¸ê¸°ë¡œ ë§¤ì¶œì´ ê¸‰ì¦í–ˆìŠµë‹ˆë‹¤!',
                        effect: () => {
                            const bonus = Math.floor(business.profit * 2);
                            gameState.currentUser.game_balance += bonus;
                            business.profit = Math.floor(business.profit * 1.1); // 10% ì˜êµ¬ ì¦ê°€
                            return bonus;
                        }
                    },
                    {
                        title: 'â­ VIP ê³ ê° ìœ ì¹˜',
                        description: 'ìœ ëª… ì¸ì‚¬ê°€ ë‹¨ê³¨ì´ ë˜ì—ˆìŠµë‹ˆë‹¤!',
                        effect: () => {
                            const bonus = Math.floor(business.profit * 1.5);
                            gameState.currentUser.game_balance += bonus;
                            business.value = Math.floor(business.value * 1.1); // 10% ê°€ì¹˜ ì¦ê°€
                            return bonus;
                        }
                    },
                    {
                        title: 'ğŸ† ì—…ê³„ 1ìœ„ ë‹¬ì„±',
                        description: 'í•´ë‹¹ ì—…ì¢…ì—ì„œ 1ìœ„ë¥¼ ë‹¬ì„±í–ˆìŠµë‹ˆë‹¤!',
                        effect: () => {
                            const bonus = Math.floor(business.value * 0.2);
                            gameState.currentUser.game_balance += bonus;
                            business.profit = Math.floor(business.profit * 1.2); // 20% ì˜êµ¬ ì¦ê°€
                            business.value = Math.floor(business.value * 1.5); // 50% ê°€ì¹˜ ì¦ê°€
                            return bonus;
                        }
                    },
                    {
                        title: 'ğŸ’° ì •ë¶€ ì§€ì›ê¸ˆ',
                        description: 'ì •ë¶€ì—ì„œ ìš°ìˆ˜ ê¸°ì—… ì§€ì›ê¸ˆì„ ì§€ê¸‰í–ˆìŠµë‹ˆë‹¤!',
                        effect: () => {
                            const bonus = Math.floor(Math.random() * 20000) + 10000;
                            gameState.currentUser.game_balance += bonus;
                            return bonus;
                        }
                    }
                ];
                
                const event = goodEvents[Math.floor(Math.random() * goodEvents.length)];
                const bonus = event.effect();
                showNotification(`${event.title}\n${business.name}: ${event.description} (+${bonus.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§)`, 'success');
                
            } else {
                // ë‚˜ìœ ì´ë²¤íŠ¸ë“¤
                const badEvents = [
                    {
                        title: 'ğŸ”¥ í™”ì¬ ì‚¬ê³ ',
                        description: 'ì‘ì€ í™”ì¬ë¡œ ì¸í•œ í”¼í•´ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.',
                        effect: () => {
                            const loss = Math.floor(business.value * 0.1);
                            gameState.currentUser.game_balance = Math.max(0, gameState.currentUser.game_balance - loss);
                            business.profit = Math.max(Math.floor(business.profit * 0.9), 100); // 10% ê°ì†Œ
                            business.value = Math.max(Math.floor(business.value * 0.85), 1000); // 15% ê°€ì¹˜ ê°ì†Œ
                            return loss;
                        }
                    },
                    {
                        title: 'ğŸ“‰ ê²½ê¸° ì¹¨ì²´',
                        description: 'ê²½ì œ ë¶ˆí™©ìœ¼ë¡œ ë§¤ì¶œì´ ê°ì†Œí–ˆìŠµë‹ˆë‹¤.',
                        effect: () => {
                            const loss = Math.floor(business.profit * 1.5);
                            gameState.currentUser.game_balance = Math.max(0, gameState.currentUser.game_balance - loss);
                            business.profit = Math.max(Math.floor(business.profit * 0.85), 50); // 15% ê°ì†Œ
                            return loss;
                        }
                    },
                    {
                        title: 'ğŸ’¸ ëŒ€í˜• ê³ ê° ì´íƒˆ',
                        description: 'ì£¼ìš” ê³ ê°ì´ ê²½ìŸì—…ì²´ë¡œ ë– ë‚¬ìŠµë‹ˆë‹¤.',
                        effect: () => {
                            const loss = Math.floor(business.profit * 2);
                            gameState.currentUser.game_balance = Math.max(0, gameState.currentUser.game_balance - loss);
                            business.profit = Math.max(Math.floor(business.profit * 0.8), 100); // 20% ê°ì†Œ
                            return loss;
                        }
                    },
                    {
                        title: 'âš–ï¸ ë²•ì  ë¶„ìŸ',
                        description: 'ì†Œì†¡ì— íœ˜ë§ë ¤ ë³€í˜¸ì‚¬ë¹„ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.',
                        effect: () => {
                            const loss = Math.floor(Math.random() * 15000) + 5000;
                            gameState.currentUser.game_balance = Math.max(0, gameState.currentUser.game_balance - loss);
                            return loss;
                        }
                    },
                    {
                        title: 'ğŸƒ í•µì‹¬ ì§ì› í‡´ì‚¬',
                        description: 'ì¤‘ìš”í•œ ì§ì›ì´ ê°‘ìê¸° ê·¸ë§Œë’€ìŠµë‹ˆë‹¤.',
                        effect: () => {
                            if (business.employees > 1) {
                                business.employees -= 1;
                                business.profit = Math.max(Math.floor(business.profit * 0.9), 50); // 10% ê°ì†Œ
                            }
                            const loss = Math.floor(business.profit * 0.5);
                            gameState.currentUser.game_balance = Math.max(0, gameState.currentUser.game_balance - loss);
                            return loss;
                        }
                    }
                ];
                
                const event = badEvents[Math.floor(Math.random() * badEvents.length)];
                const loss = event.effect();
                showNotification(`${event.title}\n${business.name}: ${event.description} (-${loss.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§)`, 'error');
            }
            
            updateBusinessDisplay();
            updateDisplay();
        }
        
        
        // ì§ì—…ë³„ ì´ˆê¸°í™” í•¨ìˆ˜ë“¤
        function initializeBusinessData() {
            if (gameState.roleData.businesses.length === 0) {
                // ê¸°ë³¸ ì‚¬ì—… í•˜ë‚˜ ìƒì„±
                gameState.roleData.businesses.push({
                    id: 1,
                    name: 'ìŠ¤íƒ€íŠ¸ì—…',
                    type: 'tech',
                    level: 1,
                    profit: 2000,
                    employees: 2,
                    value: 15000,
                    monthlyExpenses: 800
                });
            }
            updateBusinessDisplay();
        }
        
        function initializeInvestmentData() {
            if (gameState.roleData.investments.length === 0) {
                // ê¸°ë³¸ íˆ¬ì ìƒí’ˆë“¤
                gameState.roleData.investments.push(
                    { type: 'stock', name: 'ì‚¼ì„±ì „ì', amount: 5000, returnRate: 0.08, dividends: 200 },
                    { type: 'crypto', name: 'Bitcoin', amount: 3000, returnRate: 0.15, dividends: 0 }
                );
            }
            updateInvestmentDisplay();
        }
        
        function initializeWorkData() {
            if (gameState.roleData.workHistory.length === 0) {
                gameState.roleData.workHistory.push({
                    company: 'Tech Corp',
                    position: 'ì‚¬ì›',
                    startDate: new Date().toLocaleDateString(),
                    salary: 3000,
                    performance: 85
                });
            }
            updateWorkDisplay();
        }
        
        // ì‚¬ì—…ê°€ ê¸°ëŠ¥ë“¤
        function createNewBusiness() {
            openBusinessSelectionModal();
        }

        function openBusinessSelectionModal() {
            const modalContent = `
                <h2 style="text-align: center; margin-bottom: 30px; color: var(--primary);">ğŸª ìƒˆ ì‚¬ì—… ì‹œì‘</h2>
                
                <div style="margin-bottom: 20px;">
                    <p style="text-align: center; color: #cbd5e1; margin-bottom: 20px;">
                        ì°½ì—…í•  ì‚¬ì—… ì¢…ë¥˜ë¥¼ ì„ íƒí•˜ì„¸ìš”. ê° ì‚¬ì—…ë§ˆë‹¤ ì´ˆê¸° ë¹„ìš©, ìˆ˜ìµì„±, ìœ„í—˜ë„ê°€ ë‹¤ë¦…ë‹ˆë‹¤.
                    </p>
                </div>

                <div id="businessTypes" style="display: grid; gap: 15px;">
                    <!-- ì‚¬ì—… ìœ í˜•ë“¤ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                </div>
            `;
            
            showModal(modalContent);
            loadBusinessTypes();
        }

        function loadBusinessTypes() {
            const businessTypes = [
                { 
                    id: 'cafe',
                    name: 'ì¹´í˜', 
                    cost: 15000, 
                    profit: 1500, 
                    employees: 3, 
                    risk: 'ë‚®ìŒ',
                    description: 'ì•ˆì •ì ì¸ ìˆ˜ìµ, ë‚®ì€ ìœ„í—˜ë„',
                    successRate: 0.8,
                    sector: 'ì„œë¹„ìŠ¤ì—…'
                },
                { 
                    id: 'tech_startup',
                    name: 'IT ìŠ¤íƒ€íŠ¸ì—…', 
                    cost: 25000, 
                    profit: 3000, 
                    employees: 5, 
                    risk: 'ë†’ìŒ',
                    description: 'ë†’ì€ ìˆ˜ìµ ì ì¬ë ¥, ë†’ì€ ìœ„í—˜ë„',
                    successRate: 0.6,
                    sector: 'IT'
                },
                { 
                    id: 'ecommerce',
                    name: 'ì˜¨ë¼ì¸ ì‡¼í•‘ëª°', 
                    cost: 20000, 
                    profit: 2500, 
                    employees: 4, 
                    risk: 'ì¤‘ê°„',
                    description: 'í™•ì¥ì„± ì¢‹ìŒ, ì¤‘ê°„ ìœ„í—˜ë„',
                    successRate: 0.7,
                    sector: 'ì „ììƒê±°ë˜'
                },
                { 
                    id: 'restaurant',
                    name: 'ìŒì‹ì ', 
                    cost: 30000, 
                    profit: 2800, 
                    employees: 6, 
                    risk: 'ì¤‘ê°„',
                    description: 'ì§€ì—­ ê¸°ë°˜ ì‚¬ì—…, ì•ˆì •ì  ìˆ˜ìš”',
                    successRate: 0.65,
                    sector: 'ìŒì‹ì—…'
                },
                { 
                    id: 'manufacturing',
                    name: 'ì œì¡°ì—…', 
                    cost: 50000, 
                    profit: 4500, 
                    employees: 12, 
                    risk: 'ì¤‘ê°„',
                    description: 'ëŒ€ê·œëª¨ íˆ¬ì, ì•ˆì •ì  ìˆ˜ìµ',
                    successRate: 0.75,
                    sector: 'ì œì¡°ì—…'
                },
                { 
                    id: 'fintech',
                    name: 'í•€í…Œí¬', 
                    cost: 40000, 
                    profit: 5000, 
                    employees: 8, 
                    risk: 'ë§¤ìš° ë†’ìŒ',
                    description: 'í˜ì‹ ì  ê¸°ìˆ , ë§¤ìš° ë†’ì€ ìœ„í—˜-ìˆ˜ìµ',
                    successRate: 0.45,
                    sector: 'ê¸ˆìœµê¸°ìˆ '
                },
                { 
                    id: 'logistics',
                    name: 'ë¬¼ë¥˜ì—…', 
                    cost: 35000, 
                    profit: 3200, 
                    employees: 10, 
                    risk: 'ë‚®ìŒ',
                    description: 'í•„ìˆ˜ ì¸í”„ë¼, ì•ˆì •ì  ìˆ˜ìš”',
                    successRate: 0.85,
                    sector: 'ë¬¼ë¥˜'
                },
                { 
                    id: 'consulting',
                    name: 'ì»¨ì„¤íŒ…', 
                    cost: 12000, 
                    profit: 1800, 
                    employees: 2, 
                    risk: 'ë‚®ìŒ',
                    description: 'ì „ë¬¸ì„± ê¸°ë°˜, ë‚®ì€ ì´ˆê¸° ë¹„ìš©',
                    successRate: 0.9,
                    sector: 'ì „ë¬¸ì„œë¹„ìŠ¤'
                }
            ];

            const container = document.getElementById('businessTypes');
            if (!container) return;

            container.innerHTML = businessTypes.map(business => {
                const riskColor = business.risk === 'ë‚®ìŒ' ? 'var(--success)' : 
                                 business.risk === 'ì¤‘ê°„' ? 'var(--warning)' : 
                                 business.risk === 'ë†’ìŒ' ? 'var(--danger)' : '#ff6b6b';
                
                const canAfford = gameState.currentUser.game_balance >= business.cost;
                
                return `
                    <div class="business-type-card ${canAfford ? '' : 'disabled'}" 
                         onclick="${canAfford ? `selectBusinessType('${business.id}')` : ''}"
                         style="
                            padding: 20px;
                            background: ${canAfford ? 'rgba(255,255,255,0.05)' : 'rgba(255,255,255,0.02)'};
                            border: 1px solid ${canAfford ? 'rgba(255,255,255,0.1)' : 'rgba(255,255,255,0.05)'};
                            border-radius: 12px;
                            cursor: ${canAfford ? 'pointer' : 'not-allowed'};
                            transition: all 0.3s ease;
                            opacity: ${canAfford ? '1' : '0.5'};
                         "
                         onmouseover="this.style.backgroundColor='${canAfford ? 'rgba(255,255,255,0.08)' : 'rgba(255,255,255,0.02)'}'"
                         onmouseout="this.style.backgroundColor='${canAfford ? 'rgba(255,255,255,0.05)' : 'rgba(255,255,255,0.02)'}'">
                        
                        <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px;">
                            <h3 style="color: var(--primary); margin: 0;">${business.name}</h3>
                            <span style="background: ${riskColor}; color: white; padding: 2px 8px; border-radius: 12px; font-size: 0.8rem;">
                                ${business.risk}
                            </span>
                        </div>
                        
                        <p style="color: #94a3b8; margin: 8px 0; font-size: 0.9rem;">${business.description}</p>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px; font-size: 0.85rem;">
                            <div>
                                <span style="color: #64748b;">ì´ˆê¸° ë¹„ìš©:</span>
                                <div style="color: var(--danger); font-weight: 600;">${business.cost.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§</div>
                            </div>
                            <div>
                                <span style="color: #64748b;">ì›” ì˜ˆìƒìˆ˜ìµ:</span>
                                <div style="color: var(--success); font-weight: 600;">${business.profit.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§</div>
                            </div>
                            <div>
                                <span style="color: #64748b;">í•„ìš” ì§ì›:</span>
                                <div style="color: #e2e8f0; font-weight: 600;">${business.employees}ëª…</div>
                            </div>
                            <div>
                                <span style="color: #64748b;">ì„±ê³µë¥ :</span>
                                <div style="color: var(--warning); font-weight: 600;">${Math.round(business.successRate * 100)}%</div>
                            </div>
                        </div>
                        
                        <div style="margin-top: 10px; padding-top: 10px; border-top: 1px solid rgba(255,255,255,0.1);">
                            <span style="color: #64748b; font-size: 0.8rem;">ì—…ì¢…: ${business.sector}</span>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function selectBusinessType(businessId) {
            const businessTypes = [
                { id: 'cafe', name: 'ì¹´í˜', cost: 15000, profit: 1500, employees: 3, successRate: 0.8, sector: 'ì„œë¹„ìŠ¤ì—…' },
                { id: 'tech_startup', name: 'IT ìŠ¤íƒ€íŠ¸ì—…', cost: 25000, profit: 3000, employees: 5, successRate: 0.6, sector: 'IT' },
                { id: 'ecommerce', name: 'ì˜¨ë¼ì¸ ì‡¼í•‘ëª°', cost: 20000, profit: 2500, employees: 4, successRate: 0.7, sector: 'ì „ììƒê±°ë˜' },
                { id: 'restaurant', name: 'ìŒì‹ì ', cost: 30000, profit: 2800, employees: 6, successRate: 0.65, sector: 'ìŒì‹ì—…' },
                { id: 'manufacturing', name: 'ì œì¡°ì—…', cost: 50000, profit: 4500, employees: 12, successRate: 0.75, sector: 'ì œì¡°ì—…' },
                { id: 'fintech', name: 'í•€í…Œí¬', cost: 40000, profit: 5000, employees: 8, successRate: 0.45, sector: 'ê¸ˆìœµê¸°ìˆ ' },
                { id: 'logistics', name: 'ë¬¼ë¥˜ì—…', cost: 35000, profit: 3200, employees: 10, successRate: 0.85, sector: 'ë¬¼ë¥˜' },
                { id: 'consulting', name: 'ì»¨ì„¤íŒ…', cost: 12000, profit: 1800, employees: 2, successRate: 0.9, sector: 'ì „ë¬¸ì„œë¹„ìŠ¤' }
            ];
            
            const selectedBusiness = businessTypes.find(b => b.id === businessId);
            if (!selectedBusiness) return;

            if (gameState.currentUser.game_balance < selectedBusiness.cost) {
                showNotification(`${selectedBusiness.name} ì°½ì—…ì—ëŠ” ${selectedBusiness.cost.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§ì´ í•„ìš”í•©ë‹ˆë‹¤`, 'error');
                return;
            }

            // í™•ì¸ ëª¨ë‹¬ í‘œì‹œ
            const confirmContent = `
                <h2 style="text-align: center; margin-bottom: 30px; color: var(--primary);">ğŸª ì‚¬ì—… ì°½ì—… í™•ì¸</h2>
                
                <div style="background: rgba(99, 102, 241, 0.1); border: 1px solid rgba(99, 102, 241, 0.3); border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                    <h3 style="color: var(--primary); margin-bottom: 15px;">${selectedBusiness.name}</h3>
                    <div style="display: grid; gap: 10px; font-size: 0.9rem;">
                        <div><span style="color: #64748b;">ì´ˆê¸° íˆ¬ìê¸ˆ:</span> <span style="color: var(--danger); font-weight: 600;">${selectedBusiness.cost.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§</span></div>
                        <div><span style="color: #64748b;">ì˜ˆìƒ ì›” ìˆ˜ìµ:</span> <span style="color: var(--success); font-weight: 600;">${selectedBusiness.profit.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§</span></div>
                        <div><span style="color: #64748b;">í•„ìš” ì§ì›:</span> <span style="color: #e2e8f0; font-weight: 600;">${selectedBusiness.employees}ëª…</span></div>
                        <div><span style="color: #64748b;">ì„±ê³µ í™•ë¥ :</span> <span style="color: var(--warning); font-weight: 600;">${Math.round(selectedBusiness.successRate * 100)}%</span></div>
                        <div><span style="color: #64748b;">ì—…ì¢…:</span> <span style="color: #e2e8f0; font-weight: 600;">${selectedBusiness.sector}</span></div>
                    </div>
                </div>

                <div style="background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.3); border-radius: 12px; padding: 15px; margin-bottom: 20px;">
                    <p style="color: var(--danger); font-size: 0.9rem; margin: 0;">
                        âš ï¸ ì°½ì—…ì€ ìœ„í—˜ì„ ìˆ˜ë°˜í•©ë‹ˆë‹¤. ì‹¤íŒ¨í•  ê²½ìš° íˆ¬ìê¸ˆì˜ 30%ë§Œ íšŒìˆ˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                    </p>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 30px;">
                    <button onclick="closeModal()" style="
                        padding: 12px 20px;
                        border: 1px solid rgba(255,255,255,0.2);
                        background: rgba(255,255,255,0.05);
                        color: #e2e8f0;
                        border-radius: 8px;
                        cursor: pointer;
                        transition: all 0.3s ease;
                    ">ì·¨ì†Œ</button>
                    
                    <button onclick="confirmBusinessCreation('${businessId}')" style="
                        padding: 12px 20px;
                        border: none;
                        background: var(--primary);
                        color: white;
                        border-radius: 8px;
                        cursor: pointer;
                        font-weight: 600;
                        transition: all 0.3s ease;
                    ">ì°½ì—…í•˜ê¸°</button>
                </div>
            `;

            showModal(confirmContent);
        }

        function confirmBusinessCreation(businessId) {
            const businessTypes = [
                { id: 'cafe', name: 'ì¹´í˜', cost: 15000, profit: 1500, employees: 3, successRate: 0.8, sector: 'ì„œë¹„ìŠ¤ì—…' },
                { id: 'tech_startup', name: 'IT ìŠ¤íƒ€íŠ¸ì—…', cost: 25000, profit: 3000, employees: 5, successRate: 0.6, sector: 'IT' },
                { id: 'ecommerce', name: 'ì˜¨ë¼ì¸ ì‡¼í•‘ëª°', cost: 20000, profit: 2500, employees: 4, successRate: 0.7, sector: 'ì „ììƒê±°ë˜' },
                { id: 'restaurant', name: 'ìŒì‹ì ', cost: 30000, profit: 2800, employees: 6, successRate: 0.65, sector: 'ìŒì‹ì—…' },
                { id: 'manufacturing', name: 'ì œì¡°ì—…', cost: 50000, profit: 4500, employees: 12, successRate: 0.75, sector: 'ì œì¡°ì—…' },
                { id: 'fintech', name: 'í•€í…Œí¬', cost: 40000, profit: 5000, employees: 8, successRate: 0.45, sector: 'ê¸ˆìœµê¸°ìˆ ' },
                { id: 'logistics', name: 'ë¬¼ë¥˜ì—…', cost: 35000, profit: 3200, employees: 10, successRate: 0.85, sector: 'ë¬¼ë¥˜' },
                { id: 'consulting', name: 'ì»¨ì„¤íŒ…', cost: 12000, profit: 1800, employees: 2, successRate: 0.9, sector: 'ì „ë¬¸ì„œë¹„ìŠ¤' }
            ];
            
            const selectedBusiness = businessTypes.find(b => b.id === businessId);
            if (!selectedBusiness) return;

            gameState.currentUser.game_balance -= selectedBusiness.cost;
            
            const isSuccess = Math.random() < selectedBusiness.successRate;
            
            closeModal();
            
            if (isSuccess) {
                const newBusiness = {
                    id: Date.now(),
                    name: selectedBusiness.name,
                    type: 'business',
                    sector: selectedBusiness.sector,
                    level: 1,
                    profit: selectedBusiness.profit,
                    employees: selectedBusiness.employees,
                    value: selectedBusiness.cost,
                    monthlyExpenses: Math.floor(selectedBusiness.profit * 0.3),
                    founded: new Date().getFullYear(),
                    shares: 1000000, // 100ë§Œì£¼ (ìƒì¥ ì¤€ë¹„ìš©)
                    publicShares: 0, // ìƒì¥ í›„ ê³µê°œ ì£¼ì‹ìˆ˜
                    isPublic: false
                };
                
                gameState.roleData.businesses.push(newBusiness);
                updateBusinessDisplay();
                updateDisplay();
                showNotification(`âœ… ${selectedBusiness.name} ì‚¬ì—… ì°½ì—… ì„±ê³µ!`, 'success');
            } else {
                const recoveredAmount = Math.floor(selectedBusiness.cost * 0.3);
                gameState.currentUser.game_balance += recoveredAmount;
                updateDisplay();
                showNotification(`âŒ ${selectedBusiness.name} ì‚¬ì—… ì°½ì—… ì‹¤íŒ¨... ${recoveredAmount.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§ë§Œ íšŒìˆ˜í–ˆìŠµë‹ˆë‹¤.`, 'error');
            }
        }
        
        function expandBusiness() {
            if (gameState.roleData.businesses.length === 0) {
                showNotification('í™•ì¥í•  ì‚¬ì—…ì´ ì—†ìŠµë‹ˆë‹¤', 'error');
                return;
            }
            
            openBusinessExpansionModal();
        }

        function openBusinessExpansionModal() {
            const modalContent = `
                <h2 style="text-align: center; margin-bottom: 30px; color: var(--primary);">ğŸ“ˆ ì‚¬ì—… í™•ì¥</h2>
                
                <div style="margin-bottom: 20px;">
                    <p style="text-align: center; color: #cbd5e1; margin-bottom: 20px;">
                        í™•ì¥í•  ì‚¬ì—…ì„ ì„ íƒí•˜ê³  í™•ì¥ ë°©ë²•ì„ ê²°ì •í•˜ì„¸ìš”.
                    </p>
                </div>

                <div id="expansionBusinesses" style="display: grid; gap: 15px; margin-bottom: 30px;">
                    <!-- í™•ì¥ ê°€ëŠ¥í•œ ì‚¬ì—…ë“¤ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                </div>
            `;
            
            showModal(modalContent);
            loadExpansionBusinesses();
        }

        function loadExpansionBusinesses() {
            const container = document.getElementById('expansionBusinesses');
            if (!container) return;

            container.innerHTML = gameState.roleData.businesses.map(business => {
                return `
                    <div class="expansion-business-card" 
                         onclick="selectBusinessForExpansion(${business.id})"
                         style="
                            padding: 20px;
                            background: rgba(255,255,255,0.05);
                            border: 1px solid rgba(255,255,255,0.1);
                            border-radius: 12px;
                            cursor: pointer;
                            transition: all 0.3s ease;
                         "
                         onmouseover="this.style.backgroundColor='rgba(255,255,255,0.08)'"
                         onmouseout="this.style.backgroundColor='rgba(255,255,255,0.05)'">
                        
                        <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 15px;">
                            <div>
                                <h3 style="color: var(--primary); margin: 0; margin-bottom: 5px;">${business.name}</h3>
                                <p style="color: #94a3b8; margin: 0; font-size: 0.9rem;">ë ˆë²¨ ${business.level} | ${business.sector}</p>
                            </div>
                            <div style="text-align: right;">
                                <div style="color: var(--success); font-weight: 600; font-size: 0.9rem;">
                                    ${business.profit.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§/ì›”
                                </div>
                                <div style="color: #64748b; font-size: 0.8rem;">
                                    ì§ì› ${business.employees}ëª…
                                </div>
                            </div>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; font-size: 0.85rem;">
                            <div>
                                <span style="color: #64748b;">ê¸°ì—… ê°€ì¹˜:</span>
                                <div style="color: #e2e8f0; font-weight: 600;">${business.value.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§</div>
                            </div>
                            <div>
                                <span style="color: #64748b;">ì›” ì§€ì¶œ:</span>
                                <div style="color: var(--warning); font-weight: 600;">${business.monthlyExpenses.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§</div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function selectBusinessForExpansion(businessId) {
            const business = gameState.roleData.businesses.find(b => b.id === businessId);
            if (!business) return;

            // í˜„ì¬ ì§ì› ìˆ˜ì— ë”°ë¥¸ ì„±ê³µë¥  ë³´ë„ˆìŠ¤ ê³„ì‚°
            const currentEmployees = business.employees || 5;
            const employeeBonus = calculateEmployeeBonus(currentEmployees);

            const expansionOptions = [
                {
                    id: 'basic_expansion',
                    name: 'ê¸°ë³¸ í™•ì¥',
                    description: 'ê¸°ì¡´ ì‚¬ì—…ì„ í™•ì¥í•©ë‹ˆë‹¤',
                    cost: Math.floor(business.value * 0.5),
                    profitIncrease: 1.3,
                    valueIncrease: 1.3,
                    employeeIncrease: 2,
                    successRate: 0.7
                },
                {
                    id: 'premium_expansion',
                    name: 'í”„ë¦¬ë¯¸ì—„ í™•ì¥',
                    description: 'ê³ ê¸‰ ì¥ë¹„ì™€ ì‹œì„¤ë¡œ ëŒ€í­ í™•ì¥í•©ë‹ˆë‹¤',
                    cost: Math.floor(business.value * 0.8),
                    profitIncrease: 1.5,
                    valueIncrease: 1.6,
                    employeeIncrease: 4,
                    successRate: 0.6
                },
                {
                    id: 'tech_upgrade',
                    name: 'ê¸°ìˆ  ì—…ê·¸ë ˆì´ë“œ',
                    description: 'ìµœì‹  ê¸°ìˆ ì„ ë„ì…í•˜ì—¬ íš¨ìœ¨ì„±ì„ ë†’ì…ë‹ˆë‹¤',
                    cost: Math.floor(business.value * 0.6),
                    profitIncrease: 1.4,
                    valueIncrease: 1.4,
                    employeeIncrease: 1,
                    successRate: 0.65
                },
                {
                    id: 'market_expansion',
                    name: 'ì‹œì¥ í™•ì¥',
                    description: 'ìƒˆë¡œìš´ ì§€ì—­ì´ë‚˜ ê³ ê°ì¸µìœ¼ë¡œ ì§„ì¶œí•©ë‹ˆë‹¤',
                    cost: Math.floor(business.value * 0.7),
                    profitIncrease: 1.6,
                    valueIncrease: 1.5,
                    employeeIncrease: 3,
                    successRate: 0.55
                }
            ];

            const modalContent = `
                <h2 style="text-align: center; margin-bottom: 30px; color: var(--primary);">ğŸ“ˆ ${business.name} í™•ì¥ ë°©ë²•</h2>
                
                <div style="background: rgba(99, 102, 241, 0.1); border: 1px solid rgba(99, 102, 241, 0.3); border-radius: 12px; padding: 15px; margin-bottom: 20px;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; font-size: 0.9rem;">
                        <div><span style="color: #64748b;">í˜„ì¬ ë ˆë²¨:</span> <span style="color: #e2e8f0; font-weight: 600;">ë ˆë²¨ ${business.level}</span></div>
                        <div><span style="color: #64748b;">ì›” ìˆ˜ìµ:</span> <span style="color: var(--success); font-weight: 600;">${business.profit.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§</span></div>
                        <div><span style="color: #64748b;">ê¸°ì—… ê°€ì¹˜:</span> <span style="color: #e2e8f0; font-weight: 600;">${business.value.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§</span></div>
                        <div><span style="color: #64748b;">ì§ì› ìˆ˜:</span> <span style="color: #e2e8f0; font-weight: 600;">${business.employees}ëª…${employeeBonus > 0 ? ` (ë³´ë„ˆìŠ¤ +${Math.round(employeeBonus * 100)}%)` : ''}</span></div>
                    </div>
                    ${employeeBonus > 0 ? `
                        <div style="margin-top: 10px; padding: 8px; background: rgba(34, 197, 94, 0.1); border-radius: 8px; font-size: 0.8rem;">
                            ğŸ’ª <span style="color: var(--success);">ì§ì› ë³´ë„ˆìŠ¤ í™œì„±í™”!</span> ë§ì€ ì§ì›ë“¤ì´ í™•ì¥ ì„±ê³µë¥ ì„ ë†’ì—¬ì¤ë‹ˆë‹¤.
                        </div>
                    ` : `
                        <div style="margin-top: 10px; padding: 8px; background: rgba(156, 163, 175, 0.1); border-radius: 8px; font-size: 0.8rem;">
                            ğŸ’¡ <span style="color: #94a3b8;">ì§ì› ë³´ë„ˆìŠ¤:</span> 15ëª… ì´ìƒë¶€í„° í™•ì¥ ì„±ê³µë¥  ë³´ë„ˆìŠ¤ê°€ í™œì„±í™”ë©ë‹ˆë‹¤.
                        </div>
                    `}
                </div>

                <div id="expansionOptions" style="display: grid; gap: 15px;">
                    ${expansionOptions.map(option => {
                        const canAfford = gameState.currentUser.game_balance >= option.cost;
                        const profitIncrease = Math.floor(business.profit * option.profitIncrease) - business.profit;
                        
                        return `
                            <div class="expansion-option ${canAfford ? '' : 'disabled'}" 
                                 onclick="${canAfford ? `confirmExpansion(${businessId}, '${option.id}')` : ''}"
                                 style="
                                    padding: 20px;
                                    background: ${canAfford ? 'rgba(255,255,255,0.05)' : 'rgba(255,255,255,0.02)'};
                                    border: 1px solid ${canAfford ? 'rgba(255,255,255,0.1)' : 'rgba(255,255,255,0.05)'};
                                    border-radius: 12px;
                                    cursor: ${canAfford ? 'pointer' : 'not-allowed'};
                                    transition: all 0.3s ease;
                                    opacity: ${canAfford ? '1' : '0.5'};
                                 "
                                 onmouseover="this.style.backgroundColor='${canAfford ? 'rgba(255,255,255,0.08)' : 'rgba(255,255,255,0.02)'}'"
                                 onmouseout="this.style.backgroundColor='${canAfford ? 'rgba(255,255,255,0.05)' : 'rgba(255,255,255,0.02)'}'">
                                
                                <h3 style="color: var(--primary); margin: 0 0 8px 0;">${option.name}</h3>
                                <p style="color: #94a3b8; margin: 0 0 15px 0; font-size: 0.9rem;">${option.description}</p>
                                
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px; font-size: 0.85rem;">
                                    <div>
                                        <span style="color: #64748b;">ë¹„ìš©:</span>
                                        <div style="color: var(--danger); font-weight: 600;">${option.cost.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§</div>
                                    </div>
                                    <div>
                                        <span style="color: #64748b;">ìˆ˜ìµ ì¦ê°€:</span>
                                        <div style="color: var(--success); font-weight: 600;">+${profitIncrease.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§/ì›”</div>
                                    </div>
                                    <div>
                                        <span style="color: #64748b;">ì§ì› ì¦ê°€:</span>
                                        <div style="color: #e2e8f0; font-weight: 600;">+${option.employeeIncrease}ëª…</div>
                                    </div>
                                    <div>
                                        <span style="color: #64748b;">ì„±ê³µë¥ :</span>
                                        <div style="color: var(--warning); font-weight: 600;">${Math.round(Math.min(95, (option.successRate + employeeBonus) * 100))}%${employeeBonus > 0 ? ` (+${Math.round(employeeBonus * 100)}%)` : ''}</div>
                                    </div>
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>

                <div style="margin-top: 20px; text-align: center;">
                    <button onclick="openBusinessExpansionModal()" style="
                        padding: 10px 20px;
                        border: 1px solid rgba(255,255,255,0.2);
                        background: rgba(255,255,255,0.05);
                        color: #e2e8f0;
                        border-radius: 8px;
                        cursor: pointer;
                        transition: all 0.3s ease;
                    ">ë‹¤ë¥¸ ì‚¬ì—… ì„ íƒ</button>
                </div>
            `;

            showModal(modalContent);
        }

        function confirmExpansion(businessId, optionId) {
            const business = gameState.roleData.businesses.find(b => b.id === businessId);
            if (!business) return;

            // í˜„ì¬ ì§ì› ìˆ˜ì— ë”°ë¥¸ ì„±ê³µë¥  ë³´ë„ˆìŠ¤ ê³„ì‚°
            const currentEmployees = business.employees || 5;
            const employeeBonus = calculateEmployeeBonus(currentEmployees);
            
            const expansionOptions = [
                { id: 'basic_expansion', cost: Math.floor(business.value * 0.5), profitIncrease: 1.3, valueIncrease: 1.3, employeeIncrease: 2, successRate: 0.7 },
                { id: 'premium_expansion', cost: Math.floor(business.value * 0.8), profitIncrease: 1.5, valueIncrease: 1.6, employeeIncrease: 4, successRate: 0.6 },
                { id: 'tech_upgrade', cost: Math.floor(business.value * 0.6), profitIncrease: 1.4, valueIncrease: 1.4, employeeIncrease: 1, successRate: 0.65 },
                { id: 'market_expansion', cost: Math.floor(business.value * 0.7), profitIncrease: 1.6, valueIncrease: 1.5, employeeIncrease: 3, successRate: 0.55 }
            ];

            const selectedOption = expansionOptions.find(o => o.id === optionId);
            if (!selectedOption) return;

            if (gameState.currentUser.game_balance < selectedOption.cost) {
                showNotification(`í™•ì¥ ë¹„ìš©ì´ ë¶€ì¡±í•©ë‹ˆë‹¤. ${selectedOption.cost.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§ í•„ìš”`, 'error');
                return;
            }

            gameState.currentUser.game_balance -= selectedOption.cost;
            
            // ì§ì› ìˆ˜ ë³´ë„ˆìŠ¤ë¥¼ ì„±ê³µë¥ ì— ì ìš©
            const finalSuccessRate = Math.min(0.95, selectedOption.successRate + employeeBonus);
            const isSuccess = Math.random() < finalSuccessRate;
            
            closeModal();
            
            if (isSuccess) {
                business.level += 1;
                business.profit = Math.floor(business.profit * selectedOption.profitIncrease);
                business.value = Math.floor(business.value * selectedOption.valueIncrease);
                business.employees += selectedOption.employeeIncrease;
                business.monthlyExpenses = Math.floor(business.profit * 0.3);
                
                updateBusinessDisplay();
                updateDisplay();
                const bonusText = employeeBonus > 0 ? ` (ì§ì› ë³´ë„ˆìŠ¤ +${Math.round(employeeBonus * 100)}%)` : '';
                showNotification(`âœ… ${business.name} í™•ì¥ ì„±ê³µ! ë ˆë²¨ ${business.level}ë¡œ ì—…ê·¸ë ˆì´ë“œ${bonusText}`, 'success');
            } else {
                const recoveredAmount = Math.floor(selectedOption.cost * 0.25);
                gameState.currentUser.game_balance += recoveredAmount;
                business.profit = Math.max(Math.floor(business.profit * 0.9), 100);
                business.value = Math.max(Math.floor(business.value * 0.85), 1000);
                business.monthlyExpenses = Math.floor(business.profit * 0.3);
                
                updateBusinessDisplay();
                updateDisplay();
                showNotification(`âŒ ${business.name} í™•ì¥ ì‹¤íŒ¨... ${recoveredAmount.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§ë§Œ íšŒìˆ˜, ì‚¬ì—… ì†ì‹¤ ë°œìƒ`, 'error');
            }
        }
        
        function hirEmployee() {
            if (gameState.roleData.businesses.length === 0) {
                showNotification('ì§ì›ì„ ì±„ìš©í•  ì‚¬ì—…ì´ ì—†ìŠµë‹ˆë‹¤', 'error');
                return;
            }
            
            openHiringModal();
        }

        function openHiringModal() {
            const modalContent = `
                <h2 style="text-align: center; margin-bottom: 30px; color: var(--primary);">ğŸ‘¥ ì§ì› ì±„ìš©</h2>
                
                <div style="margin-bottom: 20px;">
                    <p style="text-align: center; color: #cbd5e1; margin-bottom: 20px;">
                        ì±„ìš©í•  ì‚¬ì—…ê³¼ ì§ì› ìœ í˜•ì„ ì„ íƒí•˜ì„¸ìš”.
                    </p>
                </div>

                <div id="hiringBusinesses" style="display: grid; gap: 15px; margin-bottom: 30px;">
                    <!-- ì±„ìš© ê°€ëŠ¥í•œ ì‚¬ì—…ë“¤ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                </div>
            `;
            
            showModal(modalContent);
            loadHiringBusinesses();
        }

        function loadHiringBusinesses() {
            const container = document.getElementById('hiringBusinesses');
            if (!container) return;

            container.innerHTML = gameState.roleData.businesses.map(business => {
                return `
                    <div class="hiring-business-card" 
                         onclick="selectBusinessForHiring(${business.id})"
                         style="
                            padding: 20px;
                            background: rgba(255,255,255,0.05);
                            border: 1px solid rgba(255,255,255,0.1);
                            border-radius: 12px;
                            cursor: pointer;
                            transition: all 0.3s ease;
                         "
                         onmouseover="this.style.backgroundColor='rgba(255,255,255,0.08)'"
                         onmouseout="this.style.backgroundColor='rgba(255,255,255,0.05)'">
                        
                        <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 15px;">
                            <div>
                                <h3 style="color: var(--primary); margin: 0; margin-bottom: 5px;">${business.name}</h3>
                                <p style="color: #94a3b8; margin: 0; font-size: 0.9rem;">ë ˆë²¨ ${business.level} | ${business.sector}</p>
                            </div>
                            <div style="text-align: right;">
                                <div style="color: var(--success); font-weight: 600; font-size: 0.9rem;">
                                    ${business.profit.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§/ì›”
                                </div>
                                <div style="color: #64748b; font-size: 0.8rem;">
                                    ì§ì› ${business.employees}ëª…
                                </div>
                            </div>
                        </div>
                        
                        <div style="background: rgba(99, 102, 241, 0.1); border: 1px solid rgba(99, 102, 241, 0.2); border-radius: 8px; padding: 10px; font-size: 0.85rem;">
                            <span style="color: #64748b;">ì¶”ì²œ ì±„ìš©: </span>
                            <span style="color: var(--primary); font-weight: 600;">
                                ${getRecommendedPosition(business)}
                            </span>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function getRecommendedPosition(business) {
            const recommendations = {
                'ì„œë¹„ìŠ¤ì—…': ['ë°”ë¦¬ìŠ¤íƒ€', 'ë§¤ì¥ ë§¤ë‹ˆì €', 'ê³ ê° ì„œë¹„ìŠ¤ ë‹´ë‹¹'],
                'IT': ['ê°œë°œì', 'UX ë””ìì´ë„ˆ', 'ë°ì´í„° ë¶„ì„ê°€'],
                'ì „ììƒê±°ë˜': ['ë§ˆì¼€íŒ… ì „ë¬¸ê°€', 'ë¬¼ë¥˜ ê´€ë¦¬ì', 'ê³ ê° ì§€ì›'],
                'ìŒì‹ì—…': ['ì…°í”„', 'í™€ ë§¤ë‹ˆì €', 'ì£¼ë°© ë³´ì¡°'],
                'ì œì¡°ì—…': ['ìƒì‚° ê´€ë¦¬ì', 'í’ˆì§ˆ ê²€ì‚¬ì›', 'ê¸°ìˆ ì'],
                'ê¸ˆìœµê¸°ìˆ ': ['ê¸ˆìœµ ë¶„ì„ê°€', 'AI ì—”ì§€ë‹ˆì–´', 'ì»´í”Œë¼ì´ì–¸ìŠ¤'],
                'ë¬¼ë¥˜': ['ìš´ì†¡ ê´€ë¦¬ì', 'ì°½ê³  ê´€ë¦¬ì', 'ë°°ì†¡ ê¸°ì‚¬'],
                'ì „ë¬¸ì„œë¹„ìŠ¤': ['ì»¨ì„¤í„´íŠ¸', 'í”„ë¡œì íŠ¸ ë§¤ë‹ˆì €', 'ì˜ì—… ë‹´ë‹¹']
            };
            
            const positions = recommendations[business.sector] || ['ì¼ë°˜ ì§ì›', 'ê´€ë¦¬ì', 'ì „ë¬¸ê°€'];
            return positions[Math.floor(Math.random() * positions.length)];
        }

        function selectBusinessForHiring(businessId) {
            const business = gameState.roleData.businesses.find(b => b.id === businessId);
            if (!business) return;

            const hiringOptions = [
                {
                    id: 'junior',
                    name: 'ì‹ ì… ì§ì›',
                    description: 'ê²½í—˜ì€ ë¶€ì¡±í•˜ì§€ë§Œ ì—´ì •ì ì¸ ì‹ ì… ì§ì›',
                    cost: 3000,
                    profitIncrease: 300,
                    successRate: 0.9,
                    salaryMultiplier: 0.8
                },
                {
                    id: 'experienced',
                    name: 'ê²½ë ¥ ì§ì›',
                    description: 'í’ë¶€í•œ ê²½í—˜ì„ ê°€ì§„ ì¤‘ê²¬ ì§ì›',
                    cost: 6000,
                    profitIncrease: 600,
                    successRate: 0.75,
                    salaryMultiplier: 1.2
                },
                {
                    id: 'expert',
                    name: 'ì „ë¬¸ê°€',
                    description: 'í•´ë‹¹ ë¶„ì•¼ì˜ ì „ë¬¸ê°€ê¸‰ ì¸ì¬',
                    cost: 10000,
                    profitIncrease: 1000,
                    successRate: 0.6,
                    salaryMultiplier: 1.5
                },
                {
                    id: 'manager',
                    name: 'ê´€ë¦¬ì',
                    description: 'íŒ€ì„ ì´ëŒ ìˆ˜ ìˆëŠ” ë¦¬ë”ì‹­ì„ ê°€ì§„ ê´€ë¦¬ì',
                    cost: 15000,
                    profitIncrease: 1500,
                    successRate: 0.5,
                    salaryMultiplier: 2.0
                }
            ];

            const modalContent = `
                <h2 style="text-align: center; margin-bottom: 30px; color: var(--primary);">ğŸ‘¥ ${business.name} - ì§ì› ì±„ìš©</h2>
                
                <div style="background: rgba(99, 102, 241, 0.1); border: 1px solid rgba(99, 102, 241, 0.3); border-radius: 12px; padding: 15px; margin-bottom: 20px;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; font-size: 0.9rem;">
                        <div><span style="color: #64748b;">íšŒì‚¬:</span> <span style="color: #e2e8f0; font-weight: 600;">${business.name}</span></div>
                        <div><span style="color: #64748b;">ì—…ì¢…:</span> <span style="color: #e2e8f0; font-weight: 600;">${business.sector}</span></div>
                        <div><span style="color: #64748b;">í˜„ì¬ ì§ì›:</span> <span style="color: #e2e8f0; font-weight: 600;">${business.employees}ëª…</span></div>
                        <div><span style="color: #64748b;">ì›” ìˆ˜ìµ:</span> <span style="color: var(--success); font-weight: 600;">${business.profit.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§</span></div>
                    </div>
                </div>

                <div id="hiringOptions" style="display: grid; gap: 15px;">
                    ${hiringOptions.map(option => {
                        const canAfford = gameState.currentUser.game_balance >= option.cost;
                        
                        return `
                            <div class="hiring-option ${canAfford ? '' : 'disabled'}" 
                                 onclick="${canAfford ? `confirmHiring(${businessId}, '${option.id}')` : ''}"
                                 style="
                                    padding: 20px;
                                    background: ${canAfford ? 'rgba(255,255,255,0.05)' : 'rgba(255,255,255,0.02)'};
                                    border: 1px solid ${canAfford ? 'rgba(255,255,255,0.1)' : 'rgba(255,255,255,0.05)'};
                                    border-radius: 12px;
                                    cursor: ${canAfford ? 'pointer' : 'not-allowed'};
                                    transition: all 0.3s ease;
                                    opacity: ${canAfford ? '1' : '0.5'};
                                 "
                                 onmouseover="this.style.backgroundColor='${canAfford ? 'rgba(255,255,255,0.08)' : 'rgba(255,255,255,0.02)'}'"
                                 onmouseout="this.style.backgroundColor='${canAfford ? 'rgba(255,255,255,0.05)' : 'rgba(255,255,255,0.02)'}'">
                                
                                <h3 style="color: var(--primary); margin: 0 0 8px 0;">${option.name}</h3>
                                <p style="color: #94a3b8; margin: 0 0 15px 0; font-size: 0.9rem;">${option.description}</p>
                                
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px; font-size: 0.85rem;">
                                    <div>
                                        <span style="color: #64748b;">ì±„ìš© ë¹„ìš©:</span>
                                        <div style="color: var(--danger); font-weight: 600;">${option.cost.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§</div>
                                    </div>
                                    <div>
                                        <span style="color: #64748b;">ìˆ˜ìµ ì¦ê°€:</span>
                                        <div style="color: var(--success); font-weight: 600;">+${option.profitIncrease.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§/ì›”</div>
                                    </div>
                                    <div>
                                        <span style="color: #64748b;">ì„±ê³µë¥ :</span>
                                        <div style="color: var(--warning); font-weight: 600;">${Math.round(option.successRate * 100)}%</div>
                                    </div>
                                    <div>
                                        <span style="color: #64748b;">ê¸‰ì—¬ ìˆ˜ì¤€:</span>
                                        <div style="color: #e2e8f0; font-weight: 600;">${option.salaryMultiplier}x</div>
                                    </div>
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>

                <div style="margin-top: 20px; text-align: center;">
                    <button onclick="openHiringModal()" style="
                        padding: 10px 20px;
                        border: 1px solid rgba(255,255,255,0.2);
                        background: rgba(255,255,255,0.05);
                        color: #e2e8f0;
                        border-radius: 8px;
                        cursor: pointer;
                        transition: all 0.3s ease;
                    ">ë‹¤ë¥¸ ì‚¬ì—… ì„ íƒ</button>
                </div>
            `;

            showModal(modalContent);
        }

        function confirmHiring(businessId, optionId) {
            const business = gameState.roleData.businesses.find(b => b.id === businessId);
            if (!business) return;

            const hiringOptions = [
                { id: 'junior', cost: 3000, profitIncrease: 300, successRate: 0.9, salaryMultiplier: 0.8, name: 'ì‹ ì… ì§ì›' },
                { id: 'experienced', cost: 6000, profitIncrease: 600, successRate: 0.75, salaryMultiplier: 1.2, name: 'ê²½ë ¥ ì§ì›' },
                { id: 'expert', cost: 10000, profitIncrease: 1000, successRate: 0.6, salaryMultiplier: 1.5, name: 'ì „ë¬¸ê°€' },
                { id: 'manager', cost: 15000, profitIncrease: 1500, successRate: 0.5, salaryMultiplier: 2.0, name: 'ê´€ë¦¬ì' }
            ];

            const selectedOption = hiringOptions.find(o => o.id === optionId);
            if (!selectedOption) return;

            if (gameState.currentUser.game_balance < selectedOption.cost) {
                showNotification(`ì±„ìš© ë¹„ìš©ì´ ë¶€ì¡±í•©ë‹ˆë‹¤. ${selectedOption.cost.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§ í•„ìš”`, 'error');
                return;
            }

            gameState.currentUser.game_balance -= selectedOption.cost;
            
            const isSuccess = Math.random() < selectedOption.successRate;
            
            closeModal();
            
            if (isSuccess) {
                business.employees += 1;
                business.profit += selectedOption.profitIncrease;
                business.monthlyExpenses += Math.floor(selectedOption.profitIncrease * selectedOption.salaryMultiplier * 0.5);
                business.value += selectedOption.profitIncrease * 10; // ì¸ì¬ ê°€ì¹˜ ë°˜ì˜
                
                updateBusinessDisplay();
                updateDisplay();
                showNotification(`âœ… ${selectedOption.name} ì±„ìš© ì„±ê³µ! ${business.name}ì˜ ì—­ëŸ‰ì´ ê°•í™”ë˜ì—ˆìŠµë‹ˆë‹¤.`, 'success');
            } else {
                // ì‹¤íŒ¨ ì‹œ ì±„ìš©ë¹„ì˜ 30%ë§Œ íšŒìˆ˜
                const recoveredAmount = Math.floor(selectedOption.cost * 0.3);
                gameState.currentUser.game_balance += recoveredAmount;
                updateDisplay();
                showNotification(`âŒ ${selectedOption.name} ì±„ìš© ì‹¤íŒ¨... ${recoveredAmount.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§ë§Œ íšŒìˆ˜í–ˆìŠµë‹ˆë‹¤.`, 'error');
            }
        }
        
        function sellBusiness() {
            if (gameState.roleData.businesses.length === 0) {
                showNotification('ë§¤ê°í•  ì‚¬ì—…ì´ ì—†ìŠµë‹ˆë‹¤', 'error');
                return;
            }
            
            openSaleModal();
        }

        function openSaleModal() {
            const modalContent = `
                <h2 style="text-align: center; margin-bottom: 30px; color: var(--primary);">ğŸ’° ì‚¬ì—… ë§¤ê°</h2>
                
                <div style="margin-bottom: 20px;">
                    <p style="text-align: center; color: #cbd5e1; margin-bottom: 20px;">
                        ë§¤ê°í•  ì‚¬ì—…ì„ ì„ íƒí•˜ì„¸ìš”. ì‹œì¥ ìƒí™©ê³¼ ê¸°ì—… ì„±ê³¼ì— ë”°ë¼ ë§¤ê°ê°€ê°€ ê²°ì •ë©ë‹ˆë‹¤.
                    </p>
                </div>

                <div id="saleBusinesses" style="display: grid; gap: 15px; margin-bottom: 30px;">
                    <!-- ë§¤ê° ê°€ëŠ¥í•œ ì‚¬ì—…ë“¤ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                </div>
            `;
            
            showModal(modalContent);
            loadSaleBusinesses();
        }

        function loadSaleBusinesses() {
            const container = document.getElementById('saleBusinesses');
            if (!container) return;

            container.innerHTML = gameState.roleData.businesses.map(business => {
                const marketMultiplier = 0.7 + Math.random() * 0.4; // 0.7~1.1 ì‹œì¥ ìƒí™©
                const performanceMultiplier = business.level >= 3 ? 1.1 : business.level >= 2 ? 1.0 : 0.9;
                const estimatedPrice = Math.floor(business.value * marketMultiplier * performanceMultiplier);
                const roi = business.profit > 0 ? Math.floor((estimatedPrice / (business.value || 1)) * 100) : 0;
                
                return `
                    <div class="sale-business-card" 
                         onclick="selectBusinessForSale(${business.id})"
                         style="
                            padding: 20px;
                            background: rgba(255,255,255,0.05);
                            border: 1px solid rgba(255,255,255,0.1);
                            border-radius: 12px;
                            cursor: pointer;
                            transition: all 0.3s ease;
                         "
                         onmouseover="this.style.backgroundColor='rgba(255,255,255,0.08)'"
                         onmouseout="this.style.backgroundColor='rgba(255,255,255,0.05)'">
                        
                        <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 15px;">
                            <div>
                                <h3 style="color: var(--primary); margin: 0; margin-bottom: 5px;">${business.name}</h3>
                                <p style="color: #94a3b8; margin: 0; font-size: 0.9rem;">ë ˆë²¨ ${business.level} | ${business.sector} | ì„¤ë¦½ ${business.founded}ë…„</p>
                            </div>
                            <div style="text-align: right;">
                                <div style="color: var(--success); font-weight: 600; font-size: 1.1rem;">
                                    ${estimatedPrice.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§
                                </div>
                                <div style="color: ${roi >= 100 ? 'var(--success)' : roi >= 80 ? 'var(--warning)' : 'var(--danger)'}; font-size: 0.8rem;">
                                    ${roi}% íšŒìˆ˜ìœ¨
                                </div>
                            </div>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-bottom: 15px; font-size: 0.85rem;">
                            <div>
                                <span style="color: #64748b;">ì›” ìˆ˜ìµ:</span>
                                <div style="color: var(--success); font-weight: 600;">${business.profit.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§</div>
                            </div>
                            <div>
                                <span style="color: #64748b;">ì§ì› ìˆ˜:</span>
                                <div style="color: #e2e8f0; font-weight: 600;">${business.employees}ëª…</div>
                            </div>
                            <div>
                                <span style="color: #64748b;">ê¸°ì—… ê°€ì¹˜:</span>
                                <div style="color: #cbd5e1; font-weight: 600;">${business.value.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§</div>
                            </div>
                        </div>

                        <div style="background: ${roi >= 100 ? 'rgba(16, 185, 129, 0.1)' : roi >= 80 ? 'rgba(245, 158, 11, 0.1)' : 'rgba(239, 68, 68, 0.1)'}; 
                                    border: 1px solid ${roi >= 100 ? 'rgba(16, 185, 129, 0.3)' : roi >= 80 ? 'rgba(245, 158, 11, 0.3)' : 'rgba(239, 68, 68, 0.3)'}; 
                                    border-radius: 8px; padding: 10px; font-size: 0.85rem;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                <span style="color: #64748b;">ì‹œì¥ ìƒí™©:</span>
                                <span style="color: ${marketMultiplier >= 1.0 ? 'var(--success)' : marketMultiplier >= 0.9 ? 'var(--warning)' : 'var(--danger)'}; font-weight: 600;">
                                    ${marketMultiplier >= 1.0 ? 'í˜¸í™©' : marketMultiplier >= 0.9 ? 'ë³´í†µ' : 'ë¶ˆí™©'}
                                </span>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span style="color: #64748b;">ê¸°ì—… ì„±ê³¼:</span>
                                <span style="color: ${performanceMultiplier >= 1.1 ? 'var(--success)' : performanceMultiplier >= 1.0 ? 'var(--warning)' : 'var(--danger)'}; font-weight: 600;">
                                    ${performanceMultiplier >= 1.1 ? 'ìš°ìˆ˜' : performanceMultiplier >= 1.0 ? 'ë³´í†µ' : 'ì €ì¡°'}
                                </span>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function selectBusinessForSale(businessId) {
            const business = gameState.roleData.businesses.find(b => b.id === businessId);
            if (!business) return;

            const saleOptions = [
                {
                    id: 'quick_sale',
                    name: 'ë¹ ë¥¸ ë§¤ê°',
                    description: 'ì‹œì¥ê°€ë³´ë‹¤ ë‚®ì§€ë§Œ ì¦‰ì‹œ í˜„ê¸ˆí™”',
                    multiplier: 0.7,
                    timeframe: 'ì¦‰ì‹œ',
                    risk: 'ì—†ìŒ'
                },
                {
                    id: 'market_sale',
                    name: 'ì‹œì¥ê°€ ë§¤ê°',
                    description: 'í˜„ì¬ ì‹œì¥ê°€ë¡œ ë§¤ê°',
                    multiplier: 0.85,
                    timeframe: '1-2ì£¼',
                    risk: 'ë‚®ìŒ'
                },
                {
                    id: 'premium_sale',
                    name: 'í”„ë¦¬ë¯¸ì—„ ë§¤ê°',
                    description: 'ë” ë‚˜ì€ ê°€ê²©ì„ ìœ„í•´ ì‹œê°„ì„ íˆ¬ì',
                    multiplier: 1.0,
                    timeframe: '1-2ê°œì›”',
                    risk: 'ì¤‘ê°„'
                },
                {
                    id: 'strategic_sale',
                    name: 'ì „ëµì  ë§¤ê°',
                    description: 'ì „ëµì  íˆ¬ììì—ê²Œ ë†’ì€ ê°€ê²©ìœ¼ë¡œ ë§¤ê°',
                    multiplier: 1.2,
                    timeframe: '3-6ê°œì›”',
                    risk: 'ë†’ìŒ'
                }
            ];

            const marketMultiplier = 0.7 + Math.random() * 0.4;
            const performanceMultiplier = business.level >= 3 ? 1.1 : business.level >= 2 ? 1.0 : 0.9;
            const basePrice = Math.floor(business.value * marketMultiplier * performanceMultiplier);

            const modalContent = `
                <h2 style="text-align: center; margin-bottom: 30px; color: var(--primary);">ğŸ’° ${business.name} ë§¤ê° ë°©ë²•</h2>
                
                <div style="background: rgba(99, 102, 241, 0.1); border: 1px solid rgba(99, 102, 241, 0.3); border-radius: 12px; padding: 15px; margin-bottom: 20px;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; font-size: 0.9rem;">
                        <div><span style="color: #64748b;">íšŒì‚¬ëª…:</span> <span style="color: #e2e8f0; font-weight: 600;">${business.name}</span></div>
                        <div><span style="color: #64748b;">ì—…ì¢…:</span> <span style="color: #e2e8f0; font-weight: 600;">${business.sector}</span></div>
                        <div><span style="color: #64748b;">ë ˆë²¨:</span> <span style="color: #e2e8f0; font-weight: 600;">${business.level}</span></div>
                        <div><span style="color: #64748b;">ì›” ìˆ˜ìµ:</span> <span style="color: var(--success); font-weight: 600;">${business.profit.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§</span></div>
                        <div><span style="color: #64748b;">ì§ì› ìˆ˜:</span> <span style="color: #e2e8f0; font-weight: 600;">${business.employees}ëª…</span></div>
                        <div><span style="color: #64748b;">ê¸°ì—… ê°€ì¹˜:</span> <span style="color: #e2e8f0; font-weight: 600;">${business.value.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§</span></div>
                    </div>
                </div>

                <div id="saleOptions" style="display: grid; gap: 15px;">
                    ${saleOptions.map(option => {
                        const finalPrice = Math.floor(basePrice * option.multiplier);
                        const successRate = option.id === 'strategic_sale' ? 0.6 : 
                                          option.id === 'premium_sale' ? 0.8 : 
                                          option.id === 'market_sale' ? 0.9 : 1.0;
                        
                        return `
                            <div class="sale-option" 
                                 onclick="confirmSale(${businessId}, '${option.id}')"
                                 style="
                                    padding: 20px;
                                    background: rgba(255,255,255,0.05);
                                    border: 1px solid rgba(255,255,255,0.1);
                                    border-radius: 12px;
                                    cursor: pointer;
                                    transition: all 0.3s ease;
                                 "
                                 onmouseover="this.style.backgroundColor='rgba(255,255,255,0.08)'"
                                 onmouseout="this.style.backgroundColor='rgba(255,255,255,0.05)'">
                                
                                <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px;">
                                    <h3 style="color: var(--primary); margin: 0;">${option.name}</h3>
                                    <div style="text-align: right;">
                                        <div style="color: var(--success); font-weight: 600; font-size: 1.1rem;">
                                            ${finalPrice.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§
                                        </div>
                                        <div style="color: #64748b; font-size: 0.8rem;">
                                            ì„±ê³µë¥  ${Math.round(successRate * 100)}%
                                        </div>
                                    </div>
                                </div>
                                
                                <p style="color: #94a3b8; margin: 0 0 15px 0; font-size: 0.9rem;">${option.description}</p>
                                
                                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; font-size: 0.85rem;">
                                    <div>
                                        <span style="color: #64748b;">ì˜ˆìƒ ê¸°ê°„:</span>
                                        <div style="color: #e2e8f0; font-weight: 600;">${option.timeframe}</div>
                                    </div>
                                    <div>
                                        <span style="color: #64748b;">ìœ„í—˜ë„:</span>
                                        <div style="color: ${option.risk === 'ì—†ìŒ' ? 'var(--success)' : option.risk === 'ë‚®ìŒ' ? 'var(--warning)' : option.risk === 'ì¤‘ê°„' ? 'orange' : 'var(--danger)'}; font-weight: 600;">${option.risk}</div>
                                    </div>
                                    <div>
                                        <span style="color: #64748b;">ê°€ê²© ë°°ìˆ˜:</span>
                                        <div style="color: #e2e8f0; font-weight: 600;">${option.multiplier}x</div>
                                    </div>
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>

                <div style="margin-top: 20px; text-align: center;">
                    <button onclick="openSaleModal()" style="
                        padding: 10px 20px;
                        border: 1px solid rgba(255,255,255,0.2);
                        background: rgba(255,255,255,0.05);
                        color: #e2e8f0;
                        border-radius: 8px;
                        cursor: pointer;
                        transition: all 0.3s ease;
                    ">ë‹¤ë¥¸ ì‚¬ì—… ì„ íƒ</button>
                </div>
            `;

            showModal(modalContent);
        }

        function confirmSale(businessId, optionId) {
            const business = gameState.roleData.businesses.find(b => b.id === businessId);
            if (!business) return;

            const saleOptions = [
                { id: 'quick_sale', multiplier: 0.7, successRate: 1.0, name: 'ë¹ ë¥¸ ë§¤ê°' },
                { id: 'market_sale', multiplier: 0.85, successRate: 0.9, name: 'ì‹œì¥ê°€ ë§¤ê°' },
                { id: 'premium_sale', multiplier: 1.0, successRate: 0.8, name: 'í”„ë¦¬ë¯¸ì—„ ë§¤ê°' },
                { id: 'strategic_sale', multiplier: 1.2, successRate: 0.6, name: 'ì „ëµì  ë§¤ê°' }
            ];

            const selectedOption = saleOptions.find(o => o.id === optionId);
            if (!selectedOption) return;

            const marketMultiplier = 0.7 + Math.random() * 0.4;
            const performanceMultiplier = business.level >= 3 ? 1.1 : business.level >= 2 ? 1.0 : 0.9;
            const basePrice = Math.floor(business.value * marketMultiplier * performanceMultiplier);
            const finalPrice = Math.floor(basePrice * selectedOption.multiplier);

            const isSuccess = Math.random() < selectedOption.successRate;
            
            closeModal();
            
            if (isSuccess) {
                gameState.currentUser.game_balance += finalPrice;
                const businessIndex = gameState.roleData.businesses.findIndex(b => b.id === businessId);
                if (businessIndex > -1) {
                    gameState.roleData.businesses.splice(businessIndex, 1);
                }
                
                updateBusinessDisplay();
                updateDisplay();
                showNotification(`âœ… ${business.name} ${selectedOption.name} ì„±ê³µ! ${finalPrice.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§ì„ íšë“í–ˆìŠµë‹ˆë‹¤.`, 'success');
            } else {
                // ë§¤ê° ì‹¤íŒ¨ ì‹œ ì•„ë¬´ëŸ° ë³€í™” ì—†ìŒ
                showNotification(`âŒ ${business.name} ${selectedOption.name} ì‹¤íŒ¨... ì ì ˆí•œ êµ¬ë§¤ìë¥¼ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.`, 'error');
            }
        }
        
        // íˆ¬ìì ê¸°ëŠ¥ë“¤
        function buyStock() {
            const stocks = ['ì‚¼ì„±ì „ì', 'SKí•˜ì´ë‹‰ìŠ¤', 'ë„¤ì´ë²„', 'ì¹´ì¹´ì˜¤', 'LGí™”í•™'];
            const stock = stocks[Math.floor(Math.random() * stocks.length)];
            const cost = Math.floor(Math.random() * 3000000) + 1000000; // 100ë§Œ~400ë§Œ ë¹„íŠ¸í¬ë ˆë”§ (í˜„ì‹¤í™”)
            
            if (gameState.currentUser.game_balance < cost) {
                showNotification(`ì£¼ì‹ êµ¬ë§¤ì—ëŠ” ${cost.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§ì´ í•„ìš”í•©ë‹ˆë‹¤`, 'error');
                return;
            }
            
            gameState.currentUser.game_balance -= cost;
            gameState.roleData.investments.push({
                type: 'stock',
                name: stock,
                amount: cost,
                returnRate: (Math.random() * 0.15) + 0.03, // 3~18% (í˜„ì‹¤ì )
                dividends: Math.floor(cost * 0.002), // 0.2%/ì›” (í˜„ì‹¤ì  ë°°ë‹¹)
                volatility: 0.02 // 2% ë³€ë™ì„±
            });
            
            updateInvestmentDisplay();
            updateDisplay();
            showNotification(`${stock} ì£¼ì‹ ${cost.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§ì–´ì¹˜ë¥¼ êµ¬ë§¤í–ˆìŠµë‹ˆë‹¤!`, 'success');
        }
        
        function buyCrypto() {
            const cryptos = ['Bitcoin', 'Ethereum', 'Dogecoin', 'Cardano'];
            const crypto = cryptos[Math.floor(Math.random() * cryptos.length)];
            const cost = Math.floor(Math.random() * 2500000) + 500000; // 50ë§Œ~300ë§Œ ë¹„íŠ¸í¬ë ˆë”§ (í˜„ì‹¤í™”)
            
            if (gameState.currentUser.game_balance < cost) {
                showNotification(`ì•”í˜¸í™”í êµ¬ë§¤ì—ëŠ” ${cost.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§ì´ í•„ìš”í•©ë‹ˆë‹¤`, 'error');
                return;
            }
            
            gameState.currentUser.game_balance -= cost;
            gameState.roleData.investments.push({
                type: 'crypto',
                name: crypto,
                amount: cost,
                returnRate: (Math.random() * 0.6) - 0.2, // -20~40% (ê³ ìœ„í—˜)
                dividends: 0, // ì•”í˜¸í™”íëŠ” ë°°ë‹¹ ì—†ìŒ
                volatility: 0.08 // 8% ë†’ì€ ë³€ë™ì„±
            });
            
            updateInvestmentDisplay();
            updateDisplay();
            showNotification(`${crypto} ${cost.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§ì–´ì¹˜ë¥¼ êµ¬ë§¤í–ˆìŠµë‹ˆë‹¤!`, 'success');
        }
        
        // ë¶€ë™ì‚° íˆ¬ì ëª¨ë‹¬ í•¨ìˆ˜ë“¤
        function openRealEstateModal() {
            document.getElementById('realEstateModal').style.display = 'flex';
        }

        function closeRealEstateModal() {
            document.getElementById('realEstateModal').style.display = 'none';
        }

        function buySpecificRealEstate(type) {
            let property, cost, returnRate, dividends, riskFactor;
            
            switch(type) {
                case 'apartment':
                    property = 'ğŸ¢ ì•„íŒŒíŠ¸';
                    cost = Math.floor(Math.random() * 2000000) + 3000000; // 300ë§Œ~500ë§Œ ë¹„íŠ¸í¬ë ˆë”§ (25ë°° ìƒìŠ¹)
                    returnRate = (Math.random() * 0.07) + 0.05; // 5~12%
                    dividends = Math.floor(cost * 0.003); // 0.3%/ì›” (í˜„ì‹¤ì  ìˆ˜ìµë¥ )
                    riskFactor = 0.8; // ë‚®ì€ ë¦¬ìŠ¤í¬
                    break;
                case 'officetel':
                    property = 'ğŸ¬ ì˜¤í”¼ìŠ¤í…”';
                    cost = Math.floor(Math.random() * 1500000) + 1500000; // 150ë§Œ~300ë§Œ ë¹„íŠ¸í¬ë ˆë”§ (25ë°° ìƒìŠ¹)
                    returnRate = (Math.random() * 0.15) + 0.03; // 3~18%
                    dividends = Math.floor(cost * 0.0025); // 0.25%/ì›” (í˜„ì‹¤ì  ìˆ˜ìµë¥ )
                    riskFactor = 1.0; // ë³´í†µ ë¦¬ìŠ¤í¬
                    break;
                case 'commercial':
                    property = 'ğŸª ìƒê°€';
                    cost = Math.floor(Math.random() * 5000000) + 2500000; // 250ë§Œ~750ë§Œ ë¹„íŠ¸í¬ë ˆë”§ (25ë°° ìƒìŠ¹)
                    returnRate = (Math.random() * 0.30) - 0.05; // -5~25%
                    dividends = returnRate > 0 ? Math.floor(cost * 0.004) : 0; // 0.4%/ì›” (ì„±ê³µì‹œë§Œ, í˜„ì‹¤ì )
                    riskFactor = 1.5; // ë†’ì€ ë¦¬ìŠ¤í¬
                    break;
                case 'land':
                    // í† ì§€ëŠ” ë³„ë„ì˜ ëª¨ë‹¬ì„ í†µí•´ì„œë§Œ êµ¬ë§¤ ê°€ëŠ¥
                    openLandModal();
                    closeRealEstateModal();
                    return;
            }
            
            if (gameState.currentUser.game_balance < cost) {
                showNotification(`${property} êµ¬ë§¤ì—ëŠ” ${cost.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§ì´ í•„ìš”í•©ë‹ˆë‹¤`, 'error');
                return;
            }
            
            gameState.currentUser.game_balance -= cost;
            const investment = {
                type: 'realestate',
                subType: type,
                name: property,
                amount: cost,
                returnRate: returnRate,
                dividends: dividends,
                riskFactor: riskFactor,
                originalReturnRate: returnRate // ì›ë˜ ìˆ˜ìµë¥  ì €ì¥
            };
            
            gameState.roleData.investments.push(investment);
            
            updateInvestmentDisplay();
            updateDisplay();
            closeRealEstateModal();
            
            const resultMessage = returnRate < 0 ? 
                `${property} íˆ¬ìê°€ ì†ì‹¤ì„ ë³´ê³  ìˆìŠµë‹ˆë‹¤. (${(returnRate * 100).toFixed(1)}%)` :
                `${property}ì„ ì„±ê³µì ìœ¼ë¡œ êµ¬ë§¤í–ˆìŠµë‹ˆë‹¤! (ìˆ˜ìµë¥ : ${(returnRate * 100).toFixed(1)}%)`;
            
            showNotification(resultMessage, returnRate < 0 ? 'error' : 'success');
        }
        
        function sellInvestments() {
            if (gameState.roleData.investments.length === 0) {
                showNotification('ë§¤ê°í•  íˆ¬ì ìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤', 'error');
                return;
            }
            
            const investment = gameState.roleData.investments[0];
            const salePrice = Math.floor(investment.amount * (1 + investment.returnRate));
            
            if (confirm(`${investment.name}ì„ ${salePrice.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§ì— ë§¤ê°í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                gameState.currentUser.game_balance += salePrice;
                gameState.roleData.investments.splice(0, 1);
                
                updateInvestmentDisplay();
                updateDisplay();
                showNotification(`íˆ¬ì ìƒí’ˆì„ ë§¤ê°í–ˆìŠµë‹ˆë‹¤!`, 'success');
            }
        }

        // ì™¸í™˜ íˆ¬ì ì‹œì¥
        function openForexMarket() {
            const forexPairs = [
                { pair: 'USD/KRW', rate: 1320.50, change: '+0.85%', trend: 'up' },
                { pair: 'EUR/KRW', rate: 1420.30, change: '-0.22%', trend: 'down' },
                { pair: 'JPY/KRW', rate: 8.95, change: '+1.12%', trend: 'up' },
                { pair: 'GBP/KRW', rate: 1650.80, change: '+0.45%', trend: 'up' },
                { pair: 'CHF/KRW', rate: 1480.20, change: '-0.67%', trend: 'down' },
                { pair: 'CAD/KRW', rate: 980.40, change: '+0.33%', trend: 'up' },
                { pair: 'AUD/KRW', rate: 890.60, change: '-0.89%', trend: 'down' },
                { pair: 'CNY/KRW', rate: 185.70, change: '+0.56%', trend: 'up' }
            ];

            const modalContent = `
                <h2 style="text-align: center; margin-bottom: 30px; color: var(--primary);">ğŸ’± ì™¸í™˜ íˆ¬ì ì‹œì¥</h2>
                
                <div style="background: rgba(59, 130, 246, 0.1); border: 1px solid rgba(59, 130, 246, 0.3); border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                    <h3 style="color: var(--primary); margin: 0 0 15px 0;">ğŸ“Š ì‹¤ì‹œê°„ í™˜ìœ¨ ì •ë³´</h3>
                    <div style="display: grid; gap: 12px;">
                        ${forexPairs.map(forex => `
                            <div style="
                                background: rgba(71, 85, 105, 0.1); border: 1px solid rgba(71, 85, 105, 0.3);
                                border-radius: 8px; padding: 15px; cursor: pointer;
                                display: flex; justify-content: space-between; align-items: center;
                            " onclick="buyForex('${forex.pair}', ${forex.rate})">
                                <div>
                                    <div style="color: #e2e8f0; font-weight: bold; margin-bottom: 4px;">${forex.pair}</div>
                                    <div style="color: #94a3b8; font-size: 0.9rem;">í™˜ìœ¨: ${forex.rate.toLocaleString()}ì›</div>
                                </div>
                                <div style="text-align: right;">
                                    <div style="color: ${forex.trend === 'up' ? 'var(--success)' : 'var(--danger)'}; font-weight: bold;">
                                        ${forex.trend === 'up' ? 'â†—' : 'â†˜'} ${forex.change}
                                    </div>
                                    <div style="color: #94a3b8; font-size: 0.8rem;">í´ë¦­í•˜ì—¬ íˆ¬ì</div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>

                <div style="text-align: center;">
                    <button onclick="closeModal()" style="
                        padding: 12px 30px; background: rgba(71, 85, 105, 0.2);
                        color: #e2e8f0; border: 1px solid rgba(71, 85, 105, 0.3);
                        border-radius: 8px; cursor: pointer; font-size: 0.9rem;
                    ">ë‹«ê¸°</button>
                </div>
            `;

            showModal(modalContent);
        }

        function buyForex(pair, rate) {
            const investAmount = Math.floor(Math.random() * 5000000) + 1000000; // 100ë§Œ~600ë§Œ ë¹„íŠ¸í¬ë ˆë”§
            
            if (gameState.currentUser.game_balance < investAmount) {
                showNotification(`ì™¸í™˜ íˆ¬ìì—ëŠ” ${investAmount.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§ì´ í•„ìš”í•©ë‹ˆë‹¤`, 'error');
                return;
            }

            if (confirm(`${pair}ì— ${investAmount.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§ì„ íˆ¬ìí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                gameState.currentUser.game_balance -= investAmount;
                
                gameState.roleData.investments.push({
                    type: 'forex',
                    name: pair,
                    amount: investAmount,
                    rate: rate,
                    returnRate: (Math.random() * 0.1) - 0.05, // -5% ~ +5%
                    dividends: 0, // ì™¸í™˜ì€ ë°°ë‹¹ ì—†ìŒ
                    volatility: 0.03 // 3% ë³€ë™ì„±
                });

                updateInvestmentDisplay();
                updateDisplay();
                closeModal();
                showNotification(`${pair} ì™¸í™˜ ${investAmount.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§ íˆ¬ì ì™„ë£Œ!`, 'success');
            }
        }

        // ì›ìì¬ íˆ¬ì ì‹œì¥
        function openCommodityMarket() {
            const commodities = [
                { name: 'ê¸ˆ(Gold)', price: 65420, unit: 'gë‹¹', change: '+1.2%', trend: 'up' },
                { name: 'ì€(Silver)', price: 845, unit: 'gë‹¹', change: '+0.8%', trend: 'up' },
                { name: 'êµ¬ë¦¬(Copper)', price: 8250, unit: 'kgë‹¹', change: '-0.5%', trend: 'down' },
                { name: 'ì›ìœ (WTI)', price: 78650, unit: 'ë°°ëŸ´ë‹¹', change: '+2.1%', trend: 'up' },
                { name: 'ì²œì—°ê°€ìŠ¤', price: 3420, unit: 'BTUë‹¹', change: '-1.5%', trend: 'down' },
                { name: 'ë°€(Wheat)', price: 620, unit: 'ë¶€ì…¸ë‹¹', change: '+0.7%', trend: 'up' },
                { name: 'ëŒ€ë‘(Soybean)', price: 1340, unit: 'ë¶€ì…¸ë‹¹', change: '-0.3%', trend: 'down' },
                { name: 'ì˜¥ìˆ˜ìˆ˜(Corn)', price: 580, unit: 'ë¶€ì…¸ë‹¹', change: '+1.8%', trend: 'up' }
            ];

            const modalContent = `
                <h2 style="text-align: center; margin-bottom: 30px; color: var(--primary);">ğŸ¥‡ ì›ìì¬ íˆ¬ì ì‹œì¥</h2>
                
                <div style="background: rgba(245, 158, 11, 0.1); border: 1px solid rgba(245, 158, 11, 0.3); border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                    <h3 style="color: var(--warning); margin: 0 0 15px 0;">ğŸ“ˆ ì‹¤ì‹œê°„ ì›ìì¬ ê°€ê²©</h3>
                    <div style="display: grid; gap: 12px;">
                        ${commodities.map(commodity => `
                            <div style="
                                background: rgba(71, 85, 105, 0.1); border: 1px solid rgba(71, 85, 105, 0.3);
                                border-radius: 8px; padding: 15px; cursor: pointer;
                                display: flex; justify-content: space-between; align-items: center;
                            " onclick="buyCommodity('${commodity.name}', ${commodity.price})">
                                <div>
                                    <div style="color: #e2e8f0; font-weight: bold; margin-bottom: 4px;">${commodity.name}</div>
                                    <div style="color: #94a3b8; font-size: 0.9rem;">${commodity.price.toLocaleString()}ì› ${commodity.unit}</div>
                                </div>
                                <div style="text-align: right;">
                                    <div style="color: ${commodity.trend === 'up' ? 'var(--success)' : 'var(--danger)'}; font-weight: bold;">
                                        ${commodity.trend === 'up' ? 'â†—' : 'â†˜'} ${commodity.change}
                                    </div>
                                    <div style="color: #94a3b8; font-size: 0.8rem;">í´ë¦­í•˜ì—¬ íˆ¬ì</div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>

                <div style="text-align: center;">
                    <button onclick="closeModal()" style="
                        padding: 12px 30px; background: rgba(71, 85, 105, 0.2);
                        color: #e2e8f0; border: 1px solid rgba(71, 85, 105, 0.3);
                        border-radius: 8px; cursor: pointer; font-size: 0.9rem;
                    ">ë‹«ê¸°</button>
                </div>
            `;

            showModal(modalContent);
        }

        function buyCommodity(commodity, price) {
            const investAmount = Math.floor(Math.random() * 8000000) + 2000000; // 200ë§Œ~1000ë§Œ ë¹„íŠ¸í¬ë ˆë”§
            
            if (gameState.currentUser.game_balance < investAmount) {
                showNotification(`ì›ìì¬ íˆ¬ìì—ëŠ” ${investAmount.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§ì´ í•„ìš”í•©ë‹ˆë‹¤`, 'error');
                return;
            }

            if (confirm(`${commodity}ì— ${investAmount.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§ì„ íˆ¬ìí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                gameState.currentUser.game_balance -= investAmount;
                
                // ì›ìì¬ ì¢…ë¥˜ë³„ íŠ¹ì„± ì„¤ì •
                let volatility = 0.04; // ê¸°ë³¸ 4%
                let expectedReturn = 0;
                
                if (commodity.includes('ê¸ˆ') || commodity.includes('ì€')) {
                    volatility = 0.025; // ê·€ê¸ˆì†ì€ ë³€ë™ì„± ë‚®ìŒ
                    expectedReturn = 0.02;
                } else if (commodity.includes('ì›ìœ ') || commodity.includes('ì²œì—°ê°€ìŠ¤')) {
                    volatility = 0.08; // ì—ë„ˆì§€ëŠ” ë³€ë™ì„± ë†’ìŒ
                    expectedReturn = 0.05;
                } else {
                    volatility = 0.06; // ë†ì‚°ë¬¼/ê¸°íƒ€
                    expectedReturn = 0.03;
                }
                
                gameState.roleData.investments.push({
                    type: 'commodity',
                    name: commodity,
                    amount: investAmount,
                    price: price,
                    returnRate: (Math.random() * 0.12) - 0.06 + expectedReturn, // Â±6% + ì˜ˆìƒìˆ˜ìµ
                    dividends: 0, // ì›ìì¬ëŠ” ë°°ë‹¹ ì—†ìŒ
                    volatility: volatility
                });

                updateInvestmentDisplay();
                updateDisplay();
                closeModal();
                showNotification(`${commodity} ${investAmount.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§ íˆ¬ì ì™„ë£Œ!`, 'success');
            }
        }

        // í¬íŠ¸í´ë¦¬ì˜¤ ë¶„ì„
        function showPortfolioAnalysis() {
            if (gameState.roleData.investments.length === 0) {
                showNotification('íˆ¬ì ìƒí’ˆì´ ì—†ì–´ ë¶„ì„í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤', 'info');
                return;
            }

            const totalInvestment = gameState.roleData.investments.reduce((sum, i) => sum + i.amount, 0);
            const totalValue = gameState.roleData.investments.reduce((sum, i) => sum + Math.floor(i.amount * (1 + i.returnRate)), 0);
            const totalReturn = ((totalValue - totalInvestment) / totalInvestment * 100).toFixed(2);
            
            // íˆ¬ì ìœ í˜•ë³„ ë¶„ì„
            const typeAnalysis = {};
            gameState.roleData.investments.forEach(inv => {
                if (!typeAnalysis[inv.type]) {
                    typeAnalysis[inv.type] = { count: 0, amount: 0, value: 0 };
                }
                typeAnalysis[inv.type].count++;
                typeAnalysis[inv.type].amount += inv.amount;
                typeAnalysis[inv.type].value += Math.floor(inv.amount * (1 + inv.returnRate));
            });

            const typeNames = {
                'stock': 'ì£¼ì‹',
                'crypto': 'ì•”í˜¸í™”í',
                'forex': 'ì™¸í™˜',
                'commodity': 'ì›ìì¬',
                'futures': 'ì„ ë¬¼íˆ¬ì',
                'realestate': 'ë¶€ë™ì‚°'
            };

            const modalContent = `
                <h2 style="text-align: center; margin-bottom: 30px; color: var(--primary);">ğŸ“ˆ í¬íŠ¸í´ë¦¬ì˜¤ ë¶„ì„</h2>
                
                <div style="background: rgba(34, 197, 94, 0.1); border: 1px solid rgba(34, 197, 94, 0.3); border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                    <h3 style="color: var(--success); margin: 0 0 15px 0;">ğŸ’° ì „ì²´ ìˆ˜ìµ í˜„í™©</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px;">
                        <div style="text-align: center;">
                            <div style="color: #94a3b8; font-size: 0.9rem;">ì´ íˆ¬ìê¸ˆ</div>
                            <div style="color: #e2e8f0; font-size: 1.2rem; font-weight: bold;">${totalInvestment.toLocaleString()}ì›</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="color: #94a3b8; font-size: 0.9rem;">í˜„ì¬ ê°€ì¹˜</div>
                            <div style="color: #e2e8f0; font-size: 1.2rem; font-weight: bold;">${totalValue.toLocaleString()}ì›</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="color: #94a3b8; font-size: 0.9rem;">ì´ ìˆ˜ìµë¥ </div>
                            <div style="color: ${totalReturn >= 0 ? 'var(--success)' : 'var(--danger)'}; font-size: 1.2rem; font-weight: bold;">${totalReturn >= 0 ? '+' : ''}${totalReturn}%</div>
                        </div>
                    </div>
                </div>

                <div style="background: rgba(99, 102, 241, 0.1); border: 1px solid rgba(99, 102, 241, 0.3); border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                    <h3 style="color: var(--primary); margin: 0 0 15px 0;">ğŸ“Š íˆ¬ì ìœ í˜•ë³„ ë¶„ì„</h3>
                    ${Object.entries(typeAnalysis).map(([type, data]) => {
                        const returnRate = ((data.value - data.amount) / data.amount * 100).toFixed(1);
                        const percentage = (data.amount / totalInvestment * 100).toFixed(1);
                        return `
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px solid rgba(255,255,255,0.1);">
                                <div>
                                    <div style="color: #e2e8f0; font-weight: bold;">${typeNames[type] || type}</div>
                                    <div style="color: #94a3b8; font-size: 0.9rem;">${data.count}ê°œ ì¢…ëª© â€¢ ë¹„ì¤‘ ${percentage}%</div>
                                </div>
                                <div style="text-align: right;">
                                    <div style="color: ${returnRate >= 0 ? 'var(--success)' : 'var(--danger)'}; font-weight: bold;">${returnRate >= 0 ? '+' : ''}${returnRate}%</div>
                                    <div style="color: #94a3b8; font-size: 0.9rem;">${data.value.toLocaleString()}ì›</div>
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>

                <div style="text-align: center;">
                    <button onclick="closeModal()" style="
                        padding: 12px 30px; background: rgba(71, 85, 105, 0.2);
                        color: #e2e8f0; border: 1px solid rgba(71, 85, 105, 0.3);
                        border-radius: 8px; cursor: pointer; font-size: 0.9rem;
                    ">ë‹«ê¸°</button>
                </div>
            `;

            showModal(modalContent);
        }

        // ì„ ë¬¼íˆ¬ì ì‹œì¥ (ë ˆë²„ë¦¬ì§€ ìµœëŒ€ 200ë°°) - 100ì¢… ê³„ì•½
        function openFuturesMarket() {
            const futuresContracts = [
                // === ì£¼ìš” ì§€ìˆ˜ ì„ ë¬¼ (20ì¢…) ===
                { name: 'KOSPI 200 ì„ ë¬¼', price: 325.40, change: '+1.85%', trend: 'up', category: 'index', baseVolatility: 0.02 },
                { name: 'KOSDAQ ì„ ë¬¼', price: 128.90, change: '+2.35%', trend: 'up', category: 'index', baseVolatility: 0.035 },
                { name: 'S&P 500 ì„ ë¬¼', price: 4680.20, change: '+0.95%', trend: 'up', category: 'index', baseVolatility: 0.02 },
                { name: 'NASDAQ ì„ ë¬¼', price: 15420.80, change: '-0.75%', trend: 'down', category: 'index', baseVolatility: 0.025 },
                { name: 'Dow Jones ì„ ë¬¼', price: 34520.60, change: '+0.45%', trend: 'up', category: 'index', baseVolatility: 0.018 },
                { name: 'Russell 2000 ì„ ë¬¼', price: 2045.80, change: '+1.65%', trend: 'up', category: 'index', baseVolatility: 0.028 },
                { name: 'DAX ì„ ë¬¼', price: 16240.50, change: '-0.85%', trend: 'down', category: 'index', baseVolatility: 0.022 },
                { name: 'FTSE 100 ì„ ë¬¼', price: 7520.30, change: '+0.55%', trend: 'up', category: 'index', baseVolatility: 0.019 },
                { name: 'CAC 40 ì„ ë¬¼', price: 7380.90, change: '-0.35%', trend: 'down', category: 'index', baseVolatility: 0.021 },
                { name: 'Nikkei 225 ì„ ë¬¼', price: 32840.70, change: '+1.15%', trend: 'up', category: 'index', baseVolatility: 0.023 },
                { name: 'Hang Seng ì„ ë¬¼', price: 17920.40, change: '-1.25%', trend: 'down', category: 'index', baseVolatility: 0.032 },
                { name: 'Shanghai Composite ì„ ë¬¼', price: 3125.80, change: '+0.85%', trend: 'up', category: 'index', baseVolatility: 0.028 },
                { name: 'ASX 200 ì„ ë¬¼', price: 7240.60, change: '+0.75%', trend: 'up', category: 'index', baseVolatility: 0.025 },
                { name: 'BSE Sensex ì„ ë¬¼', price: 68520.30, change: '+1.45%', trend: 'up', category: 'index', baseVolatility: 0.026 },
                { name: 'IBEX 35 ì„ ë¬¼', price: 9640.20, change: '-0.65%', trend: 'down', category: 'index', baseVolatility: 0.024 },
                { name: 'AEX ì„ ë¬¼', price: 740.80, change: '+0.25%', trend: 'up', category: 'index', baseVolatility: 0.020 },
                { name: 'TSX ì„ ë¬¼', price: 20140.50, change: '+1.05%', trend: 'up', category: 'index', baseVolatility: 0.021 },
                { name: 'BOVESPA ì„ ë¬¼', price: 126840.30, change: '+2.15%', trend: 'up', category: 'index', baseVolatility: 0.034 },
                { name: 'MOEX ì„ ë¬¼', price: 3250.90, change: '-1.85%', trend: 'down', category: 'index', baseVolatility: 0.045 },
                { name: 'VIX ì„ ë¬¼', price: 18.45, change: '+12.5%', trend: 'up', category: 'index', baseVolatility: 0.15 },

                // === ì—ë„ˆì§€ ì„ ë¬¼ (15ì¢…) ===
                { name: 'ì›ìœ (WTI) ì„ ë¬¼', price: 78.95, change: '+3.45%', trend: 'up', category: 'energy', baseVolatility: 0.05 },
                { name: 'ë¸Œë ŒíŠ¸ìœ  ì„ ë¬¼', price: 82.30, change: '+2.85%', trend: 'up', category: 'energy', baseVolatility: 0.048 },
                { name: 'ì²œì—°ê°€ìŠ¤ ì„ ë¬¼', price: 3.82, change: '-2.85%', trend: 'down', category: 'energy', baseVolatility: 0.08 },
                { name: 'íœ˜ë°œìœ  ì„ ë¬¼', price: 2.45, change: '+1.95%', trend: 'up', category: 'energy', baseVolatility: 0.055 },
                { name: 'ê²½ìœ  ì„ ë¬¼', price: 2.68, change: '+2.15%', trend: 'up', category: 'energy', baseVolatility: 0.052 },
                { name: 'ë“±ìœ  ì„ ë¬¼', price: 2.54, change: '+1.85%', trend: 'up', category: 'energy', baseVolatility: 0.053 },
                { name: 'ìš°ë¼ëŠ„ ì„ ë¬¼', price: 64.50, change: '+4.25%', trend: 'up', category: 'energy', baseVolatility: 0.085 },
                { name: 'ì„íƒ„ ì„ ë¬¼', price: 118.40, change: '-1.65%', trend: 'down', category: 'energy', baseVolatility: 0.065 },
                { name: 'ì „ë ¥ ì„ ë¬¼', price: 85.30, change: '+3.15%', trend: 'up', category: 'energy', baseVolatility: 0.075 },
                { name: 'ë¦¬íŠ¬ ì„ ë¬¼', price: 28450.00, change: '+5.85%', trend: 'up', category: 'energy', baseVolatility: 0.12 },
                { name: 'ì½”ë°œíŠ¸ ì„ ë¬¼', price: 35250.00, change: '+3.45%', trend: 'up', category: 'energy', baseVolatility: 0.095 },
                { name: 'ë‹ˆì¼ˆ ì„ ë¬¼', price: 18420.00, change: '+2.65%', trend: 'up', category: 'energy', baseVolatility: 0.088 },
                { name: 'í¬í† ë¥˜ ì„ ë¬¼', price: 145.80, change: '+6.25%', trend: 'up', category: 'energy', baseVolatility: 0.11 },
                { name: 'ìˆ˜ì†Œ ì„ ë¬¼', price: 4.25, change: '+7.85%', trend: 'up', category: 'energy', baseVolatility: 0.13 },
                { name: 'ë°”ì´ì˜¤ì—°ë£Œ ì„ ë¬¼', price: 1.85, change: '+2.45%', trend: 'up', category: 'energy', baseVolatility: 0.078 },

                // === ê·€ê¸ˆì† ì„ ë¬¼ (10ì¢…) ===
                { name: 'ê¸ˆ ì„ ë¬¼', price: 2045.30, change: '+2.15%', trend: 'up', category: 'metals', baseVolatility: 0.03 },
                { name: 'ì€ ì„ ë¬¼', price: 24.85, change: '+3.25%', trend: 'up', category: 'metals', baseVolatility: 0.048 },
                { name: 'ë°±ê¸ˆ ì„ ë¬¼', price: 1025.40, change: '+1.85%', trend: 'up', category: 'metals', baseVolatility: 0.055 },
                { name: 'íŒ”ë¼ë“ ì„ ë¬¼', price: 1580.60, change: '+4.15%', trend: 'up', category: 'metals', baseVolatility: 0.078 },
                { name: 'ë¡œë“ ì„ ë¬¼', price: 4250.00, change: '+6.85%', trend: 'up', category: 'metals', baseVolatility: 0.12 },
                { name: 'êµ¬ë¦¬ ì„ ë¬¼', price: 8.25, change: '+1.65%', trend: 'up', category: 'metals', baseVolatility: 0.045 },
                { name: 'ì•Œë£¨ë¯¸ëŠ„ ì„ ë¬¼', price: 2.18, change: '+0.85%', trend: 'up', category: 'metals', baseVolatility: 0.038 },
                { name: 'ì•„ì—° ì„ ë¬¼', price: 2.65, change: '+1.45%', trend: 'up', category: 'metals', baseVolatility: 0.042 },
                { name: 'ì£¼ì„ ì„ ë¬¼', price: 28.50, change: '+2.25%', trend: 'up', category: 'metals', baseVolatility: 0.058 },
                { name: 'ë‚© ì„ ë¬¼', price: 2.18, change: '+0.95%', trend: 'up', category: 'metals', baseVolatility: 0.048 },

                // === ë†ì‚°ë¬¼ ì„ ë¬¼ (20ì¢…) ===
                { name: 'ë°€ ì„ ë¬¼', price: 620.50, change: '+1.25%', trend: 'up', category: 'agriculture', baseVolatility: 0.04 },
                { name: 'ì˜¥ìˆ˜ìˆ˜ ì„ ë¬¼', price: 485.75, change: '+2.15%', trend: 'up', category: 'agriculture', baseVolatility: 0.045 },
                { name: 'ëŒ€ë‘ ì„ ë¬¼', price: 1385.25, change: '+1.85%', trend: 'up', category: 'agriculture', baseVolatility: 0.048 },
                { name: 'ìŒ€ ì„ ë¬¼', price: 16.80, change: '+0.95%', trend: 'up', category: 'agriculture', baseVolatility: 0.035 },
                { name: 'ë³´ë¦¬ ì„ ë¬¼', price: 245.60, change: '+1.45%', trend: 'up', category: 'agriculture', baseVolatility: 0.042 },
                { name: 'ê·€ë¦¬ ì„ ë¬¼', price: 385.40, change: '+2.25%', trend: 'up', category: 'agriculture', baseVolatility: 0.055 },
                { name: 'ì„¤íƒ• ì„ ë¬¼', price: 22.45, change: '+3.15%', trend: 'up', category: 'agriculture', baseVolatility: 0.065 },
                { name: 'ì»¤í”¼ ì„ ë¬¼', price: 175.80, change: '+4.25%', trend: 'up', category: 'agriculture', baseVolatility: 0.078 },
                { name: 'ì½”ì½”ì•„ ì„ ë¬¼', price: 3485.00, change: '+2.85%', trend: 'up', category: 'agriculture', baseVolatility: 0.068 },
                { name: 'ë©´í™” ì„ ë¬¼', price: 78.45, change: '+1.65%', trend: 'up', category: 'agriculture', baseVolatility: 0.052 },
                { name: 'ì˜¤ë Œì§€ì£¼ìŠ¤ ì„ ë¬¼', price: 145.30, change: '+5.25%', trend: 'up', category: 'agriculture', baseVolatility: 0.095 },
                { name: 'ë¼ì§€ê³ ê¸° ì„ ë¬¼', price: 82.60, change: '+2.45%', trend: 'up', category: 'agriculture', baseVolatility: 0.058 },
                { name: 'ì‡ ê³ ê¸° ì„ ë¬¼', price: 156.80, change: '+1.95%', trend: 'up', category: 'agriculture', baseVolatility: 0.048 },
                { name: 'ìš°ìœ  ì„ ë¬¼', price: 18.25, change: '+0.85%', trend: 'up', category: 'agriculture', baseVolatility: 0.038 },
                { name: 'ì¹˜ì¦ˆ ì„ ë¬¼', price: 2.15, change: '+1.15%', trend: 'up', category: 'agriculture', baseVolatility: 0.042 },
                { name: 'ê³„ë€ ì„ ë¬¼', price: 1.85, change: '+3.45%', trend: 'up', category: 'agriculture', baseVolatility: 0.085 },
                { name: 'ë‹­ê³ ê¸° ì„ ë¬¼', price: 1.28, change: '+2.25%', trend: 'up', category: 'agriculture', baseVolatility: 0.065 },
                { name: 'ì—°ì–´ ì„ ë¬¼', price: 8.45, change: '+4.15%', trend: 'up', category: 'agriculture', baseVolatility: 0.088 },
                { name: 'ìƒˆìš° ì„ ë¬¼', price: 12.60, change: '+5.85%', trend: 'up', category: 'agriculture', baseVolatility: 0.12 },
                { name: 'ë°”ë‹ë¼ ì„ ë¬¼', price: 485.00, change: '+8.25%', trend: 'up', category: 'agriculture', baseVolatility: 0.15 },

                // === í†µí™” ì„ ë¬¼ (15ì¢…) ===
                { name: 'USD/KRW ì„ ë¬¼', price: 1322.50, change: '+0.65%', trend: 'up', category: 'currency', baseVolatility: 0.015 },
                { name: 'EUR/USD ì„ ë¬¼', price: 1.0845, change: '-0.35%', trend: 'down', category: 'currency', baseVolatility: 0.02 },
                { name: 'GBP/USD ì„ ë¬¼', price: 1.2650, change: '+0.45%', trend: 'up', category: 'currency', baseVolatility: 0.025 },
                { name: 'USD/JPY ì„ ë¬¼', price: 148.50, change: '+0.85%', trend: 'up', category: 'currency', baseVolatility: 0.018 },
                { name: 'AUD/USD ì„ ë¬¼', price: 0.6750, change: '+0.55%', trend: 'up', category: 'currency', baseVolatility: 0.028 },
                { name: 'USD/CAD ì„ ë¬¼', price: 1.3450, change: '-0.25%', trend: 'down', category: 'currency', baseVolatility: 0.022 },
                { name: 'USD/CHF ì„ ë¬¼', price: 0.8925, change: '+0.15%', trend: 'up', category: 'currency', baseVolatility: 0.018 },
                { name: 'USD/CNY ì„ ë¬¼', price: 7.1850, change: '+0.35%', trend: 'up', category: 'currency', baseVolatility: 0.015 },
                { name: 'EUR/GBP ì„ ë¬¼', price: 0.8580, change: '-0.45%', trend: 'down', category: 'currency', baseVolatility: 0.021 },
                { name: 'EUR/JPY ì„ ë¬¼', price: 161.20, change: '+0.95%', trend: 'up', category: 'currency', baseVolatility: 0.024 },
                { name: 'GBP/JPY ì„ ë¬¼', price: 187.80, change: '+1.15%', trend: 'up', category: 'currency', baseVolatility: 0.032 },
                { name: 'NZD/USD ì„ ë¬¼', price: 0.6180, change: '+0.75%', trend: 'up', category: 'currency', baseVolatility: 0.035 },
                { name: 'USD/MXN ì„ ë¬¼', price: 17.25, change: '-0.85%', trend: 'down', category: 'currency', baseVolatility: 0.045 },
                { name: 'USD/BRL ì„ ë¬¼', price: 5.18, change: '+1.25%', trend: 'up', category: 'currency', baseVolatility: 0.055 },
                { name: 'USD/RUB ì„ ë¬¼', price: 95.40, change: '+2.85%', trend: 'up', category: 'currency', baseVolatility: 0.085 },

                // === ì•”í˜¸í™”í ì„ ë¬¼ (20ì¢…) ===
                { name: 'Bitcoin ì„ ë¬¼', price: 43250.00, change: '+8.25%', trend: 'up', category: 'crypto', baseVolatility: 0.12 },
                { name: 'Ethereum ì„ ë¬¼', price: 2640.80, change: '+6.15%', trend: 'up', category: 'crypto', baseVolatility: 0.15 },
                { name: 'BNB ì„ ë¬¼', price: 285.40, change: '+4.85%', trend: 'up', category: 'crypto', baseVolatility: 0.18 },
                { name: 'XRP ì„ ë¬¼', price: 0.625, change: '+12.5%', trend: 'up', category: 'crypto', baseVolatility: 0.22 },
                { name: 'Solana ì„ ë¬¼', price: 68.50, change: '+9.45%', trend: 'up', category: 'crypto', baseVolatility: 0.25 },
                { name: 'Cardano ì„ ë¬¼', price: 0.485, change: '+7.85%', trend: 'up', category: 'crypto', baseVolatility: 0.28 },
                { name: 'Dogecoin ì„ ë¬¼', price: 0.085, change: '+15.2%', trend: 'up', category: 'crypto', baseVolatility: 0.35 },
                { name: 'Polygon ì„ ë¬¼', price: 0.725, change: '+8.65%', trend: 'up', category: 'crypto', baseVolatility: 0.32 },
                { name: 'Chainlink ì„ ë¬¼', price: 14.80, change: '+6.45%', trend: 'up', category: 'crypto', baseVolatility: 0.26 },
                { name: 'Litecoin ì„ ë¬¼', price: 72.30, change: '+5.25%', trend: 'up', category: 'crypto', baseVolatility: 0.24 },
                { name: 'Avalanche ì„ ë¬¼', price: 18.50, change: '+11.5%', trend: 'up', category: 'crypto', baseVolatility: 0.38 },
                { name: 'Polkadot ì„ ë¬¼', price: 5.45, change: '+7.25%', trend: 'up', category: 'crypto', baseVolatility: 0.30 },
                { name: 'Uniswap ì„ ë¬¼', price: 6.85, change: '+9.15%', trend: 'up', category: 'crypto', baseVolatility: 0.33 },
                { name: 'NEAR ì„ ë¬¼', price: 1.95, change: '+13.8%', trend: 'up', category: 'crypto', baseVolatility: 0.42 },
                { name: 'ApeCoin ì„ ë¬¼', price: 1.25, change: '+18.5%', trend: 'up', category: 'crypto', baseVolatility: 0.55 },
                { name: 'Shiba Inu ì„ ë¬¼', price: 0.0000095, change: '+25.8%', trend: 'up', category: 'crypto', baseVolatility: 0.65 },
                { name: 'Pepe ì„ ë¬¼', price: 0.00000125, change: '+45.2%', trend: 'up', category: 'crypto', baseVolatility: 0.85 },
                { name: 'Floki ì„ ë¬¼', price: 0.000035, change: '+35.6%', trend: 'up', category: 'crypto', baseVolatility: 0.75 },
                { name: 'SafeMoon ì„ ë¬¼', price: 0.00018, change: '+28.9%', trend: 'up', category: 'crypto', baseVolatility: 0.95 },
                { name: 'DogeCoin2.0 ì„ ë¬¼', price: 0.0045, change: '+58.7%', trend: 'up', category: 'crypto', baseVolatility: 1.2 }
            ];

            const modalContent = `
                <h2 style="text-align: center; margin-bottom: 15px; color: var(--primary);">ğŸ“Š ì„ ë¬¼íˆ¬ì ì‹œì¥ (100ì¢…)</h2>
                <div style="text-align: center; margin-bottom: 20px;">
                    <span style="background: linear-gradient(45deg, #ef4444, #f97316); color: white; padding: 6px 12px; border-radius: 15px; font-size: 0.8rem; font-weight: bold;">
                        âš¡ ë ˆë²„ë¦¬ì§€ ìµœëŒ€ 200ë°° âš¡
                    </span>
                </div>
                
                <div style="background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.3); border-radius: 8px; padding: 12px; margin-bottom: 15px;">
                    <div style="color: var(--danger); font-size: 0.8rem; line-height: 1.4;">
                        <strong>âš ï¸ ê³ ìœ„í—˜:</strong> ë ˆë²„ë¦¬ì§€ íˆ¬ìëŠ” ìˆ˜ìµ/ì†ì‹¤ì´ ê·¹ëŒ€í™”ë©ë‹ˆë‹¤. 200ë°° ì‹œ 1% í•˜ë½ìœ¼ë¡œë„ ì›ê¸ˆ ì†Œì‹¤ ìœ„í—˜!
                    </div>
                </div>

                <!-- ì¹´í…Œê³ ë¦¬ íƒ­ -->
                <div style="display: flex; flex-wrap: wrap; gap: 5px; margin-bottom: 15px; justify-content: center;">
                    <button onclick="showFuturesCategory('all')" id="futuresTab-all" style="
                        padding: 8px 12px; background: var(--primary); color: white;
                        border: none; border-radius: 20px; cursor: pointer; font-size: 0.8rem; font-weight: 600;
                    ">ì „ì²´ (100)</button>
                    <button onclick="showFuturesCategory('index')" id="futuresTab-index" style="
                        padding: 8px 12px; background: rgba(71, 85, 105, 0.2); color: #94a3b8;
                        border: 1px solid rgba(71, 85, 105, 0.3); border-radius: 20px; cursor: pointer; font-size: 0.8rem;
                    ">ì§€ìˆ˜ (20)</button>
                    <button onclick="showFuturesCategory('energy')" id="futuresTab-energy" style="
                        padding: 8px 12px; background: rgba(71, 85, 105, 0.2); color: #94a3b8;
                        border: 1px solid rgba(71, 85, 105, 0.3); border-radius: 20px; cursor: pointer; font-size: 0.8rem;
                    ">ì—ë„ˆì§€ (15)</button>
                    <button onclick="showFuturesCategory('metals')" id="futuresTab-metals" style="
                        padding: 8px 12px; background: rgba(71, 85, 105, 0.2); color: #94a3b8;
                        border: 1px solid rgba(71, 85, 105, 0.3); border-radius: 20px; cursor: pointer; font-size: 0.8rem;
                    ">ê¸ˆì† (10)</button>
                    <button onclick="showFuturesCategory('agriculture')" id="futuresTab-agriculture" style="
                        padding: 8px 12px; background: rgba(71, 85, 105, 0.2); color: #94a3b8;
                        border: 1px solid rgba(71, 85, 105, 0.3); border-radius: 20px; cursor: pointer; font-size: 0.8rem;
                    ">ë†ì‚°ë¬¼ (20)</button>
                    <button onclick="showFuturesCategory('currency')" id="futuresTab-currency" style="
                        padding: 8px 12px; background: rgba(71, 85, 105, 0.2); color: #94a3b8;
                        border: 1px solid rgba(71, 85, 105, 0.3); border-radius: 20px; cursor: pointer; font-size: 0.8rem;
                    ">í†µí™” (15)</button>
                    <button onclick="showFuturesCategory('crypto')" id="futuresTab-crypto" style="
                        padding: 8px 12px; background: rgba(71, 85, 105, 0.2); color: #94a3b8;
                        border: 1px solid rgba(71, 85, 105, 0.3); border-radius: 20px; cursor: pointer; font-size: 0.8rem;
                    ">ë¹„íŠ¸í¬ë ˆë”§ (20)</button>
                </div>

                <div id="futuresContractsList" style="display: grid; gap: 8px; margin-bottom: 15px; max-height: 350px; overflow-y: auto;">
                    ${futuresContracts.map(contract => `
                        <div class="futures-contract" data-category="${contract.category}" style="
                            background: rgba(71, 85, 105, 0.1); border: 1px solid rgba(71, 85, 105, 0.3);
                            border-radius: 8px; padding: 10px; cursor: pointer; transition: all 0.2s;
                        " onclick="selectFuturesContract('${contract.name}', ${contract.price}, ${contract.baseVolatility})" 
                           onmouseover="this.style.background='rgba(99, 102, 241, 0.2)'" 
                           onmouseout="this.style.background='rgba(71, 85, 105, 0.1)'">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <div style="color: #e2e8f0; font-weight: bold; font-size: 0.9rem; margin-bottom: 2px;">${contract.name}</div>
                                    <div style="color: #94a3b8; font-size: 0.8rem;">â‚©${contract.price.toLocaleString()}</div>
                                </div>
                                <div style="text-align: right;">
                                    <div style="color: ${contract.trend === 'up' ? 'var(--success)' : 'var(--danger)'}; font-weight: bold; font-size: 0.85rem;">
                                        ${contract.trend === 'up' ? 'ğŸš€' : 'ğŸ“‰'} ${contract.change}
                                    </div>
                                    <div style="color: #94a3b8; font-size: 0.7rem;">${getCategoryName(contract.category)}</div>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>

                <div style="text-align: center;">
                    <button onclick="closeModal()" style="
                        padding: 10px 25px; background: rgba(71, 85, 105, 0.2);
                        color: #e2e8f0; border: 1px solid rgba(71, 85, 105, 0.3);
                        border-radius: 8px; cursor: pointer; font-size: 0.9rem;
                    ">ë‹«ê¸°</button>
                </div>
                
            `;

            showModal(modalContent);
        }

        // ì„ ë¬¼ ì¹´í…Œê³ ë¦¬ í•„í„°ë§
        function showFuturesCategory(category) {
            // íƒ­ ìŠ¤íƒ€ì¼ ì—…ë°ì´íŠ¸
            document.querySelectorAll('[id^="futuresTab-"]').forEach(tab => {
                tab.style.background = 'rgba(71, 85, 105, 0.2)';
                tab.style.color = '#94a3b8';
                tab.style.border = '1px solid rgba(71, 85, 105, 0.3)';
            });
            
            const activeTab = document.getElementById(`futuresTab-${category}`);
            if (activeTab) {
                activeTab.style.background = 'var(--primary)';
                activeTab.style.color = 'white';
                activeTab.style.border = 'none';
            }

            // ê³„ì•½ í•„í„°ë§
            document.querySelectorAll('.futures-contract').forEach(contract => {
                if (category === 'all' || contract.dataset.category === category) {
                    contract.style.display = 'block';
                } else {
                    contract.style.display = 'none';
                }
            });
        }

        function getCategoryName(category) {
            const names = {
                'index': 'ì§€ìˆ˜',
                'energy': 'ì—ë„ˆì§€',
                'metals': 'ê¸ˆì†',
                'agriculture': 'ë†ì‚°ë¬¼',
                'currency': 'í†µí™”',
                'crypto': 'ì•”í˜¸í™”í'
            };
            return names[category] || category;
        }

        function selectFuturesContract(contractName, price, baseVolatility) {
            const modalContent = `
                <h2 style="text-align: center; margin-bottom: 30px; color: var(--primary);">ğŸ“Š ${contractName}</h2>
                
                <div style="background: rgba(59, 130, 246, 0.1); border: 1px solid rgba(59, 130, 246, 0.3); border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                    <h3 style="color: var(--primary); margin: 0 0 15px 0;">ğŸ’° íˆ¬ì ì„¤ì •</h3>
                    
                    <div style="margin-bottom: 20px;">
                        <label style="color: #e2e8f0; display: block; margin-bottom: 8px;">íˆ¬ì ê¸ˆì•¡:</label>
                        <input type="range" id="futuresAmount" min="100000" max="50000000" value="1000000" 
                               style="width: 100%; margin-bottom: 10px;" oninput="updateFuturesAmount()">
                        <div style="display: flex; justify-content: space-between; color: #94a3b8; font-size: 0.9rem;">
                            <span>10ë§Œ</span>
                            <span id="selectedFuturesAmount" style="color: var(--primary); font-weight: bold;">100ë§Œ ë¹„íŠ¸í¬ë ˆë”§</span>
                            <span>5ì²œë§Œ</span>
                        </div>
                    </div>

                    <div style="margin-bottom: 20px;">
                        <label style="color: #e2e8f0; display: block; margin-bottom: 8px;">ë ˆë²„ë¦¬ì§€ ë°°ìˆ˜:</label>
                        <select id="leverageSelect" style="
                            width: 100%; padding: 10px; background: rgba(71, 85, 105, 0.2);
                            border: 1px solid rgba(71, 85, 105, 0.3); border-radius: 8px;
                            color: #e2e8f0; font-size: 1rem;
                        " onchange="updateLeverageInfo()">
                            <option value="1">1ë°° (ë ˆë²„ë¦¬ì§€ ì—†ìŒ)</option>
                            <option value="2">2ë°°</option>
                            <option value="5">5ë°°</option>
                            <option value="10">10ë°°</option>
                            <option value="20">20ë°°</option>
                            <option value="50">50ë°° âš¡</option>
                            <option value="100">100ë°° âš¡âš¡</option>
                            <option value="200" selected>200ë°° âš¡âš¡âš¡ (ìµœëŒ€)</option>
                        </select>
                    </div>

                    <div style="margin-bottom: 20px;">
                        <label style="color: #e2e8f0; display: block; margin-bottom: 8px;">í¬ì§€ì…˜:</label>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                            <button id="longBtn" onclick="selectPosition('long')" style="
                                padding: 12px; background: rgba(34, 197, 94, 0.2); border: 2px solid var(--success);
                                color: var(--success); border-radius: 8px; cursor: pointer; font-weight: bold;
                            ">ğŸš€ ë¡± (ìƒìŠ¹)</button>
                            <button id="shortBtn" onclick="selectPosition('short')" style="
                                padding: 12px; background: rgba(71, 85, 105, 0.1); border: 2px solid rgba(71, 85, 105, 0.3);
                                color: #94a3b8; border-radius: 8px; cursor: pointer; font-weight: bold;
                            ">ğŸ“‰ ìˆ (í•˜ë½)</button>
                        </div>
                    </div>

                    <div id="leverageInfo" style="background: rgba(34, 197, 94, 0.1); border: 1px solid rgba(34, 197, 94, 0.3); border-radius: 8px; padding: 15px;">
                        <div style="color: var(--success); font-size: 0.9rem; line-height: 1.5;" id="leverageDetails">
                            â€¢ ì‹¤ì œ íˆ¬ìê¸ˆ: 100ë§Œ ë¹„íŠ¸í¬ë ˆë”§<br>
                            â€¢ ë ˆë²„ë¦¬ì§€: 200ë°°<br>
                            â€¢ ì´ í¬ì§€ì…˜: 2ì–µ ë¹„íŠ¸í¬ë ˆë”§<br>
                            â€¢ 1% ë³€ë™ ì‹œ ìˆ˜ìµ/ì†ì‹¤: Â±200ë§Œ ë¹„íŠ¸í¬ë ˆë”§
                        </div>
                    </div>
                </div>

                <div style="display: flex; gap: 15px; justify-content: center;">
                    <button onclick="executeFuturesTrade('${contractName}', ${price}, ${baseVolatility})" style="
                        padding: 15px 30px; background: linear-gradient(135deg, #10b981, #059669);
                        color: white; border: none; border-radius: 10px; cursor: pointer;
                        font-size: 1rem; font-weight: bold; box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
                    ">ğŸ’¸ íˆ¬ì ì‹¤í–‰</button>
                    <button onclick="openFuturesMarket()" style="
                        padding: 15px 30px; background: rgba(71, 85, 105, 0.2);
                        color: #e2e8f0; border: 1px solid rgba(71, 85, 105, 0.3);
                        border-radius: 10px; cursor: pointer; font-size: 1rem;
                    ">â† ë’¤ë¡œ</button>
                </div>
            `;

            showModal(modalContent);
            window.selectedPosition = 'long'; // ê¸°ë³¸ê°’
        }

        let selectedPosition = 'long';

        function selectPosition(position) {
            selectedPosition = position;
            document.getElementById('longBtn').style.background = position === 'long' ? 'rgba(34, 197, 94, 0.2)' : 'rgba(71, 85, 105, 0.1)';
            document.getElementById('longBtn').style.border = position === 'long' ? '2px solid var(--success)' : '2px solid rgba(71, 85, 105, 0.3)';
            document.getElementById('longBtn').style.color = position === 'long' ? 'var(--success)' : '#94a3b8';
            
            document.getElementById('shortBtn').style.background = position === 'short' ? 'rgba(239, 68, 68, 0.2)' : 'rgba(71, 85, 105, 0.1)';
            document.getElementById('shortBtn').style.border = position === 'short' ? '2px solid var(--danger)' : '2px solid rgba(71, 85, 105, 0.3)';
            document.getElementById('shortBtn').style.color = position === 'short' ? 'var(--danger)' : '#94a3b8';
        }

        function updateFuturesAmount() {
            const amount = parseInt(document.getElementById('futuresAmount').value);
            document.getElementById('selectedFuturesAmount').textContent = `${Math.floor(amount / 10000)}ë§Œ ë¹„íŠ¸í¬ë ˆë”§`;
            updateLeverageInfo();
        }

        function updateLeverageInfo() {
            const amount = parseInt(document.getElementById('futuresAmount')?.value || 1000000);
            const leverage = parseInt(document.getElementById('leverageSelect')?.value || 200);
            const totalPosition = amount * leverage;
            const onePercentChange = totalPosition * 0.01;

            if (document.getElementById('leverageDetails')) {
                document.getElementById('leverageDetails').innerHTML = `
                    â€¢ ì‹¤ì œ íˆ¬ìê¸ˆ: ${amount.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§<br>
                    â€¢ ë ˆë²„ë¦¬ì§€: ${leverage}ë°°<br>
                    â€¢ ì´ í¬ì§€ì…˜: ${totalPosition.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§<br>
                    â€¢ 1% ë³€ë™ ì‹œ ìˆ˜ìµ/ì†ì‹¤: Â±${onePercentChange.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§<br>
                    â€¢ ë§ˆì§„ì½œ ê¸°ì¤€: ${leverage > 50 ? '-0.5%' : leverage > 10 ? '-2%' : '-5%'} (${leverage > 50 ? 'ê·¹ë„ë¡œ ìœ„í—˜' : leverage > 10 ? 'ë§¤ìš° ìœ„í—˜' : 'ìœ„í—˜'})
                `;

                const infoDiv = document.getElementById('leverageInfo');
                if (leverage >= 100) {
                    infoDiv.style.background = 'rgba(239, 68, 68, 0.1)';
                    infoDiv.style.border = '1px solid rgba(239, 68, 68, 0.3)';
                    infoDiv.querySelector('#leverageDetails').style.color = 'var(--danger)';
                } else if (leverage >= 20) {
                    infoDiv.style.background = 'rgba(245, 158, 11, 0.1)';
                    infoDiv.style.border = '1px solid rgba(245, 158, 11, 0.3)';
                    infoDiv.querySelector('#leverageDetails').style.color = 'var(--warning)';
                } else {
                    infoDiv.style.background = 'rgba(34, 197, 94, 0.1)';
                    infoDiv.style.border = '1px solid rgba(34, 197, 94, 0.3)';
                    infoDiv.querySelector('#leverageDetails').style.color = 'var(--success)';
                }
            }
        }

        function executeFuturesTrade(contractName, entryPrice, baseVolatility) {
            const amount = parseInt(document.getElementById('futuresAmount').value);
            const leverage = parseInt(document.getElementById('leverageSelect').value);
            const position = selectedPosition;

            if (gameState.currentUser.game_balance < amount) {
                showNotification(`ì„ ë¬¼íˆ¬ìì—ëŠ” ${amount.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§ì´ í•„ìš”í•©ë‹ˆë‹¤`, 'error');
                return;
            }

            const confirmation = confirm(`
${contractName} 
íˆ¬ìê¸ˆ: ${amount.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§
ë ˆë²„ë¦¬ì§€: ${leverage}ë°° 
í¬ì§€ì…˜: ${position === 'long' ? 'ë¡±(ìƒìŠ¹)' : 'ìˆ(í•˜ë½)'}
ì´ í¬ì§€ì…˜: ${(amount * leverage).toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§

ì •ë§ íˆ¬ìí•˜ì‹œê² ìŠµë‹ˆê¹Œ? (ê³ ìœ„í—˜ íˆ¬ìì…ë‹ˆë‹¤!)
            `);

            if (!confirmation) return;

            gameState.currentUser.game_balance -= amount;

            // ë§ˆì§„ì½œ ê¸°ì¤€ ì„¤ì •
            let marginCallThreshold;
            if (leverage >= 100) marginCallThreshold = -0.005; // -0.5%
            else if (leverage >= 50) marginCallThreshold = -0.01; // -1%
            else if (leverage >= 20) marginCallThreshold = -0.02; // -2%
            else if (leverage >= 10) marginCallThreshold = -0.05; // -5%
            else marginCallThreshold = -0.1; // -10%

            gameState.roleData.investments.push({
                type: 'futures',
                name: contractName,
                amount: amount,
                leverage: leverage,
                position: position, // 'long' or 'short'
                entryPrice: entryPrice,
                currentPrice: entryPrice,
                returnRate: 0,
                dividends: 0,
                volatility: baseVolatility * (1 + leverage * 0.01), // ë ˆë²„ë¦¬ì§€ì— ë”°ë¥¸ ë³€ë™ì„± ì¦ê°€
                marginCallThreshold: marginCallThreshold,
                totalPosition: amount * leverage,
                isActive: true,
                openTime: Date.now()
            });

            updateInvestmentDisplay();
            updateDisplay();
            closeModal();
            
            const leverageEmoji = leverage >= 100 ? 'âš¡âš¡âš¡' : leverage >= 50 ? 'âš¡âš¡' : leverage >= 10 ? 'âš¡' : '';
            showNotification(`${contractName} ${leverage}ë°° ${leverageEmoji} ${position === 'long' ? 'ë¡±' : 'ìˆ'} í¬ì§€ì…˜ ì§„ì…!`, 'success');
        }
        
        // ì§ì¥ì¸ ê¸°ëŠ¥ë“¤
        function workOvertime() {
            const overtimePay = Math.floor(gameState.roleData.workStats.salary * 0.3);
            gameState.currentUser.game_balance += overtimePay;
            gameState.roleData.workStats.experience += 1;
            
            updateWorkDisplay();
            updateDisplay();
            showNotification(`ì•¼ê·¼ìœ¼ë¡œ ${overtimePay.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§ì„ ë°›ì•˜ìŠµë‹ˆë‹¤!`, 'success');
        }
        
        function attendTraining() {
            const trainingCost = 2000;
            if (gameState.currentUser.game_balance < trainingCost) {
                showNotification(`êµìœ¡ë¹„ë¡œ ${trainingCost.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§ì´ í•„ìš”í•©ë‹ˆë‹¤`, 'error');
                return;
            }
            
            gameState.currentUser.game_balance -= trainingCost;
            gameState.roleData.workStats.experience += 5;
            gameState.roleData.workStats.salary += 200;
            
            updateWorkDisplay();
            updateDisplay();
            showNotification('êµìœ¡ì„ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤! ê¸‰ì—¬ê°€ ìƒìŠ¹í–ˆìŠµë‹ˆë‹¤.', 'success');
        }
        
        function requestPromotion() {
            if (gameState.roleData.workStats.experience < 10) {
                showNotification('ìŠ¹ì§„í•˜ë ¤ë©´ ê²½ë ¥ 10ë…„ ì´ìƒì´ í•„ìš”í•©ë‹ˆë‹¤', 'error');
                return;
            }
            
            const positions = ['ì‚¬ì›', 'ì£¼ì„', 'ëŒ€ë¦¬', 'ê³¼ì¥', 'ì°¨ì¥', 'ë¶€ì¥'];
            const currentIndex = positions.indexOf(gameState.roleData.workStats.position);
            
            if (currentIndex < positions.length - 1) {
                gameState.roleData.workStats.position = positions[currentIndex + 1];
                gameState.roleData.workStats.salary = Math.floor(gameState.roleData.workStats.salary * 1.5);
                gameState.roleData.workStats.bonuses += 5000;
                
                updateWorkDisplay();
                updateDisplay();
                showNotification(`${gameState.roleData.workStats.position}ìœ¼ë¡œ ìŠ¹ì§„í–ˆìŠµë‹ˆë‹¤!`, 'success');
            } else {
                showNotification('ë” ì´ìƒ ìŠ¹ì§„í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤', 'info');
            }
        }
        
        function changeJob() {
            const newSalary = Math.floor(gameState.roleData.workStats.salary * (0.8 + Math.random() * 0.6));
            gameState.roleData.workStats.salary = newSalary;
            gameState.roleData.workStats.experience += 2;
            
            const companies = ['ìƒˆë¡œìš´ íšŒì‚¬ A', 'ê¸€ë¡œë²Œ ê¸°ì—… B', 'ìŠ¤íƒ€íŠ¸ì—… C', 'ëŒ€ê¸°ì—… D'];
            const newCompany = companies[Math.floor(Math.random() * companies.length)];
            
            gameState.roleData.workHistory.push({
                company: newCompany,
                position: gameState.roleData.workStats.position,
                startDate: new Date().toLocaleDateString(),
                salary: newSalary,
                performance: Math.floor(Math.random() * 30) + 70
            });
            
            updateWorkDisplay();
            updateDisplay();
            showNotification(`${newCompany}ë¡œ ì´ì§í–ˆìŠµë‹ˆë‹¤!`, 'success');
        }
        
        // ì—…ë°ì´íŠ¸ í•¨ìˆ˜ë“¤
        function updateBusinessDisplay() {
            const businessCount = gameState.roleData.businesses.length;
            const totalProfit = gameState.roleData.businesses.reduce((sum, b) => sum + b.profit, 0);
            const totalValue = gameState.roleData.businesses.reduce((sum, b) => sum + b.value, 0);
            const totalEmployees = gameState.roleData.businesses.reduce((sum, b) => sum + b.employees, 0);
            
            document.getElementById('businessCount').textContent = businessCount;
            document.getElementById('monthlyProfit').textContent = totalProfit.toLocaleString();
            document.getElementById('businessValue').textContent = totalValue.toLocaleString();
            document.getElementById('employeeCount').textContent = totalEmployees;
            
            const businessList = document.getElementById('myBusinesses');
            businessList.innerHTML = '';
            
            gameState.roleData.businesses.forEach(business => {
                const businessCard = document.createElement('div');
                businessCard.className = 'business-card';
                const publicBadge = business.isPublic ? ' <span style="color: var(--primary); font-size: 0.9rem;">ğŸ“ˆ ìƒì¥</span>' : '';
                businessCard.innerHTML = `
                    <div class="business-header">
                        <div class="business-name">${business.name} (ë ˆë²¨ ${business.level})${publicBadge}</div>
                        <div class="business-profit">+${business.profit.toLocaleString()}/ì›”</div>
                    </div>
                    <p>ì§ì›: ${business.employees}ëª… | ê°€ì¹˜: ${business.value.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§</p>
                `;
                businessList.appendChild(businessCard);
            });
            
            // ìƒì¥ ê¸°ì—… ì •ë³´ ì—…ë°ì´íŠ¸
            updatePublicCompanyDisplay();
            
            // ê¸°ì—… í‰ê°€ ì •ë³´ ì—…ë°ì´íŠ¸
            updateCompanyRatingDisplay();
            
            // ê²½ìŸì‚¬ ì •ë³´ ì—…ë°ì´íŠ¸
            updateCompetitorDisplay();
        }
        
        function updateInvestmentDisplay() {
            const totalInvestment = gameState.roleData.investments.reduce((sum, i) => sum + i.amount, 0);
            const avgReturn = gameState.roleData.investments.length > 0 ? 
                (gameState.roleData.investments.reduce((sum, i) => sum + i.returnRate, 0) / gameState.roleData.investments.length * 100) : 0;
            const totalDividends = gameState.roleData.investments.reduce((sum, i) => sum + i.dividends, 0);
            
            document.getElementById('totalInvestment').textContent = totalInvestment.toLocaleString();
            document.getElementById('investmentReturn').textContent = avgReturn.toFixed(1) + '%';
            document.getElementById('stockCount').textContent = gameState.roleData.investments.length;
            document.getElementById('dividends').textContent = totalDividends.toLocaleString();
            
            const portfolioDiv = document.getElementById('investmentPortfolio');
            portfolioDiv.innerHTML = '';
            
            gameState.roleData.investments.forEach(investment => {
                const card = document.createElement('div');
                card.className = 'business-card';
                const returnColor = investment.returnRate >= 0 ? 'var(--success)' : 'var(--danger)';
                // ì„ ë¬¼íˆ¬ì íŠ¹ë³„ í‘œì‹œ
                if (investment.type === 'futures') {
                    const leverageEmoji = investment.leverage >= 100 ? 'âš¡âš¡âš¡' : investment.leverage >= 50 ? 'âš¡âš¡' : investment.leverage >= 10 ? 'âš¡' : '';
                    const positionEmoji = investment.position === 'long' ? 'ğŸš€' : 'ğŸ“‰';
                    const statusText = investment.isActive ? 'ì§„í–‰ì¤‘' : 'ì²­ì‚°ë¨';
                    const statusColor = investment.isActive ? (investment.returnRate >= 0 ? 'var(--success)' : 'var(--warning)') : 'var(--danger)';
                    
                    card.innerHTML = `
                        <div class="business-header">
                            <div class="business-name">${investment.name} ${leverageEmoji}</div>
                            <div style="color: ${returnColor}">${(investment.returnRate * 100).toFixed(1)}%</div>
                        </div>
                        <p>
                            ${positionEmoji} ${investment.position === 'long' ? 'ë¡±' : 'ìˆ'} ${investment.leverage}ë°° | 
                            íˆ¬ìê¸ˆ: ${investment.amount.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§ | 
                            <span style="color: ${statusColor};">${statusText}</span>
                        </p>
                        ${investment.isActive ? `<p style="font-size: 0.8rem; color: #94a3b8;">ì´ í¬ì§€ì…˜: ${investment.totalPosition.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§</p>` : ''}
                    `;
                } else {
                    card.innerHTML = `
                        <div class="business-header">
                            <div class="business-name">${investment.name} (${investment.type})</div>
                            <div style="color: ${returnColor}">${(investment.returnRate * 100).toFixed(1)}%</div>
                        </div>
                        <p>íˆ¬ìê¸ˆ: ${investment.amount.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§ | ë°°ë‹¹: ${investment.dividends.toLocaleString()}/ì›”</p>
                    `;
                }
                portfolioDiv.appendChild(card);
            });
        }
        
        function updateWorkDisplay() {
            document.getElementById('monthlySalary').textContent = gameState.roleData.workStats.salary.toLocaleString();
            document.getElementById('workExperience').textContent = gameState.roleData.workStats.experience + 'ë…„';
            document.getElementById('jobTitle').textContent = gameState.roleData.workStats.position;
            document.getElementById('bonusAvailable').textContent = gameState.roleData.workStats.bonuses.toLocaleString();
            
            const historyDiv = document.getElementById('workHistory');
            historyDiv.innerHTML = '';
            
            gameState.roleData.workHistory.forEach(job => {
                const card = document.createElement('div');
                card.className = 'business-card';
                card.innerHTML = `
                    <div class="business-header">
                        <div class="business-name">${job.company}</div>
                        <div class="business-profit">${job.salary.toLocaleString()}/ì›”</div>
                    </div>
                    <p>${job.position} | ì…ì‚¬ì¼: ${job.startDate} | ì„±ê³¼: ${job.performance}ì </p>
                `;
                historyDiv.appendChild(card);
            });
        }

        // M&A ì‹œìŠ¤í…œ í•¨ìˆ˜ë“¤
        function openMAModal() {
            generateAcquisitionTargets();
            document.getElementById('maModal').style.display = 'flex';
        }

        function closeMAModal() {
            document.getElementById('maModal').style.display = 'none';
        }

        function generateAcquisitionTargets() {
            const targetCompanies = [
                { name: 'í…Œí¬ë…¸ë² ì´ì…˜', sector: 'tech', value: 50000, employees: 25, profit: 3000, growth: 15 },
                { name: 'ê¸€ë¡œë²Œë¡œì§€ìŠ¤', sector: 'logistics', value: 80000, employees: 45, profit: 4500, growth: 12 },
                { name: 'ê·¸ë¦°ì—ë„ˆì§€', sector: 'energy', value: 120000, employees: 65, profit: 7000, growth: 20 },
                { name: 'í—¬ìŠ¤ì¼€ì–´í”ŒëŸ¬ìŠ¤', sector: 'healthcare', value: 90000, employees: 38, profit: 5500, growth: 18 },
                { name: 'ì—ë“€í…Œí¬', sector: 'education', value: 35000, employees: 22, profit: 2200, growth: 25 },
                { name: 'í‘¸ë“œí…Œí¬', sector: 'food', value: 60000, employees: 30, profit: 3800, growth: 14 }
            ];

            // ëœë¤ìœ¼ë¡œ 3-5ê°œ íšŒì‚¬ ì„ íƒ
            const shuffled = [...targetCompanies].sort(() => 0.5 - Math.random());
            const availableTargets = shuffled.slice(0, 3 + Math.floor(Math.random() * 3));

            const targetsDiv = document.getElementById('acquisitionTargets');
            targetsDiv.innerHTML = '';

            availableTargets.forEach(target => {
                const targetCard = document.createElement('div');
                targetCard.className = 'business-card';
                targetCard.style.marginBottom = '15px';
                
                const acquisitionCost = Math.floor(target.value * (1.2 + Math.random() * 0.4)); // 120-160% í”„ë¦¬ë¯¸ì—„
                const canAfford = gameState.currentUser.game_balance >= acquisitionCost;
                
                targetCard.innerHTML = `
                    <div class="business-header">
                        <div class="business-name">${target.name} (${target.sector})</div>
                        <div class="business-profit">+${target.profit.toLocaleString()}/ì›”</div>
                    </div>
                    <div style="margin: 10px 0; font-size: 0.9rem; color: #94a3b8;">
                        <div>ê¸°ì—…ê°€ì¹˜: ${target.value.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§ | ì§ì›: ${target.employees}ëª…</div>
                        <div>ì„±ì¥ë¥ : +${target.growth}% | ì¸ìˆ˜ë¹„ìš©: ${acquisitionCost.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§</div>
                    </div>
                    <button class="btn ${canAfford ? '' : 'btn-secondary'}" 
                            onclick="attemptAcquisition('${target.name}', ${acquisitionCost}, ${target.value}, ${target.employees}, ${target.profit}, ${target.growth})"
                            ${canAfford ? '' : 'disabled'}>
                        ${canAfford ? 'ì¸ìˆ˜í•˜ê¸°' : 'ìê¸ˆ ë¶€ì¡±'}
                    </button>
                `;
                targetsDiv.appendChild(targetCard);
            });
        }

        function attemptAcquisition(name, cost, value, employees, profit, growth) {
            if (gameState.currentUser.game_balance < cost) {
                showNotification('ì¸ìˆ˜ ìê¸ˆì´ ë¶€ì¡±í•©ë‹ˆë‹¤', 'error');
                return;
            }

            // M&A ì„±ê³µë¥  ê³„ì‚° (ìê¸ˆ ì—¬ìœ ë„, ê¸°ì—… ê·œëª¨ ë“± ê³ ë ¤)
            const fundRatio = gameState.currentUser.game_balance / cost;
            const baseSuccessRate = 0.7; // 70% ê¸°ë³¸ ì„±ê³µë¥ 
            const fundingBonus = Math.min(0.2, (fundRatio - 1) * 0.1); // ìê¸ˆ ì—¬ìœ ë„ ë³´ë„ˆìŠ¤
            const successRate = Math.min(0.9, baseSuccessRate + fundingBonus); // ìµœëŒ€ 90%

            const isSuccess = Math.random() < successRate;

            if (isSuccess) {
                // ì¸ìˆ˜ ì„±ê³µ
                gameState.currentUser.game_balance -= cost;
                
                const newBusiness = {
                    name: name,
                    level: 1,
                    employees: employees,
                    profit: Math.floor(profit * (1 + growth / 100)), // ì„±ì¥ë¥  ì ìš©
                    value: value,
                    investment: cost,
                    isPublic: false,
                    sector: 'acquired',
                    growthRate: growth,
                    acquired: true
                };

                gameState.roleData.businesses.push(newBusiness);
                
                // ê¸°ì—… í‰íŒ ìƒìŠ¹
                gameState.roleData.companyRating.reputation += 5;
                gameState.roleData.companyRating.marketShare += 2;

                updateBusinessDisplay();
                updateDisplay();
                closeMAModal();
                showNotification(`${name} ì¸ìˆ˜ê°€ ì„±ê³µí–ˆìŠµë‹ˆë‹¤! ì‹œì¥ ì ìœ ìœ¨ì´ ì¦ê°€í–ˆìŠµë‹ˆë‹¤.`, 'success');
            } else {
                // ì¸ìˆ˜ ì‹¤íŒ¨ - ì¼ë¶€ ë¹„ìš© ì†ì‹¤
                const loss = Math.floor(cost * 0.15); // 15% ì†ì‹¤ (í˜‘ìƒ ë¹„ìš©, ì‹¤ì‚¬ ë¹„ìš© ë“±)
                gameState.currentUser.game_balance -= loss;
                
                updateDisplay();
                showNotification(`${name} ì¸ìˆ˜ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. í˜‘ìƒ ë¹„ìš©ìœ¼ë¡œ ${loss.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§ì„ ìƒì—ˆìŠµë‹ˆë‹¤.`, 'error');
            }
        }

        // R&D ì‹œìŠ¤í…œ í•¨ìˆ˜ë“¤
        function openRDModal() {
            generateRDProjects();
            updateActiveRDProjects();
            document.getElementById('rdModal').style.display = 'flex';
        }

        function closeRDModal() {
            document.getElementById('rdModal').style.display = 'none';
        }

        function generateRDProjects() {
            const availableProjects = [
                { 
                    name: 'ìë™í™” ì‹œìŠ¤í…œ', 
                    cost: 30000, 
                    duration: 6, 
                    description: 'ìƒì‚° íš¨ìœ¨ì„± 20% í–¥ìƒ',
                    benefit: { type: 'efficiency', value: 0.2 }
                },
                { 
                    name: 'AI í’ˆì§ˆê´€ë¦¬', 
                    cost: 45000, 
                    duration: 8, 
                    description: 'ë¶ˆëŸ‰ë¥  50% ê°ì†Œ, í‰íŒ +10',
                    benefit: { type: 'quality', value: 0.5, reputation: 10 }
                },
                { 
                    name: 'ì¹œí™˜ê²½ ê¸°ìˆ ', 
                    cost: 25000, 
                    duration: 5, 
                    description: 'ESG ì ìˆ˜ +20, ì •ë¶€ ì§€ì›ê¸ˆ 15000 ë¹„íŠ¸í¬ë ˆë”§',
                    benefit: { type: 'esg', value: 20, subsidy: 15000 }
                },
                { 
                    name: 'ì‹ ì œí’ˆ ê°œë°œ', 
                    cost: 60000, 
                    duration: 10, 
                    description: 'ì‹ ê·œ ì‚¬ì—… ê¸°íšŒ, ìˆ˜ìµ +30%',
                    benefit: { type: 'revenue', value: 0.3 }
                },
                { 
                    name: 'ë””ì§€í„¸ íŠ¸ëœìŠ¤í¬ë©”ì´ì…˜', 
                    cost: 50000, 
                    duration: 12, 
                    description: 'ìš´ì˜ë¹„ -25%, ê³ ê° ë§Œì¡±ë„ +15',
                    benefit: { type: 'cost_reduction', value: 0.25, reputation: 15 }
                }
            ];

            // í˜„ì¬ ì§„í–‰ì¤‘ì´ì§€ ì•Šì€ í”„ë¡œì íŠ¸ë§Œ í‘œì‹œ
            const activeProjectNames = gameState.roleData.rdProjects.map(p => p.name);
            const available = availableProjects.filter(p => !activeProjectNames.includes(p.name));

            const projectsDiv = document.getElementById('availableRDProjects');
            projectsDiv.innerHTML = '';

            available.slice(0, 3).forEach(project => {
                const projectCard = document.createElement('div');
                projectCard.className = 'business-card';
                projectCard.style.marginBottom = '15px';
                
                const canAfford = gameState.currentUser.game_balance >= project.cost;
                
                projectCard.innerHTML = `
                    <div class="business-header">
                        <div class="business-name">${project.name}</div>
                        <div style="color: var(--warning);">${project.cost.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§</div>
                    </div>
                    <div style="margin: 10px 0; font-size: 0.9rem; color: #94a3b8;">
                        <div>ê°œë°œ ê¸°ê°„: ${project.duration}ê°œì›”</div>
                        <div style="color: var(--success);">${project.description}</div>
                    </div>
                    <button class="btn ${canAfford ? '' : 'btn-secondary'}" 
                            onclick="startRDProject('${project.name}', ${project.cost}, ${project.duration}, '${project.description}', '${JSON.stringify(project.benefit).replace(/"/g, "&quot;")}')"
                            ${canAfford ? '' : 'disabled'}>
                        ${canAfford ? 'í”„ë¡œì íŠ¸ ì‹œì‘' : 'ìê¸ˆ ë¶€ì¡±'}
                    </button>
                `;
                projectsDiv.appendChild(projectCard);
            });
        }

        function startRDProject(name, cost, duration, description, benefitStr) {
            if (gameState.currentUser.game_balance < cost) {
                showNotification('R&D ìê¸ˆì´ ë¶€ì¡±í•©ë‹ˆë‹¤', 'error');
                return;
            }

            gameState.currentUser.game_balance -= cost;
            
            const benefit = JSON.parse(benefitStr.replace(/&quot;/g, '"'));
            const startDate = new Date();
            const endDate = new Date();
            endDate.setMonth(endDate.getMonth() + duration);

            const rdProject = {
                name: name,
                cost: cost,
                duration: duration,
                description: description,
                benefit: benefit,
                startDate: startDate.toLocaleDateString(),
                endDate: endDate.toLocaleDateString(),
                progress: 0,
                completed: false
            };

            gameState.roleData.rdProjects.push(rdProject);
            
            updateDisplay();
            generateRDProjects();
            updateActiveRDProjects();
            showNotification(`${name} R&D í”„ë¡œì íŠ¸ë¥¼ ì‹œì‘í–ˆìŠµë‹ˆë‹¤!`, 'success');
        }

        function updateActiveRDProjects() {
            const activeDiv = document.getElementById('activeRDProjects');
            activeDiv.innerHTML = '';

            const activeProjects = gameState.roleData.rdProjects.filter(p => !p.completed);

            if (activeProjects.length === 0) {
                activeDiv.innerHTML = '<p style="color: #64748b; text-align: center;">ì§„í–‰ì¤‘ì¸ R&D í”„ë¡œì íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤</p>';
                return;
            }

            activeProjects.forEach(project => {
                const projectCard = document.createElement('div');
                projectCard.className = 'business-card';
                projectCard.style.marginBottom = '15px';
                
                // ì§„í–‰ë¥  ê³„ì‚° (ì‹œê°„ ê¸°ë°˜ ì‹œë®¬ë ˆì´ì…˜)
                const startDate = new Date(project.startDate);
                const endDate = new Date(project.endDate);
                const now = new Date();
                const totalTime = endDate - startDate;
                const elapsedTime = now - startDate;
                const progress = Math.min(100, Math.max(0, (elapsedTime / totalTime) * 100));
                
                projectCard.innerHTML = `
                    <div class="business-header">
                        <div class="business-name">${project.name}</div>
                        <div style="color: var(--primary);">${progress.toFixed(1)}%</div>
                    </div>
                    <div style="margin: 10px 0; font-size: 0.9rem; color: #94a3b8;">
                        <div>${project.description}</div>
                        <div>ì™„ë£Œ ì˜ˆì •: ${project.endDate}</div>
                        <div style="background: rgba(59, 130, 246, 0.1); border-radius: 10px; height: 8px; margin-top: 8px;">
                            <div style="background: var(--primary); height: 100%; border-radius: 10px; width: ${progress}%; transition: width 0.3s;"></div>
                        </div>
                    </div>
                    ${progress >= 100 ? 
                        `<button class="btn" onclick="completeRDProject('${project.name}')">í”„ë¡œì íŠ¸ ì™„ë£Œ</button>` :
                        '<div style="color: #64748b; text-align: center;">ê°œë°œ ì§„í–‰ì¤‘...</div>'
                    }
                `;
                activeDiv.appendChild(projectCard);
            });
        }

        function completeRDProject(projectName) {
            const projectIndex = gameState.roleData.rdProjects.findIndex(p => p.name === projectName);
            if (projectIndex === -1) return;

            const project = gameState.roleData.rdProjects[projectIndex];
            project.completed = true;

            // í˜œíƒ ì ìš©
            const benefit = project.benefit;
            let message = `${projectName} R&D í”„ë¡œì íŠ¸ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤! `;

            if (benefit.type === 'efficiency') {
                // ëª¨ë“  ì‚¬ì—…ì²´ ìˆ˜ìµ ì¦ê°€
                gameState.roleData.businesses.forEach(business => {
                    business.profit = Math.floor(business.profit * (1 + benefit.value));
                });
                message += `ëª¨ë“  ì‚¬ì—…ì²´ì˜ íš¨ìœ¨ì„±ì´ ${(benefit.value * 100)}% í–¥ìƒë˜ì—ˆìŠµë‹ˆë‹¤.`;
            }

            if (benefit.type === 'quality' || benefit.reputation) {
                gameState.roleData.companyRating.reputation += (benefit.reputation || 0);
                message += ` í‰íŒì´ ${benefit.reputation || 0}ì  ìƒìŠ¹í–ˆìŠµë‹ˆë‹¤.`;
            }

            if (benefit.type === 'esg') {
                gameState.roleData.companyRating.esgScore += benefit.value;
                if (benefit.subsidy) {
                    gameState.currentUser.game_balance += benefit.subsidy;
                    message += ` ESG ì ìˆ˜ê°€ ${benefit.value}ì  ìƒìŠ¹í•˜ê³  ì •ë¶€ ì§€ì›ê¸ˆ ${benefit.subsidy.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§ì„ ë°›ì•˜ìŠµë‹ˆë‹¤.`;
                }
            }

            if (benefit.type === 'revenue') {
                gameState.roleData.businesses.forEach(business => {
                    business.profit = Math.floor(business.profit * (1 + benefit.value));
                });
                message += ` ëª¨ë“  ì‚¬ì—…ì²´ ìˆ˜ìµì´ ${(benefit.value * 100)}% ì¦ê°€í–ˆìŠµë‹ˆë‹¤.`;
            }

            if (benefit.type === 'cost_reduction') {
                // ìš´ì˜ë¹„ ì ˆê° íš¨ê³¼ëŠ” ìˆ˜ìµ ì¦ê°€ë¡œ í‘œí˜„
                gameState.roleData.businesses.forEach(business => {
                    business.profit = Math.floor(business.profit * (1 + benefit.value * 0.5)); // ë¹„ìš© ì ˆê°ì˜ ì ˆë°˜ì„ ìˆ˜ìµ ì¦ê°€ë¡œ
                });
                if (benefit.reputation) {
                    gameState.roleData.companyRating.reputation += benefit.reputation;
                    message += ` ìš´ì˜ë¹„ê°€ ì ˆê°ë˜ê³  í‰íŒì´ ${benefit.reputation}ì  ìƒìŠ¹í–ˆìŠµë‹ˆë‹¤.`;
                }
            }

            updateBusinessDisplay();
            updateDisplay();
            updateActiveRDProjects();
            showNotification(message, 'success');
        }

        // ê¸°ì—… ë“±ê¸‰ & í‰íŒ ì‹œìŠ¤í…œ í•¨ìˆ˜ë“¤
        function updateCompanyRatingDisplay() {
            // ì‹ ìš©ë“±ê¸‰ ê³„ì‚° (ê¸°ì—…ê°€ì¹˜, í‰íŒ, ESG ì ìˆ˜ ê¸°ë°˜)
            const totalBusinessValue = gameState.roleData.businesses.reduce((sum, b) => sum + b.value, 0);
            const reputation = gameState.roleData.companyRating.reputation;
            const esgScore = gameState.roleData.companyRating.esgScore;
            
            let creditRating = 'D';
            if (totalBusinessValue >= 500000 && reputation >= 90 && esgScore >= 80) {
                creditRating = 'AAA';
            } else if (totalBusinessValue >= 300000 && reputation >= 80 && esgScore >= 70) {
                creditRating = 'AA';
            } else if (totalBusinessValue >= 200000 && reputation >= 70 && esgScore >= 60) {
                creditRating = 'A';
            } else if (totalBusinessValue >= 100000 && reputation >= 60 && esgScore >= 50) {
                creditRating = 'BBB';
            } else if (totalBusinessValue >= 50000 && reputation >= 50 && esgScore >= 40) {
                creditRating = 'BB';
            } else if (totalBusinessValue >= 20000 && reputation >= 40 && esgScore >= 30) {
                creditRating = 'B';
            } else if (totalBusinessValue >= 10000 || reputation >= 30) {
                creditRating = 'C';
            }
            
            gameState.roleData.companyRating.creditRating = creditRating;
            
            // UI ì—…ë°ì´íŠ¸
            document.getElementById('creditRating').textContent = creditRating;
            document.getElementById('companyReputation').textContent = reputation + 'ì ';
            document.getElementById('esgScore').textContent = esgScore + 'ì ';
            document.getElementById('marketSharePercent').textContent = gameState.roleData.companyRating.marketShare.toFixed(1) + '%';
            
            // ì‹ ìš©ë“±ê¸‰ì— ë”°ë¥¸ ìƒ‰ìƒ ë³€ê²½
            const ratingElement = document.getElementById('creditRating');
            ratingElement.style.color = getCreditRatingColor(creditRating);
        }

        function getCreditRatingColor(rating) {
            const colors = {
                'AAA': '#10b981', // ë…¹ìƒ‰ 
                'AA': '#16a34a',
                'A': '#65a30d', 
                'BBB': '#ca8a04', // í™©ìƒ‰
                'BB': '#ea580c',
                'B': '#dc2626',   // ì ìƒ‰
                'C': '#991b1b',
                'D': '#7f1d1d'
            };
            return colors[rating] || '#64748b';
        }

        // ê²½ìŸì‚¬ ì‹œìŠ¤í…œ í•¨ìˆ˜ë“¤
        function generateCompetitors() {
            if (gameState.roleData.competitors.length === 0) {
                const competitorNames = ['í…Œí¬ì´ë…¸ë² ì´í„°', 'ê¸€ë¡œë²Œë¹„ì¦ˆ', 'í“¨ì²˜ì»´í¼ë‹ˆ', 'ìŠ¤ë§ˆíŠ¸ì†”ë£¨ì…˜', 'ë„¥ìŠ¤íŠ¸ì œë„ˆë ˆì´ì…˜'];
                
                for (let i = 0; i < 3; i++) {
                    const competitor = {
                        name: competitorNames[i],
                        marketShare: 10 + Math.random() * 20, // 10-30%
                        reputation: 50 + Math.random() * 40,  // 50-90
                        growth: -5 + Math.random() * 20,      // -5% ~ 15%
                        strength: ['í˜ì‹ ', 'ë§ˆì¼€íŒ…', 'ë¹„ìš©íš¨ìœ¨', 'í’ˆì§ˆ', 'ê³ ê°ì„œë¹„ìŠ¤'][Math.floor(Math.random() * 5)]
                    };
                    gameState.roleData.competitors.push(competitor);
                }
            }
        }

        function updateCompetitorDisplay() {
            generateCompetitors();
            const competitorsDiv = document.getElementById('competitorsList');
            competitorsDiv.innerHTML = '';

            gameState.roleData.competitors.forEach((competitor, index) => {
                const competitorCard = document.createElement('div');
                competitorCard.className = 'business-card';
                competitorCard.style.marginBottom = '10px';
                
                const growthColor = competitor.growth >= 0 ? 'var(--success)' : 'var(--danger)';
                const vsPlayerShare = gameState.roleData.companyRating.marketShare;
                const isWinning = competitor.marketShare < vsPlayerShare;
                
                competitorCard.innerHTML = `
                    <div class="business-header">
                        <div class="business-name">${competitor.name} ${isWinning ? 'ğŸ“‰' : 'ğŸ“ˆ'}</div>
                        <div style="color: ${growthColor};">${competitor.growth.toFixed(1)}%</div>
                    </div>
                    <div style="font-size: 0.9rem; color: #94a3b8; margin-top: 5px;">
                        ì‹œì¥ì ìœ ìœ¨: ${competitor.marketShare.toFixed(1)}% | í‰íŒ: ${competitor.reputation.toFixed(0)}ì  | ê°•ì : ${competitor.strength}
                    </div>
                `;
                competitorsDiv.appendChild(competitorCard);
            });
        }

        function simulateMarketCompetition() {
            // ë§¤ë‹¬ ì‹œì¥ ì ìœ ìœ¨ ë³€í™” ì‹œë®¬ë ˆì´ì…˜
            const playerGrowth = gameState.roleData.businesses.length * 0.2 + (gameState.roleData.companyRating.reputation - 50) * 0.05;
            
            gameState.roleData.competitors.forEach(competitor => {
                const competitorGrowth = (competitor.growth / 100) * competitor.marketShare * 0.1;
                const randomFactor = (Math.random() - 0.5) * 2; // -1 ~ 1
                
                competitor.marketShare += competitorGrowth + randomFactor;
                competitor.marketShare = Math.max(1, Math.min(50, competitor.marketShare)); // 1-50% ì œí•œ
            });
            
            // í”Œë ˆì´ì–´ ì ìœ ìœ¨ ì—…ë°ì´íŠ¸
            const totalMarket = 100;
            const competitorTotalShare = gameState.roleData.competitors.reduce((sum, c) => sum + c.marketShare, 0);
            const remainingShare = Math.max(5, totalMarket - competitorTotalShare - 30); // 30%ëŠ” ê¸°íƒ€ ì—…ì²´ë“¤
            
            gameState.roleData.companyRating.marketShare += playerGrowth;
            gameState.roleData.companyRating.marketShare = Math.max(1, Math.min(remainingShare, gameState.roleData.companyRating.marketShare));
        }

        // í† ì§€ ì‹œìŠ¤í…œ ë³€ìˆ˜
        let selectedRegion = null;
        let currentLandSize = 1000;

        // í† ì§€ íˆ¬ì í•¨ìˆ˜ë“¤
        function openLandModal() {
            updateLandMarketDisplay();
            document.getElementById('landModal').style.display = 'flex';
        }

        function closeLandModal() {
            document.getElementById('landModal').style.display = 'none';
        }

        function closeLandDetailModal() {
            document.getElementById('landDetailModal').style.display = 'none';
        }

        function updateLandMarketDisplay() {
            // ì „ì²´ í† ì§€ í˜„í™© ì—…ë°ì´íŠ¸
            const totalAvailable = gameState.landMarket.regions.reduce((sum, r) => sum + r.available, 0);
            document.getElementById('landMarketStatus').textContent = 
                `ì „êµ­ í† ì§€ í˜„í™©: ì´ ${gameState.landMarket.totalLand.toLocaleString()}í‰ ì¤‘ ${totalAvailable.toLocaleString()}í‰ ë‚¨ìŒ`;
            
            // ë¶€ë™ì‚° ëª¨ë‹¬ì˜ í† ì§€ ìƒíƒœë„ ì—…ë°ì´íŠ¸
            const totalLandStatus = document.getElementById('totalLandStatus');
            if (totalLandStatus) {
                totalLandStatus.textContent = `ì´ ${(gameState.landMarket.totalLand / 10000).toFixed(1)}ë§Œí‰ ì¤‘ ${(totalAvailable / 10000).toFixed(1)}ë§Œí‰ ë‚¨ìŒ`;
            }

            // ì§€ì—­ë³„ í† ì§€ ëª©ë¡ ìƒì„±
            const regionsDiv = document.getElementById('landRegionsList');
            regionsDiv.innerHTML = '';

            gameState.landMarket.regions.forEach(region => {
                const occupancyRate = ((region.total - region.available) / region.total * 100).toFixed(1);
                // ë¬´ì œí•œ í¬ì†Œì„± í”„ë¦¬ë¯¸ì—„: ì ìœ ìœ¨ì´ ë†’ì„ìˆ˜ë¡ ê¸°í•˜ê¸‰ìˆ˜ì  ìƒìŠ¹
                const scarcityMultiplier = 1 + Math.pow(occupancyRate / 100, 2) * 10; // 100% ì ìœ ì‹œ 1100% (11ë°°)
                const basePrice = gameState.landMarket.landPricePerUnit * region.priceMultiplier * scarcityMultiplier;
                
                const regionCard = document.createElement('div');
                regionCard.className = 'business-card';
                regionCard.style.cursor = region.available > 0 ? 'pointer' : 'not-allowed';
                regionCard.style.opacity = region.available > 0 ? '1' : '0.5';
                
                const statusColor = occupancyRate < 30 ? 'var(--success)' : 
                                  occupancyRate < 70 ? 'var(--warning)' : 'var(--danger)';
                
                regionCard.innerHTML = `
                    <div class="business-header">
                        <div class="business-name">${region.name}</div>
                        <div style="color: ${statusColor};">${occupancyRate}% ì ìœ </div>
                    </div>
                    <div style="font-size: 0.9rem; color: #94a3b8; margin: 10px 0;">
                        <div>â€¢ ë‚¨ì€ í† ì§€: ${region.available.toLocaleString()}í‰</div>
                        <div>â€¢ í‰ë‹¹ ê°€ê²©: ${Math.floor(basePrice).toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§</div>
                        <div>â€¢ ì§€ì—­ íŠ¹ì„±: ${getRegionFeature(region.name)}</div>
                        <div>â€¢ ìƒíƒœ: ${region.available > 0 ? 'êµ¬ë§¤ ê°€ëŠ¥' : 'ë§¤ì§„'}</div>
                    </div>
                `;
                
                if (region.available > 0) {
                    regionCard.onclick = () => openLandDetailModal(region);
                }
                
                regionsDiv.appendChild(regionCard);
            });
        }

        function getRegionFeature(regionName) {
            const features = {
                'ê°•ë‚¨êµ¬': 'ìµœê³ ê¸‰ ìƒì—…ì§€êµ¬',
                'ì„œì´ˆêµ¬': 'êµìœ¡/ì—…ë¬´ ì¤‘ì‹¬ì§€',
                'ì†¡íŒŒêµ¬': 'ì‹ ë„ì‹œ ê°œë°œì§€ì—­',  
                'ë§ˆí¬êµ¬': 'IT/ë¬¸í™” ë³µí•©ì§€ì—­',
                'ì„±ë™êµ¬': 'ì¤€ê°•ë‚¨ ì‹ í¥ì§€ì—­',
                'ê²½ê¸°ë„': 'ìˆ˜ë„ê¶Œ ê·¼êµ',
                'ì¸ì²œ': 'êµ­ì œê³µí•­ ì¸ê·¼',
                'ì§€ë°©': 'ê°œë°œ ì ì¬ë ¥ ì§€ì—­'
            };
            return features[regionName] || 'ì¼ë°˜ ì§€ì—­';
        }

        function openLandDetailModal(region) {
            selectedRegion = region;
            currentLandSize = 1000;
            
            document.getElementById('landDetailTitle').textContent = `${region.name} í† ì§€ êµ¬ë§¤`;
            document.getElementById('landSizeSlider').value = currentLandSize;
            document.getElementById('landSizeSlider').max = Math.min(50000, region.available);
            document.getElementById('landSizeSlider').min = Math.min(1000, region.available);
            
            updateLandCalculation();
            document.getElementById('landModal').style.display = 'none';
            document.getElementById('landDetailModal').style.display = 'flex';
        }

        function updateLandCalculation() {
            if (!selectedRegion) return;
            
            currentLandSize = parseInt(document.getElementById('landSizeSlider').value);
            document.getElementById('selectedLandSize').textContent = `${currentLandSize}í‰`;
            
            // í¬ì†Œì„± í”„ë¦¬ë¯¸ì—„ ê³„ì‚° (ë¬´ì œí•œ)
            const occupancyRate = (selectedRegion.total - selectedRegion.available) / selectedRegion.total;
            const scarcityMultiplier = 1 + Math.pow(occupancyRate, 2) * 10; // ë¬´ì œí•œ ê¸°í•˜ê¸‰ìˆ˜ì  ìƒìŠ¹
            
            // ê°€ê²© ê³„ì‚°
            const basePrice = gameState.landMarket.landPricePerUnit * currentLandSize;
            const regionPrice = basePrice * (selectedRegion.priceMultiplier - 1);
            const scarcityPrice = basePrice * (scarcityMultiplier - 1);
            const totalPrice = basePrice + regionPrice + scarcityPrice;
            
            // UI ì—…ë°ì´íŠ¸
            document.getElementById('landBasePrice').textContent = `${basePrice.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§`;
            document.getElementById('landRegionPrice').textContent = `+${regionPrice.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§`;
            document.getElementById('landScarcityPrice').textContent = `+${scarcityPrice.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§`;
            document.getElementById('landTotalPrice').textContent = `${Math.floor(totalPrice).toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§`;
            
            // êµ¬ë§¤ ê°€ëŠ¥ ì—¬ë¶€ í™•ì¸
            const canAfford = gameState.currentUser.game_balance >= totalPrice;
            const purchaseBtn = document.getElementById('landPurchaseBtn');
            purchaseBtn.disabled = !canAfford || currentLandSize > selectedRegion.available;
            purchaseBtn.textContent = !canAfford ? 'ìê¸ˆ ë¶€ì¡±' : 
                                    currentLandSize > selectedRegion.available ? 'í† ì§€ ë¶€ì¡±' : 'êµ¬ë§¤í•˜ê¸°';
            purchaseBtn.className = canAfford && currentLandSize <= selectedRegion.available ? 'btn' : 'btn btn-secondary';
            
            // í† ì§€ ì •ë³´ ì—…ë°ì´íŠ¸
            document.getElementById('landDetailInfo').innerHTML = `
                <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                    <span>ì§€ì—­:</span>
                    <span style="font-weight: bold;">${selectedRegion.name}</span>
                </div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                    <span>êµ¬ë§¤ í‰ìˆ˜:</span>
                    <span style="font-weight: bold;">${currentLandSize.toLocaleString()}í‰</span>
                </div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                    <span>ë‚¨ì€ í† ì§€:</span>
                    <span>${selectedRegion.available.toLocaleString()}í‰</span>
                </div>
                <div style="display: flex; justify-content: space-between;">
                    <span>ì ìœ ìœ¨:</span>
                    <span>${((selectedRegion.total - selectedRegion.available) / selectedRegion.total * 100).toFixed(1)}%</span>
                </div>
            `;
        }

        function confirmLandPurchase() {
            if (!selectedRegion || currentLandSize > selectedRegion.available) return;
            
            // ê°€ê²© ì¬ê³„ì‚° (ë¬´ì œí•œ í¬ì†Œì„±)
            const occupancyRate = (selectedRegion.total - selectedRegion.available) / selectedRegion.total;
            const scarcityMultiplier = 1 + Math.pow(occupancyRate, 2) * 10;
            const basePrice = gameState.landMarket.landPricePerUnit * currentLandSize;
            const totalPrice = basePrice * selectedRegion.priceMultiplier * scarcityMultiplier;
            
            if (gameState.currentUser.game_balance < totalPrice) {
                showNotification('í† ì§€ êµ¬ë§¤ ìê¸ˆì´ ë¶€ì¡±í•©ë‹ˆë‹¤', 'error');
                return;
            }
            
            // í† ì§€ êµ¬ë§¤ ì²˜ë¦¬
            gameState.currentUser.game_balance -= Math.floor(totalPrice);
            selectedRegion.available -= currentLandSize;
            
            // í† ì§€ ìˆ˜ìµë¥  ê³„ì‚° (ì§€ì—­ê³¼ í¬ì†Œì„±ì— ë”°ë¼)
            const baseReturn = (Math.random() * 0.60) - 0.10; // -10~50%
            const regionBonus = (selectedRegion.priceMultiplier - 1) * 0.1; // ì§€ì—­ ë³´ë„ˆìŠ¤
            const scarcityBonus = occupancyRate * 0.2; // í¬ì†Œì„± ë³´ë„ˆìŠ¤
            const totalReturn = baseReturn + regionBonus + scarcityBonus;
            
            const landInvestment = {
                type: 'realestate',
                subType: 'land',
                name: `ğŸï¸ ${selectedRegion.name} í† ì§€`,
                region: selectedRegion.name,
                size: currentLandSize,
                amount: Math.floor(totalPrice),
                returnRate: totalReturn,
                dividends: totalReturn > 0.1 ? Math.floor(totalPrice * 0.01) : 0,
                riskFactor: 2.0,
                originalReturnRate: totalReturn,
                landData: {
                    region: selectedRegion.name,
                    size: currentLandSize,
                    purchasePrice: Math.floor(totalPrice)
                }
            };
            
            // íˆ¬ì ID ì¶”ê°€
            landInvestment.investmentId = Date.now() + Math.random();
            
            gameState.roleData.investments.push(landInvestment);
            
            updateInvestmentDisplay();
            updateDisplay();
            closeLandDetailModal();
            
            const resultMessage = totalReturn < 0 ? 
                `${selectedRegion.name} í† ì§€ íˆ¬ìê°€ ì†ì‹¤ì„ ë³´ê³  ìˆìŠµë‹ˆë‹¤. (${(totalReturn * 100).toFixed(1)}%)` :
                `${selectedRegion.name} í† ì§€ ${currentLandSize}í‰ì„ ì„±ê³µì ìœ¼ë¡œ êµ¬ë§¤í–ˆìŠµë‹ˆë‹¤! (ìˆ˜ìµë¥ : ${(totalReturn * 100).toFixed(1)}%)`;
            
            showNotification(resultMessage, totalReturn < 0 ? 'warning' : 'success');
            
            // í† ì§€ ì‹œì¥ í˜„í™© ì—…ë°ì´íŠ¸
            updateLandMarketDisplay();
        }

        // AI í† ì§€ êµ¬ë§¤ ì‹œë®¬ë ˆì´ì…˜ (ë‹¤ë¥¸ íˆ¬ììë“¤ì˜ í† ì§€ êµ¬ë§¤)
        function simulateLandMarket() {
            // ì‹ ê·œ í† ì§€ êµ¬ë§¤
            gameState.landMarket.regions.forEach(region => {
                if (region.available > 0 && Math.random() < 0.02) { // 2% í™•ë¥ ë¡œ AIê°€ êµ¬ë§¤
                    const aiPurchaseSize = Math.min(
                        Math.floor(Math.random() * 2000) + 1000, // 1000~3000í‰
                        region.available
                    );
                    region.available -= aiPurchaseSize;
                    
                    if (Math.random() < 0.1) { // 10% í™•ë¥ ë¡œ ì•Œë¦¼
                        showNotification(`ë‹¤ë¥¸ íˆ¬ììê°€ ${region.name}ì—ì„œ ${aiPurchaseSize}í‰ì„ êµ¬ë§¤í–ˆìŠµë‹ˆë‹¤`, 'info');
                    }
                }
            });
            
            // AIê°€ ë§¤ë§¤ ì‹œì¥ì— í† ì§€ ì˜¬ë¦¬ê¸°
            if (Math.random() < 0.05) { // 5% í™•ë¥ 
                generateAILandSale();
            }
            
            // AIê°€ ë§¤ë§¤ ì‹œì¥ì—ì„œ í† ì§€ êµ¬ë§¤í•˜ê¸°
            if (gameState.landMarket.marketplace.length > 0 && Math.random() < 0.03) { // 3% í™•ë¥ 
                const randomLand = gameState.landMarket.marketplace[Math.floor(Math.random() * gameState.landMarket.marketplace.length)];
                if (randomLand && !randomLand.isPlayerOwned) {
                    purchaseLandFromMarketplace(randomLand, true);
                }
            }
        }

        // í† ì§€ ë§¤ë§¤ ì‹œì¥ í•¨ìˆ˜ë“¤
        let selectedLandForSale = null;

        function openLandMarketplace() {
            updateMarketplace();
            document.getElementById('landMarketplaceModal').style.display = 'flex';
            showMarketplaceBuy();
        }

        function closeLandMarketplace() {
            document.getElementById('landMarketplaceModal').style.display = 'none';
        }

        function showMarketplaceBuy() {
            document.getElementById('marketplaceBuyBtn').className = 'btn';
            document.getElementById('marketplaceSellBtn').className = 'btn btn-secondary';
            document.getElementById('marketplaceBuySection').style.display = 'block';
            document.getElementById('marketplaceSellSection').style.display = 'none';
            updateMarketplaceBuyList();
        }

        function showMarketplaceSell() {
            document.getElementById('marketplaceBuyBtn').className = 'btn btn-secondary';
            document.getElementById('marketplaceSellBtn').className = 'btn';
            document.getElementById('marketplaceBuySection').style.display = 'none';
            document.getElementById('marketplaceSellSection').style.display = 'block';
            updateMarketplaceSellList();
        }

        function updateMarketplace() {
            updateMarketplaceBuyList();
            updateMarketplaceSellList();
        }

        function updateMarketplaceBuyList() {
            const buyListDiv = document.getElementById('landForSaleList');
            buyListDiv.innerHTML = '';

            if (gameState.landMarket.marketplace.length === 0) {
                buyListDiv.innerHTML = '<p style="text-align: center; color: #64748b; padding: 20px;">ë§¤ë§¤ ì‹œì¥ì— ì˜¬ë¼ì˜¨ í† ì§€ê°€ ì—†ìŠµë‹ˆë‹¤</p>';
                return;
            }

            gameState.landMarket.marketplace.forEach((land, index) => {
                const landCard = document.createElement('div');
                landCard.className = 'business-card';
                landCard.style.marginBottom = '15px';
                
                const profitMargin = ((land.salePrice - land.originalPrice) / land.originalPrice * 100).toFixed(1);
                const profitColor = profitMargin >= 0 ? 'var(--success)' : 'var(--danger)';
                const sellerType = land.isPlayerOwned ? '(ë‚˜)' : '(ë‹¤ë¥¸ íˆ¬ìì)';
                const canBuy = !land.isPlayerOwned && gameState.currentUser.game_balance >= land.salePrice;
                
                landCard.innerHTML = `
                    <div class="business-header">
                        <div class="business-name">${land.name} ${land.size.toLocaleString()}í‰</div>
                        <div style="color: var(--warning);">${land.salePrice.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§</div>
                    </div>
                    <div style="font-size: 0.9rem; color: #94a3b8; margin: 10px 0;">
                        <div>â€¢ ì§€ì—­: ${land.region} | í‰ë‹¹: ${Math.floor(land.salePrice / land.size).toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§</div>
                        <div>â€¢ íŒë§¤ì: ${land.sellerName} ${sellerType}</div>
                        <div>â€¢ êµ¬ë§¤ê°€ ëŒ€ë¹„: <span style="color: ${profitColor};">${profitMargin >= 0 ? '+' : ''}${profitMargin}%</span></div>
                        <div>â€¢ ìˆ˜ìµë¥ : ${(land.currentReturn * 100).toFixed(1)}%</div>
                    </div>
                    ${land.isPlayerOwned ? 
                        '<div style="text-align: center; color: #64748b;">ë‚´ê°€ íŒë§¤ì¤‘ì¸ í† ì§€</div>' :
                        `<button class="btn ${canBuy ? '' : 'btn-secondary'}" 
                                onclick="purchaseLandFromMarketplace(gameState.landMarket.marketplace[${index}])"
                                ${canBuy ? '' : 'disabled'}>
                            ${canBuy ? 'êµ¬ë§¤í•˜ê¸°' : 'ìê¸ˆ ë¶€ì¡±'}
                        </button>`
                    }
                `;
                
                buyListDiv.appendChild(landCard);
            });
        }

        function updateMarketplaceSellList() {
            const sellListDiv = document.getElementById('myLandList');
            sellListDiv.innerHTML = '';

            const myLands = gameState.roleData.investments.filter(inv => 
                inv.type === 'realestate' && inv.subType === 'land'
            );

            if (myLands.length === 0) {
                sellListDiv.innerHTML = '<p style="text-align: center; color: #64748b; padding: 20px;">ë³´ìœ í•œ í† ì§€ê°€ ì—†ìŠµë‹ˆë‹¤</p>';
                return;
            }

            myLands.forEach((land, index) => {
                const isOnSale = gameState.landMarket.marketplace.some(m => m.originalInvestmentId === land.investmentId);
                const currentMarketPrice = calculateCurrentLandValue(land);
                const profitLoss = ((currentMarketPrice - land.amount) / land.amount * 100).toFixed(1);
                const profitColor = profitLoss >= 0 ? 'var(--success)' : 'var(--danger)';
                
                const landCard = document.createElement('div');
                landCard.className = 'business-card';
                landCard.style.marginBottom = '15px';
                
                landCard.innerHTML = `
                    <div class="business-header">
                        <div class="business-name">${land.name} ${land.landData.size.toLocaleString()}í‰</div>
                        <div style="color: ${profitColor};">${profitLoss >= 0 ? '+' : ''}${profitLoss}%</div>
                    </div>
                    <div style="font-size: 0.9rem; color: #94a3b8; margin: 10px 0;">
                        <div>â€¢ êµ¬ë§¤ê°€: ${land.amount.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§</div>
                        <div>â€¢ í˜„ì¬ê°€: ${currentMarketPrice.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§</div>
                        <div>â€¢ ìˆ˜ìµë¥ : ${(land.returnRate * 100).toFixed(1)}%</div>
                        <div>â€¢ ì›”ìˆ˜ìµ: ${land.dividends.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§</div>
                    </div>
                    <button class="btn ${isOnSale ? 'btn-secondary' : ''}" 
                            onclick="${isOnSale ? 'removeLandFromMarketplace' : 'openLandSaleModal'}(${index})"
                            ${isOnSale ? '' : ''}>
                        ${isOnSale ? 'íŒë§¤ ì·¨ì†Œ' : 'ë§¤ë„í•˜ê¸°'}
                    </button>
                `;
                
                sellListDiv.appendChild(landCard);
            });
        }

        function calculateCurrentLandValue(land) {
            const region = gameState.landMarket.regions.find(r => r.name === land.landData.region);
            if (!region) return land.amount;
            
            const occupancyRate = (region.total - region.available) / region.total;
            const scarcityMultiplier = 1 + Math.pow(occupancyRate, 2) * 10; // ë¬´ì œí•œ í¬ì†Œì„±
            const basePrice = gameState.landMarket.landPricePerUnit * land.landData.size;
            
            return Math.floor(basePrice * region.priceMultiplier * scarcityMultiplier);
        }

        function openLandSaleModal(landIndex) {
            const land = gameState.roleData.investments.filter(inv => 
                inv.type === 'realestate' && inv.subType === 'land'
            )[landIndex];
            
            selectedLandForSale = { ...land, investmentIndex: landIndex };
            
            const currentMarketPrice = calculateCurrentLandValue(land);
            
            document.getElementById('salePriceSlider').value = 100;
            updateSalePrice();
            
            document.getElementById('saleItemInfo').innerHTML = `
                <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                    <span>í† ì§€:</span>
                    <span style="font-weight: bold;">${land.name}</span>
                </div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                    <span>í‰ìˆ˜:</span>
                    <span>${land.landData.size.toLocaleString()}í‰</span>
                </div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                    <span>ì§€ì—­:</span>
                    <span>${land.landData.region}</span>
                </div>
                <div style="display: flex; justify-content: space-between;">
                    <span>ë³´ìœ ê¸°ê°„:</span>
                    <span>êµ¬ë§¤ í›„ ê³„ì†</span>
                </div>
            `;
            
            document.getElementById('originalPurchasePrice').textContent = `${land.amount.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§`;
            document.getElementById('currentMarketPrice').textContent = `${currentMarketPrice.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§`;
            
            document.getElementById('landSaleModal').style.display = 'flex';
        }

        function closeLandSaleModal() {
            document.getElementById('landSaleModal').style.display = 'none';
            selectedLandForSale = null;
        }

        function updateSalePrice() {
            if (!selectedLandForSale) return;
            
            const pricePercent = parseInt(document.getElementById('salePriceSlider').value);
            const currentMarketPrice = calculateCurrentLandValue(selectedLandForSale);
            const salePrice = Math.floor(currentMarketPrice * (pricePercent / 100));
            const profit = salePrice - selectedLandForSale.amount;
            
            document.getElementById('salePricePercent').textContent = `${pricePercent}% ${
                pricePercent < 50 ? '(í­íƒ„ì„¸ì¼)' : 
                pricePercent < 80 ? '(ê¸‰ë§¤)' : 
                pricePercent <= 120 ? '(ì ì •ê°€)' :
                pricePercent <= 300 ? '(í”„ë¦¬ë¯¸ì—„)' :
                pricePercent <= 500 ? '(ê³ ê°€)' : '(íˆ¬ê¸°ê°€ê²©)'
            }`;
            document.getElementById('finalSalePrice').textContent = `${salePrice.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§`;
            document.getElementById('expectedProfit').textContent = `${profit >= 0 ? '+' : ''}${profit.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§`;
            document.getElementById('expectedProfit').style.color = profit >= 0 ? 'var(--success)' : 'var(--danger)';
        }

        function confirmLandSale() {
            if (!selectedLandForSale) return;
            
            const pricePercent = parseInt(document.getElementById('salePriceSlider').value);
            const currentMarketPrice = calculateCurrentLandValue(selectedLandForSale);
            const salePrice = Math.floor(currentMarketPrice * (pricePercent / 100));
            
            // ì‹œì¥ì— í† ì§€ ë“±ë¡
            const marketListing = {
                id: Date.now(),
                name: selectedLandForSale.name,
                region: selectedLandForSale.landData.region,
                size: selectedLandForSale.landData.size,
                originalPrice: selectedLandForSale.amount,
                salePrice: salePrice,
                currentReturn: selectedLandForSale.returnRate,
                sellerName: gameState.currentUser.username || 'ìµëª…',
                isPlayerOwned: true,
                originalInvestmentId: selectedLandForSale.investmentId || Date.now(),
                landData: selectedLandForSale.landData
            };
            
            gameState.landMarket.marketplace.push(marketListing);
            
            closeLandSaleModal();
            updateMarketplace();
            showNotification(`${selectedLandForSale.name} ${selectedLandForSale.landData.size}í‰ì„ ${salePrice.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§ì— ë§¤ë„ ë“±ë¡í–ˆìŠµë‹ˆë‹¤`, 'success');
        }

        function purchaseLandFromMarketplace(land, isAI = false) {
            if (!isAI && gameState.currentUser.game_balance < land.salePrice) {
                showNotification('í† ì§€ êµ¬ë§¤ ìê¸ˆì´ ë¶€ì¡±í•©ë‹ˆë‹¤', 'error');
                return;
            }
            
            if (!isAI && land.isPlayerOwned) {
                showNotification('ë³¸ì¸ì´ íŒë§¤ì¤‘ì¸ í† ì§€ëŠ” êµ¬ë§¤í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤', 'error');
                return;
            }
            
            if (!isAI) {
                // í”Œë ˆì´ì–´ê°€ êµ¬ë§¤í•˜ëŠ” ê²½ìš°
                gameState.currentUser.game_balance -= land.salePrice;
                
                // íˆ¬ì í¬íŠ¸í´ë¦¬ì˜¤ì— ì¶”ê°€
                const newLandInvestment = {
                    type: 'realestate',
                    subType: 'land',
                    name: land.name,
                    region: land.region,
                    size: land.size,
                    amount: land.salePrice,
                    returnRate: land.currentReturn,
                    dividends: land.currentReturn > 0.1 ? Math.floor(land.salePrice * 0.01) : 0,
                    riskFactor: 2.0,
                    originalReturnRate: land.currentReturn,
                    landData: land.landData,
                    investmentId: Date.now()
                };
                
                gameState.roleData.investments.push(newLandInvestment);
                updateInvestmentDisplay();
                updateDisplay();
                
                showNotification(`${land.name} ${land.size}í‰ì„ ${land.salePrice.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§ì— êµ¬ë§¤í–ˆìŠµë‹ˆë‹¤!`, 'success');
            }
            
            // ì‹œì¥ì—ì„œ ì œê±°
            const marketIndex = gameState.landMarket.marketplace.findIndex(m => m.id === land.id);
            if (marketIndex !== -1) {
                gameState.landMarket.marketplace.splice(marketIndex, 1);
            }
            
            // íŒë§¤ìê°€ í”Œë ˆì´ì–´ì¸ ê²½ìš° ìˆ˜ìµê¸ˆ ì§€ê¸‰
            if (land.isPlayerOwned && !isAI) {
                gameState.currentUser.game_balance += land.salePrice;
                
                // íˆ¬ì í¬íŠ¸í´ë¦¬ì˜¤ì—ì„œ í•´ë‹¹ í† ì§€ ì œê±°
                const investmentIndex = gameState.roleData.investments.findIndex(inv => 
                    inv.investmentId === land.originalInvestmentId
                );
                if (investmentIndex !== -1) {
                    gameState.roleData.investments.splice(investmentIndex, 1);
                }
                
                const profit = land.salePrice - land.originalPrice;
                showNotification(`í† ì§€ ë§¤ë„ ì™„ë£Œ! ${profit >= 0 ? '+' : ''}${profit.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§ ${profit >= 0 ? 'ìˆ˜ìµ' : 'ì†ì‹¤'}`, profit >= 0 ? 'success' : 'warning');
                updateInvestmentDisplay();
                updateDisplay();
            }
            
            updateMarketplace();
        }

        function generateAILandSale() {
            const regions = gameState.landMarket.regions;
            const randomRegion = regions[Math.floor(Math.random() * regions.length)];
            const size = Math.floor(Math.random() * 15000) + 1000; // 1000~16000í‰ (ëŒ€í˜• í† ì§€ í¬í•¨)
            const occupancyRate = (randomRegion.total - randomRegion.available) / randomRegion.total;
            const scarcityMultiplier = 1 + Math.pow(occupancyRate, 2) * 10; // ë¬´ì œí•œ í¬ì†Œì„±
            const basePrice = gameState.landMarket.landPricePerUnit * size;
            const originalPrice = Math.floor(basePrice * randomRegion.priceMultiplier * (0.8 + Math.random() * 0.4));
            const currentPrice = Math.floor(basePrice * randomRegion.priceMultiplier * scarcityMultiplier);
            const salePrice = Math.floor(currentPrice * (0.3 + Math.random() * 4)); // 30~430% ê°€ê²© (íˆ¬ê¸°ì  ë³€ë™)
            
            const aiLand = {
                id: Date.now() + Math.random(),
                name: `ğŸï¸ ${randomRegion.name} í† ì§€`,
                region: randomRegion.name,
                size: size,
                originalPrice: originalPrice,
                salePrice: salePrice,
                currentReturn: (Math.random() * 0.6) - 0.1,
                sellerName: ['í† ì§€ì™•', 'ë¶€ë™ì‚°íˆ¬ìì', 'ê°œë°œì—…ì²´', 'AIíˆ¬ìì'][Math.floor(Math.random() * 4)],
                isPlayerOwned: false,
                landData: { region: randomRegion.name, size: size }
            };
            
            gameState.landMarket.marketplace.push(aiLand);
        }

        function removeLandFromMarketplace(landIndex) {
            const myLands = gameState.roleData.investments.filter(inv => 
                inv.type === 'realestate' && inv.subType === 'land'
            );
            const land = myLands[landIndex];
            
            if (!land) return;
            
            // ì‹œì¥ì—ì„œ í•´ë‹¹ í† ì§€ ì œê±°
            const marketIndex = gameState.landMarket.marketplace.findIndex(m => 
                m.originalInvestmentId === land.investmentId && m.isPlayerOwned
            );
            
            if (marketIndex !== -1) {
                gameState.landMarket.marketplace.splice(marketIndex, 1);
                updateMarketplace();
                showNotification(`${land.name} ë§¤ë„ë¥¼ ì·¨ì†Œí–ˆìŠµë‹ˆë‹¤`, 'info');
            }
        }

        // íˆ¬ì ì‹œì¥ ë³€ìˆ˜
        let selectedInvestment = null;

        // ì£¼ì‹ ì‹œì¥ í•¨ìˆ˜ë“¤
        function openStockMarket() {
            const stockCategories = {
                'tech': [
                    // í•œêµ­ IT/í…Œí¬ (25ê°œ)
                    { name: 'ì‚¼ì„±ì „ì', price: 68500, change: '+1.25%', trend: 'up', dividend: 2.8, sector: 'tech' },
                    { name: 'SKí•˜ì´ë‹‰ìŠ¤', price: 125000, change: '+2.15%', trend: 'up', dividend: 1.5, sector: 'tech' },
                    { name: 'NAVER', price: 185000, change: '-0.85%', trend: 'down', dividend: 0.8, sector: 'tech' },
                    { name: 'ì¹´ì¹´ì˜¤', price: 58500, change: '+3.45%', trend: 'up', dividend: 1.2, sector: 'tech' },
                    { name: 'LGì „ì', price: 95000, change: '+1.85%', trend: 'up', dividend: 3.2, sector: 'tech' },
                    { name: 'LGë””ìŠ¤í”Œë ˆì´', price: 15200, change: '+4.25%', trend: 'up', dividend: 2.1, sector: 'tech' },
                    { name: 'ì‚¼ì„±SDI', price: 485000, change: '+2.85%', trend: 'up', dividend: 1.8, sector: 'tech' },
                    { name: 'SKí…”ë ˆì½¤', price: 52500, change: '+0.95%', trend: 'up', dividend: 4.5, sector: 'tech' },
                    { name: 'KT', price: 28500, change: '+1.15%', trend: 'up', dividend: 5.2, sector: 'tech' },
                    { name: 'LGìœ í”ŒëŸ¬ìŠ¤', price: 12800, change: '+0.75%', trend: 'up', dividend: 6.8, sector: 'tech' },
                    { name: 'ë„¤ì˜¤ìœ„ì¦ˆ', price: 18500, change: '+8.25%', trend: 'up', dividend: 1.5, sector: 'tech' },
                    { name: 'NHN', price: 35500, change: '+5.15%', trend: 'up', dividend: 2.8, sector: 'tech' },
                    { name: 'ë„¥ìŠ¨', price: 68500, change: '+3.85%', trend: 'up', dividend: 2.2, sector: 'tech' },
                    { name: 'NCì†Œí”„íŠ¸', price: 485000, change: '+4.25%', trend: 'up', dividend: 1.8, sector: 'tech' },
                    { name: 'í„ì–´ë¹„ìŠ¤', price: 42500, change: '+6.85%', trend: 'up', dividend: 1.2, sector: 'tech' },
                    { name: 'í¬ë˜í”„í†¤', price: 185000, change: '+2.45%', trend: 'up', dividend: 1.5, sector: 'tech' },
                    { name: 'ì»´íˆ¬ìŠ¤', price: 68500, change: '+7.25%', trend: 'up', dividend: 2.1, sector: 'tech' },
                    { name: 'ìœ„ë©”ì´ë“œ', price: 42500, change: '+9.85%', trend: 'up', dividend: 1.8, sector: 'tech' },
                    { name: 'ì—”ì”¨ì†Œí”„íŠ¸', price: 285000, change: '+3.15%', trend: 'up', dividend: 2.5, sector: 'tech' },
                    { name: 'SKìŠ¤í€˜ì–´', price: 48500, change: '+2.85%', trend: 'up', dividend: 2.8, sector: 'tech' },
                    { name: 'ì¿ íŒ¡', price: 16500, change: '+4.25%', trend: 'up', dividend: 0.0, sector: 'tech' },
                    { name: 'ë°°ë‹¬ì˜ë¯¼ì¡±', price: 125000, change: '+3.45%', trend: 'up', dividend: 1.2, sector: 'tech' },
                    { name: 'í† ìŠ¤', price: 68500, change: '+5.85%', trend: 'up', dividend: 0.8, sector: 'tech' },
                    { name: 'ë‹¹ê·¼ë§ˆì¼“', price: 45000, change: '+6.25%', trend: 'up', dividend: 0.0, sector: 'tech' },
                    { name: 'ì•¼ë†€ì', price: 28500, change: '+4.15%', trend: 'up', dividend: 1.5, sector: 'tech' },
                    
                    // ê¸€ë¡œë²Œ IT/í…Œí¬ (25ê°œ)
                    { name: 'Apple', price: 175.25, change: '+1.85%', trend: 'up', dividend: 0.5, sector: 'tech' },
                    { name: 'Microsoft', price: 425.80, change: '+2.15%', trend: 'up', dividend: 0.7, sector: 'tech' },
                    { name: 'Google', price: 142.50, change: '+1.65%', trend: 'up', dividend: 0.0, sector: 'tech' },
                    { name: 'Amazon', price: 155.40, change: '+2.85%', trend: 'up', dividend: 0.0, sector: 'tech' },
                    { name: 'Tesla', price: 248.50, change: '+4.25%', trend: 'up', dividend: 0.0, sector: 'tech' },
                    { name: 'NVIDIA', price: 485.75, change: '+6.85%', trend: 'up', dividend: 0.4, sector: 'tech' },
                    { name: 'Meta', price: 325.60, change: '+3.45%', trend: 'up', dividend: 0.0, sector: 'tech' },
                    { name: 'Netflix', price: 485.20, change: '+2.25%', trend: 'up', dividend: 0.0, sector: 'tech' },
                    { name: 'Adobe', price: 625.80, change: '+1.95%', trend: 'up', dividend: 0.0, sector: 'tech' },
                    { name: 'Salesforce', price: 285.40, change: '+2.65%', trend: 'up', dividend: 0.0, sector: 'tech' },
                    { name: 'Oracle', price: 125.60, change: '+1.45%', trend: 'up', dividend: 1.8, sector: 'tech' },
                    { name: 'Intel', price: 48.25, change: '+2.85%', trend: 'up', dividend: 2.5, sector: 'tech' },
                    { name: 'AMD', price: 125.80, change: '+4.15%', trend: 'up', dividend: 0.0, sector: 'tech' },
                    { name: 'Qualcomm', price: 148.50, change: '+3.25%', trend: 'up', dividend: 2.1, sector: 'tech' },
                    { name: 'Broadcom', price: 985.40, change: '+2.45%', trend: 'up', dividend: 1.9, sector: 'tech' },
                    { name: 'IBM', price: 185.20, change: '+1.85%', trend: 'up', dividend: 3.8, sector: 'tech' },
                    { name: 'Cisco', price: 52.80, change: '+1.65%', trend: 'up', dividend: 2.9, sector: 'tech' },
                    { name: 'ServiceNow', price: 745.60, change: '+3.85%', trend: 'up', dividend: 0.0, sector: 'tech' },
                    { name: 'Snowflake', price: 185.40, change: '+5.25%', trend: 'up', dividend: 0.0, sector: 'tech' },
                    { name: 'Palantir', price: 18.25, change: '+8.45%', trend: 'up', dividend: 0.0, sector: 'tech' },
                    { name: 'CrowdStrike', price: 285.60, change: '+6.85%', trend: 'up', dividend: 0.0, sector: 'tech' },
                    { name: 'Zoom', price: 68.25, change: '+4.15%', trend: 'up', dividend: 0.0, sector: 'tech' },
                    { name: 'Slack', price: 28.50, change: '+3.85%', trend: 'up', dividend: 0.0, sector: 'tech' },
                    { name: 'Shopify', price: 85.40, change: '+5.65%', trend: 'up', dividend: 0.0, sector: 'tech' },
                    { name: 'Unity', price: 42.80, change: '+7.25%', trend: 'up', dividend: 0.0, sector: 'tech' }
                ],
                
                'finance': [
                    // í•œêµ­ ê¸ˆìœµ (25ê°œ)
                    { name: 'KBê¸ˆìœµ', price: 58500, change: '+1.85%', trend: 'up', dividend: 4.5, sector: 'finance' },
                    { name: 'ì‹ í•œê¸ˆìœµì§€ì£¼', price: 42500, change: '+2.15%', trend: 'up', dividend: 4.8, sector: 'finance' },
                    { name: 'í•˜ë‚˜ê¸ˆìœµì§€ì£¼', price: 48500, change: '+1.65%', trend: 'up', dividend: 4.2, sector: 'finance' },
                    { name: 'ìš°ë¦¬ê¸ˆìœµì§€ì£¼', price: 15200, change: '+2.85%', trend: 'up', dividend: 5.2, sector: 'finance' },
                    { name: 'NHíˆ¬ìì¦ê¶Œ', price: 12800, change: '+3.45%', trend: 'up', dividend: 3.8, sector: 'finance' },
                    { name: 'ë¯¸ë˜ì—ì…‹ì¦ê¶Œ', price: 8500, change: '+4.25%', trend: 'up', dividend: 4.1, sector: 'finance' },
                    { name: 'ì‚¼ì„±ì¦ê¶Œ', price: 42500, change: '+2.45%', trend: 'up', dividend: 3.5, sector: 'finance' },
                    { name: 'í•œêµ­íˆ¬ìì¦ê¶Œ', price: 3850, change: '+3.85%', trend: 'up', dividend: 4.8, sector: 'finance' },
                    { name: 'DBê¸ˆìœµíˆ¬ì', price: 3250, change: '+2.65%', trend: 'up', dividend: 4.5, sector: 'finance' },
                    { name: 'í‚¤ì›€ì¦ê¶Œ', price: 125000, change: '+1.95%', trend: 'up', dividend: 2.8, sector: 'finance' },
                    { name: 'êµë³´ì¦ê¶Œ', price: 8500, change: '+2.25%', trend: 'up', dividend: 4.2, sector: 'finance' },
                    { name: 'ì‹ ì˜ì¦ê¶Œ', price: 5850, change: '+3.15%', trend: 'up', dividend: 5.1, sector: 'finance' },
                    { name: 'ìœ ì•ˆíƒ€ì¦ê¶Œ', price: 3250, change: '+2.85%', trend: 'up', dividend: 4.8, sector: 'finance' },
                    { name: 'IBKíˆ¬ìì¦ê¶Œ', price: 2850, change: '+4.15%', trend: 'up', dividend: 5.5, sector: 'finance' },
                    { name: 'í•˜ì´íˆ¬ìì¦ê¶Œ', price: 2450, change: '+3.65%', trend: 'up', dividend: 5.8, sector: 'finance' },
                    { name: 'ì‚¼ì„±ìƒëª…', price: 85000, change: '+1.45%', trend: 'up', dividend: 3.2, sector: 'finance' },
                    { name: 'í•œí™”ìƒëª…', price: 2850, change: '+2.85%', trend: 'up', dividend: 6.5, sector: 'finance' },
                    { name: 'êµë³´ìƒëª…', price: 8500, change: '+1.95%', trend: 'up', dividend: 4.8, sector: 'finance' },
                    { name: 'DBìƒëª…', price: 85000, change: '+2.15%', trend: 'up', dividend: 3.8, sector: 'finance' },
                    { name: 'ë™ì–‘ìƒëª…', price: 8500, change: '+3.45%', trend: 'up', dividend: 5.2, sector: 'finance' },
                    { name: 'ì‚¼ì„±í™”ì¬', price: 285000, change: '+1.85%', trend: 'up', dividend: 2.5, sector: 'finance' },
                    { name: 'DBì†í•´ë³´í—˜', price: 48500, change: '+2.65%', trend: 'up', dividend: 4.2, sector: 'finance' },
                    { name: 'í•œí™”ì†í•´ë³´í—˜', price: 2850, change: '+3.85%', trend: 'up', dividend: 6.8, sector: 'finance' },
                    { name: 'KBì†í•´ë³´í—˜', price: 58500, change: '+2.25%', trend: 'up', dividend: 3.5, sector: 'finance' },
                    { name: 'í˜„ëŒ€í•´ìƒ', price: 28500, change: '+2.45%', trend: 'up', dividend: 4.5, sector: 'finance' },
                    
                    // ê¸€ë¡œë²Œ ê¸ˆìœµ (25ê°œ)
                    { name: 'JPMorgan Chase', price: 185.40, change: '+1.85%', trend: 'up', dividend: 2.8, sector: 'finance' },
                    { name: 'Bank of America', price: 35.80, change: '+2.15%', trend: 'up', dividend: 3.2, sector: 'finance' },
                    { name: 'Wells Fargo', price: 48.25, change: '+2.65%', trend: 'up', dividend: 2.9, sector: 'finance' },
                    { name: 'Citigroup', price: 52.60, change: '+3.15%', trend: 'up', dividend: 3.8, sector: 'finance' },
                    { name: 'Goldman Sachs', price: 425.80, change: '+1.95%', trend: 'up', dividend: 2.1, sector: 'finance' },
                    { name: 'Morgan Stanley', price: 95.40, change: '+2.45%', trend: 'up', dividend: 2.5, sector: 'finance' },
                    { name: 'American Express', price: 185.60, change: '+1.75%', trend: 'up', dividend: 1.5, sector: 'finance' },
                    { name: 'Visa', price: 285.20, change: '+1.85%', trend: 'up', dividend: 0.8, sector: 'finance' },
                    { name: 'Mastercard', price: 425.80, change: '+2.25%', trend: 'up', dividend: 0.6, sector: 'finance' },
                    { name: 'PayPal', price: 68.50, change: '+3.45%', trend: 'up', dividend: 0.0, sector: 'finance' },
                    { name: 'Square', price: 85.40, change: '+4.85%', trend: 'up', dividend: 0.0, sector: 'finance' },
                    { name: 'Berkshire Hathaway', price: 485000, change: '+1.25%', trend: 'up', dividend: 0.0, sector: 'finance' },
                    { name: 'BlackRock', price: 825.60, change: '+1.65%', trend: 'up', dividend: 2.4, sector: 'finance' },
                    { name: 'Charles Schwab', price: 68.25, change: '+2.85%', trend: 'up', dividend: 1.8, sector: 'finance' },
                    { name: 'Credit Suisse', price: 2.85, change: '-4.25%', trend: 'down', dividend: 0.0, sector: 'finance' },
                    { name: 'Deutsche Bank', price: 12.50, change: '+2.15%', trend: 'up', dividend: 0.0, sector: 'finance' },
                    { name: 'Barclays', price: 1.85, change: '+1.95%', trend: 'up', dividend: 5.2, sector: 'finance' },
                    { name: 'HSBC', price: 6.45, change: '+2.65%', trend: 'up', dividend: 6.8, sector: 'finance' },
                    { name: 'UBS', price: 18.50, change: '+1.85%', trend: 'up', dividend: 3.5, sector: 'finance' },
                    { name: 'ING Group', price: 14.25, change: '+2.45%', trend: 'up', dividend: 4.2, sector: 'finance' },
                    { name: 'Santander', price: 3.85, change: '+3.15%', trend: 'up', dividend: 7.5, sector: 'finance' },
                    { name: 'BNP Paribas', price: 58.50, change: '+1.75%', trend: 'up', dividend: 3.8, sector: 'finance' },
                    { name: 'Societe Generale', price: 28.40, change: '+2.85%', trend: 'up', dividend: 4.5, sector: 'finance' },
                    { name: 'Lloyds Banking', price: 0.52, change: '+3.45%', trend: 'up', dividend: 4.8, sector: 'finance' },
                    { name: 'Royal Bank of Canada', price: 125.80, change: '+1.65%', trend: 'up', dividend: 3.5, sector: 'finance' }
                ],

                'energy': [
                    // í•œêµ­ ì—ë„ˆì§€ (25ê°œ)
                    { name: 'SKì´ë…¸ë² ì´ì…˜', price: 125000, change: '+2.85%', trend: 'up', dividend: 2.5, sector: 'energy' },
                    { name: 'LGí™”í•™', price: 485000, change: '+3.45%', trend: 'up', dividend: 1.8, sector: 'energy' },
                    { name: 'í•œí™”ì†”ë£¨ì…˜', price: 28500, change: '+4.15%', trend: 'up', dividend: 2.1, sector: 'energy' },
                    { name: 'S-Oil', price: 85000, change: '+3.85%', trend: 'up', dividend: 4.5, sector: 'energy' },
                    { name: 'GS', price: 42500, change: '+2.65%', trend: 'up', dividend: 3.8, sector: 'energy' },
                    { name: 'SKê°€ìŠ¤', price: 125000, change: '+1.95%', trend: 'up', dividend: 5.2, sector: 'energy' },
                    { name: 'í•œêµ­ê°€ìŠ¤ê³µì‚¬', price: 28500, change: '+2.45%', trend: 'up', dividend: 4.8, sector: 'energy' },
                    { name: 'í•œì „KPS', price: 28500, change: '+3.15%', trend: 'up', dividend: 3.5, sector: 'energy' },
                    { name: 'í•œêµ­ì „ë ¥', price: 20500, change: '+1.85%', trend: 'up', dividend: 0.0, sector: 'energy' },
                    { name: 'ë‚¨ë™ë°œì „', price: 28500, change: '+2.85%', trend: 'up', dividend: 4.2, sector: 'energy' },
                    { name: 'ë™ì„œë°œì „', price: 20500, change: '+3.45%', trend: 'up', dividend: 4.8, sector: 'energy' },
                    { name: 'ì„œë¶€ë°œì „', price: 28500, change: '+2.25%', trend: 'up', dividend: 4.5, sector: 'energy' },
                    { name: 'ì¤‘ë¶€ë°œì „', price: 20500, change: '+1.95%', trend: 'up', dividend: 5.1, sector: 'energy' },
                    { name: 'í•œìˆ˜ì›', price: 28500, change: '+2.65%', trend: 'up', dividend: 3.8, sector: 'energy' },
                    { name: 'í•œêµ­ì„ìœ ê³µì‚¬', price: 8500, change: '+4.15%', trend: 'up', dividend: 2.5, sector: 'energy' },
                    { name: 'SKì—ë„ˆì§€', price: 185000, change: '+3.85%', trend: 'up', dividend: 3.2, sector: 'energy' },
                    { name: 'GSì¹¼í…ìŠ¤', price: 485000, change: '+2.45%', trend: 'up', dividend: 2.8, sector: 'energy' },
                    { name: 'í˜„ëŒ€ì˜¤ì¼ë±…í¬', price: 8500, change: '+3.15%', trend: 'up', dividend: 4.5, sector: 'energy' },
                    { name: 'ëŒ€í•œìœ í™”', price: 185000, change: '+2.85%', trend: 'up', dividend: 3.8, sector: 'energy' },
                    { name: 'ë¡¯ë°ì¼€ë¯¸ì¹¼', price: 185000, change: '+1.95%', trend: 'up', dividend: 2.5, sector: 'energy' },
                    { name: 'ê¸ˆí˜¸ì„ìœ í™”í•™', price: 125000, change: '+3.45%', trend: 'up', dividend: 3.2, sector: 'energy' },
                    { name: 'í•œí™”ì¼€ë¯¸ì¹¼', price: 28500, change: '+2.65%', trend: 'up', dividend: 4.1, sector: 'energy' },
                    { name: 'íš¨ì„±', price: 85000, change: '+1.85%', trend: 'up', dividend: 2.8, sector: 'energy' },
                    { name: 'íƒœê´‘ì‚°ì—…', price: 485000, change: '+2.25%', trend: 'up', dividend: 1.5, sector: 'energy' },
                    { name: 'OCI', price: 85000, change: '+4.85%', trend: 'up', dividend: 2.2, sector: 'energy' },
                    
                    // ê¸€ë¡œë²Œ ì—ë„ˆì§€ (25ê°œ)
                    { name: 'Exxon Mobil', price: 125.40, change: '+2.85%', trend: 'up', dividend: 5.8, sector: 'energy' },
                    { name: 'Chevron', price: 185.60, change: '+3.15%', trend: 'up', dividend: 3.2, sector: 'energy' },
                    { name: 'Shell', price: 68.25, change: '+2.45%', trend: 'up', dividend: 6.5, sector: 'energy' },
                    { name: 'BP', price: 38.50, change: '+1.95%', trend: 'up', dividend: 4.8, sector: 'energy' },
                    { name: 'TotalEnergies', price: 68.40, change: '+2.65%', trend: 'up', dividend: 5.2, sector: 'energy' },
                    { name: 'ConocoPhillips', price: 125.80, change: '+3.45%', trend: 'up', dividend: 2.1, sector: 'energy' },
                    { name: 'Schlumberger', price: 58.25, change: '+4.15%', trend: 'up', dividend: 2.8, sector: 'energy' },
                    { name: 'Marathon Petroleum', price: 185.40, change: '+2.85%', trend: 'up', dividend: 2.5, sector: 'energy' },
                    { name: 'Valero Energy', price: 148.60, change: '+3.25%', trend: 'up', dividend: 3.8, sector: 'energy' },
                    { name: 'Phillips 66', price: 125.80, change: '+2.45%', trend: 'up', dividend: 4.2, sector: 'energy' },
                    { name: 'Kinder Morgan', price: 18.50, change: '+1.85%', trend: 'up', dividend: 6.8, sector: 'energy' },
                    { name: 'Enterprise Products', price: 28.40, change: '+2.15%', trend: 'up', dividend: 7.5, sector: 'energy' },
                    { name: 'Enbridge', price: 42.80, change: '+1.65%', trend: 'up', dividend: 6.2, sector: 'energy' },
                    { name: 'TC Energy', price: 48.25, change: '+2.85%', trend: 'up', dividend: 5.8, sector: 'energy' },
                    { name: 'NextEra Energy', price: 68.50, change: '+1.95%', trend: 'up', dividend: 2.8, sector: 'energy' },
                    { name: 'Duke Energy', price: 105.40, change: '+1.45%', trend: 'up', dividend: 3.5, sector: 'energy' },
                    { name: 'Southern Company', price: 68.25, change: '+1.85%', trend: 'up', dividend: 4.2, sector: 'energy' },
                    { name: 'Dominion Energy', price: 52.80, change: '+2.25%', trend: 'up', dividend: 4.8, sector: 'energy' },
                    { name: 'Exelon', price: 42.50, change: '+1.95%', trend: 'up', dividend: 3.2, sector: 'energy' },
                    { name: 'American Electric Power', price: 85.60, change: '+1.65%', trend: 'up', dividend: 3.8, sector: 'energy' },
                    { name: 'Sempra Energy', price: 148.25, change: '+2.45%', trend: 'up', dividend: 3.2, sector: 'energy' },
                    { name: 'Consolidated Edison', price: 95.40, change: '+1.25%', trend: 'up', dividend: 3.5, sector: 'energy' },
                    { name: 'Public Service Enterprise', price: 68.80, change: '+1.85%', trend: 'up', dividend: 2.8, sector: 'energy' },
                    { name: 'Xcel Energy', price: 62.50, change: '+1.45%', trend: 'up', dividend: 3.0, sector: 'energy' },
                    { name: 'Eversource Energy', price: 78.25, change: '+1.95%', trend: 'up', dividend: 4.2, sector: 'energy' }
                ]
            };

            const modalContent = `
                <h2 style="text-align: center; margin-bottom: 15px; color: var(--primary);">ğŸ“Š ì£¼ì‹ í˜„ë¬¼ ì‹œì¥ (150ì¢…)</h2>
                
                <div style="background: rgba(59, 130, 246, 0.1); border: 1px solid rgba(59, 130, 246, 0.3); border-radius: 8px; padding: 12px; margin-bottom: 15px;">
                    <div style="color: var(--primary); font-size: 0.9rem; line-height: 1.4; text-align: center;">
                        <strong>ğŸ“ˆ KOSPI:</strong> ${gameState.stockMarket?.kospi?.toLocaleString() || '2,450'} 
                        <span style="color: var(--success); margin-left: 10px;">+1.25%</span>
                    </div>
                </div>

                <!-- ì¹´í…Œê³ ë¦¬ íƒ­ -->
                <div style="display: flex; flex-wrap: wrap; gap: 5px; margin-bottom: 15px; justify-content: center;">
                    <button onclick="showStockCategory('all')" id="stockTab-all" style="
                        padding: 8px 12px; background: var(--primary); color: white;
                        border: none; border-radius: 20px; cursor: pointer; font-size: 0.8rem; font-weight: 600;
                    ">ì „ì²´ (150)</button>
                    <button onclick="showStockCategory('tech')" id="stockTab-tech" style="
                        padding: 8px 12px; background: rgba(71, 85, 105, 0.2); color: #94a3b8;
                        border: 1px solid rgba(71, 85, 105, 0.3); border-radius: 20px; cursor: pointer; font-size: 0.8rem;
                    ">IT/í…Œí¬ (50)</button>
                    <button onclick="showStockCategory('finance')" id="stockTab-finance" style="
                        padding: 8px 12px; background: rgba(71, 85, 105, 0.2); color: #94a3b8;
                        border: 1px solid rgba(71, 85, 105, 0.3); border-radius: 20px; cursor: pointer; font-size: 0.8rem;
                    ">ê¸ˆìœµ (50)</button>
                    <button onclick="showStockCategory('energy')" id="stockTab-energy" style="
                        padding: 8px 12px; background: rgba(71, 85, 105, 0.2); color: #94a3b8;
                        border: 1px solid rgba(71, 85, 105, 0.3); border-radius: 20px; cursor: pointer; font-size: 0.8rem;
                    ">ì—ë„ˆì§€ (50)</button>
                </div>

                <div id="stocksList" style="display: grid; gap: 8px; margin-bottom: 15px; max-height: 400px; overflow-y: auto;">
                    ${Object.entries(stockCategories).flatMap(([category, stocks]) => 
                        stocks.map(stock => `
                            <div class="stock-item" data-category="${category}" style="
                                background: rgba(71, 85, 105, 0.1); border: 1px solid rgba(71, 85, 105, 0.3);
                                border-radius: 8px; padding: 10px; cursor: pointer; transition: all 0.2s;
                            " onclick="openInvestmentDetail(${JSON.stringify(stock).replace(/"/g, '&quot;')}, 'stock')" 
                               onmouseover="this.style.background='rgba(99, 102, 241, 0.2)'" 
                               onmouseout="this.style.background='rgba(71, 85, 105, 0.1)'">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <div>
                                        <div style="color: #e2e8f0; font-weight: bold; font-size: 0.9rem; margin-bottom: 2px;">${stock.name}</div>
                                        <div style="color: #94a3b8; font-size: 0.8rem;">â‚©${stock.price.toLocaleString()} â€¢ ë°°ë‹¹ ${stock.dividend}%</div>
                                    </div>
                                    <div style="text-align: right;">
                                        <div style="color: ${stock.trend === 'up' ? 'var(--success)' : 'var(--danger)'}; font-weight: bold; font-size: 0.85rem;">
                                            ${stock.trend === 'up' ? 'ğŸ“ˆ' : 'ğŸ“‰'} ${stock.change}
                                        </div>
                                        <div style="color: #94a3b8; font-size: 0.7rem;">${stock.sector === 'tech' ? 'IT/í…Œí¬' : stock.sector === 'finance' ? 'ê¸ˆìœµ' : 'ì—ë„ˆì§€'}</div>
                                    </div>
                                </div>
                            </div>
                        `)
                    ).join('')}
                </div>

                <div style="text-align: center;">
                    <button onclick="closeModal()" style="
                        padding: 10px 25px; background: rgba(71, 85, 105, 0.2);
                        color: #e2e8f0; border: 1px solid rgba(71, 85, 105, 0.3);
                        border-radius: 8px; cursor: pointer; font-size: 0.9rem;
                    ">ë‹«ê¸°</button>
                </div>
                
            `;

            showModal(modalContent);
        }

        // ì£¼ì‹ ì¹´í…Œê³ ë¦¬ í•„í„°ë§
        function showStockCategory(category) {
            // íƒ­ ìŠ¤íƒ€ì¼ ì—…ë°ì´íŠ¸
            document.querySelectorAll('[id^="stockTab-"]').forEach(tab => {
                tab.style.background = 'rgba(71, 85, 105, 0.2)';
                tab.style.color = '#94a3b8';
                tab.style.border = '1px solid rgba(71, 85, 105, 0.3)';
            });
            
            const activeTab = document.getElementById(`stockTab-${category}`);
            if (activeTab) {
                activeTab.style.background = 'var(--primary)';
                activeTab.style.color = 'white';
                activeTab.style.border = 'none';
            }

            // ì£¼ì‹ í•„í„°ë§
            document.querySelectorAll('.stock-item').forEach(stock => {
                if (category === 'all' || stock.dataset.category === category) {
                    stock.style.display = 'block';
                } else {
                    stock.style.display = 'none';
                }
            });
        }

        function closeStockMarket() {
            document.getElementById('stockMarketModal').style.display = 'none';
        }

        function updateStockMarketModal() {
            // KOSPI ì •ë³´ ì—…ë°ì´íŠ¸
            document.getElementById('stockModalKospi').textContent = gameState.stockMarket.kospi.toLocaleString();
            const kospiChange = gameState.stockMarket.kospiChange || 0;
            document.getElementById('stockModalKospiChange').textContent = 
                `${kospiChange >= 0 ? '+' : ''}${kospiChange.toFixed(2)}%`;
            document.getElementById('stockModalKospiChange').style.color = 
                kospiChange >= 0 ? 'var(--success)' : 'var(--danger)';

            // ì£¼ì‹ ëª©ë¡ ìƒì„±
            const stocksDiv = document.getElementById('stocksList');
            stocksDiv.innerHTML = '';

            gameState.stockMarket.stocks.forEach(stock => {
                const stockCard = document.createElement('div');
                stockCard.className = 'business-card';
                stockCard.style.cursor = 'pointer';
                stockCard.style.marginBottom = '10px';
                
                const changeColor = stock.change >= 0 ? 'var(--success)' : 'var(--danger)';
                const changeSign = stock.change >= 0 ? '+' : '';
                
                stockCard.innerHTML = `
                    <div class="business-header">
                        <div class="business-name">${stock.name}</div>
                        <div style="color: ${changeColor};">${changeSign}${stock.change.toFixed(2)}%</div>
                    </div>
                    <div style="font-size: 0.9rem; color: #94a3b8; margin: 8px 0;">
                        <div>â€¢ ì£¼ê°€: ${stock.price.toLocaleString()}ì›</div>
                        <div>â€¢ ë°°ë‹¹ë¥ : ${stock.dividend}%</div>
                        <div>â€¢ ì„¹í„°: ${getSectorName(stock.sector)}</div>
                        <div style="font-size: 0.8rem; color: #64748b;">â€¢ ${stock.description}</div>
                    </div>
                `;
                
                stockCard.onclick = () => openInvestmentDetail(stock, 'stock');
                stocksDiv.appendChild(stockCard);
            });
        }

        // ì•”í˜¸í™”í ì‹œì¥ í•¨ìˆ˜ë“¤
        function openCryptoMarket() {
            updateCryptoMarketModal();
            document.getElementById('cryptoMarketModal').style.display = 'flex';
        }

        function closeCryptoMarket() {
            document.getElementById('cryptoMarketModal').style.display = 'none';
        }

        function updateCryptoMarketModal() {
            // ì´ ì‹œì¥ê°€ì¹˜ ê³„ì‚°
            const totalMarketCap = gameState.stockMarket.cryptos.reduce((sum, crypto) => sum + crypto.marketCap, 0);
            document.getElementById('cryptoMarketCap').textContent = `â‚©${Math.floor(totalMarketCap / 1000000000000)}ì¡°`;

            // ì•”í˜¸í™”í ëª©ë¡ ìƒì„±
            const cryptosDiv = document.getElementById('cryptosList');
            cryptosDiv.innerHTML = '';

            gameState.stockMarket.cryptos.forEach(crypto => {
                const cryptoCard = document.createElement('div');
                cryptoCard.className = 'business-card';
                cryptoCard.style.cursor = 'pointer';
                cryptoCard.style.marginBottom = '10px';
                
                const changeColor = crypto.change >= 0 ? 'var(--success)' : 'var(--danger)';
                const changeSign = crypto.change >= 0 ? '+' : '';
                
                cryptoCard.innerHTML = `
                    <div class="business-header">
                        <div class="business-name">${crypto.name} (${crypto.symbol})</div>
                        <div style="color: ${changeColor};">${changeSign}${crypto.change.toFixed(2)}%</div>
                    </div>
                    <div style="font-size: 0.9rem; color: #94a3b8; margin: 8px 0;">
                        <div>â€¢ ê°€ê²©: â‚©${crypto.price.toLocaleString()}</div>
                        <div>â€¢ ì‹œê°€ì´ì•¡: â‚©${Math.floor(crypto.marketCap / 1000000000)}ì–µ</div>
                        <div style="font-size: 0.8rem; color: #64748b;">â€¢ ${crypto.description}</div>
                    </div>
                `;
                
                cryptoCard.onclick = () => openInvestmentDetail(crypto, 'crypto');
                cryptosDiv.appendChild(cryptoCard);
            });
        }

        // íˆ¬ì ìƒì„¸ ì •ë³´ ëª¨ë‹¬
        function openInvestmentDetail(investment, type) {
            selectedInvestment = { ...investment, type: type };
            
            document.getElementById('investmentDetailTitle').textContent = 
                `${investment.name} íˆ¬ì`;
            
            let detailInfo = '';
            if (type === 'stock') {
                detailInfo = `
                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                        <span>ì¢…ëª©ëª…:</span>
                        <span style="font-weight: bold;">${investment.name}</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                        <span>í˜„ì¬ ì£¼ê°€:</span>
                        <span>${investment.price.toLocaleString()}ì›</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                        <span>ë°°ë‹¹ë¥ :</span>
                        <span>${investment.dividend}%</span>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <span>ì„¹í„°:</span>
                        <span>${getSectorName(investment.sector)}</span>
                    </div>
                `;
            } else {
                detailInfo = `
                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                        <span>ì•”í˜¸í™”í:</span>
                        <span style="font-weight: bold;">${investment.name} (${investment.symbol})</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                        <span>í˜„ì¬ ê°€ê²©:</span>
                        <span>â‚©${investment.price.toLocaleString()}</span>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <span>ì‹œê°€ì´ì•¡:</span>
                        <span>â‚©${Math.floor(investment.marketCap / 1000000000)}ì–µ</span>
                    </div>
                `;
            }
            
            document.getElementById('investmentDetailInfo').innerHTML = detailInfo;
            document.getElementById('investmentAmountSlider').value = 1000000;
            updateInvestmentAmount();
            
            document.getElementById('investmentDetailModal').style.display = 'flex';
        }

        function closeInvestmentDetail() {
            document.getElementById('investmentDetailModal').style.display = 'none';
            selectedInvestment = null;
        }

        function updateInvestmentAmount() {
            if (!selectedInvestment) return;
            
            const amount = parseInt(document.getElementById('investmentAmountSlider').value);
            document.getElementById('selectedInvestmentAmount').textContent = `${Math.floor(amount / 10000)}ë§Œ ë¹„íŠ¸í¬ë ˆë”§`;
            document.getElementById('finalInvestmentAmount').textContent = `${amount.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§`;
            
            let monthlyReturn, annualReturn;
            
            if (selectedInvestment.type === 'stock') {
                monthlyReturn = Math.floor(amount * selectedInvestment.dividend / 100 / 12);
                annualReturn = selectedInvestment.dividend + (Math.random() * 15 - 5); // Â±5% ë³€ë™ì„±
            } else {
                monthlyReturn = 0; // ì•”í˜¸í™”íëŠ” ë°°ë‹¹ ì—†ìŒ
                annualReturn = Math.random() * 80 - 30; // -30~50% ê³ ë³€ë™ì„±
            }
            
            document.getElementById('expectedMonthlyReturn').textContent = `${monthlyReturn.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§`;
            document.getElementById('expectedAnnualReturn').textContent = `${annualReturn >= 0 ? '+' : ''}${annualReturn.toFixed(1)}%`;
            document.getElementById('expectedAnnualReturn').style.color = annualReturn >= 0 ? 'var(--success)' : 'var(--danger)';
            
            // êµ¬ë§¤ ê°€ëŠ¥ ì—¬ë¶€ í™•ì¸
            const canAfford = gameState.currentUser.game_balance >= amount;
            const confirmBtn = document.getElementById('confirmInvestmentBtn');
            confirmBtn.disabled = !canAfford;
            confirmBtn.textContent = canAfford ? 'íˆ¬ìí•˜ê¸°' : 'ìê¸ˆ ë¶€ì¡±';
            confirmBtn.className = canAfford ? 'btn' : 'btn btn-secondary';
        }

        function confirmInvestment() {
            if (!selectedInvestment) return;
            
            const amount = parseInt(document.getElementById('investmentAmountSlider').value);
            
            if (gameState.currentUser.game_balance < amount) {
                showNotification('íˆ¬ì ìê¸ˆì´ ë¶€ì¡±í•©ë‹ˆë‹¤', 'error');
                return;
            }
            
            gameState.currentUser.game_balance -= amount;
            
            let investment;
            if (selectedInvestment.type === 'stock') {
                investment = {
                    type: 'stock',
                    name: selectedInvestment.name,
                    amount: amount,
                    shares: Math.floor(amount / selectedInvestment.price),
                    purchasePrice: selectedInvestment.price,
                    returnRate: (Math.random() * 0.15) + 0.03,
                    dividends: Math.floor(amount * selectedInvestment.dividend / 100 / 12),
                    volatility: 0.02,
                    sector: selectedInvestment.sector
                };
            } else {
                investment = {
                    type: 'crypto',
                    name: selectedInvestment.name,
                    symbol: selectedInvestment.symbol,
                    amount: amount,
                    coins: amount / selectedInvestment.price,
                    purchasePrice: selectedInvestment.price,
                    returnRate: (Math.random() * 0.6) - 0.2,
                    dividends: 0,
                    volatility: 0.08
                };
            }
            
            gameState.roleData.investments.push(investment);
            
            updateInvestmentDisplay();
            updateDisplay();
            closeInvestmentDetail();
            closeStockMarket();
            closeCryptoMarket();
            
            const investmentType = selectedInvestment.type === 'stock' ? 'ì£¼ì‹' : 'ì•”í˜¸í™”í';
            showNotification(`${selectedInvestment.name} ${investmentType} ${amount.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§ íˆ¬ì ì™„ë£Œ!`, 'success');
        }

        function getSectorName(sector) {
            const sectorNames = {
                'tech': 'ê¸°ìˆ ',
                'finance': 'ê¸ˆìœµ',
                'auto': 'ìë™ì°¨',
                'chemical': 'í™”í•™',
                'electronics': 'ì „ì',
                'steel': 'ì² ê°•',
                'media': 'ë¯¸ë””ì–´'
            };
            return sectorNames[sector] || sector;
        }

        // M&A ë° R&D íŒ¨ë„ í‘œì‹œ í•¨ìˆ˜ë“¤
        function showMAPanel() {
            openMAModal();
        }

        function showRDPanel() {
            openRDModal();
        }

        // ============================================
        // ìºí”¼íƒˆë¦¬ì¦˜ ìŠ¤íƒ€ì¼ ê²½ì œ ì‹œìŠ¤í…œ (Capitalism 2 Style)
        // ============================================

        // ì‹œì¥ ê°€ê²© ì´ˆê¸°í™”
        function initializeMarketPrices() {
            const marketPrices = gameState.roleData.supplyChain.marketPrices;
            
            // ì›ìì¬ ê°€ê²© ì„¤ì •
            marketPrices.set('wheat', { price: 50, demand: 1000, supply: 1000 });
            marketPrices.set('corn', { price: 45, demand: 800, supply: 800 });
            marketPrices.set('cotton', { price: 120, demand: 600, supply: 600 });
            marketPrices.set('lumber', { price: 80, demand: 900, supply: 900 });
            marketPrices.set('iron_ore', { price: 30, demand: 1200, supply: 1200 });
            marketPrices.set('coal', { price: 25, demand: 1100, supply: 1100 });
            marketPrices.set('oil', { price: 200, demand: 1500, supply: 1500 });
            marketPrices.set('milk', { price: 35, demand: 700, supply: 700 });
            marketPrices.set('beef', { price: 300, demand: 500, supply: 500 });
            
            // ê°€ê³µí’ˆ ê°€ê²© ì„¤ì •
            marketPrices.set('bread', { price: 150, demand: 800, supply: 700 });
            marketPrices.set('textiles', { price: 250, demand: 600, supply: 550 });
            marketPrices.set('furniture', { price: 800, demand: 400, supply: 350 });
            marketPrices.set('steel', { price: 100, demand: 1000, supply: 950 });
            marketPrices.set('gasoline', { price: 400, demand: 1200, supply: 1100 });
            marketPrices.set('electronics', { price: 1500, demand: 300, supply: 250 });
            marketPrices.set('automobiles', { price: 25000, demand: 100, supply: 80 });
        }

        // ìºí”¼íƒˆë¦¬ì¦˜ ìŠ¤íƒ€ì¼ ì‚¬ì—… ìƒì„±
        function openCapitalismBusinessModal() {
            const modalContent = `
                <h2 style="text-align: center; margin-bottom: 30px; color: var(--primary);">ğŸ­ ì‚°ì—… ì œêµ­ ê±´ì„¤</h2>
                
                <div style="margin-bottom: 20px;">
                    <p style="text-align: center; color: #cbd5e1; margin-bottom: 20px;">
                        ì›ìì¬ ìƒì‚°ë¶€í„° ì†Œë§¤ íŒë§¤ê¹Œì§€ ì™„ì „í•œ ê³µê¸‰ë§ì„ êµ¬ì¶•í•˜ì„¸ìš”.
                    </p>
                </div>

                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                    <div class="business-category" onclick="showRawMaterialBusinesses()" style="
                        padding: 20px;
                        background: linear-gradient(135deg, #10b981, #047857);
                        border-radius: 12px;
                        cursor: pointer;
                        transition: all 0.3s ease;
                        text-align: center;
                    ">
                        <div style="font-size: 2.5rem; margin-bottom: 10px;">ğŸŒ¾</div>
                        <h3 style="color: white; margin-bottom: 8px;">ì›ìì¬ ìƒì‚°</h3>
                        <p style="color: rgba(255,255,255,0.8); font-size: 0.9rem;">ë†ì¥, ê´‘ì‚°, ëª©ì¥</p>
                    </div>

                    <div class="business-category" onclick="showManufacturingBusinesses()" style="
                        padding: 20px;
                        background: linear-gradient(135deg, #f59e0b, #d97706);
                        border-radius: 12px;
                        cursor: pointer;
                        transition: all 0.3s ease;
                        text-align: center;
                    ">
                        <div style="font-size: 2.5rem; margin-bottom: 10px;">ğŸ­</div>
                        <h3 style="color: white; margin-bottom: 8px;">ì œì¡°ì—…</h3>
                        <p style="color: rgba(255,255,255,0.8); font-size: 0.9rem;">ê³µì¥, ê°€ê³µì—…ì²´</p>
                    </div>

                    <div class="business-category" onclick="showDistributionBusinesses()" style="
                        padding: 20px;
                        background: linear-gradient(135deg, #3b82f6, #1d4ed8);
                        border-radius: 12px;
                        cursor: pointer;
                        transition: all 0.3s ease;
                        text-align: center;
                    ">
                        <div style="font-size: 2.5rem; margin-bottom: 10px;">ğŸš›</div>
                        <h3 style="color: white; margin-bottom: 8px;">ìœ í†µì—…</h3>
                        <p style="color: rgba(255,255,255,0.8); font-size: 0.9rem;">ë„ë§¤ì , ë¬¼ë¥˜ì„¼í„°</p>
                    </div>

                    <div class="business-category" onclick="showRetailBusinesses()" style="
                        padding: 20px;
                        background: linear-gradient(135deg, #8b5cf6, #7c3aed);
                        border-radius: 12px;
                        cursor: pointer;
                        transition: all 0.3s ease;
                        text-align: center;
                    ">
                        <div style="font-size: 2.5rem; margin-bottom: 10px;">ğŸª</div>
                        <h3 style="color: white; margin-bottom: 8px;">ì†Œë§¤ì—…</h3>
                        <p style="color: rgba(255,255,255,0.8); font-size: 0.9rem;">ì†Œë§¤ì , ëŒ€ë¦¬ì </p>
                    </div>
                </div>

                <div style="margin-top: 30px; text-align: center;">
                    <button onclick="showSupplyChainOverview()" style="
                        padding: 12px 24px;
                        background: var(--primary);
                        color: white;
                        border: none;
                        border-radius: 8px;
                        cursor: pointer;
                        font-weight: 600;
                        margin-right: 10px;
                    ">ê³µê¸‰ë§ í˜„í™©</button>
                    
                    <button onclick="showMarketPrices()" style="
                        padding: 12px 24px;
                        background: var(--success);
                        color: white;
                        border: none;
                        border-radius: 8px;
                        cursor: pointer;
                        font-weight: 600;
                    ">ì‹œì¥ ê°€ê²©</button>
                </div>
            `;
            
            showModal(modalContent);
        }

        // ì›ìì¬ ìƒì‚°ì—… í‘œì‹œ
        function showRawMaterialBusinesses() {
            const businesses = [
                {
                    id: 'wheat_farm',
                    name: 'ë°€ ë†ì¥',
                    icon: 'ğŸŒ¾',
                    product: 'wheat',
                    cost: 25000,
                    monthlyProduction: 200,
                    description: 'ë°€ì„ ìƒì‚°í•˜ì—¬ ì œë¹µì—…ì²´ì— ê³µê¸‰',
                    requirements: 'ë†ì§€ 500í‰ í•„ìš”'
                },
                {
                    id: 'corn_farm',
                    name: 'ì˜¥ìˆ˜ìˆ˜ ë†ì¥',
                    icon: 'ğŸŒ½',
                    product: 'corn',
                    cost: 22000,
                    monthlyProduction: 180,
                    description: 'ì‚¬ë£Œìš© ë° ê°€ê³µìš© ì˜¥ìˆ˜ìˆ˜ ìƒì‚°',
                    requirements: 'ë†ì§€ 400í‰ í•„ìš”'
                },
                {
                    id: 'cotton_farm',
                    name: 'ëª©í™” ë†ì¥',
                    icon: 'ğŸŒ¿',
                    product: 'cotton',
                    cost: 30000,
                    monthlyProduction: 150,
                    description: 'ì„¬ìœ  ì›ë£Œì¸ ëª©í™” ìƒì‚°',
                    requirements: 'ë†ì§€ 600í‰ í•„ìš”'
                },
                {
                    id: 'lumber_mill',
                    name: 'ì œì¬ì†Œ',
                    icon: 'ğŸªµ',
                    product: 'lumber',
                    cost: 35000,
                    monthlyProduction: 300,
                    description: 'ëª©ì¬ ê°€ê³µ ë° ê³µê¸‰',
                    requirements: 'ì‚°ë¦¼ì§€ì—­ í•„ìš”'
                },
                {
                    id: 'iron_mine',
                    name: 'ì² ê´‘ì‚°',
                    icon: 'â›ï¸',
                    product: 'iron_ore',
                    cost: 50000,
                    monthlyProduction: 400,
                    description: 'ì² ê´‘ì„ ì±„êµ´ ë° ê°€ê³µ',
                    requirements: 'ê´‘ì—…ê¶Œ í•„ìš”'
                },
                {
                    id: 'coal_mine',
                    name: 'íƒ„ê´‘',
                    icon: 'âš«',
                    product: 'coal',
                    cost: 45000,
                    monthlyProduction: 350,
                    description: 'ì„íƒ„ ì±„êµ´ ë° ê³µê¸‰',
                    requirements: 'ê´‘ì—…ê¶Œ í•„ìš”'
                },
                {
                    id: 'oil_well',
                    name: 'ìœ ì •',
                    icon: 'ğŸ›¢ï¸',
                    product: 'oil',
                    cost: 80000,
                    monthlyProduction: 100,
                    description: 'ì›ìœ  ì±„êµ´ ë° ì •ì œ',
                    requirements: 'ì±„êµ´ê¶Œ í•„ìš”'
                },
                {
                    id: 'dairy_farm',
                    name: 'ë‚™ë†ì¥',
                    icon: 'ğŸ„',
                    product: 'milk',
                    cost: 28000,
                    monthlyProduction: 250,
                    description: 'ìš°ìœ  ìƒì‚° ë° ê³µê¸‰',
                    requirements: 'ëª©ì´ˆì§€ 300í‰ í•„ìš”'
                },
                {
                    id: 'cattle_ranch',
                    name: 'ëª©ì¥',
                    icon: 'ğŸ¥©',
                    product: 'beef',
                    cost: 60000,
                    monthlyProduction: 80,
                    description: 'ìœ¡ìš° ì‚¬ìœ¡ ë° ë„ì¶•',
                    requirements: 'ëª©ì´ˆì§€ 1000í‰ í•„ìš”'
                }
            ];

            showBusinessTypeSelection(businesses, 'rawMaterials', 'ì›ìì¬ ìƒì‚°ì—…');
        }

        // ì œì¡°ì—… í‘œì‹œ
        function showManufacturingBusinesses() {
            const businesses = [
                {
                    id: 'bakery',
                    name: 'ì œë¹µê³µì¥',
                    icon: 'ğŸ',
                    product: 'bread',
                    cost: 40000,
                    inputs: [{ product: 'wheat', quantity: 3 }],
                    monthlyProduction: 100,
                    description: 'ë°€ê°€ë£¨ë¡œ ë¹µ ì œì¡°',
                    requirements: 'ë°€ ê³µê¸‰ê³„ì•½ í•„ìš”'
                },
                {
                    id: 'textile_mill',
                    name: 'ë°©ì§ê³µì¥',
                    icon: 'ğŸ§µ',
                    product: 'textiles',
                    cost: 55000,
                    inputs: [{ product: 'cotton', quantity: 2 }],
                    monthlyProduction: 80,
                    description: 'ëª©í™”ë¥¼ ì§ë¬¼ë¡œ ê°€ê³µ',
                    requirements: 'ëª©í™” ê³µê¸‰ê³„ì•½ í•„ìš”'
                },
                {
                    id: 'furniture_factory',
                    name: 'ê°€êµ¬ê³µì¥',
                    icon: 'ğŸª‘',
                    product: 'furniture',
                    cost: 70000,
                    inputs: [{ product: 'lumber', quantity: 4 }],
                    monthlyProduction: 30,
                    description: 'ëª©ì¬ë¡œ ê°€êµ¬ ì œì¡°',
                    requirements: 'ëª©ì¬ ê³µê¸‰ê³„ì•½ í•„ìš”'
                },
                {
                    id: 'steel_mill',
                    name: 'ì œì² ì†Œ',
                    icon: 'ğŸ­',
                    product: 'steel',
                    cost: 120000,
                    inputs: [
                        { product: 'iron_ore', quantity: 3 },
                        { product: 'coal', quantity: 2 }
                    ],
                    monthlyProduction: 200,
                    description: 'ì² ê´‘ì„ê³¼ ì„íƒ„ìœ¼ë¡œ ì² ê°• ì œì¡°',
                    requirements: 'ì² ê´‘ì„, ì„íƒ„ ê³µê¸‰ê³„ì•½ í•„ìš”'
                }
            ];

            showBusinessTypeSelection(businesses, 'manufacturers', 'ì œì¡°ì—…');
        }

        // ê³µí†µ ì‚¬ì—… ì„ íƒ í‘œì‹œ í•¨ìˆ˜
        function showBusinessTypeSelection(businesses, category, categoryName) {
            const modalContent = `
                <h2 style="text-align: center; margin-bottom: 30px; color: var(--primary);">ğŸ­ ${categoryName}</h2>
                
                <div style="display: grid; gap: 15px; max-height: 60vh; overflow-y: auto;">
                    ${businesses.map(business => {
                        const canAfford = gameState.currentUser.game_balance >= business.cost;
                        // ìœ í†µì—…ê³¼ ì†Œë§¤ì—…ì€ ì§ì ‘ì ì¸ ìˆ˜ìµì´ ìˆê³ , ì œì¡°ì—…ì€ ìƒì‚°ëŸ‰ * ê°€ê²©ìœ¼ë¡œ ê³„ì‚°
                        let monthlyRevenue = 0;
                        if (category === 'distributors' || category === 'retailers') {
                            monthlyRevenue = business.monthlyRevenue || 0;
                        } else {
                            const marketPrice = gameState.roleData.supplyChain.marketPrices.get(business.product);
                            monthlyRevenue = marketPrice ? Math.floor(business.monthlyProduction * marketPrice.price) : 0;
                        }
                        
                        return `
                            <div class="capitalism-business-card ${canAfford ? '' : 'disabled'}" 
                                 onclick="${canAfford ? `createCapitalismBusiness('${business.id}', '${category}')` : ''}"
                                 style="
                                    padding: 20px;
                                    background: ${canAfford ? 'rgba(255,255,255,0.05)' : 'rgba(255,255,255,0.02)'};
                                    border: 1px solid ${canAfford ? 'rgba(255,255,255,0.1)' : 'rgba(255,255,255,0.05)'};
                                    border-radius: 12px;
                                    cursor: ${canAfford ? 'pointer' : 'not-allowed'};
                                    opacity: ${canAfford ? '1' : '0.5'};
                                 ">
                                
                                <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                                    <div style="font-size: 2rem;">${business.icon}</div>
                                    <div style="flex: 1;">
                                        <h3 style="color: var(--primary); margin: 0;">${business.name}</h3>
                                        <p style="color: #94a3b8; margin: 5px 0; font-size: 0.9rem;">${business.description}</p>
                                    </div>
                                    <div style="text-align: right;">
                                        <div style="color: var(--danger); font-weight: 600;">${business.cost.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§</div>
                                        <div style="color: var(--success); font-weight: 600;">${monthlyRevenue.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§/ì›”</div>
                                    </div>
                                </div>

                                <div style="background: rgba(99, 102, 241, 0.1); border-radius: 8px; padding: 10px; font-size: 0.85rem;">
                                    <div>ìƒì‚°ëŸ‰: ${business.monthlyProduction}/ì›” | ${business.requirements}</div>
                                    ${business.inputs ? `<div style="margin-top: 5px;">í•„ìš” ì›ë£Œ: ${business.inputs.map(i => `${i.product} ${i.quantity}ê°œ`).join(', ')}</div>` : ''}
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>

                <div style="margin-top: 20px; text-align: center;">
                    <button onclick="openCapitalismBusinessModal()" style="
                        padding: 10px 20px; border: 1px solid rgba(255,255,255,0.2);
                        background: rgba(255,255,255,0.05); color: #e2e8f0;
                        border-radius: 8px; cursor: pointer;">ë’¤ë¡œ ê°€ê¸°</button>
                </div>
            `;
            
            showModal(modalContent);
        }

        // ìºí”¼íƒˆë¦¬ì¦˜ ì‚¬ì—… ìƒì„±
        function createCapitalismBusiness(businessId, category) {
            const allBusinesses = {
                // ì›ìì¬ ìƒì‚°ì—…
                'wheat_farm': { name: 'ë°€ ë†ì¥', cost: 25000, product: 'wheat', monthlyProduction: 200, employees: 4, sector: 'ë†ì—…' },
                'corn_farm': { name: 'ì˜¥ìˆ˜ìˆ˜ ë†ì¥', cost: 22000, product: 'corn', monthlyProduction: 180, employees: 3, sector: 'ë†ì—…' },
                'cotton_farm': { name: 'ëª©í™” ë†ì¥', cost: 30000, product: 'cotton', monthlyProduction: 150, employees: 5, sector: 'ë†ì—…' },
                'lumber_mill': { name: 'ì œì¬ì†Œ', cost: 35000, product: 'lumber', monthlyProduction: 300, employees: 8, sector: 'ì„ì—…' },
                'iron_mine': { name: 'ì² ê´‘ì‚°', cost: 50000, product: 'iron_ore', monthlyProduction: 400, employees: 12, sector: 'ê´‘ì—…' },
                'coal_mine': { name: 'íƒ„ê´‘', cost: 45000, product: 'coal', monthlyProduction: 350, employees: 10, sector: 'ê´‘ì—…' },
                'oil_well': { name: 'ìœ ì •', cost: 80000, product: 'oil', monthlyProduction: 100, employees: 6, sector: 'ì„ìœ ' },
                'dairy_farm': { name: 'ë‚™ë†ì¥', cost: 28000, product: 'milk', monthlyProduction: 250, employees: 6, sector: 'ë†ì—…' },
                'cattle_ranch': { name: 'ëª©ì¥', cost: 60000, product: 'beef', monthlyProduction: 80, employees: 8, sector: 'ì¶•ì‚°ì—…' },

                // ì œì¡°ì—…
                'bakery': { name: 'ì œë¹µê³µì¥', cost: 40000, product: 'bread', monthlyProduction: 100, employees: 6, sector: 'ì‹í’ˆì œì¡°', inputs: [{ product: 'wheat', quantity: 3 }] },
                'textile_mill': { name: 'ë°©ì§ê³µì¥', cost: 55000, product: 'textiles', monthlyProduction: 80, employees: 10, sector: 'ì„¬ìœ ì œì¡°', inputs: [{ product: 'cotton', quantity: 2 }] },
                'furniture_factory': { name: 'ê°€êµ¬ê³µì¥', cost: 70000, product: 'furniture', monthlyProduction: 30, employees: 15, sector: 'ê°€êµ¬ì œì¡°', inputs: [{ product: 'lumber', quantity: 4 }] },
                'steel_mill': { name: 'ì œì² ì†Œ', cost: 120000, product: 'steel', monthlyProduction: 200, employees: 25, sector: 'ì² ê°•ì œì¡°', inputs: [{ product: 'iron_ore', quantity: 3 }, { product: 'coal', quantity: 2 }] },

                // ìœ í†µì—…
                'wholesale_center': { name: 'ë„ë§¤ ìœ í†µì„¼í„°', cost: 75000, monthlyRevenue: 12000, employees: 15, sector: 'ìœ í†µì—…', products: ['bread', 'clothing', 'furniture'] },
                'logistics_hub': { name: 'ë¬¼ë¥˜ í—ˆë¸Œ', cost: 120000, monthlyRevenue: 18000, employees: 25, sector: 'ë¬¼ë¥˜ì—…', products: ['all_products'] },
                'cold_chain': { name: 'ëƒ‰ì¥ ìœ í†µì„¼í„°', cost: 95000, monthlyRevenue: 15000, employees: 18, sector: 'ëƒ‰ì¥ìœ í†µ', products: ['milk', 'beef'] },
                'import_distributor': { name: 'ìˆ˜ì… ì´íŒ', cost: 150000, monthlyRevenue: 22000, employees: 20, sector: 'ìˆ˜ì…ìœ í†µ', products: ['luxury_goods', 'electronics'] },

                // ì†Œë§¤ì—…
                'department_store': { name: 'ë°±í™”ì ', cost: 200000, monthlyRevenue: 35000, employees: 50, sector: 'ë°±í™”ì ì—…', products: ['clothing', 'furniture', 'luxury_goods'] },
                'supermarket': { name: 'ëŒ€í˜•ë§ˆíŠ¸', cost: 180000, monthlyRevenue: 28000, employees: 40, sector: 'ëŒ€í˜•ë§ˆíŠ¸ì—…', products: ['bread', 'milk', 'beef', 'processed_foods'] },
                'convenience_store': { name: 'í¸ì˜ì  ì²´ì¸', cost: 80000, monthlyRevenue: 15000, employees: 12, sector: 'í¸ì˜ì ì—…', products: ['processed_foods', 'beverages'] },
                'specialty_store': { name: 'ì „ë¬¸ íŒë§¤ì ', cost: 120000, monthlyRevenue: 20000, employees: 15, sector: 'ì „ë¬¸ì†Œë§¤ì—…', products: ['electronics', 'luxury_goods'] },
                'online_mall': { name: 'ì˜¨ë¼ì¸ ì‡¼í•‘ëª°', cost: 60000, monthlyRevenue: 18000, employees: 8, sector: 'ì „ììƒê±°ë˜', products: ['all_products'] },
                'franchise_dealer': { name: 'ê°€ë§¹ì  ë³¸ë¶€', cost: 250000, monthlyRevenue: 45000, employees: 30, sector: 'í”„ëœì°¨ì´ì¦ˆ', products: ['franchise_rights'] }
            };

            const selectedBusiness = allBusinesses[businessId];
            if (!selectedBusiness) return;

            // ì „ì—­ ë³€ìˆ˜ì— ì €ì¥
            window.currentSelectedBusiness = selectedBusiness;
            showCapitalismBusinessOptions(selectedBusiness, businessId, category);
        }

        // ìºí”¼íƒˆë¦¬ì¦˜ ì‚¬ì—… ì˜µì…˜ ì„ íƒ
        function showCapitalismBusinessOptions(business, businessId, category) {
            const modalContent = `
                <h2 style="text-align: center; margin-bottom: 30px; color: var(--primary);">ğŸ­ ${business.name} ì„¤ë¦½ ì˜µì…˜</h2>
                
                <div style="background: rgba(99, 102, 241, 0.1); border: 1px solid rgba(99, 102, 241, 0.3); border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px; font-size: 0.9rem;">
                        <div><span style="color: #64748b;">ì‚¬ì—…ëª…:</span> <span style="color: #e2e8f0; font-weight: 600;">${business.name}</span></div>
                        <div><span style="color: #64748b;">ì—…ì¢…:</span> <span style="color: #e2e8f0; font-weight: 600;">${business.sector}</span></div>
                        <div><span style="color: #64748b;">ê¸°ë³¸ ë¹„ìš©:</span> <span style="color: var(--danger); font-weight: 600;">${business.cost.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§</span></div>
                        <div><span style="color: #64748b;">ê¸°ë³¸ ì§ì›:</span> <span style="color: #e2e8f0; font-weight: 600;">${business.employees}ëª…</span></div>
                    </div>
                </div>

                <div style="background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                    <h3 style="color: var(--primary); margin-bottom: 15px;">ğŸ—ï¸ ì‹œì„¤ ê·œëª¨ ì„ íƒ</h3>
                    <div id="facilityOptions" style="display: grid; gap: 15px;"></div>
                </div>

                <div style="background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                    <h3 style="color: var(--primary); margin-bottom: 15px;">ğŸ‘¥ ì´ˆê¸° ì§ì› ê·œëª¨ ì„ íƒ</h3>
                    <div id="staffingOptions" style="display: grid; gap: 15px;"></div>
                </div>

                <div style="background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                    <h3 style="color: var(--primary); margin-bottom: 15px;">ğŸ¯ ìš´ì˜ ì „ëµ ì„ íƒ</h3>
                    <div id="strategyOptions" style="display: grid; gap: 15px;"></div>
                </div>

                <div id="finalEstimate" style="background: rgba(16, 185, 129, 0.1); border: 1px solid rgba(16, 185, 129, 0.3); border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 30px;">
                    <button onclick="openCapitalismBusinessModal()" style="
                        padding: 12px 20px; border: 1px solid rgba(255,255,255,0.2);
                        background: rgba(255,255,255,0.05); color: #e2e8f0;
                        border-radius: 8px; cursor: pointer;">ì·¨ì†Œ</button>
                    
                    <button onclick="confirmCapitalismBusiness('${businessId}', '${category}')" style="
                        padding: 12px 20px; border: none; background: var(--primary);
                        color: white; border-radius: 8px; cursor: pointer; font-weight: 600;">ì„¤ë¦½í•˜ê¸°</button>
                </div>
            `;

            showModal(modalContent);
            loadCapitalismBusinessOptions(business, businessId);
        }

        // ìºí”¼íƒˆë¦¬ì¦˜ ì‚¬ì—… ì˜µì…˜ ë¡œë“œ
        function loadCapitalismBusinessOptions(business, businessId) {
            // ì‹œì„¤ ê·œëª¨ ì˜µì…˜
            const facilityOptions = [
                { id: 'small', name: 'ì†Œê·œëª¨', multiplier: 1.0, description: 'ê¸°ë³¸ ê·œëª¨', bonus: '' },
                { id: 'medium', name: 'ì¤‘ê·œëª¨', multiplier: 1.8, description: '80% í° ê·œëª¨', bonus: 'íš¨ìœ¨ì„± +10%' },
                { id: 'large', name: 'ëŒ€ê·œëª¨', multiplier: 3.0, description: '3ë°° í° ê·œëª¨', bonus: 'íš¨ìœ¨ì„± +25%' },
                { id: 'mega', name: 'ì´ˆëŒ€ê·œëª¨', multiplier: 5.0, description: '5ë°° í° ê·œëª¨', bonus: 'íš¨ìœ¨ì„± +50%' }
            ];

            // ì§ì› ê·œëª¨ ì˜µì…˜
            const staffingOptions = [
                { id: 'minimal', name: 'ìµœì†Œ ì¸ë ¥', multiplier: 0.8, description: 'ê¸°ë³¸ ì¸ë ¥ì˜ 80%', penalty: 'ìƒì‚°ì„± -10%' },
                { id: 'standard', name: 'í‘œì¤€ ì¸ë ¥', multiplier: 1.0, description: 'ê¸°ë³¸ ì¸ë ¥', bonus: '' },
                { id: 'expanded', name: 'í™•ì¥ ì¸ë ¥', multiplier: 1.5, description: 'ê¸°ë³¸ ì¸ë ¥ì˜ 150%', bonus: 'ìƒì‚°ì„± +20%' },
                { id: 'premium', name: 'í”„ë¦¬ë¯¸ì—„ ì¸ë ¥', multiplier: 2.0, description: 'ê¸°ë³¸ ì¸ë ¥ì˜ 200%', bonus: 'ìƒì‚°ì„± +40%' }
            ];

            // ìš´ì˜ ì „ëµ ì˜µì…˜
            const strategyOptions = [
                { id: 'cost_focus', name: 'ë¹„ìš© ìµœì í™”', description: 'ìš´ì˜ë¹„ -20%, í’ˆì§ˆ -10%' },
                { id: 'balanced', name: 'ê· í˜• ìš´ì˜', description: 'í‘œì¤€ ìš´ì˜ ë°©ì‹' },
                { id: 'quality_focus', name: 'í’ˆì§ˆ ì§‘ì¤‘', description: 'ìš´ì˜ë¹„ +30%, í’ˆì§ˆ +25%' },
                { id: 'innovation', name: 'í˜ì‹  ì¤‘ì‹¬', description: 'ìš´ì˜ë¹„ +50%, ìƒì‚°ì„± +35%' }
            ];

            // HTML ìƒì„±
            document.getElementById('facilityOptions').innerHTML = facilityOptions.map(option => {
                const cost = Math.floor(business.cost * option.multiplier);
                const canAfford = gameState.currentUser.game_balance >= cost;
                
                return `
                    <div class="option-card ${canAfford ? '' : 'disabled'}" data-type="facility" data-id="${option.id}"
                         onclick="${canAfford ? `selectCapitalismOption('facility', '${option.id}')` : ''}"
                         style="padding: 15px; border: 2px solid rgba(255,255,255,0.1); border-radius: 8px; 
                                cursor: ${canAfford ? 'pointer' : 'not-allowed'}; opacity: ${canAfford ? '1' : '0.5'};">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                            <h4 style="color: var(--primary); margin: 0;">${option.name}</h4>
                            <span style="color: var(--danger); font-weight: 600;">${cost.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§</span>
                        </div>
                        <p style="color: #94a3b8; margin: 5px 0; font-size: 0.9rem;">${option.description}</p>
                        ${option.bonus ? `<div style="color: var(--success); font-size: 0.8rem;">ğŸ’¡ ${option.bonus}</div>` : ''}
                    </div>
                `;
            }).join('');

            document.getElementById('staffingOptions').innerHTML = staffingOptions.map(option => `
                <div class="option-card" data-type="staffing" data-id="${option.id}"
                     onclick="selectCapitalismOption('staffing', '${option.id}')"
                     style="padding: 15px; border: 2px solid rgba(255,255,255,0.1); border-radius: 8px; cursor: pointer;">
                    <h4 style="color: var(--primary); margin: 0 0 8px 0;">${option.name}</h4>
                    <p style="color: #94a3b8; margin: 5px 0; font-size: 0.9rem;">${option.description}</p>
                    ${option.bonus ? `<div style="color: var(--success); font-size: 0.8rem;">ğŸ’¡ ${option.bonus}</div>` : ''}
                    ${option.penalty ? `<div style="color: var(--warning); font-size: 0.8rem;">âš ï¸ ${option.penalty}</div>` : ''}
                </div>
            `).join('');

            document.getElementById('strategyOptions').innerHTML = strategyOptions.map(option => `
                <div class="option-card" data-type="strategy" data-id="${option.id}"
                     onclick="selectCapitalismOption('strategy', '${option.id}')"
                     style="padding: 15px; border: 2px solid rgba(255,255,255,0.1); border-radius: 8px; cursor: pointer;">
                    <h4 style="color: var(--primary); margin: 0 0 8px 0;">${option.name}</h4>
                    <p style="color: #94a3b8; margin: 5px 0; font-size: 0.9rem;">${option.description}</p>
                </div>
            `).join('');

            // ê¸°ë³¸ê°’ ì„ íƒ
            window.selectedCapitalismOptions = { facility: 'small', staffing: 'standard', strategy: 'balanced' };
            selectCapitalismOption('facility', 'small');
            selectCapitalismOption('staffing', 'standard');
            selectCapitalismOption('strategy', 'balanced');
        }

        // ìºí”¼íƒˆë¦¬ì¦˜ ì˜µì…˜ ì„ íƒ
        function selectCapitalismOption(type, id) {
            // ì´ì „ ì„ íƒ í•´ì œ
            document.querySelectorAll(`[data-type="${type}"]`).forEach(el => {
                el.style.border = '2px solid rgba(255,255,255,0.1)';
            });

            // í˜„ì¬ ì„ íƒ í‘œì‹œ
            const selectedElement = document.querySelector(`[data-type="${type}"][data-id="${id}"]`);
            if (selectedElement) {
                selectedElement.style.border = '2px solid var(--primary)';
            }

            // ì„ íƒ ì €ì¥
            window.selectedCapitalismOptions[type] = id;
            updateCapitalismEstimate();
        }

        // ì˜ˆìƒ ìˆ˜ì¹˜ ì—…ë°ì´íŠ¸
        function updateCapitalismEstimate() {
            const business = window.currentSelectedBusiness;
            if (!business) return;

            const options = window.selectedCapitalismOptions;
            
            // ë°°ìœ¨ ê³„ì‚°
            const facilityMultipliers = { small: 1.0, medium: 1.8, large: 3.0, mega: 5.0 };
            const staffingMultipliers = { minimal: 0.8, standard: 1.0, expanded: 1.5, premium: 2.0 };
            
            const facilityMultiplier = facilityMultipliers[options.facility];
            const staffingMultiplier = staffingMultipliers[options.staffing];

            // ìµœì¢… ê³„ì‚°
            const totalCost = Math.floor(business.cost * facilityMultiplier);
            const totalEmployees = Math.floor(business.employees * facilityMultiplier * staffingMultiplier);
            
            let monthlyRevenue = 0;
            let finalProduction = 0;
            
            // ìœ í†µì—…/ì†Œë§¤ì—…ì¸ì§€ í™•ì¸ (monthlyRevenue ì†ì„± ìˆëŠ”ì§€ë¡œ íŒë‹¨)
            if (business.monthlyRevenue) {
                // ìœ í†µì—…ê³¼ ì†Œë§¤ì—…: ì§ì ‘ ìˆ˜ìµ ê³„ì‚°
                const baseRevenue = Math.floor(business.monthlyRevenue * facilityMultiplier);
                
                // ìˆ˜ìµì„± ë³´ë„ˆìŠ¤ ê³„ì‚°
                let revenueBonus = 0;
                if (options.staffing === 'expanded') revenueBonus += 0.2;
                if (options.staffing === 'premium') revenueBonus += 0.4;
                if (options.strategy === 'quality_focus') revenueBonus += 0.3;
                if (options.strategy === 'innovation') revenueBonus += 0.35;
                
                monthlyRevenue = Math.floor(baseRevenue * (1 + revenueBonus));
            } else {
                // ì œì¡°ì—…ê³¼ ì›ìì¬ì—…: ê¸°ì¡´ ìƒì‚°ëŸ‰ * ê°€ê²© ë°©ì‹
                const baseProduction = Math.floor(business.monthlyProduction * facilityMultiplier);
                
                // ìƒì‚°ì„± ë³´ë„ˆìŠ¤ ê³„ì‚°
                let productivityBonus = 0;
                if (options.staffing === 'expanded') productivityBonus += 0.2;
                if (options.staffing === 'premium') productivityBonus += 0.4;
                if (options.strategy === 'innovation') productivityBonus += 0.35;

                finalProduction = Math.floor(baseProduction * (1 + productivityBonus));
                
                // ì‹œì¥ ê°€ê²©ìœ¼ë¡œ ìˆ˜ìµ ê³„ì‚°
                const marketPrice = gameState.roleData.supplyChain.marketPrices.get(business.product);
                monthlyRevenue = marketPrice ? finalProduction * marketPrice.price : 0;
            }

            // ìš´ì˜ë¹„ ê³„ì‚°
            let operatingCostMultiplier = 0.05;
            if (options.strategy === 'cost_focus') operatingCostMultiplier *= 0.8;
            if (options.strategy === 'quality_focus') operatingCostMultiplier *= 1.3;
            if (options.strategy === 'innovation') operatingCostMultiplier *= 1.5;

            const monthlyOperatingCost = Math.floor(totalCost * operatingCostMultiplier);
            const monthlyProfit = monthlyRevenue - monthlyOperatingCost;

            // ì§ì› ìˆ˜ ë³´ë„ˆìŠ¤ ê³„ì‚°
            const employeeBonus = calculateEmployeeBonus(totalEmployees);

            document.getElementById('finalEstimate').innerHTML = `
                <h3 style="color: var(--success); margin-bottom: 15px;">ğŸ’° ìµœì¢… ì˜ˆìƒ ìˆ˜ì¹˜</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; font-size: 0.9rem;">
                    <div>
                        <span style="color: #64748b;">ì´ íˆ¬ìë¹„ìš©:</span>
                        <div style="color: var(--danger); font-weight: 600; font-size: 1.1rem;">${totalCost.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§</div>
                    </div>
                    <div>
                        <span style="color: #64748b;">ì´ ì§ì› ìˆ˜:</span>
                        <div style="color: #e2e8f0; font-weight: 600; font-size: 1.1rem;">${totalEmployees}ëª…</div>
                    </div>
                    <div>
                        <span style="color: #64748b;">ì›” ìƒì‚°ëŸ‰:</span>
                        <div style="color: var(--primary); font-weight: 600; font-size: 1.1rem;">${finalProduction.toLocaleString()}ê°œ</div>
                    </div>
                    <div>
                        <span style="color: #64748b;">ì›” ë§¤ì¶œ:</span>
                        <div style="color: var(--success); font-weight: 600; font-size: 1.1rem;">${monthlyRevenue.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§</div>
                    </div>
                    <div>
                        <span style="color: #64748b;">ì›” ìˆœì´ìµ:</span>
                        <div style="color: ${monthlyProfit >= 0 ? 'var(--success)' : 'var(--danger)'}; font-weight: 600; font-size: 1.1rem;">${monthlyProfit.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§</div>
                    </div>
                    <div>
                        <span style="color: #64748b;">ì§ì› ë³´ë„ˆìŠ¤:</span>
                        <div style="color: var(--warning); font-weight: 600; font-size: 1.1rem;">+${(employeeBonus * 100).toFixed(1)}%</div>
                    </div>
                </div>

                ${employeeBonus > 0 ? `
                    <div style="margin-top: 15px; padding: 10px; background: rgba(245, 158, 11, 0.1); border: 1px solid rgba(245, 158, 11, 0.3); border-radius: 8px;">
                        <div style="color: var(--warning); font-weight: 600; margin-bottom: 5px;">ğŸš€ ëŒ€ê·œëª¨ ì¡°ì§ ë³´ë„ˆìŠ¤!</div>
                        <div style="color: #cbd5e1; font-size: 0.9rem;">ì§ì› ${totalEmployees}ëª…ìœ¼ë¡œ ì¸í•œ í™•ì¥/íš¨ìœ¨ì„± ë³´ë„ˆìŠ¤ ì ìš©</div>
                    </div>
                ` : ''}
            `;

            // ìµœì¢… ìˆ˜ì¹˜ ì €ì¥
            window.finalCapitalismEstimate = {
                cost: totalCost, employees: totalEmployees, production: finalProduction,
                revenue: monthlyRevenue, profit: monthlyProfit, employeeBonus: employeeBonus, business: business
            };
        }

        // ì§ì› ìˆ˜ ë³´ë„ˆìŠ¤ ê³„ì‚°
        function calculateEmployeeBonus(employeeCount) {
            if (employeeCount >= 100) return 0.5; // 100ëª… ì´ìƒ: 50% ë³´ë„ˆìŠ¤
            if (employeeCount >= 50) return 0.3;  // 50ëª… ì´ìƒ: 30% ë³´ë„ˆìŠ¤
            if (employeeCount >= 25) return 0.2;  // 25ëª… ì´ìƒ: 20% ë³´ë„ˆìŠ¤
            if (employeeCount >= 15) return 0.1;  // 15ëª… ì´ìƒ: 10% ë³´ë„ˆìŠ¤
            return 0; // 15ëª… ë¯¸ë§Œ: ë³´ë„ˆìŠ¤ ì—†ìŒ
        }

        // ìºí”¼íƒˆë¦¬ì¦˜ ì‚¬ì—… í™•ì •
        function confirmCapitalismBusiness(businessId, category) {
            const estimate = window.finalCapitalismEstimate;
            if (!estimate) return;

            if (gameState.currentUser.game_balance < estimate.cost) {
                showNotification(`ì‚¬ì—… ì„¤ë¦½ì— ${estimate.cost.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§ì´ í•„ìš”í•©ë‹ˆë‹¤`, 'error');
                return;
            }

            // ì„±ê³µë¥  = 60% + ì§ì› ë³´ë„ˆìŠ¤
            const baseSuccessRate = 0.6;
            const employeeBonusRate = estimate.employeeBonus * 0.5;
            const finalSuccessRate = Math.min(baseSuccessRate + employeeBonusRate, 0.95);

            const isSuccess = Math.random() < finalSuccessRate;
            gameState.currentUser.game_balance -= estimate.cost;
            closeModal();

            if (isSuccess) {
                const newBusiness = {
                    id: Date.now(), name: estimate.business.name, type: 'capitalism_business',
                    category: category, sector: estimate.business.sector, level: 1,
                    profit: estimate.profit, employees: estimate.employees, value: estimate.cost,
                    monthlyExpenses: Math.floor(estimate.profit * 0.3), founded: new Date().getFullYear(),
                    shares: 1000000, publicShares: 0, isPublic: false,
                    production: estimate.production, product: estimate.business.product, employeeBonus: estimate.employeeBonus
                };

                gameState.roleData.businesses.push(newBusiness);
                
                // ê³µê¸‰ë§ì— ì‚¬ì—…ì²´ ì¶”ê°€
                if (category === 'rawMaterials') {
                    gameState.roleData.supplyChain.rawMaterials.push(newBusiness);
                } else if (category === 'manufacturers') {
                    gameState.roleData.supplyChain.manufacturers.push(newBusiness);
                } else if (category === 'distributors') {
                    gameState.roleData.supplyChain.distributors.push(newBusiness);
                } else if (category === 'retailers') {
                    gameState.roleData.supplyChain.retailers.push(newBusiness);
                }
                
                updateBusinessDisplay();
                updateDisplay();
                showNotification(`ğŸ‰ ${estimate.business.name} ì„¤ë¦½ ì„±ê³µ! ì§ì› ${estimate.employees}ëª…ìœ¼ë¡œ ì‹œì‘í•©ë‹ˆë‹¤!`, 'success');
            } else {
                const recoveredAmount = Math.floor(estimate.cost * 0.4);
                gameState.currentUser.game_balance += recoveredAmount;
                updateDisplay();
                showNotification(`âŒ ${estimate.business.name} ì„¤ë¦½ ì‹¤íŒ¨... ${recoveredAmount.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§ë§Œ íšŒìˆ˜í–ˆìŠµë‹ˆë‹¤.`, 'error');
            }
        }

        // ì‹œì¥ ê°€ê²© í‘œì‹œ
        function showMarketPrices() {
            const marketPrices = gameState.roleData.supplyChain.marketPrices;
            let priceList = '';
            
            marketPrices.forEach((data, product) => {
                const trend = data.demand > data.supply ? 'ğŸ“ˆ' : data.demand < data.supply ? 'ğŸ“‰' : 'â¡ï¸';
                const trendColor = data.demand > data.supply ? 'var(--success)' : data.demand < data.supply ? 'var(--danger)' : 'var(--warning)';
                
                priceList += `
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; border-bottom: 1px solid rgba(255,255,255,0.1);">
                        <div><span style="color: #e2e8f0; font-weight: 600;">${product}</span></div>
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <span style="color: var(--success); font-weight: 600;">${data.price.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§</span>
                            <span style="color: ${trendColor};">${trend}</span>
                        </div>
                    </div>
                `;
            });

            const modalContent = `
                <h2 style="text-align: center; margin-bottom: 30px; color: var(--primary);">ğŸ’¹ ì‹œì¥ ê°€ê²© í˜„í™©</h2>
                
                <div style="background: rgba(255,255,255,0.05); border-radius: 12px; padding: 20px; max-height: 60vh; overflow-y: auto;">
                    ${priceList}
                </div>

                <div style="margin-top: 20px; text-align: center;">
                    <button onclick="openCapitalismBusinessModal()" style="
                        padding: 10px 20px; border: 1px solid rgba(255,255,255,0.2);
                        background: rgba(255,255,255,0.05); color: #e2e8f0;
                        border-radius: 8px; cursor: pointer;">ë’¤ë¡œ ê°€ê¸°</button>
                </div>
            `;
            
            showModal(modalContent);
        }

        // ê¸°ì¡´ ì‚¬ì—… ìƒì„± ë²„íŠ¼ì„ í™•ì¥
        const originalCreateNewBusiness = createNewBusiness;
        function createNewBusiness() {
            const modalContent = `
                <h2 style="text-align: center; margin-bottom: 30px; color: var(--primary);">ğŸª ì‚¬ì—… ìœ í˜• ì„ íƒ</h2>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px;">
                    <div onclick="openBusinessSelectionModal()" style="
                        padding: 30px; background: linear-gradient(135deg, var(--primary), var(--secondary));
                        border-radius: 12px; cursor: pointer; text-align: center;">
                        <div style="font-size: 2.5rem; margin-bottom: 15px;">ğŸª</div>
                        <h3 style="color: white; margin-bottom: 10px;">ì¼ë°˜ ì‚¬ì—…</h3>
                        <p style="color: rgba(255,255,255,0.8); font-size: 0.9rem;">ì¹´í˜, ITìŠ¤íƒ€íŠ¸ì—…, ìŒì‹ì  ë“±<br>ì „í†µì ì¸ ë¹„ì¦ˆë‹ˆìŠ¤ ëª¨ë¸</p>
                    </div>

                    <div onclick="openCapitalismBusinessModal()" style="
                        padding: 30px; background: linear-gradient(135deg, var(--success), #047857);
                        border-radius: 12px; cursor: pointer; text-align: center;">
                        <div style="font-size: 2.5rem; margin-bottom: 15px;">ğŸ­</div>
                        <h3 style="color: white; margin-bottom: 10px;">ì‚°ì—… ì œêµ­</h3>
                        <p style="color: rgba(255,255,255,0.8); font-size: 0.9rem;">ì›ìì¬ë¶€í„° ì†Œë§¤ê¹Œì§€<br>ì™„ì „í•œ ê³µê¸‰ë§ êµ¬ì¶•</p>
                    </div>
                </div>

                <div style="background: rgba(99, 102, 241, 0.1); border-radius: 12px; padding: 20px;">
                    <h4 style="color: var(--primary); margin-bottom: 10px;">ğŸ’¡ ì‚°ì—… ì œêµ­ ëª¨ë“œë€?</h4>
                    <ul style="color: #cbd5e1; font-size: 0.9rem; margin: 0; padding-left: 20px;">
                        <li>ìºí”¼íƒˆë¦¬ì¦˜2 ìŠ¤íƒ€ì¼ì˜ ë³µí•© ê²½ì œ ì‹œë®¬ë ˆì´ì…˜</li>
                        <li>ë†ì¥â†’ê³µì¥â†’ë„ë§¤â†’ì†Œë§¤ì˜ ì™„ì „í•œ ê°€ì¹˜ì‚¬ìŠ¬ êµ¬ì¶•</li>
                        <li>ê³µê¸‰ê³„ì•½, ì¬ê³ ê´€ë¦¬, ì‹œì¥ ìˆ˜ê¸‰ ë¶„ì„</li>
                        <li>ê·¹í•œì˜ ììœ ë„ë¡œ ê±°ëŒ€í•œ ì‚°ì—… ì œêµ­ì„ ê±´ì„¤</li>
                    </ul>
                </div>
            `;
            
            showModal(modalContent);
        }

        // ìœ í†µì—… í‘œì‹œ
        function showDistributionBusinesses() {
            const businesses = [
                {
                    id: 'wholesale_center',
                    name: 'ë„ë§¤ ìœ í†µì„¼í„°',
                    icon: 'ğŸ¬',
                    products: ['bread', 'clothing', 'furniture'],
                    cost: 75000,
                    monthlyRevenue: 12000,
                    employees: 15,
                    description: 'ì œì¡°ì—…ì²´ì™€ ì†Œë§¤ì ì„ ì—°ê²°í•˜ëŠ” ëŒ€ê·œëª¨ ìœ í†µì„¼í„°',
                    requirements: 'ì œì¡°ì—…ì²´ ê³„ì•½ í•„ìš”, ì°½ê³  1000í‰'
                },
                {
                    id: 'logistics_hub',
                    name: 'ë¬¼ë¥˜ í—ˆë¸Œ',
                    icon: 'ğŸš›',
                    products: ['all_products'],
                    cost: 120000,
                    monthlyRevenue: 18000,
                    employees: 25,
                    description: 'ì „êµ­ ë°°ì†¡ë§ì„ ê°–ì¶˜ ì¢…í•© ë¬¼ë¥˜ì„¼í„°',
                    requirements: 'êµí†µ ìš”ì¶©ì§€ í•„ìš”, ì°¨ëŸ‰ 100ëŒ€'
                },
                {
                    id: 'cold_chain',
                    name: 'ëƒ‰ì¥ ìœ í†µì„¼í„°',
                    icon: 'ğŸ§Š',
                    products: ['milk', 'beef'],
                    cost: 95000,
                    monthlyRevenue: 15000,
                    employees: 18,
                    description: 'ì‹ ì„ ì‹í’ˆ ì „ìš© ëƒ‰ì¥ ìœ í†µ ì‹œì„¤',
                    requirements: 'ëƒ‰ì¥ì„¤ë¹„ í•„ìš”, ë†ì¥ ê³„ì•½'
                },
                {
                    id: 'import_distributor',
                    name: 'ìˆ˜ì… ì´íŒ',
                    icon: 'ğŸŒ',
                    products: ['luxury_goods', 'electronics'],
                    cost: 150000,
                    monthlyRevenue: 22000,
                    employees: 20,
                    description: 'í•´ì™¸ ë¸Œëœë“œ ë…ì  ìˆ˜ì… ìœ í†µì—…',
                    requirements: 'ìˆ˜ì… ë¼ì´ì„ ìŠ¤ í•„ìš”'
                }
            ];

            showBusinessTypeSelection(businesses, 'distributors', 'ìœ í†µì—…');
        }

        // ì†Œë§¤ì—… í‘œì‹œ
        function showRetailBusinesses() {
            const businesses = [
                {
                    id: 'department_store',
                    name: 'ë°±í™”ì ',
                    icon: 'ğŸ¬',
                    products: ['clothing', 'furniture', 'luxury_goods'],
                    cost: 200000,
                    monthlyRevenue: 35000,
                    employees: 50,
                    description: 'ê³ ê¸‰ ë¸Œëœë“œ ìœ„ì£¼ì˜ ëŒ€í˜• ë°±í™”ì ',
                    requirements: 'ìƒê¶Œ ì…ì§€ í•„ìš”, ë¸Œëœë“œ ê³„ì•½'
                },
                {
                    id: 'supermarket',
                    name: 'ëŒ€í˜•ë§ˆíŠ¸',
                    icon: 'ğŸ›’',
                    products: ['bread', 'milk', 'beef', 'processed_foods'],
                    cost: 180000,
                    monthlyRevenue: 28000,
                    employees: 40,
                    description: 'ì¼ìƒ ìƒí•„í’ˆ ìœ„ì£¼ì˜ ëŒ€í˜• í• ì¸ë§ˆíŠ¸',
                    requirements: 'ëŒ€ê·œëª¨ ë§¤ì¥ ë¶€ì§€ í•„ìš”'
                },
                {
                    id: 'convenience_store',
                    name: 'í¸ì˜ì  ì²´ì¸',
                    icon: 'ğŸª',
                    products: ['processed_foods', 'beverages'],
                    cost: 80000,
                    monthlyRevenue: 15000,
                    employees: 12,
                    description: '24ì‹œê°„ ìš´ì˜í•˜ëŠ” í¸ì˜ì  í”„ëœì°¨ì´ì¦ˆ',
                    requirements: 'ìœ ë™ì¸êµ¬ ë§ì€ ì§€ì—­ í•„ìš”'
                },
                {
                    id: 'specialty_store',
                    name: 'ì „ë¬¸ íŒë§¤ì ',
                    icon: 'ğŸ¯',
                    products: ['electronics', 'luxury_goods'],
                    cost: 120000,
                    monthlyRevenue: 20000,
                    employees: 15,
                    description: 'íŠ¹ì • ë¸Œëœë“œë‚˜ ì¹´í…Œê³ ë¦¬ ì „ë¬¸ ë§¤ì¥',
                    requirements: 'ë¸Œëœë“œ ëŒ€ë¦¬ì  ê³„ì•½ í•„ìš”'
                },
                {
                    id: 'online_mall',
                    name: 'ì˜¨ë¼ì¸ ì‡¼í•‘ëª°',
                    icon: 'ğŸ’»',
                    products: ['all_products'],
                    cost: 60000,
                    monthlyRevenue: 18000,
                    employees: 8,
                    description: 'ì¸í„°ë„· ê¸°ë°˜ ì¢…í•© ì‡¼í•‘ëª°',
                    requirements: 'IT ì¸í”„ë¼, ë¬¼ë¥˜ì„¼í„° ì—°ê³„'
                },
                {
                    id: 'franchise_dealer',
                    name: 'ê°€ë§¹ì  ë³¸ë¶€',
                    icon: 'ğŸ¢',
                    products: ['franchise_rights'],
                    cost: 250000,
                    monthlyRevenue: 45000,
                    employees: 30,
                    description: 'í”„ëœì°¨ì´ì¦ˆ ê°€ë§¹ì ì„ ìš´ì˜í•˜ëŠ” ë³¸ë¶€',
                    requirements: 'ë¸Œëœë“œ ê°œë°œ, ê°€ë§¹ì  ê´€ë¦¬ ì‹œìŠ¤í…œ'
                }
            ];

            showBusinessTypeSelection(businesses, 'retailers', 'ì†Œë§¤ì—…');
        }

        // ê³µê¸‰ë§ í˜„í™© í‘œì‹œ
        function showSupplyChainOverview() {
            const supplyChain = gameState.roleData.supplyChain;
            
            const modalContent = `
                <h2 style="text-align: center; margin-bottom: 30px; color: var(--primary);">ğŸ”— ê³µê¸‰ë§ í˜„í™©</h2>
                
                <!-- ê³µê¸‰ë§ ë‹¨ê³„ë³„ í˜„í™© -->
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 15px; margin-bottom: 30px;">
                    <div style="background: rgba(34, 197, 94, 0.1); border: 1px solid rgba(34, 197, 94, 0.3); border-radius: 12px; padding: 15px; text-align: center;">
                        <h3 style="color: var(--success); margin: 0 0 10px 0; font-size: 0.9rem;">ğŸŒ¾ ì›ìì¬</h3>
                        <div style="font-size: 1.5rem; font-weight: bold; color: #e2e8f0;">${supplyChain.rawMaterials.length}</div>
                        <div style="font-size: 0.8rem; color: #94a3b8;">ê°œ ì‚¬ì—…ì²´</div>
                    </div>
                    
                    <div style="background: rgba(59, 130, 246, 0.1); border: 1px solid rgba(59, 130, 246, 0.3); border-radius: 12px; padding: 15px; text-align: center;">
                        <h3 style="color: var(--primary); margin: 0 0 10px 0; font-size: 0.9rem;">ğŸ­ ì œì¡°ì—…</h3>
                        <div style="font-size: 1.5rem; font-weight: bold; color: #e2e8f0;">${supplyChain.manufacturers.length}</div>
                        <div style="font-size: 0.8rem; color: #94a3b8;">ê°œ ì‚¬ì—…ì²´</div>
                    </div>
                    
                    <div style="background: rgba(16, 185, 129, 0.1); border: 1px solid rgba(16, 185, 129, 0.3); border-radius: 12px; padding: 15px; text-align: center;">
                        <h3 style="color: #10b981; margin: 0 0 10px 0; font-size: 0.9rem;">ğŸš› ìœ í†µì—…</h3>
                        <div style="font-size: 1.5rem; font-weight: bold; color: #e2e8f0;">${supplyChain.distributors.length}</div>
                        <div style="font-size: 0.8rem; color: #94a3b8;">ê°œ ì‚¬ì—…ì²´</div>
                    </div>
                    
                    <div style="background: rgba(139, 92, 246, 0.1); border: 1px solid rgba(139, 92, 246, 0.3); border-radius: 12px; padding: 15px; text-align: center;">
                        <h3 style="color: #8b5cf6; margin: 0 0 10px 0; font-size: 0.9rem;">ğŸª ì†Œë§¤ì—…</h3>
                        <div style="font-size: 1.5rem; font-weight: bold; color: #e2e8f0;">${supplyChain.retailers.length}</div>
                        <div style="font-size: 0.8rem; color: #94a3b8;">ê°œ ì‚¬ì—…ì²´</div>
                    </div>
                </div>

                <!-- ì‹œì¥ ê°€ê²© í˜„í™© -->
                <div style="margin-bottom: 30px;">
                    <h3 style="color: var(--warning); margin-bottom: 15px;">ğŸ“Š ì‹œì¥ ê°€ê²© í˜„í™©</h3>
                    <div style="max-height: 200px; overflow-y: auto; background: rgba(255,255,255,0.02); border-radius: 10px; padding: 10px;">
                        ${Array.from(supplyChain.marketPrices.entries()).map(([product, data]) => {
                            const trend = data.demand > data.supply ? 'ğŸ“ˆ' : data.demand < data.supply ? 'ğŸ“‰' : 'â¡ï¸';
                            const trendColor = data.demand > data.supply ? 'var(--success)' : data.demand < data.supply ? 'var(--danger)' : 'var(--warning)';
                            return `
                                <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px 0; border-bottom: 1px solid rgba(255,255,255,0.05);">
                                    <span style="color: #e2e8f0;">${getProductKoreanName(product)}</span>
                                    <div style="display: flex; align-items: center; gap: 10px;">
                                        <span style="color: var(--warning); font-weight: bold;">${data.price.toLocaleString()}ë¹„íŠ¸í¬ë ˆë”§</span>
                                        <span style="color: ${trendColor}; font-size: 1.2rem;">${trend}</span>
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                </div>

                <!-- ê³µê¸‰ë§ ê´€ë¦¬ ë©”ë‰´ -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                    <button onclick="showSupplyChainContracts()" style="
                        padding: 15px;
                        background: var(--primary);
                        color: white;
                        border: none;
                        border-radius: 10px;
                        cursor: pointer;
                        font-size: 0.9rem;
                        font-weight: 600;
                    ">ğŸ“ ê³µê¸‰ ê³„ì•½ ê´€ë¦¬</button>
                    
                    <button onclick="showInventoryManagement()" style="
                        padding: 15px;
                        background: var(--success);
                        color: white;
                        border: none;
                        border-radius: 10px;
                        cursor: pointer;
                        font-size: 0.9rem;
                        font-weight: 600;
                    ">ğŸ“¦ ì¬ê³  ê´€ë¦¬</button>
                </div>

                <div style="text-align: center;">
                    <button onclick="closeModal()" style="
                        padding: 10px 20px;
                        border: 1px solid rgba(255,255,255,0.2);
                        background: rgba(255,255,255,0.05);
                        color: #e2e8f0;
                        border-radius: 8px;
                        cursor: pointer;
                    ">ë‹«ê¸°</button>
                </div>
            `;
            
            showModal(modalContent);
        }

        // ì œí’ˆëª… í•œê¸€ ë³€í™˜
        function getProductKoreanName(product) {
            const names = {
                'wheat': 'ë°€',
                'corn': 'ì˜¥ìˆ˜ìˆ˜', 
                'cotton': 'ëª©í™”',
                'lumber': 'ëª©ì¬',
                'iron_ore': 'ì² ê´‘ì„',
                'coal': 'ì„íƒ„',
                'oil': 'ì›ìœ ',
                'milk': 'ìš°ìœ ',
                'beef': 'ì‡ ê³ ê¸°',
                'bread': 'ë¹µ',
                'textiles': 'ì„¬ìœ ',
                'furniture': 'ê°€êµ¬',
                'steel': 'ê°•ì² '
            };
            return names[product] || product;
        }

        // ê³µê¸‰ ê³„ì•½ ê´€ë¦¬
        function showSupplyChainContracts() {
            const supplyChain = gameState.roleData.supplyChain;
            
            const modalContent = `
                <h2 style="text-align: center; margin-bottom: 30px; color: var(--primary);">ğŸ“ ê³µê¸‰ ê³„ì•½ ê´€ë¦¬</h2>
                
                <!-- í˜„ì¬ ê³„ì•½ í˜„í™© -->
                <div style="margin-bottom: 30px;">
                    <h3 style="color: var(--success); margin-bottom: 15px;">ğŸ“‹ í˜„ì¬ í™œì„± ê³„ì•½ (${supplyChain.contracts.length}ê±´)</h3>
                    <div style="max-height: 250px; overflow-y: auto; background: rgba(255,255,255,0.02); border-radius: 10px; padding: 15px;">
                        ${supplyChain.contracts.length > 0 ? supplyChain.contracts.map(contract => `
                            <div style="background: rgba(255,255,255,0.05); border-radius: 8px; padding: 15px; margin-bottom: 10px;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                                    <span style="color: var(--primary); font-weight: bold;">${getProductKoreanName(contract.product)} ê³µê¸‰ê³„ì•½</span>
                                    <span style="color: var(--warning); font-size: 0.9rem;">${contract.quantity.toLocaleString()}ê°œ/ì›”</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; font-size: 0.9rem; color: #94a3b8;">
                                    <span>ê³µê¸‰ì—…ì²´: ${contract.supplier}</span>
                                    <span>ë‹¨ê°€: ${contract.price.toLocaleString()}ë¹„íŠ¸í¬ë ˆë”§</span>
                                </div>
                                <div style="margin-top: 8px;">
                                    <button onclick="cancelContract('${contract.id}')" style="
                                        padding: 5px 10px; background: var(--danger); color: white;
                                        border: none; border-radius: 5px; cursor: pointer; font-size: 0.8rem;
                                    ">ê³„ì•½ í•´ì§€</button>
                                </div>
                            </div>
                        `).join('') : '<div style="text-align: center; color: #94a3b8; padding: 20px;">í™œì„± ê³„ì•½ì´ ì—†ìŠµë‹ˆë‹¤</div>'}
                    </div>
                </div>

                <!-- ìƒˆ ê³„ì•½ ì²´ê²° -->
                <div style="margin-bottom: 20px;">
                    <h3 style="color: var(--primary); margin-bottom: 15px;">ğŸ¤ ìƒˆ ê³„ì•½ ì²´ê²°</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <button onclick="showAvailableSuppliers()" style="
                            padding: 12px; background: var(--success); color: white;
                            border: none; border-radius: 8px; cursor: pointer; font-weight: 600;
                        ">ì›ìì¬ ê³µê¸‰ì—…ì²´ ì°¾ê¸°</button>
                        
                        <button onclick="showAvailableBuyers()" style="
                            padding: 12px; background: var(--primary); color: white;
                            border: none; border-radius: 8px; cursor: pointer; font-weight: 600;
                        ">ì œí’ˆ íŒë§¤ì²˜ ì°¾ê¸°</button>
                    </div>
                </div>

                <div style="text-align: center;">
                    <button onclick="showSupplyChainOverview()" style="
                        padding: 10px 20px; border: 1px solid rgba(255,255,255,0.2);
                        background: rgba(255,255,255,0.05); color: #e2e8f0;
                        border-radius: 8px; cursor: pointer;
                    ">ê³µê¸‰ë§ í˜„í™©ìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
                </div>
            `;
            
            showModal(modalContent);
        }

        // ì¬ê³  ê´€ë¦¬
        function showInventoryManagement() {
            const supplyChain = gameState.roleData.supplyChain;
            
            const modalContent = `
                <h2 style="text-align: center; margin-bottom: 30px; color: var(--primary);">ğŸ“¦ ì¬ê³  ê´€ë¦¬</h2>
                
                <!-- í˜„ì¬ ì¬ê³  í˜„í™© -->
                <div style="margin-bottom: 30px;">
                    <h3 style="color: var(--success); margin-bottom: 15px;">ğŸ“Š í˜„ì¬ ë³´ìœ  ì¬ê³ </h3>
                    <div style="max-height: 300px; overflow-y: auto; background: rgba(255,255,255,0.02); border-radius: 10px; padding: 15px;">
                        ${supplyChain.inventory.size > 0 ? Array.from(supplyChain.inventory.entries()).map(([product, quantity]) => {
                            const marketPrice = supplyChain.marketPrices.get(product);
                            const totalValue = marketPrice ? quantity * marketPrice.price : 0;
                            return `
                                <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: rgba(255,255,255,0.05); border-radius: 8px; margin-bottom: 10px;">
                                    <div>
                                        <div style="color: var(--primary); font-weight: bold;">${getProductKoreanName(product)}</div>
                                        <div style="color: #94a3b8; font-size: 0.9rem;">ë‹¨ê°€: ${marketPrice ? marketPrice.price.toLocaleString() : 'ì •ë³´ì—†ìŒ'}ë¹„íŠ¸í¬ë ˆë”§</div>
                                    </div>
                                    <div style="text-align: right;">
                                        <div style="color: #e2e8f0; font-weight: bold;">${quantity.toLocaleString()}ê°œ</div>
                                        <div style="color: var(--warning); font-size: 0.9rem;">ì´ ${totalValue.toLocaleString()}ë¹„íŠ¸í¬ë ˆë”§</div>
                                    </div>
                                </div>
                            `;
                        }).join('') : '<div style="text-align: center; color: #94a3b8; padding: 20px;">ë³´ìœ  ì¬ê³ ê°€ ì—†ìŠµë‹ˆë‹¤</div>'}
                    </div>
                </div>

                <!-- ì¬ê³  ê´€ë¦¬ ì˜µì…˜ -->
                <div style="margin-bottom: 20px;">
                    <h3 style="color: var(--warning); margin-bottom: 15px;">âš™ï¸ ì¬ê³  ê´€ë¦¬ ì˜µì…˜</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <button onclick="showInventoryPurchase()" style="
                            padding: 12px; background: var(--success); color: white;
                            border: none; border-radius: 8px; cursor: pointer; font-weight: 600;
                        ">ğŸ“¥ ì¬ê³  êµ¬ë§¤</button>
                        
                        <button onclick="showInventorySale()" style="
                            padding: 12px; background: var(--primary); color: white;
                            border: none; border-radius: 8px; cursor: pointer; font-weight: 600;
                        ">ğŸ“¤ ì¬ê³  íŒë§¤</button>
                    </div>
                </div>

                <div style="text-align: center;">
                    <button onclick="showSupplyChainOverview()" style="
                        padding: 10px 20px; border: 1px solid rgba(255,255,255,0.2);
                        background: rgba(255,255,255,0.05); color: #e2e8f0;
                        border-radius: 8px; cursor: pointer;
                    ">ê³µê¸‰ë§ í˜„í™©ìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
                </div>
            `;
            
            showModal(modalContent);
        }

        // ì„ì‹œ í•¨ìˆ˜ë“¤ (êµ¬í˜„ ì˜ˆì •)
        function cancelContract(contractId) {
            showNotification('ê³„ì•½ í•´ì§€ ê¸°ëŠ¥ì€ êµ¬í˜„ ì¤‘ì…ë‹ˆë‹¤!', 'warning');
        }

        function showAvailableSuppliers() {
            showNotification('ê³µê¸‰ì—…ì²´ ì°¾ê¸° ê¸°ëŠ¥ì€ êµ¬í˜„ ì¤‘ì…ë‹ˆë‹¤!', 'warning');
        }

        function showAvailableBuyers() {
            showNotification('íŒë§¤ì²˜ ì°¾ê¸° ê¸°ëŠ¥ì€ êµ¬í˜„ ì¤‘ì…ë‹ˆë‹¤!', 'warning');
        }

        function showInventoryPurchase() {
            showNotification('ì¬ê³  êµ¬ë§¤ ê¸°ëŠ¥ì€ êµ¬í˜„ ì¤‘ì…ë‹ˆë‹¤!', 'warning');
        }

        function showInventorySale() {
            showNotification('ì¬ê³  íŒë§¤ ê¸°ëŠ¥ì€ êµ¬í˜„ ì¤‘ì…ë‹ˆë‹¤!', 'warning');
        }

        // ===== ë…¸ë™ì ê´€ë¦¬ ì‹œìŠ¤í…œ =====

        // ë…¸ë™ì ìƒì„±
        function createWorker(businessId, type = 'regular') {
            const names = ['ê¹€ë¯¼ìˆ˜', 'ì´ì˜í¬', 'ë°•ì² ìˆ˜', 'ìµœìˆ˜ì§„', 'ì •í˜„ìš°', 'ê°•ì§€ì€', 'ì¡°ì„±ë¯¼', 'ìœ¤ì†Œì˜', 'ì„ëŒ€í˜„', 'í•œë¯¸ë˜'];
            const skills = ['production', 'quality', 'leadership', 'creativity'];
            
            const worker = {
                id: Date.now() + Math.random(),
                name: names[Math.floor(Math.random() * names.length)],
                age: 22 + Math.floor(Math.random() * 38), // 22-60ì„¸
                businessId: businessId,
                position: type === 'regular' ? 'ì‚¬ì›' : type === 'manager' ? 'íŒ€ì¥' : 'ë¶€ì¥',
                experience: Math.floor(Math.random() * 10), // 0-10ë…„ ê²½ë ¥
                skills: {
                    production: 30 + Math.floor(Math.random() * 70), // 30-100
                    quality: 30 + Math.floor(Math.random() * 70),
                    leadership: 20 + Math.floor(Math.random() * 60),
                    creativity: 20 + Math.floor(Math.random() * 60)
                },
                salary: calculateBaseSalary(type),
                satisfaction: 70 + Math.floor(Math.random() * 30), // 70-100%
                performance: 50 + Math.floor(Math.random() * 50), // 50-100%
                hireDate: new Date(),
                contracts: {
                    salaryBonus: 0,
                    benefits: ['ê¸°ë³¸ì˜ë£Œë³´í—˜'],
                    vacationDays: 15
                },
                training: {
                    inProgress: null,
                    completed: [],
                    nextAvailable: new Date()
                },
                status: 'active' // active, training, sick, strike
            };
            
            return worker;
        }

        // ê¸°ë³¸ ê¸‰ì—¬ ê³„ì‚°
        function calculateBaseSalary(position) {
            const baseSalaries = {
                'ì‚¬ì›': 3000 + Math.floor(Math.random() * 1000),
                'íŒ€ì¥': 5000 + Math.floor(Math.random() * 2000), 
                'ë¶€ì¥': 8000 + Math.floor(Math.random() * 3000),
                'ì„ì›': 12000 + Math.floor(Math.random() * 5000)
            };
            return baseSalaries[position] || 3000;
        }

        // ë…¸ë™ì ê´€ë¦¬ ë©”ì¸ í™”ë©´
        function showWorkforceManagement() {
            const workforce = gameState.roleData.workforce;
            
            const modalContent = `
                <h2 style="text-align: center; margin-bottom: 30px; color: var(--primary);">ğŸ‘¥ ë…¸ë™ì ê´€ë¦¬</h2>
                
                <!-- ë…¸ë™ì í˜„í™© ìš”ì•½ -->
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 15px; margin-bottom: 30px;">
                    <div style="background: rgba(34, 197, 94, 0.1); border: 1px solid rgba(34, 197, 94, 0.3); border-radius: 12px; padding: 15px; text-align: center;">
                        <h3 style="color: var(--success); margin: 0 0 10px 0; font-size: 0.9rem;">ğŸ‘¤ ì „ì²´ ì§ì›</h3>
                        <div style="font-size: 1.5rem; font-weight: bold; color: #e2e8f0;">${workforce.workers.length}</div>
                        <div style="font-size: 0.8rem; color: #94a3b8;">ëª…</div>
                    </div>
                    
                    <div style="background: rgba(59, 130, 246, 0.1); border: 1px solid rgba(59, 130, 246, 0.3); border-radius: 12px; padding: 15px; text-align: center;">
                        <h3 style="color: var(--primary); margin: 0 0 10px 0; font-size: 0.9rem;">ğŸ’¼ ê´€ë¦¬ì§</h3>
                        <div style="font-size: 1.5rem; font-weight: bold; color: #e2e8f0;">${workforce.workers.filter(w => ['íŒ€ì¥', 'ë¶€ì¥', 'ì„ì›'].includes(w.position)).length}</div>
                        <div style="font-size: 0.8rem; color: #94a3b8;">ëª…</div>
                    </div>
                    
                    <div style="background: rgba(245, 158, 11, 0.1); border: 1px solid rgba(245, 158, 11, 0.3); border-radius: 12px; padding: 15px; text-align: center;">
                        <h3 style="color: var(--warning); margin: 0 0 10px 0; font-size: 0.9rem;">ğŸ˜Š í‰ê·  ë§Œì¡±ë„</h3>
                        <div style="font-size: 1.5rem; font-weight: bold; color: #e2e8f0;">${workforce.workers.length > 0 ? Math.round(workforce.workers.reduce((a, w) => a + w.satisfaction, 0) / workforce.workers.length) : 0}</div>
                        <div style="font-size: 0.8rem; color: #94a3b8;">%</div>
                    </div>
                    
                    <div style="background: rgba(168, 85, 247, 0.1); border: 1px solid rgba(168, 85, 247, 0.3); border-radius: 12px; padding: 15px; text-align: center;">
                        <h3 style="color: #a855f7; margin: 0 0 10px 0; font-size: 0.9rem;">ğŸ“š êµìœ¡ì¤‘</h3>
                        <div style="font-size: 1.5rem; font-weight: bold; color: #e2e8f0;">${workforce.workers.filter(w => w.status === 'training').length}</div>
                        <div style="font-size: 0.8rem; color: #94a3b8;">ëª…</div>
                    </div>
                </div>

                <!-- ë…¸ë™ì ê´€ë¦¬ ë©”ë‰´ -->
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-bottom: 30px;">
                    <button onclick="showWorkerList()" style="
                        padding: 15px; background: var(--primary); color: white;
                        border: none; border-radius: 10px; cursor: pointer;
                        font-size: 0.9rem; font-weight: 600;
                    ">ğŸ‘¥ ì§ì› ëª…ë‹¨</button>
                    
                    <button onclick="showRecruitment()" style="
                        padding: 15px; background: var(--success); color: white;
                        border: none; border-radius: 10px; cursor: pointer;
                        font-size: 0.9rem; font-weight: 600;
                    ">ğŸ” ì±„ìš©í•˜ê¸°</button>
                    
                    <button onclick="showTrainingPrograms()" style="
                        padding: 15px; background: var(--warning); color: white;
                        border: none; border-radius: 10px; cursor: pointer;
                        font-size: 0.9rem; font-weight: 600;
                    ">ğŸ“š êµìœ¡ì„¼í„°</button>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                    <button onclick="showWorkerSatisfaction()" style="
                        padding: 15px; background: #8b5cf6; color: white;
                        border: none; border-radius: 10px; cursor: pointer;
                        font-size: 0.9rem; font-weight: 600;
                    ">ğŸ˜Š ë§Œì¡±ë„ ê´€ë¦¬</button>
                    
                    <button onclick="showUnionManagement()" style="
                        padding: 15px; background: var(--danger); color: white;
                        border: none; border-radius: 10px; cursor: pointer;
                        font-size: 0.9rem; font-weight: 600;
                    ">âœŠ ë…¸ì¡° ê´€ë¦¬</button>
                </div>

                <div style="text-align: center;">
                    <button onclick="closeModal()" style="
                        padding: 10px 20px; border: 1px solid rgba(255,255,255,0.2);
                        background: rgba(255,255,255,0.05); color: #e2e8f0;
                        border-radius: 8px; cursor: pointer;
                    ">ë‹«ê¸°</button>
                </div>
            `;
            
            showModal(modalContent);
        }

        // ì§ì› ëª…ë‹¨ ë³´ê¸°
        function showWorkerList() {
            const workforce = gameState.roleData.workforce;
            const businesses = gameState.roleData.businesses;
            
            const modalContent = `
                <h2 style="text-align: center; margin-bottom: 30px; color: var(--primary);">ğŸ‘¥ ì§ì› ëª…ë‹¨</h2>
                
                <div style="max-height: 400px; overflow-y: auto;">
                    ${workforce.workers.length > 0 ? workforce.workers.map(worker => {
                        const business = businesses.find(b => b.id === worker.businessId);
                        const skillAvg = Math.round((worker.skills.production + worker.skills.quality + worker.skills.leadership + worker.skills.creativity) / 4);
                        return `
                            <div style="background: rgba(255,255,255,0.05); border-radius: 10px; padding: 15px; margin-bottom: 15px;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                    <div>
                                        <h3 style="color: var(--primary); margin: 0;">${worker.name} (${worker.age}ì„¸)</h3>
                                        <div style="color: #94a3b8; font-size: 0.9rem;">${worker.position} â€¢ ${business ? business.name : 'ë¯¸ë°°ì •'}</div>
                                    </div>
                                    <div style="text-align: right;">
                                        <div style="color: var(--success); font-weight: bold;">${worker.salary.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§/ì›”</div>
                                        <div style="color: #94a3b8; font-size: 0.9rem;">ê²½ë ¥ ${worker.experience}ë…„</div>
                                    </div>
                                </div>
                                
                                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-bottom: 10px; font-size: 0.8rem;">
                                    <div style="background: rgba(34, 197, 94, 0.2); padding: 5px; border-radius: 5px; text-align: center;">
                                        <div>í‰ê·  ìŠ¤í‚¬</div>
                                        <div style="font-weight: bold; color: var(--success);">${skillAvg}ì </div>
                                    </div>
                                    <div style="background: rgba(245, 158, 11, 0.2); padding: 5px; border-radius: 5px; text-align: center;">
                                        <div>ë§Œì¡±ë„</div>
                                        <div style="font-weight: bold; color: var(--warning);">${worker.satisfaction}%</div>
                                    </div>
                                    <div style="background: rgba(59, 130, 246, 0.2); padding: 5px; border-radius: 5px; text-align: center;">
                                        <div>ì„±ê³¼</div>
                                        <div style="font-weight: bold; color: var(--primary);">${worker.performance}%</div>
                                    </div>
                                </div>
                                
                                <div style="display: flex; gap: 10px;">
                                    <button onclick="showWorkerDetails('${worker.id}')" style="
                                        padding: 5px 10px; background: var(--primary); color: white;
                                        border: none; border-radius: 5px; cursor: pointer; font-size: 0.8rem;
                                    ">ìƒì„¸ì •ë³´</button>
                                    
                                    <button onclick="promoteWorker('${worker.id}')" style="
                                        padding: 5px 10px; background: var(--success); color: white;
                                        border: none; border-radius: 5px; cursor: pointer; font-size: 0.8rem;
                                    ">ìŠ¹ì§„</button>
                                    
                                    <button onclick="fireWorker('${worker.id}')" style="
                                        padding: 5px 10px; background: var(--danger); color: white;
                                        border: none; border-radius: 5px; cursor: pointer; font-size: 0.8rem;
                                    ">í•´ê³ </button>
                                </div>
                            </div>
                        `;
                    }).join('') : '<div style="text-align: center; color: #94a3b8; padding: 40px;">ì§ì›ì´ ì—†ìŠµë‹ˆë‹¤</div>'}
                </div>

                <div style="text-align: center; margin-top: 20px;">
                    <button onclick="showWorkforceManagement()" style="
                        padding: 10px 20px; border: 1px solid rgba(255,255,255,0.2);
                        background: rgba(255,255,255,0.05); color: #e2e8f0;
                        border-radius: 8px; cursor: pointer;
                    ">ëŒì•„ê°€ê¸°</button>
                </div>
            `;
            
            showModal(modalContent);
        }

        // ì±„ìš© ì‹œì¥
        function showRecruitment() {
            // êµ¬ì¸ ì‹œì¥ì— í›„ë³´ì ìƒì„± (ì—†ìœ¼ë©´)
            if (gameState.roleData.workforce.jobMarket.length === 0) {
                for (let i = 0; i < 8; i++) {
                    gameState.roleData.workforce.jobMarket.push(createJobSeeker());
                }
            }
            
            const jobMarket = gameState.roleData.workforce.jobMarket;
            
            const modalContent = `
                <h2 style="text-align: center; margin-bottom: 30px; color: var(--primary);">ğŸ” ì¸ì¬ ì±„ìš©</h2>
                
                <div style="margin-bottom: 20px; text-align: center;">
                    <button onclick="refreshJobMarket()" style="
                        padding: 10px 20px; background: var(--success); color: white;
                        border: none; border-radius: 8px; cursor: pointer; font-weight: 600;
                    ">ğŸ”„ ìƒˆë¡œìš´ ì¸ì¬ ì°¾ê¸° (1000 ë¹„íŠ¸í¬ë ˆë”§)</button>
                </div>
                
                <div style="max-height: 400px; overflow-y: auto;">
                    ${jobMarket.map(candidate => {
                        const skillAvg = Math.round((candidate.skills.production + candidate.skills.quality + candidate.skills.leadership + candidate.skills.creativity) / 4);
                        const hireCost = candidate.expectedSalary + (candidate.experience * 500);
                        return `
                            <div style="background: rgba(255,255,255,0.05); border-radius: 10px; padding: 15px; margin-bottom: 15px;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                    <div>
                                        <h3 style="color: var(--primary); margin: 0;">${candidate.name} (${candidate.age}ì„¸)</h3>
                                        <div style="color: #94a3b8; font-size: 0.9rem;">${candidate.previousJob} â€¢ ê²½ë ¥ ${candidate.experience}ë…„</div>
                                    </div>
                                    <div style="text-align: right;">
                                        <div style="color: var(--warning); font-weight: bold;">í¬ë§ ê¸‰ì—¬: ${candidate.expectedSalary.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§</div>
                                        <div style="color: #94a3b8; font-size: 0.9rem;">ì±„ìš©ë¹„: ${hireCost.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§</div>
                                    </div>
                                </div>
                                
                                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 8px; margin-bottom: 10px; font-size: 0.8rem;">
                                    <div style="background: rgba(34, 197, 94, 0.2); padding: 5px; border-radius: 5px; text-align: center;">
                                        <div>ìƒì‚°</div>
                                        <div style="font-weight: bold;">${candidate.skills.production}</div>
                                    </div>
                                    <div style="background: rgba(245, 158, 11, 0.2); padding: 5px; border-radius: 5px; text-align: center;">
                                        <div>í’ˆì§ˆ</div>
                                        <div style="font-weight: bold;">${candidate.skills.quality}</div>
                                    </div>
                                    <div style="background: rgba(168, 85, 247, 0.2); padding: 5px; border-radius: 5px; text-align: center;">
                                        <div>ë¦¬ë”ì‹­</div>
                                        <div style="font-weight: bold;">${candidate.skills.leadership}</div>
                                    </div>
                                    <div style="background: rgba(59, 130, 246, 0.2); padding: 5px; border-radius: 5px; text-align: center;">
                                        <div>ì°½ì˜ì„±</div>
                                        <div style="font-weight: bold;">${candidate.skills.creativity}</div>
                                    </div>
                                </div>
                                
                                <div style="text-align: center;">
                                    <button onclick="hireCandidate('${candidate.id}')" style="
                                        padding: 8px 16px; background: var(--success); color: white;
                                        border: none; border-radius: 5px; cursor: pointer; font-weight: 600;
                                    ">ì±„ìš©í•˜ê¸°</button>
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>

                <div style="text-align: center; margin-top: 20px;">
                    <button onclick="showWorkforceManagement()" style="
                        padding: 10px 20px; border: 1px solid rgba(255,255,255,0.2);
                        background: rgba(255,255,255,0.05); color: #e2e8f0;
                        border-radius: 8px; cursor: pointer;
                    ">ëŒì•„ê°€ê¸°</button>
                </div>
            `;
            
            showModal(modalContent);
        }

        // êµ¬ì§ì ìƒì„±
        function createJobSeeker() {
            const names = ['ê¹€ì˜ìˆ˜', 'ì´ë¯¸ì˜', 'ë°•í˜„ì¤€', 'ìµœì§€í˜œ', 'ì •íƒœìœ¤', 'ê°•ìˆ˜ë¯¼', 'ì¡°í•´ë¦¼', 'ìœ¤ì§€ì›', 'ì„ì„±í˜¸', 'í•œì˜ˆì§„'];
            const jobs = ['ìƒì‚°ì§', 'í’ˆì§ˆê´€ë¦¬', 'ì˜ì—…ì§', 'ê¸°ìˆ ì§', 'ê´€ë¦¬ì§', 'ì—°êµ¬ê°œë°œ', 'ë§ˆì¼€íŒ…', 'ì¬ë¬´íšŒê³„'];
            
            return {
                id: Date.now() + Math.random(),
                name: names[Math.floor(Math.random() * names.length)],
                age: 22 + Math.floor(Math.random() * 35),
                experience: Math.floor(Math.random() * 15),
                previousJob: jobs[Math.floor(Math.random() * jobs.length)],
                skills: {
                    production: 40 + Math.floor(Math.random() * 60),
                    quality: 40 + Math.floor(Math.random() * 60),
                    leadership: 30 + Math.floor(Math.random() * 50),
                    creativity: 30 + Math.floor(Math.random() * 50)
                },
                expectedSalary: 3000 + Math.floor(Math.random() * 5000),
                availability: new Date()
            };
        }

        // êµìœ¡ í”„ë¡œê·¸ë¨
        function showTrainingPrograms() {
            const modalContent = `
                <h2 style="text-align: center; margin-bottom: 30px; color: var(--primary);">ğŸ“š êµìœ¡ì„¼í„°</h2>
                
                <div style="display: grid; gap: 15px; max-height: 400px; overflow-y: auto;">
                    <div style="background: rgba(34, 197, 94, 0.1); border: 1px solid rgba(34, 197, 94, 0.3); border-radius: 10px; padding: 15px;">
                        <h3 style="color: var(--success); margin: 0 0 10px 0;">ğŸ­ ìƒì‚°ì„± í–¥ìƒ êµìœ¡</h3>
                        <p style="color: #94a3b8; margin: 0 0 10px 0; font-size: 0.9rem;">ìƒì‚° ìŠ¤í‚¬ì„ 10-20ì  í–¥ìƒì‹œí‚µë‹ˆë‹¤</p>
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <span style="color: var(--danger);">ë¹„ìš©: 5000 ë¹„íŠ¸í¬ë ˆë”§</span> â€¢ 
                                <span style="color: #94a3b8;">ê¸°ê°„: 2ì£¼</span>
                            </div>
                            <button onclick="startTraining('production')" style="
                                padding: 8px 16px; background: var(--success); color: white;
                                border: none; border-radius: 5px; cursor: pointer;
                            ">êµìœ¡ ì‹œì‘</button>
                        </div>
                    </div>

                    <div style="background: rgba(245, 158, 11, 0.1); border: 1px solid rgba(245, 158, 11, 0.3); border-radius: 10px; padding: 15px;">
                        <h3 style="color: var(--warning); margin: 0 0 10px 0;">â­ í’ˆì§ˆê´€ë¦¬ êµìœ¡</h3>
                        <p style="color: #94a3b8; margin: 0 0 10px 0; font-size: 0.9rem;">í’ˆì§ˆ ìŠ¤í‚¬ì„ 10-20ì  í–¥ìƒì‹œí‚µë‹ˆë‹¤</p>
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <span style="color: var(--danger);">ë¹„ìš©: 6000 ë¹„íŠ¸í¬ë ˆë”§</span> â€¢ 
                                <span style="color: #94a3b8;">ê¸°ê°„: 3ì£¼</span>
                            </div>
                            <button onclick="startTraining('quality')" style="
                                padding: 8px 16px; background: var(--warning); color: white;
                                border: none; border-radius: 5px; cursor: pointer;
                            ">êµìœ¡ ì‹œì‘</button>
                        </div>
                    </div>

                    <div style="background: rgba(168, 85, 247, 0.1); border: 1px solid rgba(168, 85, 247, 0.3); border-radius: 10px; padding: 15px;">
                        <h3 style="color: #a855f7; margin: 0 0 10px 0;">ğŸ‘‘ ë¦¬ë”ì‹­ êµìœ¡</h3>
                        <p style="color: #94a3b8; margin: 0 0 10px 0; font-size: 0.9rem;">ë¦¬ë”ì‹­ ìŠ¤í‚¬ì„ 15-25ì  í–¥ìƒì‹œí‚µë‹ˆë‹¤</p>
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <span style="color: var(--danger);">ë¹„ìš©: 8000 ë¹„íŠ¸í¬ë ˆë”§</span> â€¢ 
                                <span style="color: #94a3b8;">ê¸°ê°„: 4ì£¼</span>
                            </div>
                            <button onclick="startTraining('leadership')" style="
                                padding: 8px 16px; background: #a855f7; color: white;
                                border: none; border-radius: 5px; cursor: pointer;
                            ">êµìœ¡ ì‹œì‘</button>
                        </div>
                    </div>

                    <div style="background: rgba(59, 130, 246, 0.1); border: 1px solid rgba(59, 130, 246, 0.3); border-radius: 10px; padding: 15px;">
                        <h3 style="color: var(--primary); margin: 0 0 10px 0;">ğŸ’¡ ì°½ì˜ì„± êµìœ¡</h3>
                        <p style="color: #94a3b8; margin: 0 0 10px 0; font-size: 0.9rem;">ì°½ì˜ì„± ìŠ¤í‚¬ì„ 10-20ì  í–¥ìƒì‹œí‚µë‹ˆë‹¤</p>
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <span style="color: var(--danger);">ë¹„ìš©: 7000 ë¹„íŠ¸í¬ë ˆë”§</span> â€¢ 
                                <span style="color: #94a3b8;">ê¸°ê°„: 3ì£¼</span>
                            </div>
                            <button onclick="startTraining('creativity')" style="
                                padding: 8px 16px; background: var(--primary); color: white;
                                border: none; border-radius: 5px; cursor: pointer;
                            ">êµìœ¡ ì‹œì‘</button>
                        </div>
                    </div>
                </div>

                <div style="text-align: center; margin-top: 20px;">
                    <button onclick="showWorkforceManagement()" style="
                        padding: 10px 20px; border: 1px solid rgba(255,255,255,0.2);
                        background: rgba(255,255,255,0.05); color: #e2e8f0;
                        border-radius: 8px; cursor: pointer;
                    ">ëŒì•„ê°€ê¸°</button>
                </div>
            `;
            
            showModal(modalContent);
        }

        // ë§Œì¡±ë„ ê´€ë¦¬
        function showWorkerSatisfaction() {
            const workforce = gameState.roleData.workforce;
            const factors = workforce.satisfactionFactors;
            
            const modalContent = `
                <h2 style="text-align: center; margin-bottom: 30px; color: var(--primary);">ğŸ˜Š ì§ì› ë§Œì¡±ë„ ê´€ë¦¬</h2>
                
                <!-- ë§Œì¡±ë„ ìš”ì†Œë“¤ -->
                <div style="display: grid; gap: 15px; margin-bottom: 30px;">
                    <div style="background: rgba(34, 197, 94, 0.1); border: 1px solid rgba(34, 197, 94, 0.3); border-radius: 10px; padding: 15px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <h3 style="color: var(--success); margin: 0;">ğŸ’° ê¸‰ì—¬ ìˆ˜ì¤€</h3>
                            <span style="color: #e2e8f0; font-weight: bold;">${factors.baseSalary}%</span>
                        </div>
                        <p style="color: #94a3b8; margin: 0 0 10px 0; font-size: 0.9rem;">ì „ì²´ ì§ì›ì˜ ê¸‰ì—¬ë¥¼ 10% ì¸ìƒí•©ë‹ˆë‹¤</p>
                        <button onclick="improveSalaries()" style="
                            padding: 8px 16px; background: var(--success); color: white;
                            border: none; border-radius: 5px; cursor: pointer; width: 100%;
                        ">ê¸‰ì—¬ ì¸ìƒ (${Math.floor(workforce.workers.reduce((sum, w) => sum + w.salary, 0) * 0.1).toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§/ì›” ì¶”ê°€)</button>
                    </div>

                    <div style="background: rgba(245, 158, 11, 0.1); border: 1px solid rgba(245, 158, 11, 0.3); border-radius: 10px; padding: 15px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <h3 style="color: var(--warning); margin: 0;">ğŸ¥ ë³µë¦¬í›„ìƒ</h3>
                            <span style="color: #e2e8f0; font-weight: bold;">${factors.benefits}%</span>
                        </div>
                        <p style="color: #94a3b8; margin: 0 0 10px 0; font-size: 0.9rem;">ì˜ë£Œë³´í—˜, ì‹ë‹¹, í—¬ìŠ¤ì¥ ë“±ì„ ê°œì„ í•©ë‹ˆë‹¤</p>
                        <button onclick="improveBenefits()" style="
                            padding: 8px 16px; background: var(--warning); color: white;
                            border: none; border-radius: 5px; cursor: pointer; width: 100%;
                        ">ë³µë¦¬í›„ìƒ ê°œì„  (50000 ë¹„íŠ¸í¬ë ˆë”§)</button>
                    </div>

                    <div style="background: rgba(59, 130, 246, 0.1); border: 1px solid rgba(59, 130, 246, 0.3); border-radius: 10px; padding: 15px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <h3 style="color: var(--primary); margin: 0;">ğŸ¢ ê·¼ë¬´í™˜ê²½</h3>
                            <span style="color: #e2e8f0; font-weight: bold;">${factors.workEnvironment}%</span>
                        </div>
                        <p style="color: #94a3b8; margin: 0 0 10px 0; font-size: 0.9rem;">ì‚¬ë¬´ì‹¤, ì‘ì—…ì¥, íœ´ê²Œì‹œì„¤ì„ ê°œì„ í•©ë‹ˆë‹¤</p>
                        <button onclick="improveWorkEnvironment()" style="
                            padding: 8px 16px; background: var(--primary); color: white;
                            border: none; border-radius: 5px; cursor: pointer; width: 100%;
                        ">ê·¼ë¬´í™˜ê²½ ê°œì„  (80000 ë¹„íŠ¸í¬ë ˆë”§)</button>
                    </div>

                    <div style="background: rgba(168, 85, 247, 0.1); border: 1px solid rgba(168, 85, 247, 0.3); border-radius: 10px; padding: 15px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <h3 style="color: #a855f7; margin: 0;">ğŸ“ˆ ì„±ì¥ê¸°íšŒ</h3>
                            <span style="color: #e2e8f0; font-weight: bold;">${factors.growthOpportunity}%</span>
                        </div>
                        <p style="color: #94a3b8; margin: 0 0 10px 0; font-size: 0.9rem;">ìŠ¹ì§„ ê¸°íšŒì™€ ê²½ë ¥ ê°œë°œ í”„ë¡œê·¸ë¨ì„ í™•ëŒ€í•©ë‹ˆë‹¤</p>
                        <button onclick="improveGrowthOpportunity()" style="
                            padding: 8px 16px; background: #a855f7; color: white;
                            border: none; border-radius: 5px; cursor: pointer; width: 100%;
                        ">ì„±ì¥ê¸°íšŒ í™•ëŒ€ (60000 ë¹„íŠ¸í¬ë ˆë”§)</button>
                    </div>
                </div>

                <!-- ì „ì²´ ë§Œì¡±ë„ í˜„í™© -->
                <div style="background: rgba(255,255,255,0.05); border-radius: 10px; padding: 15px; margin-bottom: 20px;">
                    <h3 style="color: var(--primary); margin: 0 0 15px 0;">ğŸ“Š ì§ì›ë³„ ë§Œì¡±ë„ í˜„í™©</h3>
                    <div style="max-height: 200px; overflow-y: auto;">
                        ${workforce.workers.length > 0 ? workforce.workers.map(worker => `
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px 0; border-bottom: 1px solid rgba(255,255,255,0.05);">
                                <span style="color: #e2e8f0;">${worker.name}</span>
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    <div style="width: 100px; height: 8px; background: rgba(255,255,255,0.1); border-radius: 4px; overflow: hidden;">
                                        <div style="width: ${worker.satisfaction}%; height: 100%; background: ${worker.satisfaction >= 80 ? 'var(--success)' : worker.satisfaction >= 60 ? 'var(--warning)' : 'var(--danger)'};"></div>
                                    </div>
                                    <span style="color: ${worker.satisfaction >= 80 ? 'var(--success)' : worker.satisfaction >= 60 ? 'var(--warning)' : 'var(--danger)'}; font-weight: bold; min-width: 40px;">${worker.satisfaction}%</span>
                                </div>
                            </div>
                        `).join('') : '<div style="text-align: center; color: #94a3b8;">ì§ì›ì´ ì—†ìŠµë‹ˆë‹¤</div>'}
                    </div>
                </div>

                <div style="text-align: center;">
                    <button onclick="showWorkforceManagement()" style="
                        padding: 10px 20px; border: 1px solid rgba(255,255,255,0.2);
                        background: rgba(255,255,255,0.05); color: #e2e8f0;
                        border-radius: 8px; cursor: pointer;
                    ">ëŒì•„ê°€ê¸°</button>
                </div>
            `;
            
            showModal(modalContent);
        }

        // ë…¸ì¡° ê´€ë¦¬
        function showUnionManagement() {
            const workforce = gameState.roleData.workforce;
            
            const modalContent = `
                <h2 style="text-align: center; margin-bottom: 30px; color: var(--primary);">âœŠ ë…¸ë™ì¡°í•© ê´€ë¦¬</h2>
                
                <!-- ë…¸ì¡° í˜„í™© -->
                <div style="background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.3); border-radius: 10px; padding: 20px; margin-bottom: 30px;">
                    <h3 style="color: var(--danger); margin: 0 0 15px 0;">âš ï¸ ë…¸ì¡° ê²°ì„± ìœ„í—˜ë„</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div>
                            <div style="color: #94a3b8; margin-bottom: 5px;">í‰ê·  ë§Œì¡±ë„:</div>
                            <div style="color: #e2e8f0; font-weight: bold; font-size: 1.2rem;">
                                ${workforce.workers.length > 0 ? Math.round(workforce.workers.reduce((a, w) => a + w.satisfaction, 0) / workforce.workers.length) : 0}%
                            </div>
                        </div>
                        <div>
                            <div style="color: #94a3b8; margin-bottom: 5px;">íŒŒì—… ìœ„í—˜ë„:</div>
                            <div style="color: var(--danger); font-weight: bold; font-size: 1.2rem;">
                                ${calculateStrikeRisk()}%
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ë…¸ì¡° í™œë™ -->
                <div style="display: grid; gap: 15px; margin-bottom: 30px;">
                    <div style="background: rgba(255,255,255,0.05); border-radius: 10px; padding: 15px;">
                        <h3 style="color: var(--warning); margin: 0 0 10px 0;">ğŸ’¬ ë…¸ì‚¬í˜‘ìƒ</h3>
                        <p style="color: #94a3b8; margin: 0 0 15px 0;">ì§ì›ë“¤ê³¼ ì„ê¸ˆ ë° ê·¼ë¡œì¡°ê±´ì— ëŒ€í•´ í˜‘ìƒí•©ë‹ˆë‹¤</p>
                        <button onclick="startNegotiation()" style="
                            padding: 10px 20px; background: var(--warning); color: white;
                            border: none; border-radius: 5px; cursor: pointer; width: 100%;
                        ">í˜‘ìƒ ì‹œì‘</button>
                    </div>

                    <div style="background: rgba(255,255,255,0.05); border-radius: 10px; padding: 15px;">
                        <h3 style="color: var(--danger); margin: 0 0 10px 0;">ğŸš¨ íŒŒì—… ëŒ€ì‘</h3>
                        <p style="color: #94a3b8; margin: 0 0 15px 0;">íŒŒì—…ì´ ë°œìƒí–ˆì„ ë•Œ ëŒ€ì‘ ë°©ì•ˆì„ ì„ íƒí•©ë‹ˆë‹¤</p>
                        <div style="display: flex; gap: 10px;">
                            <button onclick="handleStrike('negotiate')" style="
                                padding: 8px 12px; background: var(--success); color: white;
                                border: none; border-radius: 5px; cursor: pointer; flex: 1;
                            ">í˜‘ìƒ</button>
                            <button onclick="handleStrike('replace')" style="
                                padding: 8px 12px; background: var(--danger); color: white;
                                border: none; border-radius: 5px; cursor: pointer; flex: 1;
                            ">ëŒ€ì²´ì¸ë ¥</button>
                        </div>
                    </div>
                </div>

                <!-- í˜„ì¬ ì§„í–‰ì¤‘ì¸ ë…¸ì‚¬ ì´ìŠˆ -->
                <div style="background: rgba(255,255,255,0.02); border-radius: 10px; padding: 15px; margin-bottom: 20px;">
                    <h3 style="color: var(--primary); margin: 0 0 15px 0;">ğŸ“‹ í˜„ì¬ ë…¸ì‚¬ ì´ìŠˆ</h3>
                    <div style="max-height: 150px; overflow-y: auto;">
                        ${generateLaborIssues().length > 0 ? generateLaborIssues().map(issue => `
                            <div style="padding: 10px; background: rgba(255,255,255,0.05); border-radius: 5px; margin-bottom: 10px;">
                                <div style="color: var(--warning); font-weight: bold;">${issue.title}</div>
                                <div style="color: #94a3b8; font-size: 0.9rem;">${issue.description}</div>
                                <div style="color: var(--danger); font-size: 0.8rem;">ì˜í–¥: ë§Œì¡±ë„ ${issue.impact}% ê°ì†Œ</div>
                            </div>
                        `).join('') : '<div style="text-align: center; color: #94a3b8;">í˜„ì¬ íŠ¹ë³„í•œ ì´ìŠˆê°€ ì—†ìŠµë‹ˆë‹¤</div>'}
                    </div>
                </div>

                <div style="text-align: center;">
                    <button onclick="showWorkforceManagement()" style="
                        padding: 10px 20px; border: 1px solid rgba(255,255,255,0.2);
                        background: rgba(255,255,255,0.05); color: #e2e8f0;
                        border-radius: 8px; cursor: pointer;
                    ">ëŒì•„ê°€ê¸°</button>
                </div>
            `;
            
            showModal(modalContent);
        }

        // íŒŒì—… ìœ„í—˜ë„ ê³„ì‚°
        function calculateStrikeRisk() {
            const workforce = gameState.roleData.workforce;
            if (workforce.workers.length === 0) return 0;
            
            const avgSatisfaction = workforce.workers.reduce((a, w) => a + w.satisfaction, 0) / workforce.workers.length;
            return Math.max(0, Math.min(100, Math.round(100 - avgSatisfaction)));
        }

        // ë…¸ì‚¬ ì´ìŠˆ ìƒì„±
        function generateLaborIssues() {
            const issues = [
                { title: "ì„ê¸ˆ ì¸ìƒ ìš”êµ¬", description: "ì§ì›ë“¤ì´ 5% ì„ê¸ˆ ì¸ìƒì„ ìš”êµ¬í•˜ê³  ìˆìŠµë‹ˆë‹¤", impact: 15 },
                { title: "ê·¼ë¬´ì‹œê°„ ë‹¨ì¶•", description: "ì£¼ 40ì‹œê°„ ê·¼ë¬´ì œ ë„ì…ì„ ìš”êµ¬í•©ë‹ˆë‹¤", impact: 10 },
                { title: "ë³µë¦¬í›„ìƒ ê°œì„ ", description: "ì˜ë£Œë³´í—˜ê³¼ ì‹ëŒ€ ì§€ì› í™•ëŒ€ë¥¼ ìš”êµ¬í•©ë‹ˆë‹¤", impact: 12 },
                { title: "ì‘ì—…í™˜ê²½ ê°œì„ ", description: "ì•ˆì „ì¥ë¹„ì™€ ì‘ì—…ê³µê°„ ê°œì„ ì„ ìš”êµ¬í•©ë‹ˆë‹¤", impact: 18 }
            ];
            
            // ë§Œì¡±ë„ì— ë”°ë¼ ì´ìŠˆ ë°œìƒ
            const avgSatisfaction = gameState.roleData.workforce.workers.length > 0 
                ? gameState.roleData.workforce.workers.reduce((a, w) => a + w.satisfaction, 0) / gameState.roleData.workforce.workers.length 
                : 100;
            
            if (avgSatisfaction < 70) {
                return issues.slice(0, Math.floor(Math.random() * 3) + 1);
            }
            
            return [];
        }

        // ===== ë…¸ë™ì ê´€ë¦¬ ì•¡ì…˜ í•¨ìˆ˜ë“¤ =====

        // ì±„ìš©í•˜ê¸°
        function hireCandidate(candidateId) {
            const jobMarket = gameState.roleData.workforce.jobMarket;
            const candidate = jobMarket.find(c => c.id == candidateId);
            if (!candidate) return;

            const hireCost = candidate.expectedSalary + (candidate.experience * 500);
            
            if (gameState.currentUser.game_balance < hireCost) {
                showNotification(`ì±„ìš©ì— ${hireCost.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§ì´ í•„ìš”í•©ë‹ˆë‹¤`, 'error');
                return;
            }

            // ë°°ì •í•  ì‚¬ì—…ì²´ ì„ íƒ (ì²« ë²ˆì§¸ ì‚¬ì—…ì²´ì— ë°°ì •)
            const businesses = gameState.roleData.businesses;
            const businessId = businesses.length > 0 ? businesses[0].id : null;

            const newWorker = {
                id: Date.now() + Math.random(),
                name: candidate.name,
                age: candidate.age,
                businessId: businessId,
                position: candidate.experience >= 8 ? 'íŒ€ì¥' : candidate.experience >= 15 ? 'ë¶€ì¥' : 'ì‚¬ì›',
                experience: candidate.experience,
                skills: candidate.skills,
                salary: candidate.expectedSalary,
                satisfaction: 80 + Math.floor(Math.random() * 20), // 80-100%
                performance: 60 + Math.floor(Math.random() * 40), // 60-100%
                hireDate: new Date(),
                contracts: {
                    salaryBonus: 0,
                    benefits: ['ê¸°ë³¸ì˜ë£Œë³´í—˜'],
                    vacationDays: 15
                },
                training: {
                    inProgress: null,
                    completed: [],
                    nextAvailable: new Date()
                },
                status: 'active'
            };

            gameState.currentUser.game_balance -= hireCost;
            gameState.roleData.workforce.workers.push(newWorker);
            
            // êµ¬ì¸ ì‹œì¥ì—ì„œ ì œê±°
            const index = jobMarket.findIndex(c => c.id == candidateId);
            jobMarket.splice(index, 1);

            updateDisplay();
            showNotification(`âœ… ${candidate.name}ë‹˜ì„ ì„±ê³µì ìœ¼ë¡œ ì±„ìš©í–ˆìŠµë‹ˆë‹¤!`, 'success');
            showRecruitment(); // í™”ë©´ ìƒˆë¡œê³ ì¹¨
        }

        // êµ¬ì¸ ì‹œì¥ ìƒˆë¡œê³ ì¹¨
        function refreshJobMarket() {
            if (gameState.currentUser.game_balance < 1000) {
                showNotification('êµ¬ì¸ ì‹œì¥ ìƒˆë¡œê³ ì¹¨ì— 1000 ë¹„íŠ¸í¬ë ˆë”§ì´ í•„ìš”í•©ë‹ˆë‹¤', 'error');
                return;
            }

            gameState.currentUser.game_balance -= 1000;
            gameState.roleData.workforce.jobMarket = [];
            
            for (let i = 0; i < 8; i++) {
                gameState.roleData.workforce.jobMarket.push(createJobSeeker());
            }

            updateDisplay();
            showNotification('ìƒˆë¡œìš´ ì¸ì¬ë“¤ì´ ë‚˜íƒ€ë‚¬ìŠµë‹ˆë‹¤!', 'success');
            showRecruitment();
        }

        // ì§ì› í•´ê³ 
        function fireWorker(workerId) {
            const workers = gameState.roleData.workforce.workers;
            const worker = workers.find(w => w.id == workerId);
            if (!worker) return;

            const severancePay = Math.floor(worker.salary * 2); // í‡´ì§ê¸ˆ 2ê°œì›”ì¹˜
            
            if (confirm(`${worker.name}ë‹˜ì„ í•´ê³ í•˜ì‹œê² ìŠµë‹ˆê¹Œ? í‡´ì§ê¸ˆ ${severancePay.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§ì´ ì§€ê¸‰ë©ë‹ˆë‹¤.`)) {
                gameState.currentUser.game_balance -= severancePay;
                
                const index = workers.findIndex(w => w.id == workerId);
                workers.splice(index, 1);

                // ë‹¤ë¥¸ ì§ì›ë“¤ì˜ ë§Œì¡±ë„ ê°ì†Œ
                workers.forEach(w => {
                    w.satisfaction = Math.max(20, w.satisfaction - 10);
                });

                updateDisplay();
                showNotification(`${worker.name}ë‹˜ì„ í•´ê³ í–ˆìŠµë‹ˆë‹¤. í‡´ì§ê¸ˆ ${severancePay.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§ ì§€ê¸‰`, 'warning');
                showWorkerList();
            }
        }

        // ì§ì› ìŠ¹ì§„
        function promoteWorker(workerId) {
            const worker = gameState.roleData.workforce.workers.find(w => w.id == workerId);
            if (!worker) return;

            const promotions = {
                'ì‚¬ì›': { next: 'íŒ€ì¥', salaryIncrease: 2000 },
                'íŒ€ì¥': { next: 'ë¶€ì¥', salaryIncrease: 3000 },
                'ë¶€ì¥': { next: 'ì„ì›', salaryIncrease: 4000 },
                'ì„ì›': null
            };

            const promotion = promotions[worker.position];
            if (!promotion) {
                showNotification(`${worker.name}ë‹˜ì€ ì´ë¯¸ ìµœê³  ì§ê¸‰ì…ë‹ˆë‹¤`, 'warning');
                return;
            }

            if (confirm(`${worker.name}ë‹˜ì„ ${promotion.next}ë¡œ ìŠ¹ì§„ì‹œí‚¤ì‹œê² ìŠµë‹ˆê¹Œ? ì›”ê¸‰ì´ ${promotion.salaryIncrease.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§ ì¸ìƒë©ë‹ˆë‹¤.`)) {
                worker.position = promotion.next;
                worker.salary += promotion.salaryIncrease;
                worker.satisfaction = Math.min(100, worker.satisfaction + 20);
                worker.performance = Math.min(100, worker.performance + 10);

                showNotification(`ğŸ‰ ${worker.name}ë‹˜ì´ ${promotion.next}ë¡œ ìŠ¹ì§„í–ˆìŠµë‹ˆë‹¤!`, 'success');
                showWorkerList();
            }
        }

        // êµìœ¡ ì‹œì‘
        function startTraining(skillType) {
            const workers = gameState.roleData.workforce.workers;
            const trainingCosts = {
                'production': 5000,
                'quality': 6000, 
                'leadership': 8000,
                'creativity': 7000
            };

            const cost = trainingCosts[skillType];
            
            if (gameState.currentUser.game_balance < cost) {
                showNotification(`êµìœ¡ì— ${cost.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§ì´ í•„ìš”í•©ë‹ˆë‹¤`, 'error');
                return;
            }

            // êµìœ¡ë°›ì„ ì§ì› ì„ íƒ (ëœë¤)
            const availableWorkers = workers.filter(w => w.status === 'active');
            if (availableWorkers.length === 0) {
                showNotification('êµìœ¡ë°›ì„ ì§ì›ì´ ì—†ìŠµë‹ˆë‹¤', 'warning');
                return;
            }

            const worker = availableWorkers[Math.floor(Math.random() * availableWorkers.length)];
            
            gameState.currentUser.game_balance -= cost;
            worker.status = 'training';
            worker.training.inProgress = skillType;
            
            // êµìœ¡ ì™„ë£Œ ì‹œë®¬ë ˆì´ì…˜ (ì¦‰ì‹œ ì™„ë£Œ)
            setTimeout(() => {
                const improvement = 10 + Math.floor(Math.random() * 11); // 10-20ì  í–¥ìƒ
                worker.skills[skillType] = Math.min(100, worker.skills[skillType] + improvement);
                worker.status = 'active';
                worker.training.inProgress = null;
                worker.training.completed.push(skillType);
                worker.satisfaction = Math.min(100, worker.satisfaction + 5);
                
                showNotification(`âœ… ${worker.name}ë‹˜ì˜ ${getSkillName(skillType)} êµìœ¡ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤! (+${improvement}ì )`, 'success');
            }, 2000);

            updateDisplay();
            showNotification(`${worker.name}ë‹˜ì´ ${getSkillName(skillType)} êµìœ¡ì„ ì‹œì‘í–ˆìŠµë‹ˆë‹¤`, 'info');
            showTrainingPrograms();
        }

        function getSkillName(skillType) {
            const names = {
                'production': 'ìƒì‚°ì„±',
                'quality': 'í’ˆì§ˆê´€ë¦¬',
                'leadership': 'ë¦¬ë”ì‹­',
                'creativity': 'ì°½ì˜ì„±'
            };
            return names[skillType];
        }

        // ë§Œì¡±ë„ ê°œì„  í•¨ìˆ˜ë“¤
        function improveSalaries() {
            const workers = gameState.roleData.workforce.workers;
            const totalIncrease = Math.floor(workers.reduce((sum, w) => sum + w.salary, 0) * 0.1);
            
            if (gameState.currentUser.game_balance < totalIncrease) {
                showNotification(`ê¸‰ì—¬ ì¸ìƒì— ${totalIncrease.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§ì´ í•„ìš”í•©ë‹ˆë‹¤`, 'error');
                return;
            }

            gameState.currentUser.game_balance -= totalIncrease;
            gameState.roleData.workforce.satisfactionFactors.baseSalary = Math.min(200, gameState.roleData.workforce.satisfactionFactors.baseSalary + 10);
            
            workers.forEach(w => {
                w.salary = Math.floor(w.salary * 1.1);
                w.satisfaction = Math.min(100, w.satisfaction + 15);
            });

            updateDisplay();
            showNotification('ğŸ’° ì „ì²´ ì§ì› ê¸‰ì—¬ë¥¼ 10% ì¸ìƒí–ˆìŠµë‹ˆë‹¤!', 'success');
            showWorkerSatisfaction();
        }

        function improveBenefits() {
            if (gameState.currentUser.game_balance < 50000) {
                showNotification('ë³µë¦¬í›„ìƒ ê°œì„ ì— 50000 ë¹„íŠ¸í¬ë ˆë”§ì´ í•„ìš”í•©ë‹ˆë‹¤', 'error');
                return;
            }

            gameState.currentUser.game_balance -= 50000;
            gameState.roleData.workforce.satisfactionFactors.benefits = Math.min(100, gameState.roleData.workforce.satisfactionFactors.benefits + 20);
            
            gameState.roleData.workforce.workers.forEach(w => {
                w.satisfaction = Math.min(100, w.satisfaction + 10);
            });

            updateDisplay();
            showNotification('ğŸ¥ ë³µë¦¬í›„ìƒì´ ê°œì„ ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
            showWorkerSatisfaction();
        }

        function improveWorkEnvironment() {
            if (gameState.currentUser.game_balance < 80000) {
                showNotification('ê·¼ë¬´í™˜ê²½ ê°œì„ ì— 80000 ë¹„íŠ¸í¬ë ˆë”§ì´ í•„ìš”í•©ë‹ˆë‹¤', 'error');
                return;
            }

            gameState.currentUser.game_balance -= 80000;
            gameState.roleData.workforce.satisfactionFactors.workEnvironment = Math.min(100, gameState.roleData.workforce.satisfactionFactors.workEnvironment + 25);
            
            gameState.roleData.workforce.workers.forEach(w => {
                w.satisfaction = Math.min(100, w.satisfaction + 12);
                w.performance = Math.min(100, w.performance + 8);
            });

            updateDisplay();
            showNotification('ğŸ¢ ê·¼ë¬´í™˜ê²½ì´ ê°œì„ ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
            showWorkerSatisfaction();
        }

        function improveGrowthOpportunity() {
            if (gameState.currentUser.game_balance < 60000) {
                showNotification('ì„±ì¥ê¸°íšŒ í™•ëŒ€ì— 60000 ë¹„íŠ¸í¬ë ˆë”§ì´ í•„ìš”í•©ë‹ˆë‹¤', 'error');
                return;
            }

            gameState.currentUser.game_balance -= 60000;
            gameState.roleData.workforce.satisfactionFactors.growthOpportunity = Math.min(100, gameState.roleData.workforce.satisfactionFactors.growthOpportunity + 30);
            
            gameState.roleData.workforce.workers.forEach(w => {
                w.satisfaction = Math.min(100, w.satisfaction + 15);
                w.performance = Math.min(100, w.performance + 5);
            });

            updateDisplay();
            showNotification('ğŸ“ˆ ì„±ì¥ê¸°íšŒê°€ í™•ëŒ€ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
            showWorkerSatisfaction();
        }

        // ë…¸ì‚¬í˜‘ìƒ ì‹œì‘
        function startNegotiation() {
            const avgSatisfaction = gameState.roleData.workforce.workers.length > 0 
                ? gameState.roleData.workforce.workers.reduce((a, w) => a + w.satisfaction, 0) / gameState.roleData.workforce.workers.length 
                : 100;

            if (avgSatisfaction >= 80) {
                showNotification('ğŸ˜Š ì§ì›ë“¤ì´ í˜„ì¬ ìƒíƒœì— ë§Œì¡±í•˜ê³  ìˆì–´ íŠ¹ë³„í•œ í˜‘ìƒì´ í•„ìš”í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤', 'success');
                return;
            }

            const demandIncrease = Math.floor((100 - avgSatisfaction) * 100); // ë§Œì¡±ë„ì— ë°˜ë¹„ë¡€
            
            if (confirm(`ì§ì›ë“¤ì´ ${demandIncrease.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§ì˜ ë³µì§€ë¹„ ì§€ì›ì„ ìš”êµ¬í•©ë‹ˆë‹¤. ìˆ˜ë½í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                if (gameState.currentUser.game_balance < demandIncrease) {
                    showNotification('ìê¸ˆì´ ë¶€ì¡±í•˜ì—¬ í˜‘ìƒì´ ê²°ë ¬ë˜ì—ˆìŠµë‹ˆë‹¤', 'error');
                    gameState.roleData.workforce.workers.forEach(w => {
                        w.satisfaction = Math.max(10, w.satisfaction - 20);
                    });
                } else {
                    gameState.currentUser.game_balance -= demandIncrease;
                    gameState.roleData.workforce.workers.forEach(w => {
                        w.satisfaction = Math.min(100, w.satisfaction + 25);
                    });
                    showNotification('ğŸ¤ ë…¸ì‚¬í˜‘ìƒì´ ì„±ê³µì ìœ¼ë¡œ ë§ˆë¬´ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
                }
            } else {
                gameState.roleData.workforce.workers.forEach(w => {
                    w.satisfaction = Math.max(10, w.satisfaction - 15);
                });
                showNotification('í˜‘ìƒì´ ê²°ë ¬ë˜ì–´ ì§ì›ë“¤ì˜ ë§Œì¡±ë„ê°€ í•˜ë½í–ˆìŠµë‹ˆë‹¤', 'warning');
            }
            
            updateDisplay();
            showUnionManagement();
        }

        // íŒŒì—… ëŒ€ì‘
        function handleStrike(response) {
            if (response === 'negotiate') {
                const cost = Math.floor(gameState.roleData.workforce.workers.length * 2000); // ì§ì› 1ëª…ë‹¹ 2000 ë¹„íŠ¸í¬ë ˆë”§
                
                if (gameState.currentUser.game_balance < cost) {
                    showNotification('í˜‘ìƒ ìê¸ˆì´ ë¶€ì¡±í•©ë‹ˆë‹¤', 'error');
                    return;
                }

                gameState.currentUser.game_balance -= cost;
                gameState.roleData.workforce.workers.forEach(w => {
                    w.satisfaction = Math.min(100, w.satisfaction + 30);
                    w.status = 'active';
                });
                
                showNotification('ğŸ¤ íŒŒì—…ì´ í•´ê²°ë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
            } else if (response === 'replace') {
                // ëŒ€ì²´ì¸ë ¥ ê³ ìš© (ë¹„ìš© ë§ì´ ë“¤ê³  ë§Œì¡±ë„ ë” í•˜ë½)
                const cost = Math.floor(gameState.roleData.workforce.workers.length * 5000);
                
                if (gameState.currentUser.game_balance < cost) {
                    showNotification('ëŒ€ì²´ì¸ë ¥ ê³ ìš© ë¹„ìš©ì´ ë¶€ì¡±í•©ë‹ˆë‹¤', 'error');
                    return;
                }

                gameState.currentUser.game_balance -= cost;
                gameState.roleData.workforce.workers.forEach(w => {
                    w.satisfaction = Math.max(5, w.satisfaction - 40);
                    w.status = 'active';
                });
                
                showNotification('ğŸ’° ëŒ€ì²´ì¸ë ¥ìœ¼ë¡œ íŒŒì—…ì„ ì–µì œí–ˆì§€ë§Œ ì§ì›ë“¤ì˜ ë¶ˆë§Œì´ ì»¤ì¡ŒìŠµë‹ˆë‹¤', 'warning');
            }
            
            updateDisplay();
            showUnionManagement();
        }

        // ë¡œê·¸ì•„ì›ƒ ê¸°ëŠ¥
        function showCoinPurchase() {
            const coinPackages = [
                // ì†Œì•¡ íŒ¨í‚¤ì§€ (0~20% ë³´ë„ˆìŠ¤)
                { amount: 500, price: 0.99, bonus: 0, popular: false, category: 'ì…ë¬¸ì' },
                { amount: 1200, price: 1.99, bonus: 200, popular: false, category: 'ì…ë¬¸ì' },
                { amount: 2500, price: 2.99, bonus: 500, popular: false, category: 'ì…ë¬¸ì' },
                { amount: 5000, price: 4.99, bonus: 1000, popular: false, category: 'ì…ë¬¸ì' },
                
                // ì¸ê¸° íŒ¨í‚¤ì§€ (25~50% ë³´ë„ˆìŠ¤)
                { amount: 8000, price: 7.99, bonus: 2500, popular: false, category: 'ì¸ê¸°' },
                { amount: 12000, price: 9.99, bonus: 4000, popular: true, category: 'ì¸ê¸°' },
                { amount: 18000, price: 14.99, bonus: 7000, popular: false, category: 'ì¸ê¸°' },
                { amount: 25000, price: 19.99, bonus: 12500, popular: false, category: 'ì¸ê¸°' },
                
                // ëŒ€ìš©ëŸ‰ íŒ¨í‚¤ì§€ (60~100% ë³´ë„ˆìŠ¤)
                { amount: 35000, price: 24.99, bonus: 25000, popular: false, category: 'ëŒ€ìš©ëŸ‰' },
                { amount: 50000, price: 34.99, bonus: 40000, popular: false, category: 'ëŒ€ìš©ëŸ‰' },
                { amount: 75000, price: 49.99, bonus: 75000, popular: false, category: 'ëŒ€ìš©ëŸ‰' },
                { amount: 100000, price: 69.99, bonus: 120000, popular: false, category: 'ëŒ€ìš©ëŸ‰' },
                
                // í”„ë¦¬ë¯¸ì—„ íŒ¨í‚¤ì§€ (167~3000% ë³´ë„ˆìŠ¤)
                { amount: 150000, price: 99.99, bonus: 250000, popular: false, category: 'í”„ë¦¬ë¯¸ì—„' },
                { amount: 200000, price: 149.99, bonus: 800000, popular: false, category: 'í”„ë¦¬ë¯¸ì—„' },
                { amount: 300000, price: 199.99, bonus: 2700000, popular: false, category: 'í”„ë¦¬ë¯¸ì—„' },
                { amount: 500000, price: 299.99, bonus: 15000000, popular: false, category: 'í”„ë¦¬ë¯¸ì—„' }
            ];

            const modalContent = `
                <h2 style="text-align: center; margin-bottom: 30px; color: var(--primary);">ğŸ’° ë¹„íŠ¸í¬ë ˆë”§ êµ¬ë§¤</h2>
                
                <!-- í˜„ì¬ ë³´ìœ  ë¹„íŠ¸í¬ë ˆë”§ -->
                <div style="background: rgba(34, 197, 94, 0.1); border: 1px solid rgba(34, 197, 94, 0.3); border-radius: 12px; padding: 20px; margin-bottom: 30px; text-align: center;">
                    <div style="color: #94a3b8; font-size: 0.9rem; margin-bottom: 5px;">í˜„ì¬ ë³´ìœ  ë¹„íŠ¸í¬ë ˆë”§</div>
                    <div style="color: var(--success); font-size: 2rem; font-weight: bold;">${gameState.roleData.balance.toLocaleString()}</div>
                </div>

                <!-- ë¹„íŠ¸í¬ë ˆë”§ íŒ¨í‚¤ì§€ -->
                ${['ì…ë¬¸ì', 'ì¸ê¸°', 'ëŒ€ìš©ëŸ‰', 'í”„ë¦¬ë¯¸ì—„'].map(category => {
                    const categoryPackages = coinPackages.filter(pkg => pkg.category === category);
                    const categoryColors = {
                        'ì…ë¬¸ì': { bg: 'rgba(34, 197, 94, 0.1)', border: 'rgba(34, 197, 94, 0.3)', accent: '#22c55e' },
                        'ì¸ê¸°': { bg: 'rgba(99, 102, 241, 0.1)', border: 'rgba(99, 102, 241, 0.3)', accent: '#6366f1' },
                        'ëŒ€ìš©ëŸ‰': { bg: 'rgba(168, 85, 247, 0.1)', border: 'rgba(168, 85, 247, 0.3)', accent: '#a855f7' },
                        'í”„ë¦¬ë¯¸ì—„': { bg: 'rgba(251, 191, 36, 0.1)', border: 'rgba(251, 191, 36, 0.3)', accent: '#fbbf24' }
                    };
                    const colors = categoryColors[category];
                    
                    return `
                        <div style="margin-bottom: 25px;">
                            <div style="
                                text-align: center; margin-bottom: 15px; padding: 8px 16px;
                                background: ${colors.bg}; border: 1px solid ${colors.border};
                                border-radius: 20px; display: inline-block;
                                color: ${colors.accent}; font-weight: bold; font-size: 0.9rem;
                            ">${category === 'ì…ë¬¸ì' ? 'ğŸŒ±' : category === 'ì¸ê¸°' ? 'ğŸ”¥' : category === 'ëŒ€ìš©ëŸ‰' ? 'ğŸ’' : 'ğŸ‘‘'} ${category} íŒ¨í‚¤ì§€</div>
                            
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 12px;">
                                ${categoryPackages.map(pkg => {
                                    const bonusPercentage = pkg.bonus > 0 ? Math.round((pkg.bonus / pkg.amount) * 100) : 0;
                                    const totalCoins = pkg.amount + pkg.bonus;
                                    const pricePerCoin = (pkg.price / totalCoins * 1000).toFixed(1);
                                    
                                    return `
                                        <div style="
                                            position: relative;
                                            background: ${pkg.popular ? 'linear-gradient(135deg, rgba(99, 102, 241, 0.15), rgba(139, 92, 246, 0.15))' : colors.bg};
                                            border: ${pkg.popular ? '2px solid var(--primary)' : `1px solid ${colors.border}`};
                                            border-radius: 12px; padding: 16px; cursor: pointer;
                                            transition: all 0.3s ease; hover: transform: translateY(-2px);
                                            ${pkg.popular ? 'transform: scale(1.02); box-shadow: 0 8px 25px rgba(99, 102, 241, 0.2);' : ''}
                                        " onclick="purchaseCoin(${totalCoins}, ${pkg.price})">
                                            ${pkg.popular ? '<div style="position: absolute; top: -8px; left: 50%; transform: translateX(-50%); background: linear-gradient(45deg, #6366f1, #8b5cf6); color: white; padding: 4px 12px; border-radius: 15px; font-size: 0.7rem; font-weight: 600; box-shadow: 0 2px 8px rgba(99, 102, 241, 0.3);">ğŸ”¥ ì¸ê¸° ìƒí’ˆ</div>' : ''}
                                            ${bonusPercentage >= 50 ? '<div style="position: absolute; top: -8px; right: 10px; background: linear-gradient(45deg, #f59e0b, #ef4444); color: white; padding: 4px 8px; border-radius: 12px; font-size: 0.7rem; font-weight: 600;">HOT</div>' : ''}
                                            
                                            <div style="text-align: center; margin-bottom: 12px;">
                                                <div style="color: var(--primary); font-size: 1.8rem; font-weight: bold; margin-bottom: 4px;">$${pkg.price}</div>
                                                <div style="color: #94a3b8; font-size: 0.75rem;">ë¹„íŠ¸í¬ë ˆë”§ë‹¹ $${pricePerCoin}/1000ê°œ</div>
                                            </div>
                                            
                                            <div style="text-align: center; margin-bottom: 8px;">
                                                <div style="color: #e2e8f0; font-size: 1.1rem; font-weight: bold;">
                                                    ${pkg.amount.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§
                                                </div>
                                                ${pkg.bonus > 0 ? `
                                                    <div style="color: ${colors.accent}; font-size: 0.9rem; margin-top: 4px;">
                                                        +${pkg.bonus.toLocaleString()} ë³´ë„ˆìŠ¤ (${bonusPercentage}%)
                                                    </div>
                                                    <div style="color: ${colors.accent}; font-size: 0.8rem; font-weight: 600; margin-top: 2px;">
                                                        = ${totalCoins.toLocaleString()} ì´ ë¹„íŠ¸í¬ë ˆë”§
                                                    </div>
                                                ` : ''}
                                            </div>
                                            
                                            ${pkg.bonus > 0 ? `<div style="text-align: center; margin-top: 8px; padding: 6px; background: rgba(34, 197, 94, 0.1); border-radius: 6px; border: 1px solid rgba(34, 197, 94, 0.2);"><div style="color: var(--success); font-size: 0.7rem; font-weight: 600;">${pkg.bonus.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§ ë¬´ë£Œ!</div></div>` : ''}
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        </div>
                    `;
                }).join('')}

                <!-- ì£¼ì˜ì‚¬í•­ -->
                <div style="background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.3); border-radius: 8px; padding: 15px; margin-bottom: 20px;">
                    <div style="color: var(--danger); font-size: 0.9rem; line-height: 1.5;">
                        <strong>âš ï¸ ì£¼ì˜ì‚¬í•­:</strong><br>
                        â€¢ êµ¬ë§¤í•œ ë¹„íŠ¸í¬ë ˆë”§ì€ í™˜ë¶ˆë˜ì§€ ì•ŠìŠµë‹ˆë‹¤<br>
                        â€¢ ê²°ì œëŠ” ì•ˆì „í•œ PayPalì„ í†µí•´ ì²˜ë¦¬ë©ë‹ˆë‹¤<br>
                        â€¢ êµ¬ë§¤ í›„ ì¦‰ì‹œ ë¹„íŠ¸í¬ë ˆë”§ì´ ì§€ê¸‰ë©ë‹ˆë‹¤
                    </div>
                </div>

                <div style="text-align: center;">
                    <button onclick="closeModal()" style="
                        padding: 12px 30px; background: rgba(71, 85, 105, 0.2);
                        color: #e2e8f0; border: 1px solid rgba(71, 85, 105, 0.3);
                        border-radius: 8px; cursor: pointer; font-size: 0.9rem;
                    ">ë‹«ê¸°</button>
                </div>
            `;

            showModal(modalContent);
        }

        function purchaseCoin(amount, price) {
            if (confirm(`$${price}ì— ${amount.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§ì„ êµ¬ë§¤í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                // ì‹¤ì œ ê²°ì œ ì²˜ë¦¬ëŠ” ì—¬ê¸°ì„œ êµ¬í˜„ (PayPal, Stripe ë“±)
                // ì„ì‹œë¡œ ë°”ë¡œ ë¹„íŠ¸í¬ë ˆë”§ ì§€ê¸‰
                showPaymentInterface(amount, price);
            }
        }

        function showPaymentInterface(amount, price) {
            const modalContent = `
                <h2 style="text-align: center; margin-bottom: 30px; color: var(--primary);">ğŸ’³ ê²°ì œ ì§„í–‰</h2>
                
                <div style="background: rgba(59, 130, 246, 0.1); border: 1px solid rgba(59, 130, 246, 0.3); border-radius: 12px; padding: 20px; margin-bottom: 30px;">
                    <div style="text-align: center; margin-bottom: 20px;">
                        <div style="color: #94a3b8; font-size: 0.9rem;">êµ¬ë§¤ ìƒí’ˆ</div>
                        <div style="color: #e2e8f0; font-size: 1.5rem; font-weight: bold; margin: 10px 0;">${amount.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§</div>
                        <div style="color: var(--primary); font-size: 1.3rem; font-weight: bold;">$${price}</div>
                    </div>
                    
                    <div style="border-top: 1px solid rgba(71, 85, 105, 0.3); padding-top: 15px; text-align: center;">
                        <div style="color: #94a3b8; font-size: 0.8rem; margin-bottom: 15px;">ê²°ì œ ë°©ë²• ì„ íƒ</div>
                        
                        <div style="display: grid; gap: 10px;">
                            <button onclick="processPayment('paypal', ${amount}, ${price})" style="
                                padding: 15px; background: #0070ba; color: white;
                                border: none; border-radius: 8px; cursor: pointer;
                                font-size: 1rem; font-weight: 600;
                                display: flex; align-items: center; justify-content: center; gap: 10px;
                            ">
                                <span>PayPal</span>
                            </button>
                            
                            <button onclick="processPayment('card', ${amount}, ${price})" style="
                                padding: 15px; background: #1a1a1a; color: white;
                                border: 1px solid #333; border-radius: 8px; cursor: pointer;
                                font-size: 1rem; font-weight: 600;
                                display: flex; align-items: center; justify-content: center; gap: 10px;
                            ">
                                ğŸ’³ ì‹ ìš©ì¹´ë“œ
                            </button>
                            
                            <button onclick="processPayment('demo', ${amount}, ${price})" style="
                                padding: 15px; background: var(--success); color: white;
                                border: none; border-radius: 8px; cursor: pointer;
                                font-size: 1rem; font-weight: 600;
                            ">
                                ğŸ® ë°ëª¨ êµ¬ë§¤ (í…ŒìŠ¤íŠ¸ìš©)
                            </button>
                        </div>
                    </div>
                </div>

                <div style="text-align: center;">
                    <button onclick="showCoinPurchase()" style="
                        padding: 12px 30px; background: rgba(71, 85, 105, 0.2);
                        color: #e2e8f0; border: 1px solid rgba(71, 85, 105, 0.3);
                        border-radius: 8px; cursor: pointer; font-size: 0.9rem;
                    ">â† ë’¤ë¡œ</button>
                </div>
            `;

            showModal(modalContent);
        }

        function processPayment(method, amount, price) {
            if (method === 'demo') {
                // ë°ëª¨ êµ¬ë§¤ - ì¦‰ì‹œ ë¹„íŠ¸í¬ë ˆë”§ ì§€ê¸‰
                gameState.roleData.balance += amount;
                updateDisplay();
                
                alert(`ğŸ‰ êµ¬ë§¤ ì™„ë£Œ!\n${amount.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§ì´ ê³„ì •ì— ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.`);
                closeModal();
            } else {
                // ì‹¤ì œ ê²°ì œ ì²˜ë¦¬
                alert(`${method === 'paypal' ? 'PayPal' : 'ì‹ ìš©ì¹´ë“œ'} ê²°ì œ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.\n\nì‹¤ì œ ì„œë¹„ìŠ¤ì—ì„œëŠ” ì—¬ê¸°ì„œ ê²°ì œ ì²˜ë¦¬ê°€ ì§„í–‰ë©ë‹ˆë‹¤.`);
                
                // ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” ì—¬ê¸°ì„œ ê²°ì œ API í˜¸ì¶œ
                // ì„ì‹œë¡œ ì„±ê³µí–ˆë‹¤ê³  ê°€ì •
                setTimeout(() => {
                    gameState.roleData.balance += amount;
                    updateDisplay();
                    alert(`ğŸ‰ êµ¬ë§¤ ì™„ë£Œ!\n${amount.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§ì´ ê³„ì •ì— ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.`);
                    closeModal();
                }, 2000);
            }
        }

        function logout() {
            if (confirm('ì •ë§ ë¡œê·¸ì•„ì›ƒí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì €ì¥ë˜ì§€ ì•Šì€ ë°ì´í„°ëŠ” ì†ì‹¤ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.')) {
                // ê²Œì„ ìƒíƒœ ì´ˆê¸°í™”
                gameState = {
                    currentUser: null,
                    isLoggedIn: false,
                    selectedRole: null,
                    gameData: {
                        banks: [],
                        businesses: [],
                        stockMarket: {
                            kospi: 2400,
                            companies: new Map()
                        },
                        users: []
                    }
                };

                // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ í˜„ì¬ ì‚¬ìš©ì ì •ë³´ ì œê±°
                localStorage.removeItem('currentUser');

                // í™”ë©´ ì´ˆê¸°í™”
                document.getElementById('loginSection').style.display = 'flex';
                document.getElementById('roleSelection').style.display = 'none';
                document.getElementById('gameInterface').style.display = 'none';

                // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
                document.getElementById('loginForm').reset();

                showNotification('ë¡œê·¸ì•„ì›ƒë˜ì—ˆìŠµë‹ˆë‹¤', 'info');
            }
        }

        // ì‚¬ìš©ì ì •ë³´ ì—…ë°ì´íŠ¸
        function updateUserDisplay() {
            if (gameState.currentUser) {
                document.getElementById('currentUserName').textContent = gameState.currentUser.username;
            }
        }

        // ê³„ì • ë©”ë‰´ í‘œì‹œ
        function showAccountMenu() {
            const modalContent = `
                <h2 style="text-align: center; margin-bottom: 30px; color: var(--primary);">ğŸ‘¤ ê³„ì • ê´€ë¦¬</h2>
                
                <!-- í˜„ì¬ ê³„ì • ì •ë³´ -->
                <div style="background: rgba(59, 130, 246, 0.1); border: 1px solid rgba(59, 130, 246, 0.3); border-radius: 12px; padding: 20px; margin-bottom: 30px;">
                    <h3 style="color: var(--primary); margin: 0 0 15px 0;">ğŸ“‹ í˜„ì¬ ê³„ì • ì •ë³´</h3>
                    <div style="display: grid; gap: 10px;">
                        <div style="display: flex; justify-content: space-between;">
                            <span style="color: #94a3b8;">ì‚¬ìš©ìëª…:</span>
                            <span style="color: #e2e8f0; font-weight: bold;">${gameState.currentUser ? gameState.currentUser.username : '-'}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span style="color: #94a3b8;">ì´ë©”ì¼:</span>
                            <span style="color: #e2e8f0;">${gameState.currentUser ? gameState.currentUser.email : '-'}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span style="color: #94a3b8;">ê³„ì • ID:</span>
                            <span style="color: #94a3b8; font-family: monospace; font-size: 0.8rem;">${gameState.currentUser ? gameState.currentUser.id : '-'}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span style="color: #94a3b8;">ì—­í• :</span>
                            <span style="color: var(--success); font-weight: bold;">${gameState.currentUser ? (gameState.currentUser.role === 'entrepreneur' ? 'ì‚¬ì—…ê°€' : gameState.currentUser.role === 'banker' ? 'ì€í–‰ê°€' : gameState.currentUser.role === 'investor' ? 'íˆ¬ìì' : gameState.currentUser.role === 'worker' ? 'ì§ì¥ì¸' : 'ë¯¸ì„ íƒ') : '-'}</span>
                        </div>
                    </div>
                </div>

                <!-- ê³„ì • ê´€ë¦¬ ì˜µì…˜ -->
                <div style="display: grid; gap: 15px; margin-bottom: 30px;">
                    <button onclick="changeUsername()" style="
                        padding: 15px; background: var(--primary); color: white;
                        border: none; border-radius: 10px; cursor: pointer;
                        font-size: 0.9rem; font-weight: 600;
                    ">âœï¸ ì‚¬ìš©ìëª… ë³€ê²½</button>
                    
                    <button onclick="changeRole()" style="
                        padding: 15px; background: #8b5cf6; color: white;
                        border: none; border-radius: 10px; cursor: pointer;
                        font-size: 0.9rem; font-weight: 600;
                    ">ğŸ­ ì—­í•  ë³€ê²½</button>
                    
                    <button onclick="switchAccount()" style="
                        padding: 15px; background: var(--warning); color: white;
                        border: none; border-radius: 10px; cursor: pointer;
                        font-size: 0.9rem; font-weight: 600;
                    ">ğŸ”„ ë‹¤ë¥¸ ê³„ì •ìœ¼ë¡œ ì „í™˜</button>
                    
                    <button onclick="showGameStats()" style="
                        padding: 15px; background: var(--success); color: white;
                        border: none; border-radius: 10px; cursor: pointer;
                        font-size: 0.9rem; font-weight: 600;
                    ">ğŸ“Š ê²Œì„ í†µê³„</button>
                    
                    <button onclick="showCoinPurchase()" style="
                        padding: 15px; background: linear-gradient(135deg, #fbbf24, #f59e0b); color: white;
                        border: none; border-radius: 10px; cursor: pointer;
                        font-size: 0.9rem; font-weight: 600;
                        box-shadow: 0 4px 12px rgba(251, 191, 36, 0.3);
                    ">ğŸ’° ë¹„íŠ¸í¬ë ˆë”§ êµ¬ë§¤</button>
                </div>

                <!-- ë°ì´í„° ê´€ë¦¬ ì„¹ì…˜ -->
                <div style="border-top: 1px solid rgba(255,255,255,0.1); padding-top: 20px; margin-bottom: 30px;">
                    <h4 style="color: #94a3b8; margin: 0 0 15px 0; font-size: 0.9rem; text-align: center;">ğŸ’¾ ë°ì´í„° ê´€ë¦¬</h4>
                    
                    <div style="display: grid; gap: 10px;">
                        <!-- ë¡œì»¬ ì €ì¥ -->
                        <button onclick="saveGameState(); showNotification('ë¡œì»¬ì— ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤', 'success');" style="
                            padding: 12px; background: rgba(16, 185, 129, 0.8);
                            color: white; border: none; border-radius: 8px;
                            cursor: pointer; font-weight: 600; font-size: 0.85rem;
                        ">ğŸ’¾ ë¡œì»¬ ì €ì¥</button>
                        
                        ${supabaseClient && !gameState.isDemo ? `
                        <!-- í´ë¼ìš°ë“œ ì €ì¥/ë¡œë“œ (Supabase ì—°ê²° ì‹œë§Œ) -->
                        <button onclick="saveGameStateToSupabase()" style="
                            padding: 12px; background: rgba(59, 130, 246, 0.9);
                            color: white; border: none; border-radius: 8px;
                            cursor: pointer; font-weight: 600; font-size: 0.85rem;
                        ">â˜ï¸ í´ë¼ìš°ë“œ ì €ì¥</button>
                        
                        <button onclick="loadGameStateFromSupabase()" style="
                            padding: 12px; background: rgba(139, 69, 19, 0.9);
                            color: white; border: none; border-radius: 8px;
                            cursor: pointer; font-weight: 600; font-size: 0.85rem;
                        ">â˜ï¸ í´ë¼ìš°ë“œì—ì„œ ë¡œë“œ</button>
                        ` : ''}
                        
                        <button onclick="exportGameData()" style="
                            padding: 12px; background: rgba(156, 163, 175, 0.8);
                            color: white; border: none; border-radius: 8px;
                            cursor: pointer; font-weight: 600; font-size: 0.85rem;
                        ">ğŸ“¤ ë°ì´í„° ë‚´ë³´ë‚´ê¸°</button>
                        
                        <button onclick="importGameData()" style="
                            padding: 12px; background: rgba(107, 114, 128, 0.8);
                            color: white; border: none; border-radius: 8px;
                            cursor: pointer; font-weight: 600; font-size: 0.85rem;
                        ">ğŸ“¥ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°</button>
                        
                        <button onclick="resetGameData()" style="
                            padding: 12px; background: rgba(239, 68, 68, 0.8);
                            color: white; border: none; border-radius: 8px;
                            cursor: pointer; font-weight: 600; font-size: 0.85rem;
                        ">ğŸ—‘ï¸ ë°ì´í„° ì´ˆê¸°í™”</button>
                    </div>
                </div>

                <div style="text-align: center;">
                    <button onclick="closeModal()" style="
                        padding: 10px 20px; border: 1px solid rgba(255,255,255,0.2);
                        background: rgba(255,255,255,0.05); color: #e2e8f0;
                        border-radius: 8px; cursor: pointer;
                    ">ë‹«ê¸°</button>
                </div>
            `;
            
            showModal(modalContent);
        }

        // P2P ê±°ë˜ ëª¨ë‹¬ë“¤
        function showP2PBuyModal(listing) {
            const fee = listing.price * gameState.p2pMarket.fees[listing.type + 'Sale'];
            const totalCost = listing.price + fee;
            
            const modalContent = `
                <h2 style="text-align: center; margin-bottom: 30px; color: var(--primary);">ğŸ›’ P2P êµ¬ë§¤</h2>
                
                <div style="background: rgba(59, 130, 246, 0.1); border: 1px solid rgba(59, 130, 246, 0.3); border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                    <div style="margin-bottom: 15px;">
                        <div style="font-size: 1.2rem; font-weight: bold; color: var(--primary);">${listing.name}</div>
                        <div style="color: #94a3b8; font-size: 0.9rem;">íŒë§¤ì: ${listing.sellerName}</div>
                    </div>
                    <div style="color: #e2e8f0;">
                        ${listing.description || 'ìƒì„¸ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.'}
                    </div>
                </div>

                <div style="background: rgba(34, 34, 34, 0.6); border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <span>ê¸°ë³¸ ê°€ê²©:</span>
                        <span>${listing.price.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <span>ê±°ë˜ ìˆ˜ìˆ˜ë£Œ (${(gameState.p2pMarket.fees[listing.type + 'Sale'] * 100).toFixed(1)}%):</span>
                        <span>${fee.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§</span>
                    </div>
                    <div style="border-top: 1px solid rgba(255,255,255,0.1); padding-top: 10px; margin-top: 10px;">
                        <div style="display: flex; justify-content: space-between; font-weight: bold; font-size: 1.1rem;">
                            <span>ì´ ê²°ì œì•¡:</span>
                            <span style="color: var(--primary);">${totalCost.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§</span>
                        </div>
                    </div>
                </div>

                <div style="background: ${gameState.currentUser.game_balance >= totalCost ? 'rgba(34, 197, 94, 0.1)' : 'rgba(239, 68, 68, 0.1)'}; 
                     border: 1px solid ${gameState.currentUser.game_balance >= totalCost ? 'rgba(34, 197, 94, 0.3)' : 'rgba(239, 68, 68, 0.3)'}; 
                     border-radius: 12px; padding: 15px; margin-bottom: 20px; text-align: center;">
                    <div style="color: #94a3b8; font-size: 0.9rem; margin-bottom: 5px;">ë‚´ ë³´ìœ  ë¹„íŠ¸í¬ë ˆë”§</div>
                    <div style="color: ${gameState.currentUser.game_balance >= totalCost ? 'var(--success)' : 'var(--danger)'}; font-size: 1.5rem; font-weight: bold;">
                        ${gameState.currentUser.game_balance.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§
                    </div>
                </div>

                <div style="display: flex; gap: 15px; margin-top: 20px;">
                    <button onclick="closeModal()" class="btn btn-secondary" style="flex: 1;">ì·¨ì†Œ</button>
                    <button onclick="confirmP2PBuy('${listing.id}')" 
                            ${gameState.currentUser.game_balance >= totalCost ? 'class="btn"' : 'class="btn btn-secondary" disabled'} 
                            style="flex: 1;">
                        ${gameState.currentUser.game_balance >= totalCost ? 'êµ¬ë§¤í•˜ê¸°' : 'ì”ì•¡ ë¶€ì¡±'}
                    </button>
                </div>
            `;
            
            showModal(modalContent);
        }

        function showP2PSellModal(asset, type) {
            let suggestedPrice = 0;
            let description = '';
            
            if (type === 'business') {
                suggestedPrice = Math.floor(asset.value * 1.2); // ê¸°ì—… ê°€ì¹˜ì˜ 120%
                description = `${asset.type} ì‚¬ì—…ì²´, ì›” ìˆ˜ìµ: ${asset.profit.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§, ì§ì›: ${asset.employees}ëª…`;
            } else if (type === 'investment') {
                suggestedPrice = Math.floor(asset.amount * (1 + asset.returnRate)); // í˜„ì¬ ê°€ì¹˜
                description = `${asset.type} íˆ¬ì, ìˆ˜ìµë¥ : ${(asset.returnRate * 100).toFixed(1)}%`;
            }
            
            const modalContent = `
                <h2 style="text-align: center; margin-bottom: 30px; color: var(--primary);">ğŸ’° P2P íŒë§¤ ë“±ë¡</h2>
                
                <div style="background: rgba(34, 197, 94, 0.1); border: 1px solid rgba(34, 197, 94, 0.3); border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                    <div style="margin-bottom: 15px;">
                        <div style="font-size: 1.2rem; font-weight: bold; color: var(--success);">${asset.name}</div>
                        <div style="color: #94a3b8; font-size: 0.9rem;">${description}</div>
                    </div>
                </div>

                <div style="margin-bottom: 20px;">
                    <label style="display: block; color: #cbd5e1; margin-bottom: 8px; font-weight: 500;">íŒë§¤ ê°€ê²© (ë¹„íŠ¸í¬ë ˆë”§)</label>
                    <input type="number" id="p2pSellPrice" min="1000" 
                           style="width: 100%; padding: 12px; border: 1px solid rgba(255,255,255,0.2); 
                                  border-radius: 8px; background: rgba(255,255,255,0.05); color: #e2e8f0;
                                  font-size: 1rem;" 
                           oninput="updateP2PSellPreview()">
                    <div style="color: #94a3b8; font-size: 0.8rem; margin-top: 5px;">
                        ê¶Œì¥ ê°€ê²©: ${suggestedPrice.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§
                    </div>
                </div>

                <div style="margin-bottom: 20px;">
                    <label style="display: block; color: #cbd5e1; margin-bottom: 8px; font-weight: 500;">íŒë§¤ ì„¤ëª… (ì„ íƒ)</label>
                    <textarea id="p2pSellDescription" placeholder="êµ¬ë§¤ìì—ê²Œ ì „ë‹¬í•  ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”..." 
                              style="width: 100%; padding: 12px; border: 1px solid rgba(255,255,255,0.2); 
                                     border-radius: 8px; background: rgba(255,255,255,0.05); color: #e2e8f0;
                                     resize: vertical; height: 80px; font-family: inherit;"></textarea>
                </div>

                <div style="background: rgba(34, 34, 34, 0.6); border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <span>íŒë§¤ ê°€ê²©:</span>
                        <span id="sellPriceDisplay">${suggestedPrice.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <span>ê±°ë˜ ìˆ˜ìˆ˜ë£Œ (${(gameState.p2pMarket.fees[type + 'Sale'] * 100).toFixed(1)}%):</span>
                        <span id="sellFeeDisplay">-${Math.floor(suggestedPrice * gameState.p2pMarket.fees[type + 'Sale']).toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§</span>
                    </div>
                    <div style="border-top: 1px solid rgba(255,255,255,0.1); padding-top: 10px; margin-top: 10px;">
                        <div style="display: flex; justify-content: space-between; font-weight: bold; font-size: 1.1rem;">
                            <span>ì‹¤ ìˆ˜ë ¹ì•¡:</span>
                            <span style="color: var(--success);" id="netReceiveDisplay">${Math.floor(suggestedPrice * (1 - gameState.p2pMarket.fees[type + 'Sale'])).toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§</span>
                        </div>
                    </div>
                </div>

                <div style="display: flex; gap: 15px; margin-top: 20px;">
                    <button onclick="closeModal()" class="btn btn-secondary" style="flex: 1;">ì·¨ì†Œ</button>
                    <button onclick="confirmP2PSell('${asset.id || asset.name}', '${type}')" class="btn" style="flex: 1;">
                        íŒë§¤ ë“±ë¡í•˜ê¸°
                    </button>
                </div>
            `;
            
            showModal(modalContent);
            
            // ëª¨ë‹¬ì´ í‘œì‹œëœ í›„ input ê°’ ì„¤ì •
            setTimeout(() => {
                const priceInput = document.getElementById('p2pSellPrice');
                if (priceInput) {
                    priceInput.value = suggestedPrice;
                }
                updateP2PSellPreview();
            }, 50);
        }

        // ì‚¬ìš©ìëª… ë³€ê²½
        function changeUsername() {
            const newUsername = prompt('ìƒˆë¡œìš´ ì‚¬ìš©ìëª…ì„ ì…ë ¥í•˜ì„¸ìš”:', gameState.currentUser.username);
            
            if (newUsername && newUsername.trim() !== '' && newUsername.length >= 3) {
                gameState.currentUser.username = newUsername.trim();
                updateUserDisplay();
                showNotification('ì‚¬ìš©ìëª…ì´ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
                showAccountMenu(); // ë©”ë‰´ ìƒˆë¡œê³ ì¹¨
            } else if (newUsername !== null) {
                showNotification('ì‚¬ìš©ìëª…ì€ 3ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤', 'error');
            }
        }

        // ì—­í•  ë³€ê²½
        function changeRole() {
            const modalContent = `
                <h2 style="text-align: center; margin-bottom: 30px; color: var(--primary);">ğŸ­ ì—­í•  ë³€ê²½</h2>
                
                <div style="background: rgba(245, 158, 11, 0.1); border: 1px solid rgba(245, 158, 11, 0.3); border-radius: 12px; padding: 20px; margin-bottom: 30px;">
                    <h3 style="color: var(--warning); margin: 0 0 10px 0;">âš ï¸ ì£¼ì˜ì‚¬í•­</h3>
                    <p style="color: #94a3b8; margin: 0; font-size: 0.9rem;">
                        ì—­í• ì„ ë³€ê²½í•˜ë©´ í˜„ì¬ ê²Œì„ ë°ì´í„°ê°€ ì´ˆê¸°í™”ë˜ê³  ìƒˆë¡œìš´ ì—­í• ë¡œ ë‹¤ì‹œ ì‹œì‘ë©ë‹ˆë‹¤. 
                        ë³€ê²½ ì „ì— ì¤‘ìš”í•œ ë°ì´í„°ë¥¼ ì €ì¥í•´ë‘ì„¸ìš”.
                    </p>
                </div>

                <div style="display: grid; gap: 15px; margin-bottom: 30px;">
                    <button onclick="confirmRoleChange('entrepreneur')" style="
                        padding: 20px; background: linear-gradient(135deg, #3b82f6, #1d4ed8);
                        color: white; border: none; border-radius: 12px; cursor: pointer;
                        display: flex; align-items: center; gap: 15px;
                        ${gameState.currentUser.role === 'entrepreneur' ? 'opacity: 0.5; cursor: not-allowed;' : ''}
                    ">
                        <div style="font-size: 2rem;">ğŸ’¼</div>
                        <div style="text-align: left;">
                            <div style="font-size: 1.1rem; font-weight: bold;">ì‚¬ì—…ê°€ <span style="color: #ef4444; font-size: 0.8rem;">[ìµœê³  ë‚œì´ë„]</span></div>
                            <div style="font-size: 0.9rem; opacity: 0.8;">ì‚¬ì—…ì„ ë§Œë“¤ê³  ìš´ì˜í•˜ë©° ê²½ì œ ì œêµ­ì„ ê±´ì„¤í•˜ì„¸ìš” (1ë§Œ ë¹„íŠ¸í¬ë ˆë”§)</div>
                        </div>
                        ${gameState.currentUser.role === 'entrepreneur' ? '<div style="margin-left: auto; color: var(--success);">í˜„ì¬ ì—­í• </div>' : ''}
                    </button>

                    <button onclick="confirmRoleChange('banker')" style="
                        padding: 20px; background: linear-gradient(135deg, #10b981, #059669);
                        color: white; border: none; border-radius: 12px; cursor: pointer;
                        display: flex; align-items: center; gap: 15px;
                        ${gameState.currentUser.role === 'banker' ? 'opacity: 0.5; cursor: not-allowed;' : ''}
                    ">
                        <div style="font-size: 2rem;">ğŸ¦</div>
                        <div style="text-align: left;">
                            <div style="font-size: 1.1rem; font-weight: bold;">ì€í–‰ê°€ <span style="color: #10b981; font-size: 0.8rem;">[ìµœì € ë‚œì´ë„]</span></div>
                            <div style="font-size: 0.9rem; opacity: 0.8;">ì€í–‰ì„ ìš´ì˜í•˜ê³  ê¸ˆìœµ ì„œë¹„ìŠ¤ë¥¼ ì œê³µí•˜ì„¸ìš” (100ì–µ ë¹„íŠ¸í¬ë ˆë”§)</div>
                        </div>
                        ${gameState.currentUser.role === 'banker' ? '<div style="margin-left: auto; color: var(--success);">í˜„ì¬ ì—­í• </div>' : ''}
                    </button>

                    <button onclick="confirmRoleChange('investor')" style="
                        padding: 20px; background: linear-gradient(135deg, #8b5cf6, #7c3aed);
                        color: white; border: none; border-radius: 12px; cursor: pointer;
                        display: flex; align-items: center; gap: 15px;
                        ${gameState.currentUser.role === 'investor' ? 'opacity: 0.5; cursor: not-allowed;' : ''}
                    ">
                        <div style="font-size: 2rem;">ğŸ“ˆ</div>
                        <div style="text-align: left;">
                            <div style="font-size: 1.1rem; font-weight: bold;">íˆ¬ìì <span style="color: #f59e0b; font-size: 0.8rem;">[ë†’ì€ ë‚œì´ë„]</span></div>
                            <div style="font-size: 0.9rem; opacity: 0.8;">ì£¼ì‹ê³¼ ìì‚°ì— íˆ¬ìí•˜ì—¬ ìˆ˜ìµì„ ì°½ì¶œí•˜ì„¸ìš” (1ë§Œ ë¹„íŠ¸í¬ë ˆë”§)</div>
                        </div>
                        ${gameState.currentUser.role === 'investor' ? '<div style="margin-left: auto; color: var(--success);">í˜„ì¬ ì—­í• </div>' : ''}
                    </button>

                    <button onclick="confirmRoleChange('worker')" style="
                        padding: 20px; background: linear-gradient(135deg, #f59e0b, #d97706);
                        color: white; border: none; border-radius: 12px; cursor: pointer;
                        display: flex; align-items: center; gap: 15px;
                        ${gameState.currentUser.role === 'worker' ? 'opacity: 0.5; cursor: not-allowed;' : ''}
                    ">
                        <div style="font-size: 2rem;">ğŸ‘·</div>
                        <div style="text-align: left;">
                            <div style="font-size: 1.1rem; font-weight: bold;">ì§ì¥ì¸ <span style="color: #fbbf24; font-size: 0.8rem;">[ë³´í†µ ë‚œì´ë„]</span></div>
                            <div style="font-size: 0.9rem; opacity: 0.8;">íšŒì‚¬ì—ì„œ ì¼í•˜ë©° ì•ˆì •ì ì¸ ìˆ˜ì…ì„ ì–»ìœ¼ì„¸ìš” (1ë§Œ ë¹„íŠ¸í¬ë ˆë”§)</div>
                        </div>
                        ${gameState.currentUser.role === 'worker' ? '<div style="margin-left: auto; color: var(--success);">í˜„ì¬ ì—­í• </div>' : ''}
                    </button>
                </div>

                <div style="text-align: center;">
                    <button onclick="showAccountMenu()" style="
                        padding: 10px 20px; border: 1px solid rgba(255,255,255,0.2);
                        background: rgba(255,255,255,0.05); color: #e2e8f0;
                        border-radius: 8px; cursor: pointer;
                    ">ì·¨ì†Œ</button>
                </div>
            `;
            
            showModal(modalContent);
        }

        // ì—­í•  ë³€ê²½ í™•ì¸
        function confirmRoleChange(newRole) {
            const roleNames = {
                'entrepreneur': 'ì‚¬ì—…ê°€',
                'banker': 'ì€í–‰ê°€', 
                'investor': 'íˆ¬ìì',
                'worker': 'ì§ì¥ì¸'
            };

            if (gameState.currentUser.role === newRole) {
                showNotification('ì´ë¯¸ ì„ íƒëœ ì—­í• ì…ë‹ˆë‹¤', 'warning');
                return;
            }

            const roleName = roleNames[newRole];
            
            if (confirm(`ì •ë§ ${roleName}ë¡œ ì—­í• ì„ ë³€ê²½í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\ní˜„ì¬ ê²Œì„ ë°ì´í„°ê°€ ì´ˆê¸°í™”ë˜ê³  ìƒˆë¡œ ì‹œì‘ë©ë‹ˆë‹¤.`)) {
                // í˜„ì¬ ì‚¬ìš©ì ì •ë³´ ë³´ì¡´ (ì´ë¦„, ì´ë©”ì¼ì€ ìœ ì§€)
                const username = gameState.currentUser.username;
                const email = gameState.currentUser.email;
                const id = gameState.currentUser.id;

                // ì—­í•  ë³€ê²½ ë° ë°ì´í„° ì´ˆê¸°í™”
                gameState.currentUser.role = newRole;
                gameState.selectedRole = newRole;

                // ì—­í• ë³„ ì´ˆê¸° ìê¸ˆ ì„¤ì •
                const initialBalance = {
                    'entrepreneur': 10000,
                    'banker': 10000000000, // 100ì–µ
                    'investor': 10000,
                    'worker': 10000
                };

                gameState.currentUser.game_balance = initialBalance[newRole];

                // roleData ì´ˆê¸°í™”
                initializeRoleData(newRole);

                // UI ì—…ë°ì´íŠ¸
                updateDisplay();
                updateUserDisplay();
                showRoleSpecificMenu();

                closeModal();
                showNotification(`ğŸ‰ ${roleName}ë¡œ ì—­í• ì´ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤! ìƒˆë¡œìš´ ì—¬ì •ì„ ì‹œì‘í•˜ì„¸ìš”!`, 'success');
            }
        }

        // ì—­í• ë³„ ë°ì´í„° ì´ˆê¸°í™”
        function initializeRoleData(role) {
            // roleData ì™„ì „ ì´ˆê¸°í™”
            gameState.roleData = {
                businesses: [],
                investments: [],
                workHistory: [],
                workStats: {
                    salary: 3000,
                    experience: 0,
                    position: 'ì‚¬ì›',
                    bonuses: 0
                },
                publicCompany: null,
                companyRating: {
                    creditRating: 'BBB',
                    reputation: 75,
                    esgScore: 50,
                    marketShare: 5.0
                },
                rdProjects: [],
                competitors: [],
                supplyChain: {
                    rawMaterials: [],
                    manufacturers: [],
                    distributors: [],
                    retailers: [],
                    contracts: [],
                    inventory: new Map(),
                    marketPrices: new Map()
                },
                workforce: {
                    workers: [],
                    jobMarket: [],
                    unions: [],
                    trainingPrograms: [],
                    satisfactionFactors: {
                        baseSalary: 100,
                        benefits: 50,
                        workEnvironment: 50,
                        growthOpportunity: 50
                    }
                }
            };

            // ì—­í• ë³„ ì´ˆê¸° ì„¤ì •
            if (role === 'entrepreneur') {
                initializeBusinessData();
                initializeMarketPrices();
            } else if (role === 'banker') {
                // ì€í–‰ê°€ì˜ ê²½ìš° ì€í–‰ ë°ì´í„° ì´ˆê¸°í™”
                if (gameState.gameData.banks.length === 0) {
                    gameState.gameData.banks.push({
                        id: Date.now(),
                        name: gameState.currentUser.username + ' ì€í–‰',
                        owner: gameState.currentUser.id,
                        totalDeposits: 0,
                        totalLoans: 0,
                        reserves: gameState.currentUser.game_balance,
                        interestRate: 0.05,
                        loanRate: 0.08,
                        creditRating: 'BBB',
                        branches: 1
                    });
                }
            } else if (role === 'investor') {
                // íˆ¬ììì˜ ê²½ìš° ê¸°ë³¸ íˆ¬ì í¬íŠ¸í´ë¦¬ì˜¤ ìƒì„±
                gameState.roleData.investments = [];
            } else if (role === 'worker') {
                // ì§ì¥ì¸ì˜ ê²½ìš° ê·¼ë¬´ í†µê³„ ì´ˆê¸°í™”
                gameState.roleData.workStats = {
                    salary: 3000,
                    experience: 0,
                    position: 'ì‚¬ì›',
                    bonuses: 0
                };
            }
        }

        // ì—­í• ë³„ ë©”ë‰´ í‘œì‹œ
        function showRoleSpecificMenu() {
            // ëª¨ë“  ì—­í• ì´ ëª¨ë“  ë©”ë‰´ì— ì ‘ê·¼ ê°€ëŠ¥í•˜ë„ë¡ ë³€ê²½
            document.getElementById('bankMenu').style.display = 'none';
            document.getElementById('investmentMenu').style.display = 'block'; // ëª¨ë“  ì—­í• ì´ íˆ¬ì ë©”ë‰´ ì‚¬ìš© ê°€ëŠ¥
            document.getElementById('workMenu').style.display = 'none';

            // ëª¨ë“  ì—­í• ì´ ì‚¬ì—…ê³¼ íˆ¬ì ë°ì´í„° ì´ˆê¸°í™”
            const role = gameState.currentUser.role;
            initializeBusinessData();
            initializeInvestmentData();
            
            if (role === 'banker') {
                document.getElementById('bankMenu').style.display = 'block';
            } else if (role === 'worker') {
                document.getElementById('workMenu').style.display = 'block';
            }

            // í˜„ì¬ ì„¹ì…˜ ì—…ë°ì´íŠ¸ (ê¸°ë³¸ì ìœ¼ë¡œ ì‚¬ì—… ì„¹ì…˜ í‘œì‹œ)
            showSection('business');
        }

        // ê³„ì • ì „í™˜
        function switchAccount() {
            if (confirm('ë‹¤ë¥¸ ê³„ì •ìœ¼ë¡œ ì „í™˜í•˜ì‹œê² ìŠµë‹ˆê¹Œ? í˜„ì¬ ê²Œì„ ë°ì´í„°ëŠ” ì €ì¥ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.')) {
                closeModal();
                logout();
            }
        }

        // ê²Œì„ í†µê³„ í‘œì‹œ
        function showGameStats() {
            const businesses = gameState.roleData?.businesses || [];
            const workers = gameState.roleData?.workforce?.workers || [];
            
            const modalContent = `
                <h2 style="text-align: center; margin-bottom: 30px; color: var(--primary);">ğŸ“Š ê²Œì„ í†µê³„</h2>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px;">
                    <!-- ì¬ì • í†µê³„ -->
                    <div style="background: rgba(34, 197, 94, 0.1); border: 1px solid rgba(34, 197, 94, 0.3); border-radius: 12px; padding: 15px;">
                        <h3 style="color: var(--success); margin: 0 0 15px 0;">ğŸ’° ì¬ì • í˜„í™©</h3>
                        <div style="display: grid; gap: 8px; font-size: 0.9rem;">
                            <div style="display: flex; justify-content: space-between;">
                                <span>í˜„ì¬ ì”ê³ :</span>
                                <span style="font-weight: bold;">${gameState.currentUser.game_balance.toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§</span>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span>ì´ ìì‚°:</span>
                                <span style="font-weight: bold;">${(gameState.currentUser.totalAssets || gameState.currentUser.game_balance).toLocaleString()} ë¹„íŠ¸í¬ë ˆë”§</span>
                            </div>
                        </div>
                    </div>

                    <!-- ì‚¬ì—… í†µê³„ -->
                    <div style="background: rgba(59, 130, 246, 0.1); border: 1px solid rgba(59, 130, 246, 0.3); border-radius: 12px; padding: 15px;">
                        <h3 style="color: var(--primary); margin: 0 0 15px 0;">ğŸ¢ ì‚¬ì—… í˜„í™©</h3>
                        <div style="display: grid; gap: 8px; font-size: 0.9rem;">
                            <div style="display: flex; justify-content: space-between;">
                                <span>ë³´ìœ  ì‚¬ì—…:</span>
                                <span style="font-weight: bold;">${businesses.length}ê°œ</span>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span>ì´ ì§ì›:</span>
                                <span style="font-weight: bold;">${workers.length}ëª…</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ì„±ì·¨ í†µê³„ -->
                <div style="background: rgba(168, 85, 247, 0.1); border: 1px solid rgba(168, 85, 247, 0.3); border-radius: 12px; padding: 15px; margin-bottom: 20px;">
                    <h3 style="color: #a855f7; margin: 0 0 15px 0;">ğŸ† ì„±ì·¨ í˜„í™©</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; font-size: 0.8rem;">
                        <div style="text-align: center; padding: 10px; background: rgba(255,255,255,0.05); border-radius: 8px;">
                            <div style="font-size: 1.2rem; margin-bottom: 5px;">${businesses.length >= 10 ? 'ğŸŒŸ' : businesses.length >= 5 ? 'â­' : businesses.length >= 1 ? 'ğŸŒ±' : 'â“'}</div>
                            <div>ì‚¬ì—…ê°€ ë“±ê¸‰</div>
                        </div>
                        <div style="text-align: center; padding: 10px; background: rgba(255,255,255,0.05); border-radius: 8px;">
                            <div style="font-size: 1.2rem; margin-bottom: 5px;">${workers.length >= 50 ? 'ğŸ­' : workers.length >= 20 ? 'ğŸ¢' : workers.length >= 5 ? 'ğŸª' : 'â“'}</div>
                            <div>ê³ ìš©ì£¼ ë“±ê¸‰</div>
                        </div>
                        <div style="text-align: center; padding: 10px; background: rgba(255,255,255,0.05); border-radius: 8px;">
                            <div style="font-size: 1.2rem; margin-bottom: 5px;">${gameState.currentUser.game_balance >= 1000000 ? 'ğŸ’' : gameState.currentUser.game_balance >= 100000 ? 'ğŸ’°' : gameState.currentUser.game_balance >= 10000 ? 'ğŸª™' : 'â“'}</div>
                            <div>ë¶€ì ë“±ê¸‰</div>
                        </div>
                    </div>
                </div>

                <div style="text-align: center;">
                    <button onclick="showAccountMenu()" style="
                        padding: 10px 20px; border: 1px solid rgba(255,255,255,0.2);
                        background: rgba(255,255,255,0.05); color: #e2e8f0;
                        border-radius: 8px; cursor: pointer;
                    ">ëŒì•„ê°€ê¸°</button>
                </div>
            `;
            
            showModal(modalContent);
        }

        // ë…¸ë™ì ê´€ë¦¬ ì‹œìŠ¤í…œì„ ë©”ì¸ ë©”ë‰´ì— ì¶”ê°€í•˜ê¸° ìœ„í•œ í•¨ìˆ˜
        function addWorkforceButton() {
            // ì´ë¯¸ ë²„íŠ¼ì´ ìˆëŠ”ì§€ í™•ì¸
            if (document.getElementById('workforceButton')) return;
            
            const businessMenu = document.querySelector('.business-menu');
            if (businessMenu) {
                const workforceButton = document.createElement('button');
                workforceButton.id = 'workforceButton';
                workforceButton.className = 'btn';
                workforceButton.innerHTML = 'ğŸ‘¥ ë…¸ë™ì ê´€ë¦¬';
                workforceButton.onclick = showWorkforceManagement;
                workforceButton.style.marginTop = '10px';
                businessMenu.appendChild(workforceButton);
            }
        }

        // ë°ì´í„° ì˜ì†ì„± ì‹œìŠ¤í…œ
        function saveGameState() {
            try {
                // ì¤‘ìš”í•œ ê²Œì„ ìƒíƒœë§Œ ì €ì¥ (ë¯¼ê°í•œ ì •ë³´ ì œì™¸)
                const saveData = {
                    currentUser: gameState.currentUser,
                    selectedRole: gameState.selectedRole,
                    roleData: gameState.roleData,
                    economy: gameState.economy,
                    bankSettings: gameState.bankSettings,
                    landMarket: gameState.landMarket,
                    cryptos: gameState.cryptos,
                    p2pMarket: gameState.p2pMarket,
                    laborMarket: gameState.laborMarket,
                    resourceSystem: gameState.resourceSystem ? {
                        resources: Object.fromEntries(gameState.resourceSystem.resources),
                        scarcityEffects: gameState.resourceSystem.scarcityEffects
                    } : null,
                    countrySystem: gameState.countrySystem,
                    lastSaved: Date.now()
                };
                
                localStorage.setItem('economyGameSave', JSON.stringify(saveData));
                localStorage.setItem('saveTimestamp', Date.now().toString());
                console.log('ê²Œì„ ìƒíƒœ ì €ì¥ ì™„ë£Œ');
                return true;
            } catch (error) {
                console.error('ê²Œì„ ì €ì¥ ì‹¤íŒ¨:', error);
                showNotification('âŒ ê²Œì„ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤', 'error');
                return false;
            }
        }

        function loadGameState() {
            try {
                const saveData = localStorage.getItem('economyGameSave');
                if (!saveData) return false;

                const parsedData = JSON.parse(saveData);
                
                // ê²Œì„ ìƒíƒœ ë³µì›
                if (parsedData.currentUser) gameState.currentUser = parsedData.currentUser;
                if (parsedData.selectedRole) gameState.selectedRole = parsedData.selectedRole;
                if (parsedData.roleData) gameState.roleData = parsedData.roleData;
                if (parsedData.economy) gameState.economy = { ...gameState.economy, ...parsedData.economy };
                if (parsedData.bankSettings) gameState.bankSettings = { ...gameState.bankSettings, ...parsedData.bankSettings };
                if (parsedData.landMarket) gameState.landMarket = { ...gameState.landMarket, ...parsedData.landMarket };
                if (parsedData.cryptos) gameState.cryptos = parsedData.cryptos;
                if (parsedData.p2pMarket) gameState.p2pMarket = parsedData.p2pMarket;
                if (parsedData.laborMarket) gameState.laborMarket = parsedData.laborMarket;
                
                // ìì› ì‹œìŠ¤í…œ ë³µì› (Map ê°ì²´ ë³µì›)
                if (parsedData.resourceSystem) {
                    gameState.resourceSystem = {
                        ...gameState.resourceSystem,
                        resources: new Map(Object.entries(parsedData.resourceSystem.resources)),
                        scarcityEffects: parsedData.resourceSystem.scarcityEffects
                    };
                }
                
                if (parsedData.countrySystem) gameState.countrySystem = parsedData.countrySystem;

                const lastSaved = new Date(parsedData.lastSaved);
                console.log(`ê²Œì„ ìƒíƒœ ë¡œë“œ ì™„ë£Œ (ë§ˆì§€ë§‰ ì €ì¥: ${lastSaved.toLocaleString()})`);
                showNotification('âœ… ì €ì¥ëœ ê²Œì„ì„ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤', 'success');
                
                // UI ì—…ë°ì´íŠ¸
                updateDisplay();
                updateEconomyDisplay();
                if (gameState.resourceSystem) updateResourceDisplay();
                if (gameState.countrySystem) updateCountryDisplay();
                
                return true;
            } catch (error) {
                console.error('ê²Œì„ ë¡œë“œ ì‹¤íŒ¨:', error);
                showNotification('âŒ ì €ì¥ëœ ê²Œì„ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤', 'error');
                return false;
            }
        }

        function autoSaveGame() {
            if (gameState.currentUser && !gameState.isDemo) {
                saveGameState();
            }
        }

        function resetGameData() {
            if (confirm('ì •ë§ë¡œ ëª¨ë“  ê²Œì„ ë°ì´í„°ë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) {
                localStorage.removeItem('economyGameSave');
                localStorage.removeItem('saveTimestamp');
                location.reload(); // í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ìœ¼ë¡œ ì´ˆê¸° ìƒíƒœë¡œ ë³µì›
            }
        }

        function exportGameData() {
            try {
                const saveData = localStorage.getItem('economyGameSave');
                if (!saveData) {
                    showNotification('âŒ ë‚´ë³´ë‚¼ ì €ì¥ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤', 'error');
                    return;
                }

                const dataBlob = new Blob([saveData], { type: 'application/json' });
                const url = URL.createObjectURL(dataBlob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `economy_game_save_${new Date().toISOString().slice(0, 10)}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                showNotification('âœ… ê²Œì„ ë°ì´í„°ê°€ ë‚´ë³´ë‚´ê¸° ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
            } catch (error) {
                console.error('ë°ì´í„° ë‚´ë³´ë‚´ê¸° ì‹¤íŒ¨:', error);
                showNotification('âŒ ë°ì´í„° ë‚´ë³´ë‚´ê¸°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤', 'error');
            }
        }

        function importGameData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(event) {
                const file = event.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const importedData = JSON.parse(e.target.result);
                        
                        // ë°ì´í„° ìœ íš¨ì„± ê²€ì‚¬
                        if (!importedData.currentUser || !importedData.selectedRole) {
                            throw new Error('ìœ íš¨í•˜ì§€ ì•Šì€ ì €ì¥ íŒŒì¼ì…ë‹ˆë‹¤');
                        }

                        localStorage.setItem('economyGameSave', JSON.stringify(importedData));
                        showNotification('âœ… ê²Œì„ ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ì™„ë£Œ! í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•©ë‹ˆë‹¤.', 'success');
                        
                        setTimeout(() => {
                            location.reload();
                        }, 2000);
                        
                    } catch (error) {
                        console.error('ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨:', error);
                        showNotification('âŒ ìœ íš¨í•˜ì§€ ì•Šì€ ì €ì¥ íŒŒì¼ì…ë‹ˆë‹¤', 'error');
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        }

        // Supabase ë°ì´í„° ì €ì¥/ë¡œë“œ ì‹œìŠ¤í…œ
        async function saveGameStateToSupabase() {
            if (!supabaseClient || gameState.isDemo) {
                console.log('Supabase í´ë¼ì´ì–¸íŠ¸ê°€ ì—†ê±°ë‚˜ ë°ëª¨ ëª¨ë“œì…ë‹ˆë‹¤');
                return false;
            }

            try {
                const saveData = {
                    user_id: gameState.currentUser.email || gameState.currentUser.username,
                    username: gameState.currentUser.username,
                    role: gameState.selectedRole,
                    game_data: {
                        currentUser: gameState.currentUser,
                        selectedRole: gameState.selectedRole,
                        roleData: gameState.roleData,
                        economy: gameState.economy,
                        bankSettings: gameState.bankSettings,
                        landMarket: gameState.landMarket,
                        cryptos: gameState.cryptos,
                        p2pMarket: gameState.p2pMarket,
                        laborMarket: gameState.laborMarket,
                        resourceSystem: gameState.resourceSystem ? {
                            resources: Object.fromEntries(gameState.resourceSystem.resources),
                            scarcityEffects: gameState.resourceSystem.scarcityEffects
                        } : null,
                        countrySystem: gameState.countrySystem
                    },
                    last_saved: new Date().toISOString()
                };

                // ê¸°ì¡´ ë°ì´í„° í™•ì¸
                const { data: existingData } = await supabaseClient
                    .from('game_saves')
                    .select('id')
                    .eq('user_id', saveData.user_id)
                    .single();

                let result;
                if (existingData) {
                    // ì—…ë°ì´íŠ¸
                    result = await supabaseClient
                        .from('game_saves')
                        .update(saveData)
                        .eq('user_id', saveData.user_id);
                } else {
                    // ìƒˆë¡œ ìƒì„±
                    result = await supabaseClient
                        .from('game_saves')
                        .insert([saveData]);
                }

                if (result.error) {
                    throw result.error;
                }

                console.log('Supabaseì— ê²Œì„ ìƒíƒœ ì €ì¥ ì™„ë£Œ');
                showNotification('â˜ï¸ í´ë¼ìš°ë“œì— ì €ì¥ ì™„ë£Œ!', 'success');
                return true;
            } catch (error) {
                console.error('Supabase ì €ì¥ ì‹¤íŒ¨:', error);
                showNotification('âŒ í´ë¼ìš°ë“œ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤', 'error');
                return false;
            }
        }

        async function loadGameStateFromSupabase() {
            if (!supabaseClient) {
                console.log('Supabase í´ë¼ì´ì–¸íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤');
                return false;
            }

            try {
                const userIdentifier = gameState.currentUser?.email || gameState.currentUser?.username;
                if (!userIdentifier) {
                    console.log('ì‚¬ìš©ì ì‹ë³„ìê°€ ì—†ìŠµë‹ˆë‹¤');
                    return false;
                }

                const { data, error } = await supabaseClient
                    .from('game_saves')
                    .select('*')
                    .eq('user_id', userIdentifier)
                    .single();

                if (error) {
                    if (error.code === 'PGRST116') {
                        console.log('ì €ì¥ëœ ê²Œì„ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤');
                        return false;
                    }
                    throw error;
                }

                if (data && data.game_data) {
                    const gameData = data.game_data;
                    
                    // ê²Œì„ ìƒíƒœ ë³µì›
                    if (gameData.currentUser) gameState.currentUser = gameData.currentUser;
                    if (gameData.selectedRole) gameState.selectedRole = gameData.selectedRole;
                    if (gameData.roleData) gameState.roleData = gameData.roleData;
                    if (gameData.economy) gameState.economy = { ...gameState.economy, ...gameData.economy };
                    if (gameData.bankSettings) gameState.bankSettings = { ...gameState.bankSettings, ...gameData.bankSettings };
                    if (gameData.landMarket) gameState.landMarket = { ...gameState.landMarket, ...gameData.landMarket };
                    if (gameData.cryptos) gameState.cryptos = gameData.cryptos;
                    if (gameData.p2pMarket) gameState.p2pMarket = gameData.p2pMarket;
                    if (gameData.laborMarket) gameState.laborMarket = gameData.laborMarket;
                    
                    // ìì› ì‹œìŠ¤í…œ ë³µì›
                    if (gameData.resourceSystem) {
                        gameState.resourceSystem = {
                            ...gameState.resourceSystem,
                            resources: new Map(Object.entries(gameData.resourceSystem.resources)),
                            scarcityEffects: gameData.resourceSystem.scarcityEffects
                        };
                    }
                    
                    if (gameData.countrySystem) gameState.countrySystem = gameData.countrySystem;

                    const lastSaved = new Date(data.last_saved);
                    console.log(`Supabaseì—ì„œ ê²Œì„ ìƒíƒœ ë¡œë“œ ì™„ë£Œ (ë§ˆì§€ë§‰ ì €ì¥: ${lastSaved.toLocaleString()})`);
                    showNotification('â˜ï¸ í´ë¼ìš°ë“œì—ì„œ ê²Œì„ì„ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤!', 'success');
                    
                    // UI ì—…ë°ì´íŠ¸
                    updateDisplay();
                    updateEconomyDisplay();
                    if (gameState.resourceSystem) updateResourceDisplay();
                    if (gameState.countrySystem) updateCountryDisplay();
                    
                    return true;
                }
                
                return false;
            } catch (error) {
                console.error('Supabase ë¡œë“œ ì‹¤íŒ¨:', error);
                showNotification('âŒ í´ë¼ìš°ë“œì—ì„œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤', 'error');
                return false;
            }
        }

        async function deleteGameStateFromSupabase() {
            if (!supabaseClient || gameState.isDemo) return false;

            try {
                const userIdentifier = gameState.currentUser?.email || gameState.currentUser?.username;
                if (!userIdentifier) return false;

                const { error } = await supabaseClient
                    .from('game_saves')
                    .delete()
                    .eq('user_id', userIdentifier);

                if (error) throw error;

                console.log('Supabaseì—ì„œ ê²Œì„ ë°ì´í„° ì‚­ì œ ì™„ë£Œ');
                showNotification('â˜ï¸ í´ë¼ìš°ë“œ ë°ì´í„°ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤', 'info');
                return true;
            } catch (error) {
                console.error('Supabase ì‚­ì œ ì‹¤íŒ¨:', error);
                showNotification('âŒ í´ë¼ìš°ë“œ ë°ì´í„° ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤', 'error');
                return false;
            }
        }

        // ìë™ ì €ì¥ ì‹œìŠ¤í…œ (ë¡œì»¬ + í´ë¼ìš°ë“œ)
        async function autoSaveGame() {
            if (gameState.currentUser && !gameState.isDemo) {
                // ë¡œì»¬ ì €ì¥
                const localSaved = saveGameState();
                
                // í´ë¼ìš°ë“œ ì €ì¥ (Supabase ì—°ê²°ë˜ì–´ ìˆìœ¼ë©´)
                if (supabaseClient) {
                    await saveGameStateToSupabase();
                }
            }
        }

        // ìë™ ì €ì¥ ê°„ê²© ì„¤ì • (5ë¶„ë§ˆë‹¤)
        let autoSaveInterval;
        
        function startAutoSave() {
            if (autoSaveInterval) clearInterval(autoSaveInterval);
            autoSaveInterval = setInterval(autoSaveGame, 5 * 60 * 1000); // 5ë¶„ë§ˆë‹¤
        }

        function stopAutoSave() {
            if (autoSaveInterval) {
                clearInterval(autoSaveInterval);
                autoSaveInterval = null;
            }
        }

        // í˜ì´ì§€ë¥¼ ë– ë‚  ë•Œ ìë™ ì €ì¥
        window.addEventListener('beforeunload', function(e) {
            if (gameState.currentUser && !gameState.isDemo) {
                autoSaveGame();
            }
        });

        // ë¹„í™œì„±í™” ì‹œì—ë„ ì €ì¥
        document.addEventListener('visibilitychange', function() {
            if (document.visibilityState === 'hidden' && gameState.currentUser && !gameState.isDemo) {
                autoSaveGame();
            }
        });

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì²´í¬
        window.onload = function() {
            // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
            setupEventListeners();
            
            // ì €ì¥ëœ ê²Œì„ ë°ì´í„° ë¡œë“œ ì‹œë„
            loadGameState();
            
            const savedUrl = localStorage.getItem('supabaseUrl');
            const savedKey = localStorage.getItem('supabaseKey');
            
            if (savedUrl && savedKey) {
                try {
                    const { createClient } = supabase;
                    supabaseClient = createClient(savedUrl, savedKey);
                    
                    document.getElementById('setupScreen').style.display = 'none';
                    document.getElementById('loginScreen').style.display = 'flex';
                } catch (error) {
                    console.log('Supabase ìë™ ì—°ê²° ì‹¤íŒ¨, ë°ëª¨ ëª¨ë“œ ì‚¬ìš© ê°€ëŠ¥');
                }
            }
        };
    </script>
</body>
</html>